(function(){if(!window.WL){var Wf="download",e="interface_method",pc="WL.Internal.jsonp.",dd=2000,Tb="body",v="callback",J="code",hf="element",Rb="error",Be="error_description",Mb="logging",jf="tracing",G="message",db="method",Ke="file_input",ue="stream_input",Ue="file_name",Ce="file_output",Le="overwrite",hb="path",pd="pretty",tf="result",uf="status",Rc="return_ssl_resources",Ve="success",vf="error",Kc="suppress_redirects",ee="suppress_response_codes",x="x_http_live_library",Sb=0,Bb=1,i="access_token",bg="appstate",Wb="authentication_token",lb="client_id",dg="display",lg="code",nb="error",Xb="error_description",gc="expires",Yb="expires_in",ig="locale",Df="redirect_uri",rf="response_type",Zb="request_ts",Dd="resource_id",kc="scope",eg="session",sf="secure_cookie",Pd="state",jg="status",Lf=[i,Wb,kc,Yb,gc],Gd="connected",Ff="notConnected",Xf="unchecked",hg="unknown",Kd="expiring",gg="expired",Gf="live-sdk-upload",lf="live-sdk-download",Qd="appId",Pf="channelUrl",cg="wl_auth",Qf="wl_upload",Zf="page",Rf="touch",Yf="none",Pb="none",wf="auth.login",mf="auth.logout",xb="auth.sessionChange",ne="auth.statusChange",Od="wl.log",Me="access_denied",Gc="connection_failed",Ye="invalid_cookie",Tc="invalid_request",Qb="request_canceled",D="request_failed",xd="timed_out",af="unknown_user",Ne="user_canceled",ke="METHOD: Failed to get the required user permission to perform this operation.",Ac="The request could not be completed due to browser issues.",vb="The request could not be completed due to browser limitations.",Nb="METHOD: The operation has been canceled.",he="The 'wl_auth' cookie is not valid.",fe="The 'wl_auth' cookie has been modified incorrectly. Ensure that the redirect URI only modifies sub-keys for values received from the OAuth endpoint.",Zd="The 'wl_auth' cookie has multiple values. Ensure that the redirect URI specifies a cookie domain and path when setting cookies.",Lc="METHOD: The input property 'PARAM' does not reference a valid DOM element.",Yc="METHOD: An exception was received for EVENT. Detail: MESSAGE",Mc="METHOD: The WL object must be initialized with WL.init() prior to invoking this method.",Ab="A connection to the server could not be established.",de="The user could not be identified.",me="The pending login request has been canceled.",be="Logging out the user is not supported in current session because the user is logged in with a Microsoft account on this computer. To logout, the user may quit the app or log out from the computer.",wb="METHOD: The input value for parameter/property 'PARAM' is not valid.",Bc="METHOD: The input parameter/property 'PARAM' must be included.",rc="METHOD: The type of the provided value for the input parameter/property 'PARAM' is not valid.",T="METHOD: There is a pending METHOD request, the current call will be ignored.",Xd=T.replace(/METHOD/g,"WL.login"),mc=T.replace(/METHOD/g,"WL.fileDialog"),Yd=T.replace(/METHOD/g,"WL.upload"),ce="METHOD: The input property 'redirect_uri' is required if the value of the 'response_type' property is 'code'.",Wd="WL.init: The redirect_uri value should be the same as the value of 'Redirect Domain' of your registered app. It must begin with 'http://' or 'https://'.",ae="METHOD: The api call is not supported on this platform.",Vd="WL.init: The response_type value 'code' is not supported on this platform.",Ze="METHOD: The input property 'redirect_uri' must use https: to match the scheme of the current page.",le="The auth request is timed out.",re="The popup is closed without receiving consent.",cb=0,yc=1,yb=2,id=3,ud="GET",zf="POST",If="PUT",cf="DELETE",xf="COPY",yf="MOVE",oe=30000,mg="METHOD",m="onSuccess",n="onError",s="onProgress",Tf="redirect_type",df="auth",De="upload",ef="code",Qe="token",M="https:",ec="http:",Id="wl.signin",Ad="wl.skydrive",Vc="wl.skydrive_update",pf=/\s|,/,bc="boolean",Rd="dom",c="function",fc="number",b="string",B="object",ff="string_or_array",Vb="undefined",Fd="name",eb="element",Nf="brand",Vf="type",xe="sign_in_text",se="sign_out_text",A="theme",Re="onloggedin",Ge="onloggedout",fb="onerror",gf="messenger",Bf="hotmail",qf="skydrive",Cf="windows",Fe="windowslive",Uf="none",jc="signin",Ae=jc,Ie="login",te="connect",ze="custom",Gb="blue",X="white",He="dark",ye="light",Kf="id",Cd="auth_server",o="apiservice_uri",p="skydrive_uri",g="sdk_root",Sd="wl_trace",d={subscribe:function(a,b){S("Subscribe "+a);var c=d.getHandlers(a);c.push(b)},unsubscribe:function(c,f){S("Unsubscribe "+c);var b=d.getHandlers(c),e=[];if(f!=null){var g=false;for(var a=0;a<b.length;a++)if(g||b[a]!=f)e.push(b[a]);else g=true}d._eHandlers[c]=e},getHandlers:function(b){if(!d._eHandlers)d._eHandlers={};var a=d._eHandlers[b];if(a==null)d._eHandlers[b]=a=[];return a},notify:function(c,e){S("Notify "+c);var b=d.getHandlers(c);for(var a=0;a<b.length;a++)b[a](e)}},a={_status:Sb,_statusRequests:[],_rpsAuth:false};a.appInit=function(c){if(a._status==Bb){var e=a._session.getNormalStatus();return Db("WL.init",true,c.callback,e)}var b=WL[g];if(b){if(b.charAt(b.length-1)!=="/")b+="/";a[g]=b}var d=c[Mb];if(d===false)a._logEnabled=d;if(a.testInit)a.testInit(c);a._status=Bb;return Dc(c)};a.onloadInit=function(){wd();zd()};function gb(b){if(a._status===Sb)throw new Error(Mc.replace("METHOD",b))}function Nd(){return WL.Internal.tApp||a}a.api=function(a){gb("WL.api");var c=a[Tb];if(c){a=w(jb(c),a);delete a[Tb]}var b=a[db];a[db]=(b!=null?mb(b):ud).toUpperCase();return (new hc(a)).execute()};var ad=function(){var b=a.api.lastId,c;b=b===undefined?1:b+1;c="WLAPI_REQ_"+b+"_"+(new Date).getTime();a.api.lastId=b;return c},hc=function(b){var c=this;c._properties=b;c._completed=false;c._id=ad();b[pd]=false;b[Rc]=a._isHttps;b[x]=a[x];var d=b[hb];c._url=qd()+(d.charAt(0)==="/"?d.substring(1):d);c._promise=new l("WL.api",null,null)};hc.prototype={execute:function(){nd(this);return this._promise},onCompleted:function(a){if(this._completed)return;this._completed=true;z(this._properties.callback,a,true);if(a[nb])this._promise[n](a);else this._promise[m](a)}};function Lb(e,c,a,d){a=a?mb(a):"";var b=a!==""?rd(a):null;if(b===null){b={};if(c/100!==2)b[Rb]=kd(c,d)}e.onCompleted(b)}function kd(c,b){var a={};a[J]=D;a[G]=b||Ab;return a}function bd(){var c=null;if(!a._rpsAuth){var b=Nd()._session.getStatus();if(b.status===Kd||b.status===Gd)c=b.session[i]}return c}function jb(i){var c={};for(var b in i){var a=i[b],j=typeof a;if(a instanceof Array)for(var d=0;d<a.length;d++){var f=a[d],l=typeof f;if(j==B&&!(a instanceof Date)){var h=jb(f);for(var e in h)c[b+"."+d+"."+e]=h[e]}else c[b+"."+d]=f}else if(j==B&&!(a instanceof Date)){var k=jb(a);for(var g in k)c[b+"."+g]=k[g]}else c[b]=a}return c}function Nc(c,b){C(b.message);var a=c[fb];if(a)O(function(){error=W("WL.ui","WL.ui",b),a(error)})}function Ub(){return a[g]}function Hd(){return Ub()+"images"}var Ee=new RegExp("^\\w+\\.\\w+:\\w+\\|\\w+:([\\d\\w]+\\!\\d+)$");function mb(a){return a.replace(/^\s+|\s+$/g,"")}function ub(a,b){if(a&&b)return a.toLowerCase()===b.toLowerCase();return a===b}function Jb(a){return a==null||a===""}function w(b,d){var c=d||{};if(b!=null)for(var a in b)c[a]=b[a];return c}function jd(e,d,b){var c=w(e,d);for(var a=0;a<b.length;a++)delete c[b[a]];return c}function ic(a){return Array.prototype.slice.call(a)}function q(b,a){return function(){if(typeof a===c)return a.apply(b,arguments)}}function lc(a,e){a="[WL]"+a;var b=window.console;if(b&&b.log)switch(e){case "warning":b.warn(a);break;case "error":b.error(a);break;default:b.log(a)}var d=window.opera;if(d)d.postError(a);var c=window.debugService;if(c)c.trace(a)}function S(b){if(a._traceEnabled)lc(b)}function pb(b,c){if(a._logEnabled||a._traceEnabled)lc(b,c);d.notify(Od,b)}if(window.WL&&WL.Internal){WL.Internal.trace=S;WL.Internal.log=pb}function C(a){pb(a,"error")}function Ib(b){var a=document.createElement(b);a.style.position="absolute";a.style.top="-1000px";a.style.width="300px";a.style.height="300px";a.style.visibility="hidden";return a}function Sc(){var a=null;while(a==null){a="wl_"+Math.floor(Math.random()*1024*1024);if(K(a)!=null)a=null}return a}function K(a){return document.getElementById(a)}function Ud(a){w(ob(a),this)}Ud.prototype={toString:function(){var a=this,b=(a.scheme!=""?a.scheme+"//":"")+a.host+(a.port!=""?":"+a.port:"")+a.path;return b},resolve:function(){var a=this;if(a.scheme==""){var b=window.location.port,c=window.location.host;a.scheme=window.location.protocol;a.host=c.split(":")[0];a.port=b!=null?b:"";if(a.path.charAt(0)!="/")a.path=ed(a.host,window.location.href,a.path)}}};function ob(c){var e=c.indexOf(M)==0?M:c.indexOf(ec)==0?ec:"",h="",i="",f;if(e!="")var b=c.substring(e.length+2),a=b.indexOf("/"),g=a>0?b.substring(0,a):b,d=g.split(":"),h=d[0],i=d.length>1?d[1]:"",f=a>0?b.substring(a):"";else f=c;return {scheme:e,host:h,port:i,path:f}}function Ed(a){return ob(a.toLowerCase()).host}function ed(e,b,h){var d=function(a,c){charIdx=b.indexOf(c);a=charIdx>0?a.substring(0,charIdx):a;return a};b=d(d(b,"?"),"#");var f=b.indexOf(e),a=b.substring(f+e.length),g=a.indexOf("/"),c=a.lastIndexOf("/");a=c>=0?a.substring(g,c):a;return a+"/"+h}function z(a,b,d,c){if(a!=null){if(c)b[Pd]=c;if(d)a(b);else O(function(){a(b)})}}function rd(a){if(window.JSON)return JSON.parse(a);else return eval("("+a+")")}function Td(b,c){var d=b.length;for(var a=0;a<d;a++)c(b[a])}function u(d,c){var a={},b={};a[J]=d,a[G]=c;b[Rb]=a;return b}function W(a,b,c){return u(D,Yc.replace("METHOD",a).replace("EVENT",b).replace("MESSAGE",c.message))}function Qc(b){var a=b.split(".");return a[0]+"."+a[1]}function O(a,b){if(window.wlUnitTests)wlUnitTests.delayInvoke(a);else window.setTimeout(a,b||1)}function wd(){var b=yd(navigator.userAgent,document.documentMode),c=a[x];a._browser=b;a[x]=c.replace("DEVICE",b.device)}function yd(a,e){a=a.toLowerCase();var c="other",b={"firefox":/firefox/.test(a),"firefox1.5":/firefox\/1\.5/.test(a),"firefox2":/firefox\/2/.test(a),"firefox3":/firefox\/3/.test(a),"firefox4":/firefox\/4/.test(a),"ie":(/msie/.test(a)||/trident/.test(a))&&!/opera/.test(a),"ie6":false,"ie7":false,"ie8":false,"ie9":false,"ie10":false,"ie11":false,"opera":/opera/.test(a),"webkit":/webkit/.test(a),"chrome":/chrome/.test(a),"mobile":/mobile/.test(a)||/phone/.test(a)};if(b["ie"]){var d=0;if(e)d=e;else if(/msie 7/.test(a))d=7;d=Math.min(11,Math.max(d,6));c="ie"+d;b[c]=true}else if(b.firefox)c="firefox";else if(b.chrome)c="chrome";else if(b.webkit)c="webkit";else if(b.opera)c="opera";if(b.mobile)c+="mobile";b.device=c;return b}function Eb(e,c){var f=c!=null?c:{};if(e!=null){var d=e.split("&");for(var b=0;b<d.length;b++){var a=d[b].split("=");if(a.length==2)f[decodeURIComponent(a[0])]=decodeURIComponent(a[1])}}return f}function fd(b){var a="";if(b!=null)for(var c in b){var d=a.length==0?"":"&",e=b[c];a+=d+encodeURIComponent(c)+"="+encodeURIComponent(gd(e))}return a}function gd(a){if(a instanceof Date){var b=function(a,b){switch(b){case 2:return a<10?"0"+a:a;case 3:return (a<10?"00":a<100?"0":"")+a}};return a.getUTCFullYear()+"-"+b(a.getUTCMonth()+1,2)+"-"+b(a.getUTCDate(),2)+"T"+b(a.getUTCHours(),2)+":"+b(a.getUTCMinutes(),2)+":"+b(a.getUTCSeconds(),2)+"."+b(a.getUTCMilliseconds(),3)+"Z"}return ""+a}function od(b){var d=b.indexOf("?")+1,c=b.indexOf("#")+1,a={};if(d>0){var e=c>d?c-1:b.length;a=Eb(b.substring(d,e),a)}if(c>0)a=Eb(b.substring(c),a);return a}function Hb(a,b){return a+(a.indexOf("?")<0?"?":"&")+fd(b)}var tb={name:v,type:c,optional:true},ie={name:v,type:c,optional:false};function Bd(a,c,d){if(a instanceof Array)for(var b=0;b<a.length;b++)ac(a[b],c[b],d);else ac(a,c,d)}function ac(c,a,b){Ob(c,a,b);if(a.type==="properties")y(c,a.properties,b)}function Ob(g,f,d){var e=f.name,a=typeof g,h=f.type;if(a==="undefined"||g==null)if(f.optional)return;else throw zb(e,d);switch(h){case "string":if(a!==b)throw t(e,d);if(!f.optional&&mb(g)==="")throw zb(e,d);break;case "properties":if(a!=B)throw t(e,d);break;case "function":if(a!=c)throw t(a,d);break;case "dom":if(a==b){if(K(g)==null)throw new Error(Lc.replace("METHOD",d).replace("PARAM",e))}else if(a!=B)throw t(e,d);break;case "string_or_array":if(a!==b&&!(g instanceof Array))throw t(a,d);break;default:if(a!==h)throw t(e,d)}if(f.allowedValues!=null)cd(g,f.allowedValues,f.caseSensitive,e,d)}function y(g,c,f){var d=g||{};for(var b=0;b<c.length;b++){var a=c[b],e=d[a.name]||d[a.altName];Ob(e,a,f)}}function cd(d,a,e,f,h){var g=typeof a[0]===b;for(var c=0;c<a.length;c++)if(g&&!e){if(d.toLowerCase()===a[c].toLowerCase())return}else if(d===a[c])return;throw Fc(f,h)}function t(a,b){return new Error(rc.replace("METHOD",b).replace("PARAM",a))}function zb(a,b){return new Error(Bc.replace("METHOD",b).replace("PARAM",a))}function Fc(c,d,a){var b=wb.replace("METHOD",d).replace("PARAM",c);if(typeof a!==Vb)b+=" "+a;return new Error(b)}function bb(j,i){var g=ic(j),a=null,b=null;for(var f=0;f<g.length;f++){var d=g[f],h=typeof d;if(h===B&&a===null)a=w(d);else if(h===c&&b===null)b=d}a=a||{};if(b)a.callback=b;a[e]=i;return a}function Jc(a,b){var c=W(a,a,b);C(b.message);return Db(a,false,null,c)}var l=function(b,c,a){this._name=b;this._op=c;this._uplinkPromise=a;this._isCompleted=false;this._listeners=[]};l.prototype={then:function(d,e,c){var b=new l(null,null,this),a={};a[m]=d;a[n]=e;a[s]=c;a.chainedPromise=b;this._listeners.push(a);return b},cancel:function(){if(this._isCompleted)return;if(this._uplinkPromise&&!this._uplinkPromise._isCompleted)this._uplinkPromise.cancel();else{var a=this._op?this._op.cancel:null;if(typeof a===c)this._op.cancel();else this.onError(u(Qb,Nb.replace("METHOD",this._getName())))}},_getName:function(){if(this._name)return this._name;if(this._op&&typeof this._op._getName===c)return this._op._getName();if(this._uplinkPromise)return this._uplinkPromise._getName();return ""},_onEvent:function(b,a){if(this._isCompleted)return;this._isCompleted=a!==s;this._notify(b,a)},_notify:function(b,a){var c=this;Td(this._listeners,function(g){var h=g[a],d=g.chainedPromise,f=a!==s;if(h)try{var e=h.apply(g,b);if(f&&e&&e.then){d._op=e;e.then(function(a){d[m](a)},function(a){d[n](a)},function(a){d[s](a)})}}catch(i){if(f)d.onError(W(c._getName(),a,i))}else if(f)d[a].apply(d,b)})}};l.prototype[m]=function(){this._onEvent(arguments,m)};l.prototype[n]=function(){this._onEvent(arguments,n)};l.prototype[s]=function(){this._onEvent(arguments,s)};function Db(f,e,b,g){var a=new l(f,null,null),d=e?m:n;if(typeof b===c)a.then(function(a){b(a)});O(function(){a[d](g)});return a}var Lf=[i,Wb,kc,Yb,gc,Zb,nb,Xb],Ef="refresh_type",Je="app",Se="ms",Te="response_method",pe="url",ge="cookie",E="onanalytics",We="login",je="loginstatus",Ec="file_dialog",Oe="auth.response",f="mode",r="open",sb="save",V="read",U="readwrite",rb="resourceType";FILEDIALOG_PARAM_RESOURCETYPE_FILE="file";FILEDIALOG_PARAM_RESOURCETYPE_FOLDER="folder";FILEDIALOG_PARAM_SELECT="select",(FILEDIALOG_PARAM_SELECT_SINGLE="single",(FILEDIALOG_PARAM_SELECT_MULTI="multi",(FILEDIALOG_PARAM_PERMISSION="permission",(FILEDIALOG_PARAM_PERMISSION_ONETIME="onetime",(FILEDIALOG_PARAM_LIGHTBOX="lightbox",(FILEDIALOG_PARAM_LIGHTBOX_GREY="grey",(FILEDIALOG_PARAM_LIGHTBOX_TRANSPARENT="transparent",(FILEDIALOG_PARAM_LIGHTBOX_WHITE="white",(FILEDIALOG_PARAM_LOADING_TIMEOUT="loading_timeout",FILEDIALOG_PARAM_ONSELECTED="onselected")))))))));var Uc="auth",wc="rps",uc="oauth",xc="v",nc="1",oc="2",Hc="domain",Cc="livesdk",Zc="mkt",qb="pickerscript",tc="onPickerComplete",sc="updateToken",F="WL.fileDialog",Md=27,H="skydrivepicker",vc="Loading SkyDrive picker is timed out.";window.WL={};WL.Internal={};WL.init=function(d){try{var c=w(d);Bd(c,{name:"properties",type:"properties",optional:false,properties:[{name:lb,altName:Qd,type:b,optional:false},{name:Mb,type:bc,optional:true}]},"WL.init");a.appInit(c)}catch(e){C(e.message)}};WL.ui=function(){try{var c=bb(arguments);y(c,[{name:Fd,type:b,allowedValues:[H],optional:false},tb],"WL.ui");a.ui(c)}catch(f){Nc(c,f)}};WL.fileDialog=function(){try{var b=F,c=bb(arguments,b);Cb(c,b);return a.fileDialog(c)}catch(f){return Jc(b,f)}};function Cb(e,d){y(e,[{name:f,type:b,allowedValues:[r,sb,V,U],optional:false},{name:rb,type:b,allowedValues:[FILEDIALOG_PARAM_RESOURCETYPE_FILE,FILEDIALOG_PARAM_RESOURCETYPE_FOLDER],optional:true},{name:FILEDIALOG_PARAM_SELECT,type:b,allowedValues:[FILEDIALOG_PARAM_SELECT_SINGLE,FILEDIALOG_PARAM_SELECT_MULTI],optional:true},{name:FILEDIALOG_PARAM_LIGHTBOX,type:b,allowedValues:[FILEDIALOG_PARAM_LIGHTBOX_GREY,FILEDIALOG_PARAM_LIGHTBOX_TRANSPARENT,FILEDIALOG_PARAM_LIGHTBOX_WHITE],optional:true},{name:FILEDIALOG_PARAM_LOADING_TIMEOUT,type:fc,optional:true},{name:FILEDIALOG_PARAM_PERMISSION,type:b,allowedValues:[FILEDIALOG_PARAM_PERMISSION_ONETIME],optional:true},tb],d);if(d!==F)y(e,[{name:A,allowedValues:[Gb,X],type:b,optional:true},{name:FILEDIALOG_PARAM_ONSELECTED,type:c,optional:false},{name:fb,type:c,optional:true}],d);if(!ib.isSupported()||!window.JSON||a._browser.mobile)throw new Error(vb)}function Dc(b){a._rpsAuth=true;a._appId=b[lb]}function zd(){a._logEnabled=true;a._urlParams=od(window.location.href);a._traceEnabled=a._urlParams[Sd];var b=window.wlAsyncInit;if(b&&typeof b===c)b.call()}function nd(a){if(Pc(a))return;if(sendAPIRequestViaXHR(a))return;if(Oc(a))return;var b={};b[J]=D;b[G]=vb;a.onCompleted(b)}function qd(){return a[o]}a.jsonp={};WL.Internal.jsonp=a.jsonp;function Pc(c){var h=document.getElementsByTagName("HEAD")[0],b=document.createElement("SCRIPT"),d=jd(c._properties,d,[v,hb]),e=c._id,f=bd();if(f!=null)d[i]=f;d[v]=pc+e;d[Kc]="true";var g=Hb(c._url,d);if(g.length>dd)return false;c.scriptTag=b;a.jsonp[e]=function(a){Y(e,b);c.onCompleted(a)};hd(b,c);b.setAttribute("async","async");b.type="text/javascript";b.src=g;h.appendChild(b);window.setTimeout(function(){if(c._completed)return;Y(e,b)},30000);return true}function hd(b,c){if(a._browser.ie&&b.attachEvent)b.attachEvent("onreadystatechange",function(a){kb(a,c)});else{b.readyState="complete";b.addEventListener("load",function(a){kb(a,c)},false);b.addEventListener("error",function(a){kb(a,c)},false)}}function kb(d,c){if(c._completed)return;var b=d.srcElement||d.currentTarget;if(!b.readyState)b=d.currentTarget;if(b.readyState!="complete"&&b.readyState!="loaded")return;var f=c._id;failure=d.type=="error"||a.jsonp[f]!=null;if(failure){Y(f,c.scriptTag);var e={};e[J]=Gc;e[G]=Ab;c.onCompleted({error:e})}}function Y(b,c){delete a.jsonp[b];document.getElementsByTagName("HEAD")[0].removeChild(c)}function Oc(b){Ld();if(a._browser.flashVersion<9)return false;a.xdrFlash.send(b);return true}a.xdrFlash={_id:"",_status:cb,_flashObject:null,_requests:{},_pending:[],init:function(){if(this._status!=cb)return;this._status=yc;var c=Ib("div");c.id="wl_xdr_container";document.body.appendChild(c);this._id=Sc();var b=Ic,d=a[g]+"XDR.swf";b=b.replace(/{url}/g,d);b=b.replace(/{id}/g,this._id);b=b.replace(/{variables}/g,"domain="+document.domain);c.innerHTML=b},onReady:function(b){if(b){if(a._browser.firefox)this._flashObject=document.embeds[this._id];else this._flashObject=K(this._id);this._status=yb}else this._status=id;while(this._pending.length>0)this.send(this._pending.shift())},onRequestCompleted:function(b,e,c,f){var d=a.xdrFlash._requests[b];delete a.xdrFlash._requests[b];Lb(d,e,sd(c),f)},send:function(a){if(this._status<yb){this._pending.push(a);if(this._status==cb)ab(q(this,this.init));return}if(this._flashObject!=null){this._requests[a._id]=a;var b=prepareXDRRequest(a);this.invoke("send",[a._id,b.url,b.method,b.body])}else Lb(a,0,null,Ac)},invoke:function(d,a){a=a||[];var c=window.__flash__argumentsToXML(a,0),e='<invoke name="'+d+'" returntype="javascript">'+c+"</invoke>",b=this._flashObject.CallFunction(e);if(b==null)return null;return eval(b)}};WL.Internal.xdrFlash=a.xdrFlash;function sd(a){return a?a.replace(/\r/g," ").replace(/\n/g," "):a}var Ic="<object classid='clsid:d27cdb6e-ae6d-11cf-96b8-444553540000' codebase='https://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=7,0,0,0' width='300' height='300' id='{id}' name='{id}' type='application/x-shockwave-flash' data='{url}'>"+"<param name='movie' value='{url}'></param>"+"<param name='allowScriptAccess' value='always'></param>"+"<param name='FlashVars' value='{variables}'></param>"+"<embed play='true' menu='false' swLiveConnect='true' allowScriptAccess='always' type='application/x-shockwave-flash' FlashVars='{variables}' src='{url}' width='300' height='300' name='{id}'></embed>"+"</object>",Z=null;(function(){a.fileDialog=function(b){gb(b[e]);if(a._pendingPickerOp!=null)throw new Error(mc);return (new Z(b)).execute()};var h=0,b=1,g=2,c=3;Z=function(c){var b=this;b._props=c;b._startTs=(new Date).getTime();c[FILEDIALOG_PARAM_LIGHTBOX]=c[FILEDIALOG_PARAM_LIGHTBOX]||FILEDIALOG_PARAM_LIGHTBOX_WHITE;c[FILEDIALOG_PARAM_SELECT]=c[FILEDIALOG_PARAM_SELECT]||FILEDIALOG_PARAM_SELECT_SINGLE;b._state=h;b._authDelegate=q(b,b._onAuthResp);a._pendingPickerOp=b};Z.prototype={execute:function(){var a=this,b=new l(a._props[e],a,null);a._promise=b;a._process();return b},cancel:function(a){var b=this,d=b._props;if(b._state===c)return;if(!a)a=u(Qb,Nb.replace("METHOD",this._props[e]));b._onComplete(a)},_process:function(){var a=this;switch(a._state){case h:a._validateAuth();break;case b:a._initPicker();break;case g:a._complete()}},_changeState:function(d,b){var a=this;if(a._state!==c&&a._state!==d){a._state=d;if(b)a._result=b;a._process()}},_onComplete:function(a){this._changeState(g,a)},_validateAuth:function(){var c=this,g=false;if(a._rpsAuth)c._changeState(b);else{var d="";switch(c._props[f]){case r:d=Ad;break;case sb:d=Vc;break;case V:case U:d=c._buildExternalScope();g=true;break;default:var j=wb.replace("METHOD",F).replace("PARAM",f);c._onComplete(u(Tc,j));return}var i=c._props[e],h=650;if(g)a.login({scope:d,external_consent:true}).then(function(a){c._onExternalConsentComplete(a)},function(a){c._onComplete(a)});else{d+=" "+Id;a.ensurePermission(d,h,i,c._authDelegate)}}},_buildExternalScope:function(){var b=this,a="onedrive_onetime.access:";switch(b._props[f]){case V:a+="read";break;case U:a+="readwrite"}switch(b._props[rb]){case FILEDIALOG_PARAM_RESOURCETYPE_FILE:a+="file|";break;case FILEDIALOG_PARAM_RESOURCETYPE_FOLDER:a+="folder|";break;default:a+="file|"}a+=b._props[FILEDIALOG_PARAM_SELECT]==="single"?"single":"multi";return a},_onAuthResp:function(c){var a=this;if(c.error){if(!a._channel)a._onComplete(c)}else{var d=c.session[i];a._props[i]=d;if(a._channel)a._channel.send(sc,d);else a._changeState(b)}},_initPicker:function(){var b=this,c=b._props;w(c);b._channel=a.channel.registerOuterChannel(Ec,ob(c.url).host,c.frame.contentWindow,c.url,q(b,b._onMessage));d.subscribe(xb,b._authDelegate);var e=function(a){if(a.keyCode===Md)b.cancel()};c.keydownHandler=e;j(window,"keydown",e);b._initTimeout()},_initTimeout:function(){var a=this;timeoutSeconds=a._props[FILEDIALOG_PARAM_LOADING_TIMEOUT];if(timeoutSeconds&&timeoutSeconds>0)a._timeout=window.setTimeout(q(a,a._onTimeout),timeoutSeconds*1000)},_onTimeout:function(){var a=this,b=a._channel._connected;if(!b)a.cancel(u(xd,vc));a._clearTimeout()},_clearTimeout:function(){var a=this;if(a._timeout){window.clearTimeout(a._timeout);a._timeout=undefined}},_complete:function(){var b=this,d=b._result,f=d.error?n:m;b._state=c;b._cleanup();b._normalizeResp();if(b._props[e]===F)z(b._props[v],d,true);else if(d.data)z(b._props[FILEDIALOG_PARAM_ONSELECTED],d,true);else z(b._props[fb],d,true);b._promise[f](d);if(!a._rpsAuth)O(function(){b._report()})},_report:function(){var g=this._props,b=this._result,l=((new Date).getTime()-this._startTs)/1000,j="none",c=0,d=0;if(b.data){if(b.data.folders!=null)c=b.data.folders.length;if(b.data.files!=null)d=b.data.files.length}j=c>0&&d>0?"both":c>0?"folder":d>0?"file":"none";var k=c+d,i={client:H,api:g[e],mode:g[f],select:g[FILEDIALOG_PARAM_SELECT],result:b.error?b.error.code:"success",duration:l,object_selected:j,selected_count:k},h=a[E];a.api({path:"web_analytics",method:"POST",body:i});if(h)h(i)},_onExternalConsentComplete:function(c){var b=this;if(c.error){b._onComplete(c);return}var d=c[Dd];if(d==null){b.complete(u(D,"Did not get expected resource id."));return}a.api({path:d,method:"GET"}).then(function(a){b._onComplete(a)},function(a){b._onComplete(a)})},_onMessage:function(a,b){pb(a);switch(a){case tc:this._onComplete(b)}},_normalizeResp:function(){var g=this,i=g._props[f]===r,b=g._result.data,d=g._result.error,h=function(c){var b=c.upload_location;if(b)c.upload_location=b.replace("WL_APISERVICE_URL",a[o])};if(b){if(b.folders)for(var c=0;c<b.folders.length;c++)h(b.folders[c]);if(b.files)for(var c=0;c<b.files.length;c++)h(b.files[c])}if(d&&d.message)d.message=d.message.replace("METHOD",g._props[e])},_cleanup:function(){var c=this,b=c._props,g=c._channel,f=b.resizeHandler,e=b.keydownHandler;c._clearTimeout();d.unsubscribe(xb,c._authDelegate);if(b.lightBox){b.frame.style.display=Pb;b.lightBox.style.display=Pb;document.body.removeChild(b.frame);document.body.removeChild(b.lightBox);delete b.lightBox;delete b.frame}if(g){g.dispose();delete c._channel}if(f)k(window,"resize",f);if(e)k(window,"keydown",e);delete a._pendingPickerOp}};function w(c){var g=c[f]===r,e=g?800:500,d=g?600:450,h=c[FILEDIALOG_PARAM_LIGHTBOX],n=h===FILEDIALOG_PARAM_LIGHTBOX_TRANSPARENT,k=n?0:60,o=h===FILEDIALOG_PARAM_LIGHTBOX_WHITE?"white":"rgb(0,0,0)",l=k/100,i=s(e,d),m=t(c),b=document.createElement("div");b.style.top="0px";b.style.left="0px";b.style.position="fixed";b.style.width="100%";b.style.height="100%";b.style.display="block";b.style.backgroundColor=o;b.style.opacity=l;b.style.MozOpacity=l;b.style.filter="alpha(opacity="+k+")";b.style.zIndex="2600000";var a=document.createElement("iframe");a.id="picker"+(new Date).getTime();a.style.top=i.top;a.style.left=i.left;a.style.position="fixed";a.style.width=e+"px";a.style.height=d+"px";a.style.display="block";a.style.zIndex="2600001";a.style.borderWidth="1px";a.style.borderColor="gray";a.style.maxHeight="100%";a.style.maxWidth="100%";a.src=m;a.setAttribute("sutra","picker");document.body.appendChild(a);document.body.appendChild(b);c.resizeHandler=function(){var b=s(e,d);a.style.top=b.top;a.style.left=b.left};j(window,"resize",c.resizeHandler);c.lightBox=b;c.frame=a;c.url=m}function t(d){var e=d[f]===r,g=e?oc:nc,b={},c=Ub()+a[qb];if(c.charAt(0)==="/")c=M+c;b[xc]=g;b[Uc]=a._rpsAuth?wc:uc;b[Hc]=window.location.hostname.toLowerCase();b[Cc]=c;b[lb]=a._appId;b[Zb]=(new Date).getTime();b[Zc]=a._locale;if(!a._rpsAuth)b[i]=d[i];if(e)b[FILEDIALOG_PARAM_SELECT]=d[FILEDIALOG_PARAM_SELECT];return Hb(a[p],b)}function s(f,e){var b,c;if(a._browser.ie){var d=document.documentElement;b=(d.clientWidth-f)/2;c=(d.clientHeight-e)/2}else{b=(window.innerWidth-f)/2;c=(window.innerHeight-e)/2}b=b<10?10:b;c=c<10?10:c;return {left:b+"px",top:c+"px"}}})();a.ui=function(a){gb("WL.ui");switch(a.name){case jc:new SignInControl(a);break;case H:new Fb(a)}};var Fb=function(b){Cb(b);var a=this;a._props=b;ab(q(a,a.init))};Fb.prototype={init:function(){var a=this;if(a._inited===true)return;a._inited=true;try{var c=a._props,d=c[eb],f=c[v];c[e]="WL.ui-"+H;a.validate();c[A]=c[A]||X;d=typeof d===b?K(c[eb]):d;a._element=d;var g=qc(c);Jd(d,g);zc(d,q(a,a.onClick),q(a,a.onRender));a.onRender(false,false);z(f,c,false)}catch(h){C(h.message)}},validate:function(){var a=this._props;y(a,[{name:eb,type:Rd,optional:false}],a[e])},onClick:function(){try{return a.fileDialog(this._props)}catch(b){C(b.message)}return false},onRender:function(){var k=this._props,f=k[A]===X,h=a._locale,e=h.indexOf("ar")>-1||h.indexOf("he")>-1,j=e?"RTL":"LTR",b=this._element.childNodes[0],i=b.childNodes[0],c=b.childNodes[1],d="#094AB2",g="#ffffff";b.style.direction=j;b.style.backgroundColor=f?g:d;b.style.border="solid 1px";b.style.borderColor=d;b.style.height="20px";b.style.paddingLeft="4px";b.style.paddingRight="4px";b.style.textAlign="center";b.style.cursor="pointer";i.style.verticalAlign="middle";i.style.height="16px";c.style.fontFamily="'Segoe UI', 'Segoe UI Web Regular', 'Helvetica Neue', 'BBAlpha Sans', 'S60 Sans', Arial, 'sans-serif'";c.style.fontSize="12px";c.style.fontWeight="bold";c.style.color=f?d:g;c.style.textAlign="center";c.style.verticalAlign="middle";c.style.marginLeft=e?"0px":"2px";c.style.marginRight=e?"2px":"0px"}};function qc(b){var l=b[f],k=b[A],a=l===r,e=a?R.skyDriveOpenPickerButtonText:R.skyDriveSavePickerButtonText,c=a?R.skyDriveOpenPickerButtonTooltip:R.skyDriveSavePickerButtonTooltip,g=a?"skydriveopenpickerbutton":"skydrivesavepickerbutton",j=k===Gb?"SkyDriveIcon_white.png":"SkyDriveIcon_blue.png",i="<img alt='' src='"+Hd()+"/SkyDrivePicker/"+j+"'>",h="<span>"+e+"</span>",d="<button id='"+g+"' title='"+c+"'>"+i+h+"</button>";return d}function zc(c,n,m){var a=c.childNodes[0];if(n){var f=function(b){if(c.childNodes.length==0){k(a,"click",f);return}n(b)};j(a,"click",f)}if(m){var d=false,e=false,g=function(a){e=true;b(a)},h=function(a){e=false;b(a)},i=function(a){d=true;b(a)},l=function(a){d=false;b(a)},b=function(){if(c.childNodes.length==0){k(a,"mouseenter",g);k(a,"mouseleave",h);k(document,"mousedown",i);k(document,"mouseup",l);return}m(d,e)};j(a,"mouseenter",g);j(a,"mouseleave",h);j(document,"mousedown",i);j(document,"mouseup",l)}}function Ld(){if(a._browser.flash!==undefined)return;var b=0;try{if(a._browser.ie){var k=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7"),f=k.GetVariable("$version"),i=f.split(" "),g=i[1],d=g.split(",");b=d[0]}else if(navigator.plugins&&navigator.plugins.length>0)if(navigator.plugins["Shockwave Flash 2.0"]||navigator.plugins["Shockwave Flash"]){var j=navigator.plugins["Shockwave Flash 2.0"]?" 2.0":"",e=navigator.plugins["Shockwave Flash"+j].description,h=e.split(" "),c=h[2].split(".");b=c[0]}}catch(l){}a._browser.flashVersion=b;a._browser.flash=b>=8}function ab(b){if(document.body)switch(document.readyState){case "complete":b();return;case "loaded":if(a._browser.webkit){b();return}break;case "interactive":case undefined:if(a._browser.firefox||a._browser.webkit){b();return}}if(document.addEventListener){document.addEventListener("DOMContentLoaded",b,false);document.addEventListener("load",b,false)}else if(window.attachEvent)window.attachEvent("onload",b);if(a._browser.ie&&document.attachEvent)document.attachEvent("onreadystatechange",function(){if(document.readyState==="complete"){document.detachEvent("onreadystatechange",arguments.callee);b()}})}function Jd(b,a){b.innerHTML=a}function j(a,b,c){if(a.addEventListener)a.addEventListener(b,c,false);else if(a.attachEvent)a.attachEvent("on"+b,c)}function k(a,b,c){if(a.removeEventListener)a.removeEventListener(b,c,false);else if(a.detachEvent)a.detachEvent("on"+b,c)}var ib={registerOuterChannel:function(e,b,c,d,a){return h.registerChannel(e,b,c,d,a)},registerInnerChannel:function(c,b,a){return h.registerChannel(c,b,null,null,a)},isSupported:function(){return h.isSupported()}},h={_channels:[],isSupported:function(){return window.postMessage!=null},registerChannel:function(i,e,f,g,d){var b=h,c=b._channels,a=null;if(b.isSupported()){a=new Kb(i,e,f,g,d);if(c.length===0)j(window,"message",b._onMessage);c.push(a)}return a},unregisterChannel:function(d){var c=h,a=c._channels;for(var b=0;b<a.length;b++)if(a[b]==d){a.splice(b,1);break}if(a.length===0)k(window,"message",c._onMessage)},_onMessage:function(a){var d=h,a=a||window.event,c=vd(a);if(c!=null){var b=d._findChannel(a,c);if(b!=null)switch(c.text){case dc:b._onConnectReq(a.source,a.origin);break;case cc:b._onConnectAck(a.source);break;default:b._onMessage(c.text)}}},_findChannel:function(g,f){var d=h,c=d._channels,e=Ed(g.origin);for(var b=0;b<c.length;b++){var a=c[b];if(ub(a._name,f.name)&&ub(a._allowedDomain,e))return a}return null}},dc="@ConnectReq",cc="@ConnectAck";function Kb(f,d,b,e,c){var a=this;a._name=f;a._allowedDomain=d;a._msgHandler=c;if(b){a._targetWindow=b;a._targetUrl=td(e);a._connect()}}Kb.prototype={_disposed:false,_connected:false,_allowedDomain:null,_targetWindow:null,_targetUrl:null,_msgHandler:null,_connectSchedule:-1,_pendingQueue:[],_recvQueue:[],dispose:function(){var a=this;if(!a._disposed){a._disposed=true;a._cancelConnect();h.unregisterChannel(a)}},send:function(c,d){var a=this;if(a._disposed)return;var b=Xc(c,d);if(a._connected)a._post(b);else a._pendingQueue.push(b)},_connect:function(){var a=this;if(a._disposed||a._connected)return;var b=function(){a._post(dc)};if(a._connectSchedule===-1){a._connectSchedule=window.setInterval(b,500);b()}},_post:function(b){var a=this,c=md(a._name,b);a._targetWindow.postMessage(c,a._targetUrl)},_onConnectReq:function(c,b){var a=this;if(!a._connected){a._connected=true;a._targetWindow=c;a._targetUrl=b;a._post(cc);a._onConnected()}},_onConnectAck:function(b){var a=this;if(!a._connected){a._targetWindow=b;a._onConnected()}},_onConnected:function(){var a=this,c=a._pendingQueue;a._connected=true;for(var b=0;b<c.length;b++)a._post(c[b]);a._pendingQueue=[];a._cancelConnect()},_cancelConnect:function(){var a=this;if(a._connectSchedule!=-1){window.clearInterval(a._connectSchedule);a._connectSchedule=-1}},_onMessage:function(b){if(this._msgHandler){var a=Wc(b);this._msgHandler(a.cmd,a.args)}}};function td(b){var a=b.indexOf("://");if(a>=0){a=b.indexOf("/",a+3);if(a>=0)b=b.substring(0,a)}return b}function vd(a){var b=null;if(!Jb(a.origin)&&!Jb(a.data)&&a.source!=null)b=ld(a.data);return b}function md(a,b){return "<"+a+">"+b}function ld(a){var c=null;if(a.charAt(0)=="<"){var b=a.indexOf(">");if(b>0){var d=a.substring(1,b),e=a.substr(b+1);c={name:d,text:e}}}return c}function Xc(a,c){var b={cmd:a,args:c};return JSON.stringify(b)}function Wc(b){var a=JSON.parse(b);return a}if(window.WL)a.channel=ib;else window.WL={channel:ib};var R={connect:"Connect",signIn:"Sign in",signOut:"Sign out",login:"Log in",logout:"Log out",skyDriveOpenPickerButtonText:"Open from SkyDrive",skyDriveOpenPickerButtonTooltip:"Open from SkyDrive",skyDriveSavePickerButtonText:"Save to SkyDrive",skyDriveSavePickerButtonTooltip:"Save to SkyDrive"};a._locale="en";a[x]="Web/DEVICE_"+Qc("5.5.8111.4002");a.testInit=function(b){if(b.env)a._settings.init(b.env);if(b.skydrive_uri)a._settings[p]=b.skydrive_uri;if(b[E])a[E]=b[E]};var L={};L[o]="https://apis.live.net/v5.0/";L[p]="https://onedrive.live.com/";L[g]="//js.live.net/v5.0/";var Q={};Q[o]="https://df.apis.live.net/v5.0/";Q[p]="https://onedrive.live.com/";Q[g]="//df-js.live.net/v5.0/";var P={};P[o]="https://apis.live-int.net/v5.0/";P[p]="https://onedrive.live-int.com/";P[g]="//js.live-int.net/v5.0/";var I={};I[o]="https://current.apis.live-tst.net/v5.0/";I[p]="https://onedrive.live-int.com/";I[g]="//current-js.live-int.net/v5.0/";var N={};N[o]="https://bvt.apis.live-tst.net/v5.0/";N[p]="https://onedrive-bvt.live-int.com/";N[g]="//bvt-js.live-int.net/v5.0/";a._settings={PROD:L,DF:Q,INT:P,CURRENT:I,BVT:N,init:function(b){b=b.toUpperCase();var c=this[b];if(c)w(c,a)}};a._settings.init("PROD");a[qb]="wl.skydrivepicker.js";a.onloadInit()}})();