(function(){var n=ol.templateMap=ol.templateMap||{};n["#rteContextMenuControlTemplate"]={tmpls:[{tmpls:[{tmpls:[],links:{},tags:{},bnds:[{fn:function(n){return[{tmpl:0,params:"#data tmpl=Template",props:{tmpl:n.Template},args:[n]}]},paths:["#data","Template"],_ctxs:"for"}],_is:"template",allowCode:!0,htmlTag:"",tmplName:"rteContextMenuControlTemplate/for/for",fn:{fn:function(n,t,i){var i=i||jsviews,u=i._tag,r="";return r+="                    ",r+=u("for",t,this,1),r+"                "}}}],links:{},tags:{},bnds:[],_is:"template",allowCode:!0,htmlTag:"ul",tmplName:"rteContextMenuControlTemplate/for",fn:{fn:function(n,t,i,r){var i=i||jsviews,f,e=i._tag,u="";return u+='            <ul class="c_m t_hovl" ',u+=(f=t.hlp("sutra")(n.SutraTag))!=r?f:"",u+=">                ",u+=e("for",t,this,[{tmpl:1,params:"Items",props:{},args:[n.Items]}]),u+"            <\/ul>        "}}}],links:{},tags:{},bnds:[{fn:function(n,t){return[{tmpl:1,params:"~tag.Menu",props:{},args:[t.hlp("tag").Menu]}]},paths:["~tag.Menu"],_ctxs:"for"}],_is:"template",allowCode:!0,tmplName:"rteContextMenuControlTemplate",htmlTag:"div",fn:{fn:function(n,t,i,r){var i=i||jsviews,f,e=i._tag,u="";return u+='    <div class="rtecontextmenu c_ml" id="',u+=(f=t.hlp("tag").ControlNamespace)!=r?f:"",u+='">        ',u+=e("for",t,this,1),u+"    <\/div>"}}},n["#rteToolbarHyperlinkFlyoutTemplate"]={tmpls:[],links:{},tags:{},bnds:[],_is:"template",allowCode:!0,tmplName:"rteToolbarHyperlinkFlyoutTemplate",htmlTag:"div",fn:{fn:function(n,t,i,r){var i=i||jsviews,f,u="";return u+='    <div class="UrlContainer">        <Label for="HLINK_URL">',u+=(f=t.hlp("ol").GetString("RTE.InsertHyperlink.Caption"))!=r?f:"",u+'<\/Label>        <input type="text" spellcheck="false" name="HLINK_URL" class="Url" data-link="{:State:}" />    <\/div>'}}},n["#rteToolbarEmojiPickerFlyoutTemplate"]={tmpls:[],links:{},tags:{},bnds:[{fn:function(n,t){return[{tmpl:0,params:"data=~composeVm.EmojiPicker",props:{data:t.hlp("composeVm").EmojiPicker},args:[]}]},paths:["~composeVm.EmojiPicker"],_ctxs:"emojiPickerControl"}],_is:"template",allowCode:!0,tmplName:"rteToolbarEmojiPickerFlyoutTemplate",htmlTag:"",fn:{fn:function(n,t,i){var i=i||jsviews,u=i._tag,r="";return r+="    ",r+=u("emojiPickerControl",t,this,1),r+""}}},n["#emojiPickerTemplate"]={tmpls:[{tmpls:[],links:{},tags:{},bnds:[],_is:"template",allowCode:!0,htmlTag:"a",tmplName:"emojiPickerTemplate/for",fn:{fn:function(n,t,i,r){var i=i||jsviews,f,u="";return u+='                <a href="#" sutra="',u+=(f=n.Sutra)!=r?f:"",u+='" data-link="class{getSelectedClass: #data #parent.parent.data.SelectedItem}">                    <div class="EmojiImage">                        <img title="',u+=(f=n.CategoryName)!=r?f:"",u+='" aria-label="',u+=(f=n.CategoryName)!=r?f:"",u+='" src="',u+=(f=t.hlp("ol").config.compose.emojiPicker.imageServer)!=r?f:"",u+='emojicatstrip.png" style="top: ',u+=(f=n.ImageOffset)!=r?f:"",u+';" />                    <\/div>                <\/a>            '}}},{tmpls:[],links:{},tags:{},bnds:[{fn:function(n){return[{tmpl:0,params:"data=#data",props:{data:n},args:[]}]},paths:["#data"],_ctxs:"emojiListControl"}],_is:"template",allowCode:!0,htmlTag:"",tmplName:"emojiPickerTemplate/for",fn:{fn:function(n,t,i){var i=i||jsviews,u=i._tag,r="";return r+="            ",r+=u("emojiListControl",t,this,1),r+"        "}}}],links:{},tags:{},bnds:[{fn:function(n){return[{tmpl:1,params:"Items",props:{},args:[n.Items]}]},paths:["Items"],_ctxs:"for"},{fn:function(n){return[{tmpl:2,params:"SelectedItem",props:{},args:[n.SelectedItem]}]},paths:["SelectedItem"],_ctxs:"for"}],_is:"template",allowCode:!0,tmplName:"emojiPickerTemplate",htmlTag:"div",fn:{fn:function(n,t,i,r){var i=i||jsviews,f,e=i._tag,u="";return u+='    <div class="EmojiPicker" ',u+=(f=t.hlp("sutra")("emojipicker"))!=r?f:"",u+=' id="',u+=(f=t.hlp("tag").ControlNamespace)!=r?f:"",u+='">        <div class="EmojiCategoryList" ',u+=(f=t.hlp("sutra")("emojicategorylist"))!=r?f:"",u+=">            ",u+=e("for",t,this,1),u+="        <\/div>        ",u+=e("for",t,this,2),u+"    <\/div>"}}},n["#emojiListTemplate"]={tmpls:[],links:{},tags:{},bnds:[{fn:function(n){return{params:"CategoryName",props:{},args:[n.CategoryName]}},paths:["CategoryName"],_ctxs:">"},{fn:function(n){return[{tmpl:0,params:"Items tmpl=Template ",props:{tmpl:n.Template},args:[n.Items]}]},paths:["Items","Template"],_ctxs:"for"}],_is:"template",allowCode:!0,tmplName:"emojiListTemplate",htmlTag:"div",fn:{fn:function(n,t,i,r){var i=i||jsviews,f,e=i._tag,o=i._cnvt,u="";return u+='    <div class="CategoryName" ',u+=(f=t.hlp("sutra")("emojicategoryname"))!=r?f:"",u+=">",u+=o("html",t,1),u+='<\/div>    <div class="EmojiCategory" ',u+=(f=t.hlp("sutra")("emojicategory"))!=r?f:"",u+='>        <div id="emojiLists" ',u+=(f=t.hlp("sutra")("emojiiconitems"))!=r?f:"",u+=">            ",u+=e("for",t,this,2),u+"        <\/div>    <\/div>"}}},n["#emojiDefaultListTemplate"]={tmpls:[],links:{},tags:{},bnds:[],_is:"template",allowCode:!0,tmplName:"emojiDefaultListTemplate",htmlTag:"a",fn:{fn:function(n,t,i,r){var i=i||jsviews,u,f="";return f+='    <a href="#" ',f+=(u=t.hlp("sutra")(n.Sutra))!=r?u:"",f+=' class="EmojiList" unselectable="on">        <div class="EmojiImage">            <img unselectable="on" aria-label="',f+=(u=n.CategoryNameString)!=r?u:"",f+='" src="',f+=(u=t.hlp("ol").config.compose.emojiPicker.imageServer)!=r?u:"",f+=(u=t.hlp("ol").config.compose.emojiPicker.imageStripVersion)!=r?u:"",f+=".",f+=(u=n.CategoryName)!=r?u:"",f+='.png" style="top: ',f+=(u=n.ImageOffset)!=r?u:"",f+';" />        <\/div>    <\/a>'}}},n["#emojiMruListTemplate"]={tmpls:[],links:{},tags:{},bnds:[],_is:"template",allowCode:!0,tmplName:"emojiMruListTemplate",htmlTag:"a",fn:{fn:function(n,t,i,r){var i=i||jsviews,f,u="";return u+='    <a href="#" ',u+=(f=t.hlp("sutra")(n.Sutra))!=r?f:"",u+=' class="EmojiList" unselectable="on">',u+=(f=n.ImgTag)!=r?f:"",u+"<\/a>"}}},n["#InlineImageTemplate"]={tmpls:[],links:{},tags:{},bnds:[],_is:"template",allowCode:!0,tmplName:"InlineImageTemplate",htmlTag:"span",fn:{fn:function(n,t,i,r){var i=i||jsviews,f,u="";return u+='    <span contentEditable="true">&nbsp;<\/span>    <div style="display: inline-block" unselectable="on" contentEditable="false" data-link="        class{getInlineCssClass: ItemErrorMessage}        initHeight{:InitialHeight}        initWidth{:InitialWidth}        html{:Html}"        ',u+=(f=t.hlp("sutra")("inlineimageitem"))!=r?f:"",u+'>    <\/div>    <span contentEditable="true">&nbsp;<\/span>'}}},n["#ForgotAttachTmpl"]={tmpls:[],links:{},tags:{},bnds:[],_is:"template",allowCode:!0,tmplName:"ForgotAttachTmpl",htmlTag:"div",fn:{fn:function(n,t,i,r){var i=i||jsviews,f,u="";return u+='    <div class="Row">        ',u+=(f=t.hlp("ol").GetString("EditMessage.AttachmentForgotten.Message"))!=r?f:"",u+='    <\/div>    <div>        <input type="checkbox" id="ForgotAttachChk" data-link="{:DoNotShow:}" ',u+=(f=t.hlp("sutra")("checkbox"))!=r?f:"",u+='/>        <label for="ForgotAttachChk" ',u+=(f=t.hlp("sutra")("checkboxtext"))!=r?f:"",u+=">            ",u+=(f=t.hlp("ol").GetString("EditMessage.AttachmentForgotten.Checkbox"))!=r?f:"",u+"        <\/label>    <\/div>"}}}})(),function(n,t){"use strict";var r={InlineImageSmall:.25,InlineImageMedium:.5,InlineImageOriginal:1,InlineImageLarge:2},u={InlineImageSmall:1,InlineImageMedium:2,InlineImageOriginal:3,InlineImageLarge:4,InlineImageRemove:5},f={ShareSkyDriveView:1,ShareSkyDriveRemove:2},i="rteContextMenuControlTemplate",e={templateId:i,template:t.templates("#"+i),attr:"html",init:function(t){this.data=t.ctx.data,this.ControlNamespace=n.createControlNamespace(this.tagName),this.contextMenu=new n.ContextMenu;var i=new n.vm.MenuItem({key:"InlineImageRemove",text:n.GetString("InlineImage.Remove"),sutraTag:"inlineimagedelete"});this.skyDriveMenu=new n.vm.Menu({sutraTag:"inlineimagemenu",items:[new n.vm.MenuItem({key:"ShareSkyDriveView",text:n.GetString("ShareSkyDrive.View"),sutraTag:"shareskydriveview"}),new n.vm.MenuItem({key:"ShareSkyDriveRemove",text:n.GetString("ShareSkyDrive.Remove"),sutraTag:"shareskydriveremove"})]}),this.removeInlineImageMenu=new n.vm.Menu({sutraTag:"inlineimagemenu",items:[i]}),this.fullInlineImageMenu=new n.vm.Menu({sutraTag:"inlineimagemenu",items:[new n.vm.MenuItem({key:"InlineImageSmall",text:n.GetString("InlineImage.Small"),sutraTag:"inlineimagesmall"}),new n.vm.MenuItem({key:"InlineImageMedium",text:n.GetString("InlineImage.Medium"),sutraTag:"inlineimagemedium"}),new n.vm.MenuItem({key:"InlineImageOriginal",text:n.GetString("InlineImage.Original"),sutraTag:"inlineimageoriginal"}),new n.vm.MenuItem({key:"InlineImageLarge",text:n.GetString("InlineImage.Large"),sutraTag:"inlineimagelarge"}),i]})},render:function(){return this.tagCtx.render(this.data)},onAfterLink:function(){var n=this,i=this.contents();i.on("click",".menuLinkItem",t.proxy(n._contextMenuClick,n))},menu:function(t){return n.Accessor(this,"Menu",t)},close:function(){this.contextMenu.hide()},_resizeInlineImage:function(i,u){var f=r[u],e=t(i.find("img")[0]);e.attr("height",Math.ceil(f*i.attr("initHeight"))),e.attr("width",Math.ceil(f*i.attr("initWidth"))),n.Cmd("rte.inlineimageresize").bubble(this)},_contextMenuClick:function(i){var s=t(i.target).view().data,e=s.Key,r=this,o;switch(e){case"InlineImageSmall":case"InlineImageMedium":case"InlineImageOriginal":case"InlineImageLarge":r._resizeInlineImage(r._currentContextMenuTarget,e);break;case"InlineImageRemove":o=this.data.Attachments.removeFile(r._currentContextMenuTarget.view().data,!0),o||(t(r._currentContextMenuTarget).parent().remove(),n.Cmd("rte.cleanupinlineimages").bubble(r));break;case"ShareSkyDriveView":case"ShareSkyDriveRemove":n.Cmd("skydrive.contextmenu").bubble(r,{key:e,target:r._currentContextMenuTarget})}return this._currentContextMenuTarget.hasClass("inlineImage")?$BSI.reportEvent("Cmp.InImgA",{ImgAc:u[e]}):this._currentContextMenuTarget.hasClass("shareSkyDriveItem")&&$BSI.reportEvent("Cmp.SDLinksA",{ImgAc:f[e]}),this.close(),!1},show:function(n,i){var r=this,u=r._currentContextMenuTarget=t(n.currentTarget);if(i=r.ctx.adjustMenuPosition(i,r.ctx.containerSelector),u.hasClass("shareSkyDriveItem"))r.menu(r.skyDriveMenu);else if(u.hasClass("inlineImage"))u.hasClass("inlineImageError")?r.menu(r.removeInlineImageMenu):r.menu(r.fullInlineImageMenu);else return;setTimeout(function(){var t=_$ge(r.ControlNamespace);r.contextMenu.cancelTimers();var n=t[0],u=t.find(".c_m")[0],f={targetLoc:i,sourceEl:n,parentEl:n,forceDispose:!0,disableAnimations:!0};r.contextMenu.show(u,n,f,"RTE")},0)}};t.views.tags({rteContextMenuControl:e}),n.markControlAsLoaded("rteContextMenuControl")}(window.ol,window.originaljQuery||window.jQuery),function(){function u(){try{n=t.localStorage}catch(i){n=null}return n?!0:!1}var t=window,i=t.ol=t.ol||{},n=null,r=i.WebStorage=function(t){var r=this,i=t||"";r.getProperty=function(t){return i&&(t=i+"."+t),n.getItem(t)},r.setProperty=function(t,r){i&&(t=i+"."+t),r?n.setItem(t,r):n.removeItem(t)}};u(),r.isStorageAvailable=function(){return!!n}}(window.originaljQuery||window.jQuery),function(){function t(n){return this.currentPosition=0,this.previousPosition=-1,this.sourceString=n,this}t.prototype.GetCurerntPosition=function(){return this.currentPosition},t.prototype.Rewind=function(){this.previousPosition>=0&&(this.currentPosition=this.previousPosition)},t.prototype.IsEndOfString=function(){return this.currentPosition>=this.sourceString.length},t.prototype.Peek=function(){return this.sourceString[this.currentPosition]},t.prototype.PeekPreviousChar=function(){return this.previousPosition<0||this.currentPosition<1?null:this.sourceString.substring(this.previousPosition,this.currentPosition)},t.prototype.GetPreviousCharCode=function(){return this.previousPosition<0?0:this.sourceString.charCodeAt(this.previousPosition)},t.prototype.Read=function(){return ConvertToUtf8(this.ReadCharCode())},t.prototype.GetCharCode=function(){var t,n;return this.IsEndOfString()?-1:((n=/^&#\d{2,6};/.exec(this.sourceString.substring(this.currentPosition)))!=null?(t=parseInt(n[0].substring(2),10),this.currentPosition+=n[0].length,this.htmlEntity=n[0]):(n=/^&#x[0-9A-F]{2,6};/i.exec(this.sourceString.substring(this.currentPosition)))!=null?(t=parseInt(n[0].substring(3),16),this.currentPosition+=n[0].length,this.htmlEntity=n[0]):(t=this.sourceString.charCodeAt(this.currentPosition),this.currentPosition++,this.htmlEntity=null),t==NaN&&(t=-1),t)},t.prototype.ReadCharCode=function(){var n=0,t;for(this.previousPosition=this.currentPosition;!this.IsEndOfString();){if((n=this.GetCharCode())==-1)return null;if(t=0,55296<=n&&n<=56319){if(this.sourceString.length<=this.currentPosition||(t=this.GetCharCode())==-1)return null;if(t<56320||57343<t){n=0;continue}n=(n-55296)*1024+(t-56320)+65536;break}else if(56320<=n&&n<=57343){n=0;continue}else break}return n};var i=window.ol=window.ol||{},n=i.EmojiRenderer={};n.EmojiCodeArray=[8252,8265,8505,8596,8597,8598,8599,8600,8601,8617,8618,8986,8987,9193,9194,9195,9196,9200,9203,9410,9642,9643,9654,9664,9723,9724,9725,9726,9728,9729,9742,9745,9748,9749,9757,9785,9786,9800,9801,9802,9803,9804,9805,9806,9807,9808,9809,9810,9811,9824,9827,9829,9830,9832,9851,9855,9875,9888,9889,9898,9899,9917,9918,9924,9925,9934,9940,9962,9970,9971,9973,9978,9981,9986,9989,9992,9993,9994,9995,9996,9999,10002,10004,10006,10024,10035,10036,10052,10055,10060,10062,10067,10068,10069,10071,10084,10133,10134,10135,10145,10160,10175,10548,10549,11013,11014,11015,11035,11036,11088,11093,12336,12349,12951,12953,126980,127183,127344,127345,127358,127359,127374,127377,127378,127379,127380,127381,127382,127383,127384,127385,127386,127489,127490,127514,127535,127538,127539,127540,127541,127542,127543,127544,127545,127546,127568,127569,127744,127745,127746,127747,127748,127749,127750,127751,127752,127753,127754,127755,127756,127759,127761,127763,127764,127765,127769,127771,127775,127776,127792,127793,127796,127797,127799,127800,127801,127802,127803,127804,127805,127806,127807,127808,127809,127810,127811,127812,127813,127814,127815,127816,127817,127818,127820,127821,127822,127823,127825,127826,127827,127828,127829,127830,127831,127832,127833,127834,127835,127836,127837,127838,127839,127840,127841,127842,127843,127844,127845,127846,127847,127848,127849,127850,127851,127852,127853,127854,127855,127856,127857,127858,127859,127860,127861,127862,127863,127864,127865,127866,127867,127872,127873,127874,127875,127876,127877,127878,127879,127880,127881,127882,127883,127884,127885,127886,127887,127888,127889,127890,127891,127904,127905,127906,127907,127908,127909,127910,127911,127912,127913,127914,127915,127916,127917,127918,127919,127920,127921,127922,127923,127924,127925,127926,127927,127928,127929,127930,127931,127932,127933,127934,127935,127936,127937,127938,127939,127940,127942,127944,127946,127968,127969,127970,127971,127973,127974,127975,127976,127977,127978,127979,127980,127981,127982,127983,127984,128012,128013,128014,128017,128018,128020,128023,128024,128025,128026,128027,128028,128029,128030,128031,128032,128033,128034,128035,128036,128037,128038,128039,128040,128041,128043,128044,128045,128046,128047,128048,128049,128050,128051,128052,128053,128054,128055,128056,128057,128058,128059,128060,128061,128062,128064,128066,128067,128068,128069,128070,128071,128072,128073,128074,128075,128076,128077,128078,128079,128080,128081,128082,128083,128084,128085,128086,128087,128088,128089,128090,128091,128092,128093,128094,128095,128096,128097,128098,128099,128100,128102,128103,128104,128105,128106,128107,128110,128111,128112,128113,128114,128115,128116,128117,128118,128119,128120,128121,128122,128123,128124,128125,128126,128127,128128,128129,128130,128131,128132,128133,128134,128135,128136,128137,128138,128139,128140,128141,128142,128143,128144,128145,128146,128147,128148,128149,128150,128151,128152,128153,128154,128155,128156,128157,128158,128159,128160,128161,128162,128163,128164,128165,128166,128167,128168,128169,128170,128171,128172,128174,128175,128176,128177,128178,128179,128180,128181,128184,128185,128186,128187,128188,128189,128190,128191,128192,128193,128194,128195,128196,128197,128198,128199,128200,128201,128202,128203,128204,128205,128206,128207,128208,128209,128210,128211,128212,128213,128214,128215,128216,128217,128218,128219,128220,128221,128222,128223,128224,128225,128226,128227,128228,128229,128230,128231,128232,128233,128234,128235,128238,128240,128241,128242,128243,128244,128246,128247,128249,128250,128251,128252,128259,128266,128267,128268,128269,128270,128271,128272,128273,128274,128275,128276,128278,128279,128280,128281,128282,128283,128284,128285,128286,128287,128288,128289,128290,128291,128292,128293,128294,128295,128296,128297,128298,128299,128302,128303,128304,128305,128306,128307,128308,128309,128310,128311,128312,128313,128314,128315,128316,128317,128336,128337,128338,128339,128340,128341,128342,128343,128344,128345,128346,128347,128507,128508,128509,128510,128511,128513,128514,128515,128516,128517,128518,128519,128520,128521,128522,128523,128524,128525,128526,128527,128528,128530,128531,128532,128534,128536,128538,128540,128541,128542,128544,128545,128546,128547,128548,128549,128552,128553,128554,128555,128557,128560,128561,128562,128563,128565,128566,128567,128568,128569,128570,128571,128572,128573,128574,128575,128576,128581,128582,128583,128584,128585,128586,128587,128588,128589,128590,128591,128640,128643,128644,128645,128647,128649,128652,128655,128657,128658,128659,128661,128663,128665,128666,128674,128676,128677,128679,128680,128681,128682,128683,128684,128685,128690,128694,128697,128698,128699,128700,128701,128702,128704],n.EmojiCodeCompositeArray=[[35,8419],[48,8419],[49,8419],[50,8419],[51,8419],[52,8419],[53,8419],[54,8419],[55,8419],[56,8419],[57,8419],[127464,127475],[127465,127466],[127466,127480],[127467,127479],[127468,127463],[127470,127481],[127471,127477],[127472,127479],[127479,127482],[127482,127480]],n.ToHexString=function(n,t){for(var r=0,i="";n>0;)r=n%16,n=(n-r)/16,i="0123456789ABCDEF".charAt(r)+i;return!isNaN(t)&&t>0&&i.length<t&&(i="0000000000".substring(0,t-i.length)+i),i},n.ConvertToUtf8=function(n){if(n>=65536){var t=Math.floor((n-65536)/1024)+55296,i=(n-65536)%1024+56320;return String.fromCharCode(t,i)}return String.fromCharCode(n)},n.IsEmojiCharacter=function(t){if(12953<t&&t<126980||128704<t)return!1;for(var i=t>126976?115:0;i<n.EmojiCodeArray.length;i++){if(t<n.EmojiCodeArray[i])return!1;if(n.EmojiCodeArray[i]==t)return!0}return!1},n.EmojiToImageFromTemplate=function(t,i,r,u,f){var s=n.ToHexString(i,5),l=f?"_27":"",e,h,o,c;for(r>0&&(s+="_"+n.ToHexString(r,5)),e=t+"Emoji_"+s+l+".png",h=0,o=0;o<e.length;o++)h+=e.charCodeAt(o);return c="Emoji$"+s+"$"+n.ToHexString(h,-1)+(u&&u.length>0?" "+u:" RenderedEmoji"),"<img src='"+e+"' alt='Emoji' class='"+c+"' />"},n.GetNextCompositeChar=function(t){for(var i=0;i<n.EmojiCodeCompositeArray.length;i++)if(n.EmojiCodeCompositeArray[i][0]==t)return n.EmojiCodeCompositeArray[i][1];return 0},n.GetIndexOfCompositeChar=function(t){for(var i=0;i<n.EmojiCodeCompositeArray.length;i++)if(n.EmojiCodeCompositeArray[i][0]==t[0]&&n.EmojiCodeCompositeArray[i][1]==t[1])return i;return-1},n.GetCompositeCharByIndex=function(t){return t<0||t>=n.EmojiCodeCompositeArray.length?null:n.EmojiCodeCompositeArray[t]},n.RenderEmoji=function(i,r,u){for(var f=new t(r),e="",h=0,a=r.match(/< *html|body|div|br|img *.*>/gi,r),s,o,c,l;!f.IsEndOfString();)if(s=f.Peek(),o=f.ReadCharCode(),!isNaN(o)&&o!=0){if(a!=null){if(s=="<")h++;else if(s==">"&&(h--,h==0)){e+=s;continue}if(h>0){e+=s;continue}}if(c=n.GetNextCompositeChar(o),c!=0){if(f.IsEndOfString()){e+=f.PeekPreviousChar();break}if(l=f.ReadCharCode(),l==c){e+=n.EmojiToImageFromTemplate(i,o,l,u,!1);continue}e+=s,f.Rewind();continue}e+=n.IsEmojiCharacter(o)?n.EmojiToImageFromTemplate(i,o,0,u,!1):f.PeekPreviousChar()}return e},n.BuildEmojiDataTable=function(n){for(var i={},r=/<img.*?src=[\"|\'].+?emoji_(.+?)\.png[\"|\'].*?[\/]?>/gi,t;(t=r.exec(n))!=null;)i[t[1]]=t[0];return i},n.GenerateEmojiString=function(t){var i=t.split("_"),r;if(i.length==1)r=n.ConvertToUtf8(parseInt(i[0],16));else if(i.length==2)r=n.ConvertToUtf8(parseInt(i[0],16))+n.ConvertToUtf8(parseInt(i[1],16));else return null;return r},n.ReverseRenderEmoji=function(t){var f=n.BuildEmojiDataTable(t),i=t,r,u;for(r in f)u=n.GenerateEmojiString(r),u!=null&&(i=i.split(f[r]).join(u));return i}}(),function(n){"use strict";function h(){return{items:[],selectedItem:null}}var u=window.ol=window.ol||{},t=u.vm=u.vm||{},i=ol.EmojiRenderer,f="EmojiPicker.LastCategory",e="EmojiPicker.MRUList",s=27,r=1114112,c=t.EmojiPicker=function(u){function b(){tt(),n.observable.simpleOn([h],"arrayChange",k)}function k(){o._webStorage.setProperty(e,n.map(h,function(n){return n.Code}).toString())}function d(n){var t=i.GetIndexOfCompositeChar(n);return t>=0?t+r:n}function g(n){var t=i.GetCompositeCharByIndex(n-r);return t!=null?t:n}function nt(n){return i.GetCompositeCharByIndex(n-r)!=null||i.IsEmojiCharacter(n)}function tt(){var i=o._webStorage.getProperty(e),t,r,n;if(i&&i.length!=0)for(r=i.split(","),n=0;n<r.length;n++){if(n>a)break;t=parseInt(r[n]),!isNaN(t)&&nt(t)&&h.push(p(t))}}function p(t){var f,r,e,u;return t=g(t),f=n.isArray(t)?i.EmojiToImageFromTemplate(v,t[0],t[1],"EmojiImage",!0):i.EmojiToImageFromTemplate(v,t,0,"EmojiImage",!0),r=n("<div>"+f+"<\/div>"),r.find("img").attr("aria-label",o.Items[0].categoryName),e=c&&c.length>0?c:"",u=null,t in y||(u={Code:t,ImgTag:r.html(),CategoryName:o.Items[0].CategoryId,CategoryNameString:o.Items[0].CategoryName,SectionName:o.Items[0].SectionName,Sutra:e}),u}function it(){var r=o.Items.length,t,u=c&&c.length>0?c:"",i;for(o._isMruEnabled?(o.Items[0].Items=h,o.Items[0].Template="#emojiMruListTemplate",t=1):t=0,i=1;t<r;t++,i++)o.Items[t].items(n.map(w[i],function(n,i){var f=0-i*s,r=null;return n in y||(r={Code:n,ImageOffset:f.toString()+"px",CategoryName:o.Items[t].CategoryId,CategoryNameString:o.Items[t].CategoryName,SectionName:o.Items[t].SectionName,Sutra:u}),r})),o.Items[t].template("#emojiDefaultListTemplate")}function rt(n){for(var i=-1,t=0;t<o.Items.length;t++)if(o.Items[t].CategoryId===n){i=t;break}return i}function ut(){var n=[];return n.push(new t.EmojiCategory({categoryId:"Recent",categoryName:ol.GetString("EmojiPicker.Category.Recent"),imageOffset:"0px",sutra:"mru",sectionName:"emojirecent"})),n.push(new t.EmojiCategory({categoryId:"PeopleAndFaces",categoryName:ol.GetString("EmojiPicker.Category.PeopleAndFaces"),imageOffset:"-27px",sutra:"peopleface",sectionName:"emojipeople"})),n.push(new t.EmojiCategory({categoryId:"Activities",categoryName:ol.GetString("EmojiPicker.Category.Activities"),imageOffset:"-54px",sutra:"activities",sectionName:"emojiactivities"})),n.push(new t.EmojiCategory({categoryId:"FoodAndThings",categoryName:ol.GetString("EmojiPicker.Category.FoodAndThings"),imageOffset:"-81px",sutra:"foodthings",sectionName:"emojifood"})),n.push(new t.EmojiCategory({categoryId:"Travel",categoryName:ol.GetString("EmojiPicker.Category.Travel"),imageOffset:"-108px",sutra:"travel",sectionName:"emojitravel"})),n.push(new t.EmojiCategory({categoryId:"Nature",categoryName:ol.GetString("EmojiPicker.Category.Nature"),imageOffset:"-135px",sutra:"nature",sectionName:"emojinature"})),n.push(new t.EmojiCategory({categoryId:"Symbols",categoryName:ol.GetString("EmojiPicker.Category.Symbols"),imageOffset:"-162px",sutra:"symbols",sectionName:"emojisymbol"})),n}function ft(){var t,n,i,e,r,s;if(o.initAccessorValues(u),t=null,n=0,v=l.emojiPicker.imageServer,i=ut(),c=l.emojiPicker.sutraLabel,a=l.emojiPicker.maxMruList,o._isMruEnabled=ol.WebStorage.isStorageAvailable()&&l.emojiPicker.enableMru&&a>0,o._isMruEnabled&&(o._webStorage=new ol.WebStorage(ol.config.cookies.pdCookie)),l.emojiPicker.droppedCode.length>0)for(e=l.emojiPicker.droppedCode.split(","),r=0;r<e.length;r++)s=parseInt(e[r]),isNaN(s)||(y[s]=!0);o._isMruEnabled||i.shift(),o.items(i),o._isMruEnabled&&(t=o._webStorage.getProperty(f),t&&(n=rt(t)),b(),(n==0&&h.length==0||n<0)&&(n=1)),it(),o.selectedItem(i[n])}var o=this,w=[[],[128515,128522,128542,128521,128513,128514,128516,128517,128518,128519,128520,128523,128524,128525,128526,128527,128528,128530,128531,128532,128534,128536,128538,128540,128541,128544,128545,128546,128547,128548,128549,128552,128553,128554,128555,128557,128560,128561,128562,128563,128565,128566,128567,9786,9785,128064,128066,128067,128068,128069,128070,128071,128072,128073,128074,128075,128076,128077,128078,128079,128080,128584,128585,128586,128581,128582,128583,128587,128588,128589,128590,128591,9757,9994,9995,9996,10084,128147,128148,128149,128150,128151,128152,128153,128154,128155,128156,128157,128158,128159,128100,128102,128103,128104,128105,128106,128107,128110,128111,128112,128113,128114,128115,128116,128117,128118,128119,128129,128130,128131],[127885,127886,127890,127891,127887,127883,127878,127879,127888,127889,127875,127877,127876,127880,127872,127873,127874,127881,127882,127884,128139,128140,128141,128142,128143,128144,128145,128146,128120,128121,128122,128123,128124,128125,128126,128127,128128,127933,127934,127935,127936,127937,127938,127939,127940,127942,127944,127946,9917,9918,128132,128133,128134,128135,128136,128137,128138,127183,127904,127905,127906,127907,127908,127909,127910,127911,127912,127913,127914,127915,127916,127917,127918,127919,127920,127921,127922,127923,127924,126980,127925,127926,127927,127928,127929,127930,127931,127932,128247,128249,128250,128251,128252,9824,9827,9829,9830],[127829,127828,127830,127831,127832,127833,127834,127835,127836,127837,127838,127839,127840,127841,127842,127843,127844,127845,127846,127847,127848,127849,127850,127851,127852,127853,127854,127855,127856,127857,127858,127859,128298,127860,127861,127862,127863,127864,127865,127866,127867,9749,127813,127814,127815,127816,127817,127818,127820,127821,127822,127823,127825,127826,127827,128221,128222,128223,128224,128225,128226,128227,128228,128229,128230,128231,128232,128233,128234,128235,128238,128240,128241,128242,128243,128244,128246,128293,128294,128295,128296,128297,128299,128302,128303,128305,128081,128082,128083,128084,128085,128086,128087,128088,128089,128090,128091,128092,128093,128094,128095,128096,128097,128098,128099,128186,128187,128188,128189,128190,128191,128192,128193,128194,128195,128196,128197,128198,128199,128200,128201,128202,128203,128204,128205,128206,128207,128208,128209,128210,128211,128212,128213,128214,128215,128216,128217,128218,128219,128220,9742,9986,9993,9999,10002,128336,128337,128338,128339,128340,128341,128342,128343,128344,128345,128346,128347],[128690,9992,128640,128643,128644,128645,128647,128649,128652,128655,128657,128658,128659,128661,128663,128665,128666,9973,128674,128676,128677,128679,128680,9940,127359,11093,128304,128681,128682,128683,128684,128685,128694,128697,128698,128699,128700,128701,128702,128704,9855,9888,9889,127968,127969,127970,127971,127973,127974,127975,127976,127977,127978,127979,127980,127981,127982,127983,127984,9832,9875,9962,9970,9971,9978,9981],[9925,127744,127745,127746,127747,127748,127749,127750,127751,127752,127753,127754,127755,127756,127761,127763,127764,127765,127769,127771,127775,127776,9728,9729,9748,9924,10024,10035,10036,10052,10055,11088,128012,128013,128014,128017,128018,128020,128023,128024,128025,128026,128027,128028,128029,128030,128031,128032,128033,128034,128035,128036,128037,128038,128039,128040,128041,128043,128044,128045,128046,128047,128048,128049,128050,128051,128052,128053,128054,128055,128056,128057,128058,128059,128060,128061,128062,128568,128569,128570,128571,128572,128573,128574,128575,128576,127792,127793,127796,127797,127799,127800,127801,127802,127803,127804,127805,127806,127807,127808,127809,127810,127811,127812,9851],[8265,8252,10067,10068,10069,10071,9745,9989,10004,10060,10062,10133,10134,10006,10135,127759,128507,128508,128509,128510,128511,10160,10175,10548,10549,11035,11036,12336,12349,128160,128161,128162,128163,128164,128165,128166,128167,128168,128169,128170,128171,128172,128174,128175,128176,128177,128178,128179,128180,128181,128184,128185,128281,128282,128283,128284,128285,8596,8597,8598,8599,8600,8601,8617,8618,10145,11013,11014,11015,128306,128307,128308,128309,128310,128311,128312,128313,9642,9643,9654,9664,9723,9724,9725,9726,[35,8419],[48,8419],[49,8419],[50,8419],[51,8419],[52,8419],[53,8419],[54,8419],[55,8419],[56,8419],[57,8419],128287,8505,128286,9410,9898,9899,127568,127569,12951,12953,127344,127345,127358,127374,127377,127378,127379,127380,127381,127382,127383,127384,127385,127386,127489,127490,127514,127535,127538,127539,127540,127541,127542,127543,127544,127545,127546,128259,128266,128267,128268,128269,128270,128271,128272,128273,128274,128275,128276,128278,128279,128280,128288,128289,128290,128291,128292,128314,128315,128316,128317,8986,8987,9193,9194,9195,9196,9200,9203,9800,9801,9802,9803,9804,9805,9806,9807,9808,9809,9810,9811,9934,[127464,127475],[127465,127466],[127466,127480],[127467,127479],[127468,127463],[127470,127481],[127471,127477],[127472,127479],[127479,127482],[127482,127480]]],v=null,c=null;o._webStorage=null,o._isMruEnabled=!1;var h=[],a,y=[],l=ol.config.compose;o.addCodeToMru=function(t){var i,r,u,f;if(o._isMruEnabled){for(t=d(t),i=-1,r=0;r<h.length;r++)if(JSON.stringify(h[r].Code)===JSON.stringify(t)){i=r;break}i>0?n.observable(h).move(i,0,1):i<0&&(u=p(t),h.length>=a?(f=h.slice(0,a-1),f.unshift(u),n.observable(h).refresh(f)):n.observable(h).insert(0,u))}},ft()},o=c.prototype;ol.AddOptionsAccessorAndInitFunctions(o,h),o.selectedItem=function(n){var t=this;return n&&t._isMruEnabled&&t._webStorage.setProperty(f,n.CategoryId),ol.Accessor(t,"SelectedItem",n)}}(window.originaljQuery||window.jQuery),function(){"use strict";function i(){return{categoryId:"",categoryName:"",imageOffset:"",sutra:"",sectionName:"",items:[],template:""}}var n=window.ol=window.ol||{},t=n.vm=n.vm||{},r=t.EmojiCategory=function(n){this.initAccessorValues(n)};ol.AddOptionsAccessorAndInitFunctions(r.prototype,i)}(),function(n,t){"use strict";var i="emojiPickerTemplate",o=n.config.compose,s=wLive.Animations,r=35,u=306,h=window,f=t.templates(null,{markup:"#"+i,converters:{getSelectedClass:function(n,t){var i="EmojiCategoryIcon";return n===t&&(i+=" Selected"),i}}}),e={templateId:i,template:f,attr:"html",init:function(t){var i=this,r;i.data=t.props.data,r=t.ctx,i.thread=r.thread,i.ControlNamespace=n.createControlNamespace(this.tagName)},render:function(){return this.tagCtx.render(this.data)},onAfterLink:function(){var n=this;n._$picker=n.contents("#"+n.ControlNamespace);n._$picker.on("click",".EmojiCategoryList a",function(){var i=t(this).view().data;return n.data.selectedItem(i),!1});n._reLayoutPicker()},_reLayoutPicker:function(){var i=this._$picker.find(".EmojiCategory"),n=this.data.items().length,t=Math.floor((u-r)/(n-1));this._$picker.find(".EmojiCategoryIcon").each(function(i,r){i<n-1?r.style.left=(i*t).toString()+"px":r.style.right="0px"})},onDispose:function(){this._$picker=null},onCmdBubble:function(t,i,r){switch(i.name){case"emojipicker.insert":this.data.addCodeToMru(r.code),n.c.EmojiPickerControl.insertEmoticon(this,this.thread,r.code)}}};n.c=window.ol.c||{},n.c.EmojiPickerControl={},n.c.EmojiPickerControl.insertEmoticon=function(i,r,u){var f=n.EmojiRenderer,e="",o;r.TextMode===n.vm.Compose.TextModes.PlainText?t.isArray(u)?(e=f.ConvertToUtf8(u[0]),e=f.ConvertToUtf8(u[1])):e=f.ConvertToUtf8(u):(o=n.config.compose.emojiPicker.imageServer,e=t.isArray(u)?f.EmojiToImageFromTemplate(o,u[0],u[1],!0):f.EmojiToImageFromTemplate(o,u,0,!0)),n.Cmd("rte.insertcontent").bubble(i,{content:e})},n.c.EmojiPickerControl.onKeyPress=function(t,i,r){i.TextMode===n.vm.Compose.TextModes.RichText&&n.EmojiRenderer.IsEmojiCharacter(r.keyCode)&&(n.c.EmojiPickerControl.insertEmoticon(t,i,r.keyCode),r.returnValue=!1)},t.views.tags({emojiPickerControl:e}),n.markControlAsLoaded("emojiPickerControl")}(window.ol,window.originaljQuery||window.jQuery),function(n,t){"use strict";var i="emojiListTemplate",u=n.config.compose,r={templateId:i,template:t.templates("#"+i),attr:"html",init:function(n){this.data=n.props.data},render:function(){return this.tagCtx.render(this.data)},onAfterLink:function(){var i=this,r=this.contents();r.on("click","a",function(){var r=t(this).view().data;return n.Cmd("emojipicker.insert").bubble(i,{code:r.Code}),$BSI.reportEvent("Insert.Business.QuickAdd",{QACategory:"emoji",QASection:r.SectionName,EmojiCode:r.Code}),!1})}};t.views.tags({emojiListControl:r}),t.templates("#emojiDefaultListTemplate"),t.templates("#emojiMruListTemplate")}(window.ol,window.originaljQuery||window.jQuery)