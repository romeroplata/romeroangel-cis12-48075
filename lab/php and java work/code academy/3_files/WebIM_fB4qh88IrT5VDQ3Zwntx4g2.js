(function(){var n=window;n.ss=n.Sys,n.MC=n.MC||{},n.MSH=n.MSH||{},n.MSCr=n.MSCr||{},n.MSM=n.MSM||{},n.Web=n.Web||{},n.MSCo=n.MSCo||{},n.MSP=n.MSP||{},n.MSCh=n.MSCh||{},n.MSI=n.MSI||{};var i=n.Microsoft=n.Microsoft||{},r=i.Live=i.Live||{},t=r.Messenger=r.Messenger||{};t.Services=t.Services||{},t.Messaging=t.Messaging||{},t.Presence=t.Presence||{}})(),function(){var n=window.MC;n.IMServiceDataProperties={isOnline:"IsOnline",isOnlineViaMobileDevice:"IsOnlineViaMobileDevice",isOnlineViaWeb:"IsOnlineViaWeb",videoCallSupports16By9AspectRatio:"VideoCallSupports16By9AspectRatio",status:"Status",supportsMultipartyConversations:"SupportsMultipartyConversations",version:"Version"},n.IMServiceEndpointDataProperties={capabilities:"Capabilities",domain:"DMN",isOnlineViaMobileDevice:"IsOnlineViaMobileDevice",isOnlineViaWeb:"IsOnlineViaWeb",videoCallSupports16By9AspectRatio:"VideoCallSupports16By9AspectRatio",messageExtensions:"MessageExtensions",presenceExtensions:"PresenceExtensions",supportsMultipartyConversations:"SupportsMultipartyConversations",version:"Version"},n.PDServiceEndpointDataProperties={epName:"EpName",clientType:"ClientType"},n.PEServiceDataProperties={displayName:"FriendlyName",displayPictureUrl:"DisplayPictureUrl",isIdentityVerified:"IsIdentityVerified",personalMessage:"PSM",richLinkType:"RLT",richUrl:"RUL",richUserMessage:"RUM",safeUrl:"SUL",userTileLocation:"UserTileLocation"},n.PEServiceEndpointDataProperties={capabilities:"Capabilities",client:"VER",clientName:"ClientName",clientType:"TYP",clientVersion:"ClientVersion"},n.SKPServiceDataProperties={mood:"Mood",skypeName:"Skypename"},n.SKPServiceEndpointDataProperties={nodeInfo:"NodeInfo"}}(),function(){var pt=window,t=window.MC,wt=pt.ss,lt=wt.NotifyCollectionChangedAction=function(){},yt,ut,n,e,h,u,ft,et,at,i,nt,tt,a,ot,w,y,r,st,b,vt,f,ht,o,c,l,p,it,k,s,rt,v,d,ct,g;lt.add=0,lt.remove=1,lt.reset=2,yt=t.AuthenticationType=function(){},yt.rpsAuth=1,ut=t.BooleanValue=function(){},ut.None=0,ut.True=1,ut.False=2,n=t.CapabilitiesFlags=function(){},n.none=0,n.onlineViaMobile=1,n.onlineViaTexas=2,n.supportsGifInk=4,n.supportsIsfInk=8,n.supportsChunking=32,n.mobileEnabled=64,n.webWatchEnabled=128,n.supportsActivities=256,n.onlineViaWebIM=512,n.mobileDevice=1024,n.onlineViaFederatedInterface=2048,n.hasSpace=4096,n.isMceUser=8192,n.supportsDirectIM=16384,n.supportsWinks=32768,n.supportsSharedSearch=65536,n.isBot=131072,n.supportsTunneledSip=2097152,n.supportsVoiceIM=262144,n.supportsSChannel=524288,n.supportsSipInvite=1048576,n.supportsMultipartyMedia=2097152,n.supportsSDrive=4194304,n.supportsPageModeMessaging=8388608,n.hasOneCare=16777216,n.supportsTurn=33554432,n.supportsDirectBootstrapping=67108864,n.usingAlias=134217728,n.appVersion60=268435456,n.appVersion61=536870912,n.appVersion62=805306368,n.appVersion70=1073741824,n.appVersion75=1342177280,n.appVersion80=1610612736,n.appVersion81=1879048192,n.appVersion85=2147483648,n.appVersion90=2415919104,n.appVersion2009=2684354560,n.isSmsOnly=1,n.supportsVoiceOverMsnp=2,n.supportsUucpSipStack=4,n.rtcVideoEnabled=16,n.supportsPeerToPeerV2=32,n.isAuthenticatedWebIMUser=64,n.supportsOfflineIM=256,n.videoCallSupports16By9AspectRatio=262144,n.supportsPeerToPeerMixerRelay=32768,n.supportsPeerToPeerEnveloping=524288,n.sipTunnelVersion2=8388608,n.fTurnCapable=536870912,n.supportsMultipartyConversations=2147483648,n.supportsMissedConversations=1,n.supportsShortCircuit=32,n.appVersionMask=4026531840,e=t.ClientType=function(){},e.unknown=0,e.computer=1,e.website=2,e.mobile=3,e.xbox=4,e.zune=5,e.iPhone=6,e.mac=7,e.SMS=8,h=t.ConnectionServiceResultCode=function(){},h.success=0,h.failure=1,h.partialFailure=2,h.signedOutRoaming=3,h.signedOutExceededMaxEndpointCount=4,h.unauthenticated=5,h.signedOutSessionTimeout=6,h.badUic=7,u=t.DatagramInfoType=function(){},u.sdg=0,u.imGroupPut=1,u.imGroupDel=2,u.put=3,u.del=4,u.serviceDataPut=5,u.serviceDataDel=6,u.networkDataPut=7,u.get=8,u.conversationPut=9,ft=t.GroupChatPhase=function(){},ft.disabled=0,ft.consumption=1,ft.creation=2,et=t.GroupConversationOperationResult=function(){},et.success=0,et.failure=1,et.partialFailure=2,at=t.IdentityServiceResultCode=function(){},at.success=0,at.failure=1,i=t.IMAddressInfoType=function(){},i.none=0,i.windowsLive=1,i.officeCommunicator=2,i.telephone=4,i.skype=8,i.circle=9,i.cid=11,i.connect=13,i.remoteNetwork=14,i.smtp=16,i.temporaryGroup=19,i.shortCircuit=20,nt=t.LogEntryType=function(){},nt.normal=0,nt.exception=1,nt.httpRequest=2,nt.stateChange=3,tt=t.LogLevel=function(){},tt.error=0,tt.warning=1,tt.information=2,tt.trace=3,a=t.MailNotificationFolderType=function(){},a.inbox=0,a.trash=1,a.junkMail=2,a.sent=3,a.drafts=4,a.other=5,a.hidden=6,ot=t.MailNotificationInfoType=function(){},ot.initial=0,ot.incoming=1,ot.activity=2,w=t.MessageChannelType=function(){},w.none=0,w.online=1,w.offline=2,w.mobile=3,w.history=4,y=t.MessageInfoType=function(){},y.unknownMessage=0,y.textMessage=1,y.callEventMessage=6,y.logRequestMessage=7,y.typingUserMessage=13,y.threadActivityMessage=14,r=t.MessengerServiceResultCode=function(){},r.success=0,r.failure=1,r.notFound=2,r.unauthenticated=3,r.notAllowed=4,r.messageTooLong=5,r.messageRecipientInvalid=6,r.messageRecipientDisabled=7,r.failedToPersist=8,r.failedToConnect=9,r.transferred=10,st=t.NetworkConnectionType=function(){},st.none=0,st.windowsLive=1,st.connect=2,b=t.NetworkInfoStatus=function(){},b.signedOut=0,b.signingIn=1,b.signedIn=2,b.signingOut=3,b.autoReconnectWaiting=4,vt=t.NetworkOperationType=function(){},vt.enableIM=1,vt.disableIM=2,f=t.PresenceInfoStatus=function(){},f.none=0,f.offline=1,f.online=2,f.appearOffline=3,f.busy=4,f.idle=5,f.beRightBack=6,f.away=7,f.inACall=8,f.outToLunch=9,ht=t.PrivacyOptions=function(){},ht.none=0,ht.blockByDefault=1,ht.allowByDefault=2,o=t.RichPsmLinkType=function(){},o.none=0,o.simpleText=1,o.link=2,o.linkToVideo=3,o.photo=4,o.photos=5,o.video=6,o.document=7,o.location=8,c=t.RoleLists=function(){},c.none=0,c.forward=1,c.allow=2,c.block=4,c.hideCompat=5,c.reverse=8,c.pending=16,c.hide=64,l=t.SendDatagramResultCode=function(){},l.success=0,l.failure=1,l.partialFailure=2,l.tooLong=3,l.recipientInvalid=4,l.recipientDisabled=5,l.recipientNotAcceptingIMs=6,l.invalidData=7,p=t.ServiceType=function(){},p.none=0,p.PE=1,p.IM=2,p.PD=4,p.CM=8,p.SKP=16,it=t.SessionServiceOptions=function(){},it.normal=0,it.notifications=1,it.contactPresence=2,it.full=3,k=t.SignOutLocationFlags=function(){},k.none=0,k.localEndpoint=1,k.remoteEndpoints=2,k.allEndpoints=3,k.specificEndpoints=8,s=t.SignOutReasonCode=function(){},s.signedOutByLocalEndpoint=0,s.signedOutByRemoteEndpoint=1,s.connectionLost=2,s.serverError=3,s.endpointLimitExceeded=4,s.signedOutForReconnect=5,s.userTransferred=6,s.sessionTimeout=7,s.badUic=8,rt=t.SubscriptionType=function(){},rt.notificationSubscribe=1,rt.presenceAndNotificationSubscribe=2,rt.presenceUnsubscribe=3,rt.presenceAndNotificationUnsubscribe=4,v=t.ThreadActivityMessageType=function(){},v.addMember=0,v.deleteMember=1,v.topicUpdate=2,v.pictureUpdate=3,v.fileShared=4,v.contactShared=5,v.none=6,d=t.UpdateIMAvailabilityOperationCode=function(){},d.none=0,d.addContacts=1,d.removeContacts=2,d.addNetwork=3,d.removeNetwork=4,ct=t.UploadLogsPreferenceType=function(){},ct.none=0,ct.accept=1,ct.decline=2,g=t.TestFlags=function(){},g.none=0,g.RecentListLoadFailure=1,g.EnableDeleteConversation=2,g.DeleteConversationFailure=4,g.DeleteConversationPartialFailure=8,t.enumToString=function(n,t){for(var i in n)if(n[i]===t)return i;return""}}(),function(){function y(t){n.event=t}function t(n,t,i){n[t]||(n[t]=i)}function e(n,t,i,r){Object.defineProperty?n.hasOwnProperty(t)||Object.defineProperty(n,t,{get:i,set:r}):n.__lookupGetter__&&n.__lookupGetter__(t)!==undefined||(n.__defineGetter__(t,i),n.__defineSetter__(t,r))}function u(n,t,i){Object.defineProperty?n.hasOwnProperty(t)||Object.defineProperty(n,t,{get:i}):n.__lookupGetter__&&n.__lookupGetter__(t)!==undefined||n.__defineGetter__(t,i)}var n=window,p=n.document,f,i,l,r;if(n.navigator.userAgent.indexOf("Trident/4")<0)try{var h=n.navigator.userAgent.indexOf("Opera")>=0,c=n.navigator.userAgent.indexOf("Gecko")>=0,w=function(n){try{while(n&&n.nodeType!=1)n=n.parentNode}catch(t){n=null}return n},o=function(n,t){var i=n.slice(2);return i=="mousewheel"&&(h||c)&&(i="DOMMouseScroll"),this.addEventListener(i,y,!0),this.addEventListener(i,t,!1),!0},s=function(n,t){var i=n.slice(2);i=="mousewheel"&&(h||c)&&(i="DOMMouseScroll"),this.removeEventListener(i,y,!0),this.removeEventListener(i,t,!1)};t(n,"attachEvent",o),t(n,"detachEvent",s),n.HTMLDocument&&(t(n.HTMLDocument.prototype,"attachEvent",o),t(n.HTMLDocument.prototype,"detachEvent",s)),t(n.HTMLElement.prototype,"attachEvent",o),t(n.HTMLElement.prototype,"detachEvent",s),f=n.Event.prototype,u(f,"srcElement",function(){return w(this.target)||this.currentTarget}),e(f,"cancelBubble",function(){return this._bubblingCanceled||!1},function(n){n&&(this._bubblingCanceled=!0,this.stopPropagation())}),e(f,"returnValue",function(){return this._cancelDefault},function(n){return n||this.preventDefault(),this._cancelDefault=n,n}),i=n.HTMLElement.prototype,u(i,"parentElement",function(){return this.parentNode}),u(i,"children",function(){for(var i=[],r=this.childNodes.length,t,n=0;n<r;n++)t=this.childNodes[n],t.nodeType==1&&i.push(t);return i}),e(i,"innerText",function(){var t,n;try{return this.textContent}catch(i){for(t="",n=0;n<this.childNodes.length;n++)this.childNodes[n].nodeType==3&&(t+=this.childNodes[n].textContent);return t}},function(n){var t=p.createTextNode(n);this.innerHTML="",this.appendChild(t)}),u(i,"currentStyle",function(){return n.getComputedStyle(this,null)}),t(i,"contains",function(n){while(n!=null&&n!=this)n=n.parentElement;return n!=null}),l=n.DocumentFragment.prototype,t(l,"getElementsByTagName",function(n){for(var f=[],u=[],r=this.childNodes,t,i=0;i<r.length;i++)t=r[i],t.nodeType==1&&u.push(t);while(u.length)if(t=u.shift(),(n=="*"||t.tagName==n)&&f.push(t),r=t.childNodes,r.length!=0)for(i=0;i<r.length;i++)t=r[i],t.nodeType==1&&u.push(t);return f});var a=function(t,i,r){var u;if(!t.documentElement)return[];r=r?r:t;var o=new n.XPathEvaluator,f=o.evaluate(i,r,t.createNSResolver(t.documentElement),n.XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null),e=new Array(f.snapshotLength);for(u=0;u<f.snapshotLength;u++)e[u]=f.snapshotItem(u);return e},b=function(n,t,i){var r,u;if(t+="[1]",r=a(n,t,i),r.length!=0)for(u=0;u<r.length;u++)if(r[u])return r[u];return null},v=n.Document.prototype;t(v,"selectNodes",function(n,t){return a(this,n,t)}),t(v,"selectSingleNode",function(n,t){return b(this,n,t)}),r=n.Node.prototype,t(r,"selectNodes",function(n){var t=this.ownerDocument;return t.selectNodes(n,this)}),t(r,"selectSingleNode",function(n){var t=this.ownerDocument;return t.selectSingleNode(n,this)}),e(r,"text",function(){return this.textContent},function(n){this.textContent=n}),u(r,"xml",function(){return(new n.XMLSerializer).serializeToString(this)})}catch(k){}}(),function(){function r(t){for(var u="",f=t[0],o,r,c,e,i=0;;){if(o=f.indexOf("{",i),r=f.indexOf("}",i),o<0&&r<0){u+=f.slice(i);break}if(r>0&&(r<o||o<0)){if(f.charAt(r+1)!=="}")throw new Error("BraceMismatch");u+=f.slice(i,r+1),i=r+2;continue}if(u+=f.slice(i,o),i=o+1,f.charAt(i)==="{"){u+="{",i++;continue}if(r<0)throw new Error("BraceMismatch");var s=f.substring(i,r),h=s.indexOf(":"),l=parseInt(h<0?s:s.substring(0,h),10)+1;if(isNaN(l))throw new Error("BadFormat");c=h<0?"":s.substring(h+1),e=t[l],n.isNullOrUndefined(e)&&(e=""),u+=e.toFormattedString?e.toFormattedString(c):e.format?e.format(c):e.toString(),i=r+1}return u}function i(n,t){for(var r=n,i=1;i<t;i++)r+=n;return r}var t=window,n=t.ss;n.isUndefined=function(n){return n===undefined},n.isNullOrUndefined=function(n){return n===null||n===undefined},n.getKeyCount=function(n){var t=0,i;for(i in n)t++;return t},n.clearKeys=function(n){for(var t in n)delete n[t]},n.keyExists=function(n,t){return n[t]!==undefined},n.isNullOrEmpty=function(n){return!n||!n.length},n.format=function(){return r(arguments)},n.replaceAll=function(n,t,i){return i=i||"",n.split(t).join(i)},n.padLeft=function(n,t,r){return n.length<t?(r=r||" ",i(r,t-n.length)+n):n.valueOf()},n.padRight=function(n,t,r){return n.length<t?(r=r||" ",n+i(r,t-n.length)):n.valueOf()},n.compare=function(n,t,i){return(i&&(n&&(n=n.toUpperCase()),t&&(t=t.toUpperCase())),n=n||"",t=t||"",n==t)?0:n<t?-1:1},n.parseXml=function(n){var u,r,i,f;if(!t.DOMParser||t.$B&&t.$B.IE)for(u=["Msxml2.DOMDocument.3.0","Msxml2.DOMDocument"],r=0;r<u.length;r++)try{return i=new t.ActiveXObject(u[r]),i.async=!1,i.loadXML(n),i.setProperty("SelectionLanguage","XPath"),i}catch(e){}else try{return f=new t.DOMParser,f.parseFromString(n,"text/xml")}catch(e){}return null}}(),function(){var t=window,n=t.ss;n.Delegate=function(){},n.Delegate.Null=function(){},n.Delegate._contains=function(n,t,i){for(var r=0;r<n.length;r+=2)if(n[r]===t&&n[r+1]===i)return!0;return!1},n.Delegate._create=function(t){var i=function(){var r,i;if(t.length==2)return t[1].apply(t[0],arguments);for(r=t.clone(),i=0;i<r.length;i+=2)n.Delegate._contains(t,r[i],r[i+1])&&r[i+1].apply(r[i],arguments);return null};return i.invoke=i,i._targets=t,i},n.Delegate.create=function(t,i){return t?(t.ssDelegates||(t.ssDelegates={}),t.ssDelegates[i]||(t.ssDelegates[i]=n.Delegate._create([t,i])),t.ssDelegates[i]):i}}(),function(){var i=window,n=i.ss,t=function(n){this._array=n,this._index=-1};t.prototype={get_current:function(){return this._array[this._index]},moveNext:function(){return this._index++,this._index<this._array.length},reset:function(){this._index=-1}},n.IEnumerator=function(){},n.IEnumerator.prototype={get_current:null,moveNext:null,reset:null},n.IEnumerator.getEnumerator=function(n){return n?n.getEnumerator?n.getEnumerator():new t(n):null}}(),function(){var n=window,t=n.ss;t.CollectionChange=function(n,t,i,r,u){this.action=n,t&&(t instanceof Array||(t=[t])),this.newItems=t||null,typeof i!="number"&&(i=-1),this.newStartingIndex=i,r&&(r instanceof Array||(r=[r])),this.oldItems=r||null,typeof u!="number"&&(u=-1),this.oldStartingIndex=u}}(),function(){function i(n){return this._parts.push(n),this}function r(n){return this._parts.push(typeof n=="undefined"||n===null||n===""?"\r\n":n+"\r\n"),this}function u(){if(arguments.length!==0)throw new Error("InvalidParameterCount");this._parts=[],this._value={},this._len=0}function f(){if(arguments.length!==0)throw new Error("InvalidParameterCount");return this._parts.length===0?!0:this.toString()===""}function e(n){var t,r,i;if(n=n||"",t=this._parts,this._len!==t.length&&(this._value={},this._len=t.length),r=this._value,typeof r[n]=="undefined"){if(n!=="")for(i=0;i<t.length;)typeof t[i]=="undefined"||t[i]===""||t[i]===null?t.splice(i,1):i++;r[n]=this._parts.join(n)}return r[n]}var t=window,n=t.ss;n.StringBuilder=function(t){this._parts=n.isNullOrEmpty(t)?[]:[t.toString()],this._value={},this._len=0},n.StringBuilder.prototype={append:i,appendLine:r,clear:u,isEmpty:f,toString:e}}(),function(){var f=window,e=f.ss,u=f.MC,i=u.ServiceType,n=u.PresenceInfoStatus,o=u.CapabilitiesFlags,t=u.RichPsmLinkType,r=u.ServiceDataHelper=function(){};r.shouldPublishProperty=function(n,t,r){switch(r){case i.IM:if(t&&n==="NOO")return!1;break;case i.PE:if(t&&n==="DisplayPictureUrl")return!1;break;case i.CM:return!1}return!0},r.parseServiceName=function(n){switch(n){case"IM":return i.IM;case"PE":return i.PE;case"PD":return i.PD;case"CM":return i.CM;case"SKP":return i.SKP;default:return i.none}},r.formatServiceType=function(n){switch(n){case i.IM:return"IM";case i.PE:return"PE";case i.PD:return"PD";case i.CM:return"CM";case i.SKP:return"SKP";default:return""}},r.parseStatus=function(t){if(e.isNullOrEmpty(t))return n.none;var i;switch(t){case"NLN":i=n.online;break;case"HDN":i=n.appearOffline;break;case"BSY":i=n.busy;break;case"IDL":i=n.idle;break;case"FLN":i=n.offline;break;case"BRB":i=n.beRightBack;break;case"AWY":i=n.away;break;case"PHN":i=n.inACall;break;case"LUN":i=n.outToLunch;break;default:i=n.none}return i},r.formatStatus=function(t){switch(t){case n.online:return"NLN";case n.appearOffline:return"HDN";case n.busy:return"BSY";case n.idle:return"IDL";case n.offline:return"FLN";case n.beRightBack:return"BRB";case n.away:return"AWY";case n.inACall:return"PHN";case n.outToLunch:return"LUN";case n.none:default:return""}},r.parseCapabilities=function(n){var u,i,t,f;if(e.isNullOrEmpty(n))return[o.none];for(u=n.split(":"),i=new Array(u.length),t=0;t<i.length;t++)f=r._tryParseInt(u[t]),i[t]=f<0?o.none:f;return i},r.formatCapabilities=function(n){var i,t;if(n.length===0)return"0";for(i=new Array(n.length),t=0;t<i.length;t++)i[t]=r._capabilitiesToString(n[t]);return i.join(":")},r.isSet=function(n,t,i){return i!=null&&i.length>n?(i[n]&t)!=0:!1},r.parseRichLinkType=function(n){switch(n){case"0":return t.simpleText;case"1":return t.link;case"2":return t.linkToVideo;case"3":return t.photo;case"4":return t.photos;case"5":return t.video;case"6":return t.document;case"7":return t.location;default:return t.none}},r.convertToRawLinkType=function(n){switch(n){case t.simpleText:return"0";case t.link:return"1";case t.linkToVideo:return"2";case t.photo:return"3";case t.photos:return"4";case t.video:return"5";case t.document:return"6";case t.location:return"7";case t.none:default:return""}},r._capabilitiesToString=function(n){var t=n;return t<0&&(t+=4294967296),t.toString()},r._tryParseInt=function(n){var t=parseInt(n,10);return isNaN(t)?-1:t},r.getDefaultOfflineEndpointData=function(n){var t={};switch(n){case i.CM:t.events="<events />"}return t}}(),function(){var t=window,i=t.$B,r=t.ss,u=t.MC,n=u._nativeJsonParser=function(){};n._dateTimePropertyChangedObjects=[],n._isUnpatchedIE8=!1,n._storedArrayPrototypeMethods={},n._storedObjectPrototypeMethods={},n._isFirefox=t.$B&&i.Firefox?!0:!1,n._addDateTimeChangedObject=function(t,i,r){n._dateTimePropertyChangedObjects.push([t,i,r])},n._recoverDateTimeChangedObjects=function(){for(var i=r.IEnumerator.getEnumerator(n._dateTimePropertyChangedObjects),t;i.moveNext();)t=i.get_current(),t[0][t[1]]=t[2];n._dateTimePropertyChangedObjects.length=0},n._testUnpatchedIE8=function(){var n=t.JSON.stringify(undefined);return!r.isUndefined(n)&&n==="undefined"?!0:!1},n._isUnpatchedIE8=t.$B&&i.IE&&i.V===8&&n._testUnpatchedIE8(),n._deserialize=function(i){n._isUnpatchedIE8&&(n._disablePrototypeExtensions(Array.prototype,n._storedArrayPrototypeMethods),n._disablePrototypeExtensions(Object.prototype,n._storedObjectPrototypeMethods));try{return t.JSON.parse(i,n._reviver)}finally{return n._isUnpatchedIE8&&(n._restorePrototypeMethods(Object.prototype,n._storedObjectPrototypeMethods),n._restorePrototypeMethods(Array.prototype,n._storedArrayPrototypeMethods)),null}},n._restorePrototypeMethods=function(n,t){var f=t,i,u;for(i in f)u={key:i,value:f[i]},n[u.key]=u.value;r.clearKeys(t)},n._disablePrototypeExtensions=function(n,t){var e=n,i,r,u,f,o;for(i in e)r={key:i,value:e[i]},t[r.key]=r.value;u=t;for(f in u)o={key:f,value:u[f]},delete n[o.key]},n._serialize=function(i){var r=t.JSON.stringify(i,n._replacer);return n._recoverDateTimeChangedObjects(),r},n._reviver=n.dateReviver=function(n,t){if(t!=null){var i=t.$date;if(i!=null)return new Date(i)}return t},n._replacer=n.dateReplacer=function(t,i){var r=this[t],u;return r instanceof Date?(u={},u.$date=r.getTime(),n._isFirefox&&(this[t]=u,n._addDateTimeChangedObject(this,t,r)),u):r===""?"":i}}(),function(){var t=window,n=t.MC,r=t.ss,i=n.JSON=function(){};i.deserialize=function(t){if(r.isNullOrEmpty(t))return null;try{return n._nativeJsonParser._deserialize(t)}catch(i){}return null},i.serialize=function(t){if(t==null)return"";try{return n._nativeJsonParser._serialize(t)}catch(i){}return null}}(),function(){var n=window.MC;n.AuthenticationInfo=function(t,i){var r=this;switch(t){}r.authType=t,r.ticket=i,r.uicTicket=null}}(),function(){var n=window.MC;n.MessengerSessionInfo=function(n,t,i,r){var u=this;u.server=n,u.sessionToken=t,u.transactionID=i,u.pendingEvents=r,u.registrationToken=""}}(),function(){var n=window.MC;n.ConsumptionHorizonInfo=function(n,t){var i=this;i.lastReadMessageId=n,i.lastReadMessageTimestamp=t}}(),function(){var n=window.MC;n.ContactInfo=function(n,t,i){var r=this;r.id=n,r.nickname=t,r.addresses=i,r.firstName="",r.lastName="",r.favoritesOrder=null,r.isBlocked=!1,r.fullName=null,r.cid=null,r.pictureUrl=null,r.skypePendingOutbound=!1}}(),function(){var n=window.MC;n.CallEventMessageInfo=function(n){this.duration=n}}(),function(){var n=window.MC;n.ThreadActivityMessageInfo=function(n,t,i,r){var u=this;u.type=n,u.initiator=t,u.targets=i,u.otherInfo=r}}(),function(){var n=window.MC;n.GroupConversationMemberInfo=function(n,t){var i=this;i.address=n,i.linkedAddress=t,i.isAdmin=!1,i.capabilities=0}}(),function(){var n=window.MC;n.GroupConversationInfo=function(n,t){var i=this;i.id=n,i.version=t,i.capabilities=0,i.userInitiated=!1}}(),function(){var n=window.MC;n.SkypeInitializationInfo=function(n,t,i,r){var u=this;u.liveId=n,u.cid=t,u.buddy=i,u.networks=r}}(),function(){var n=window.MC;n.DateInfo=function(n){this.utcMilliseconds=n.getTime()}}(),function(){var n=window.MC;n.DatagramInfo=function(n,t){var i=this;i.datagramType=n,i.payload=t}}(),function(){var n=window.MC;n.IdentityInfo=function(n,t){var i=this;i.liveId=n,i.skypeId="",i.endpointId=t,i.cid="",i.experienceId=null,i.applicationId=null,i.authenticationInfo=null}}(),function(){var n=window.MC;n.IMAddressInfo=function(t,i,r,u){var f=this;f.address=i===n.IMAddressInfoType.connect?t:t!=null?t.toLowerCase():null,f.type=i,f.roleLists=r,f.messagingAddress=u,f.cid="",f.type===n.IMAddressInfoType.cid&&(f.cid=t),f.id=f.address,f.isFan=!1,f.isFacebookMobileEnabled=!1,f.network=null,f.applicationId=null,f.skypeId=null,f.inviteMessage=null}}(),function(){var n=window.MC;n.LogRequestMessageInfo=function(n,t){var i=this;i.uploadUrl=n,i.authToken=t}}(),function(){var n=window.MC;n.MailNotificationActivityInfo=function(n,t,i){var r=this;r.source=n,r.destination=t,r.delta=i}}(),function(){var n=window.MC;n.MailNotificationIncomingInfo=function(n,t,i,r,u,f){var e=this;e.from=n,e.fromAddress=t,e.messageUrl=i,e.subject=r,e.folder=u,e.id=f}}(),function(){var n=window.MC;n.MailNotificationInfo=function(n,t){var i=this;i.notification=n,i.type=t}}(),function(){var n=window.MC;n.MailNotificationInitialInfo=function(n,t,i,r){var u=this;u.inboxUnread=n,u.inboxTotal=t,u.foldersUnread=i,u.foldersTotal=r}}(),function(){var n=window.MC;n.MessageInfo=function(t,i){var r=this;r.type=t,r.sender=null,r.timestamp=new n.DateInfo(new Date),r.id=null,r.clientId=null,r.targetEndpointId=null,r.isOfflineMessage=!1,r.isHistoryMessage=!1,r.isRecentMessage=!1,r.isLastHistoryMessage=!1,r.info=i}}(),function(){var n=window.MC;n.MessengerSessionEvents=function(n){this.events=n||[]}}(),function(){var n=window.MC;n.MessengerSessionState=function(n,t,i,r,u,f){var e=this;e.server=n,e.sessionToken=t,e.transactionID=i,e.services=r,e.disconnected=u,e.identity=f,e.registrationToken=""}}(),function(){var n=window.MC;n.NetworkInfo=function(t,i,r,u,f,e,o,s){var h=this;h.id=t,h.name=i,h.connectionType=r,h.photoUrlFormat=f,h.profileUrlFormat=e,h.sendMessageUrlFormat=o,h.reportAbuseUrlFormat=s,h.supportsIM=r!==n.NetworkConnectionType.none,h.imEnabled=!1,h.tokenState="",h.status=n.NetworkInfoStatus.signedOut,h.isRemoteNetwork=u,h.rank=0}}(),function(){var n=window.MC;n.PersonInfo=function(n,t){var i=this;i.id=n,i.contacts=t}}(),function(){var n=window.MC;n.ServiceDataInfo=function(n,t,i){var r=this;r.service=n,r.properties=t,r.endpointData=i}}(),function(){var n=window.MC;n.ServiceDataDiff=function(n){this.service=n,this.updatedEndpoints={},this.updatedProperties=[],this.deletedEndpoints={},this.newEndpoints={}},n.ServiceDataDiff.prototype={service:n.ServiceType.none,updatedProperties:null,updatedEndpoints:null,newEndpoints:null,deletedEndpoints:null}}(),function(){var n=window.MC;n.ServiceEndpointDataInfo=function(n,t,i){var r=this;r.endpointId=n,r.service=t,r.properties=i}}(),function(){var n=window.MC;n.TextMessageFormatInfo=function(n,t,i,r){var u=this;u.fontColor=n,u.fontFamily=t||"",u.fontStyle=i,u.rightToLeft=r}}(),function(){var n=window.MC;n.TextMessageInfo=function(n,t){var i=this;i.text=n,i.format=t,i.safeUrl=""}}(),function(){var t=window,u=t.ss,f=window.MC,r=t.$ScenarioQoS,i=t.wLive,n=f.WebmainHelper=function(){};n._qoSPropertyId="WebIM",n.qoSScenarioSendIm="WebIM_SendIm",n.qoSScenarioSignin="WebIM_Signin",n.qoSScenarioReconnect="WebIM_Reconnect",n.qoSScenarioRecentConversations="WebIM_RecentConversations",n.qoSScenarioConversationHistory="WebIM_ConversationHistory",n.qoSScenarioDeleteConversations="WebIM_DeleteConversations",n.qoSScenarioGroupChatCreateGroup="WebIM_GroupChatCreateGroup",n.qoSScenarioGroupChatAddContacts="WebIM_GroupChatAddContacts",n.qoSScenarioGroupChatLeaveGroup="WebIM_GroupChatLeaveGroup",n.qoSScenarioResetSkypePendingInboundCount="WebIM_ResetSkypePendingInboundCount",n.qoSScenarioGetInvitations="WebIM_SkypeGetInvitations",n.qoSScenarioOnOffThirdPartyChat="WebIM_OnOffThirdPartyChat",n.qoSScenarioUpdateWebIMSettings="WebIM_UpdateWebIMSettings",n.qoSScenarioSkypeAcceptRequest="WebIM_SkypeAcceptRequest",n.qoSApiGetUic="WebIM_Signin_GetUic",n.qoSApiContactsReady="WebIM_Signin_ContactsReady",n.qoSApiConnectMessenger="WebIM_Signin_ConnectMessenger",n.qoSApiReconnect="WebIM_Reconnect_Call",n.qoSApiSendIm="WebIM_SendIm_Call",n.qoSApiRecentConversations="WebIM_RecentConversations_Call",n.qoSApiDeleteConversations="WebIM_DeleteConversations_Call",n.qoSApiConversationHistory="WebIM_ConversationHistory_Call",n.qoSApiGroupChatCreateGroup="WebIM_GroupChatCreateGroup_Call",n.qoSApiGroupChatAddContacts="WebIM_GroupChatAddContacts_Call",n.qoSApiGroupChatLeaveGroup="WebIM_GroupChatLeaveGroup_Call",n.qoSApiResetSkypePendingInboundCount="WebIM_ResetSkypePendingInboundCount_Call",n.qoSApiGetInvitations="WebIM_GetInvitations_Call",n.qoSApiOnThirdPartyChat="WebIM_OnThirdPartyChat_Call",n.qoSApiOffThirdPartyChat="WebIM_OffThirdPartyChat_Call",n.qoSApiUpdateWebIMSettings="WebIM_UpdateWebIMSettings_Call",n.qoSApiSkypeAcceptRequest="WebIM_SkypeAcceptRequest_Call",n.qoSSigninApiStartTime=0,n.qoSReconnectApiStartTime=0,n.qoSGetInvitationsApiStartTime=0,n.qoSSkypeAcceptRequestApiStartTime=0,n.qoSResetSkypePendingInboundCountApiStartTime=0,n.qoSOnOffThirdPartyChatApiStartTime=0,n.isQoS=function(){return t.$ScenarioQoS!=null?!0:!1},n.isConfig=function(){return t.$Config!=null?!0:!1},n.isWlxIM=function(){return t.$WLXIM!=null?!0:!1},n.startQoS=function(t){return n.isQoS()?r.startScenario(t,n._qoSPropertyId):null},n.stopQoS=function(t,i,u,f){if(t&&t.id){var e=!i,o=i?null:u;n.peopleLog({eventType:t.id,resultCode:o},e)}n.isQoS()&&t!=null&&r.stopScenario(t,i,u,f?"c":undefined)},n.addQoSStats=function(t,i,r,u,f){n.isQoS()&&u!=null&&window.$WLXIM.addScenarioQoSStats(t,i,r,u,f)},n.qoSResetTime=function(t){switch(t){case n.qoSScenarioSignin:n.qoSSigninApiStartTime=+new Date;break;case n.qoSScenarioReconnect:n.qoSReconnectApiStartTime=+new Date;break;case n.qoSScenarioGetInvitations:n.qoSGetInvitationsApiStartTime=+new Date;break;case n.qoSScenarioResetSkypePendingInboundCount:n.qoSResetSkypePendingInboundCountApiStartTime=+new Date;break;case n.qoSScenarioOnOffThirdPartyChat:n.qoSOnOffThirdPartyChatApiStartTime=+new Date;break;case n.qoSScenarioSkypeAcceptRequest:n.qoSSkypeAcceptRequestApiStartTime=+new Date}},n.getQueryParameterByName=function(n){var i=window.location.href.indexOf("?"),t,f;if(i<0)return"";for(var e=window.location.href.substr(i+1),o=e.split("&"),r=u.IEnumerator.getEnumerator(o);r.moveNext();)if(t=r.get_current(),t.toLowerCase().startsWith(n.toLowerCase()))return f=t.indexOf("="),decodeURIComponent(t.substr(f+1));return""},n.peopleLog=function(n,t){i&&i.People&&n&&n.eventType&&(n.eventType.indexOf("WebIM_")!=0&&(n.eventType="WebIM_"+n.eventType),i.People.Reporter.log(n,t))}}(),function(){var n=window.MC;n.GroupChatFeatures=function(){},n.GroupChatFeatures.phase=n.GroupChatPhase.disabled,window.$Config.WebIM.gc&&(n.GroupChatFeatures.phase=n.GroupChatPhase.creation)}(),function(){var n=window,o=n.$pwc,i=n.MC,t=i.WebmainHelper,e=1e3,r=0,u=1,f=2;i.Settings=function(){var o=this,i=[],h=-1,s=n.$pwc.settings.getWebIMSettings(),c;s&&(i=s.split(",")),o.get_peopleFilter=function(){var n=parseInt(i[r]);return isNaN(n)?null:n},o.set_peopleFilter=function(n){(n||n===0)&&!isNaN(n)&&(i[r]=n.toString(),c())},o.get_userPresencePreference=function(){var n=parseInt(i[u]);return isNaN(n)?null:n},o.set_userPresencePreference=function(n){n==null||isNaN(n)||(i[u]=n.toString(),c())},o.get_upsellClosedFlag=function(){var n=parseInt(i[f]);return n==1},o.set_upsellClosedFlag=function(n){i[f]=n===!0?1:0,c()},c=function(){var r=i.join(",");s!=r&&(s=r,h!=-1&&n.clearTimeout(h),h=n.setTimeout(function(){var i,u,r;h=-1,i=new n.XMLHttpRequest,i.open("POST",n.location.protocol+"//"+n.location.host+"/Handlers/PeopleApi/UpdateWebIMSettings.mvc",!0),i.setRequestHeader("X-Requested-With","XMLHttpRequest"),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),i.onreadystatechange=function(){if(i.readyState==4)if(i.status==200)t.addQoSStats(t.qoSApiUpdateWebIMSettings,null,u,r,!1),t.stopQoS(r,!0,null);else{var n=i.status.toString();i.statusText&&(n+=", "+i.statusText),t.addQoSStats(t.qoSApiUpdateWebIMSettings,n,u,r,!1),t.stopQoS(r,!1,n)}},u=+new Date,r=t.startQoS(t.qoSScenarioUpdateWebIMSettings),i.send("canary="+encodeURIComponent(n.$Config.ContactCache.canary)+"&webIMSettings="+s)},e))}}}(),function(n){var r=window,u=r.Microsoft,i=r.$BSI,t=u.Live.Messenger.Services.SkyJSHelper=function(){};t._id="SkyJS",t._skyjs=null,t._pluginStartTime=new Date,t.isCallInProgress=!1,t.isPluginLoaded=!1,t.skypeEnabled=!1,t.initErrorCode=null,t.skypeAudioVideoEnabled=!1,t.initCompleted=!1,t.getInstance=function(){return t._skyjs==null&&(t._skyjs=window[t._id]),t._skyjs},t.get_skypeInitCompleted=function(){return t.initCompleted},t.set_skypeInitCompleted=function(){t.initCompleted=!0,n(t).triggerHandler("initCompleted")},t.skypeCallStarted=function(){t.isCallInProgress=!0,t.isPluginLoaded=!1,n(t).triggerHandler("callStarted"),t._pluginStartTime=new Date},t.skypePluginStarted=function(){t.isPluginLoaded=!0,n(t).triggerHandler("pluginLoaded"),t.reportPluginStartDuration()},t.skypeCallFinished=function(){t.isCallInProgress=!1,t.isPluginLoaded=!1,n(t).triggerHandler("callFinished")},t.reportSkypeLogin=function(n,r){if(t.initErrorCode=r,window.$BSI){var u={};u.HasSkype=n?1:0,u.ErrorCode=r,i.reportEvent("WebIM.SkypeLogin",u)}},t.reportAudioVideoStarted=function(n){if(window.$BSI){var t={};t.WebIMLaunchPoint="recentConversations",t.ConversationType=n?"video":"voice",t.isOverlayMode=window.$WLXIM.isSidebarOverlay(),i.reportEvent("WebIM.ConversationStarted",t)}},t.reportPluginStartDuration=function(){if(window.$BSI){var r=Math.floor((new Date-t._pluginStartTime)/1e3),n={};n.PluginStartTime=r,i.reportEvent("WebIM.SkypePluginStart",n)}}}(window.originaljQuery||jQuery),function(){var u=window,t=u.ss,n=u.MC,i=n.ServiceType,r=n.ServiceEndpointData=function(n){this.info=n};r.create=function(t){switch(t.service){case i.PE:return new n.PEServiceEndpointData(t);case i.IM:return new n.IMServiceEndpointData(t);case i.PD:return new n.PDServiceEndpointData(t);case i.CM:return new n.CMServiceEndpointData(t);case i.SKP:return new n.SKPServiceEndpointData(t);default:return null}},r.createEmpty=function(t,i){return r.create(new n.ServiceEndpointDataInfo(i,t,{}))},r.prototype={info:null,get_capabilities:null,set_capabilities:null,get_client:null,set_client:null,get_clientName:null,set_clientName:null,get_clientType:null,set_clientType:null,get_clientVersion:null,set_clientVersion:null,get_properties:function(){return this.info.properties},get_service:function(){return this.info.service},get_endpointId:function(){return this.info.endpointId},get__info:function(){return this.info},clone:function(){var r=new n.ServiceEndpointDataInfo(this.info.endpointId,this.info.service,{}),u=this.info.properties,t,i;for(t in u)i={key:t,value:u[t]},r.properties[i.key]=i.value;return r},createDiff:function(t){return new n.ServiceEndpointDataInfo(this.info.endpointId,this.info.service,this._createDictionaryDiff(t.info.properties))},_update:function(n,t){var i=[],e=n.properties,r,u,f;for(r in e)u={key:r,value:e[r]},f=u.key,this.updateProperty(f,u.value)&&i.push(f);i.length>0&&(t.updatedEndpoints[this.get__info().endpointId]=i)},propertyEquals:function(n,t){return this.info.properties[n]===t},propertyIsNullOrEmpty:function(n){return t.isNullOrEmpty(this.info.properties[n])},updateProperty:function(n,i){if(i==null){if(t.keyExists(this.info.properties,n)){var r=!this.propertyIsNullOrEmpty(n);return delete this.info.properties[n],r}}else if(!t.keyExists(this.info.properties,n)||!this.propertyEquals(n,i))return this.info.properties[n]=i,!0;return!1},_createDictionaryDiff:function(i){var f={},h=i,r,e,o,s,u;for(e in h)r={key:e,value:h[e]},t.keyExists(this.info.properties,r.key)&&this.propertyEquals(r.key,r.value)||(f[r.key]=r.value);o=this.info.properties;for(s in o)r={key:s,value:o[s]},u=r.key,t.keyExists(i,u)||n.ServiceDataHelper.shouldPublishProperty(u,!1,this.info.service)&&(f[u]=null);return f},get_item:function(n){return t.keyExists(this.info.properties,n)?this.info.properties[n]:""},set_item:function(n,t){return this.info.properties[n]=t,t}}}(),function(){var t=window.MC,n=t.ServiceEndpointData,i=t.CMServiceEndpointData=function(t){n.call(this,t)},r=i.prototype=new n;r.constructor=i,r._update=function(t,i){n.prototype._update.call(this,t,i)}}(),function(){var n=window.MC,i=n.ServiceEndpointData,r=n.SKPServiceEndpointData=function(n){i.call(this,n)},t=r.prototype=new i;t.constructor=r,t.get_nodeInfo=function(){return this.get_item(n.SKPServiceEndpointDataProperties.nodeInfo)},t.set_nodeInfo=function(t){return this.set_item(n.SKPServiceEndpointDataProperties.nodeInfo,t),t},t._update=function(n,t){i.prototype._update.call(this,n,t)}}(),function(){var u=window,n=u.MC,t=u.ss,i=n.ServiceType,r=n.ServiceData=function(t){var i,r,u;if(this.info=t,this.endpointData={},t){i=t.endpointData;for(r in i)u={key:r,value:i[r]},this.endpointData[u.key]=n.ServiceEndpointData.create(u.value)}};r.create=function(t){switch(t.service){case i.PE:return new n.PEServiceData(t);case i.IM:return new n.IMServiceData(t);case i.PD:return new n.PDServiceData(t);case i.CM:return new n.CMServiceData(t);case i.SKP:return new n.SKPServiceData(t);default:return null}},r.createEmpty=function(t){var i=new n.ServiceDataInfo(t,{},{});return r.create(i)},r.prototype={info:null,endpointData:null,get_status:null,get_service:function(){return this.info.service},get_properties:function(){return this.info.properties},get_info:function(){return this.info},get__endpointData:function(){return this.endpointData},addEndpoint:function(n){this.endpointData[n.get_endpointId()]=n,this.info.endpointData[n.get_endpointId()]=n.get__info()},addEndpointFromInfo:function(t){this.endpointData[t.endpointId]=n.ServiceEndpointData.create(t),this.info.endpointData[t.endpointId]=t},getAllEndpoints:function(){var t=[],i=this.endpointData,n,r;for(n in i)r={key:n,value:i[n]},t.push(r.value);return t},getEndpoint:function(n){return t.keyExists(this.endpointData,n)?this.endpointData[n]:null},deleteEndpoint:function(n){delete this.endpointData[n],delete this.info.endpointData[n]},clone:function(){var t=new n.ServiceDataInfo(this.info.service,{},{}),o=this.info.properties,i,r,u,f,e;for(i in o)r={key:i,value:o[i]},t.properties[r.key]=r.value;u=this.endpointData;for(f in u)e={key:f,value:u[f]},t.endpointData[e.key]=e.value.clone();return t},update:function(i){var r=new n.ServiceDataDiff(this.info.service),v=i.properties,s,h,c,l,a,e,u,f,o;for(s in v)h={key:s,value:v[s]},c=h.key,this._updateProperty(c,h.value)&&r.updatedProperties.push(c);l=i.endpointData;for(a in l)e={key:a,value:l[a]},u=e.key,t.keyExists(this.get__endpointData(),u)?(f=this.get__endpointData()[u],f._update(e.value,r)):(o=e.value,f=n.ServiceEndpointData.createEmpty(o.service,u),this.addEndpoint(f),r.newEndpoints[u]=f,t.getKeyCount(o.properties)===0?r.updatedEndpoints[u]=[]:f._update(o,r));return r},Delete:function(i){var f=new n.ServiceDataDiff(this.info.service),c=i.endpointData,e,l,r,u,o,s,h,a;for(e in c)if(l={key:e,value:c[e]},r=l.key,t.keyExists(this.get__endpointData(),r)){u=this.get__endpointData()[r],this.deleteEndpoint(u.get_endpointId()),o=[],s=u.get_properties();for(h in s)a={key:h,value:s[h]},o.push(a.key);f.deletedEndpoints[r]=u,f.updatedEndpoints[r]=o}return f},createDiff:function(i){for(var u=new n.ServiceDataInfo(this.info.service,this._createDictionaryDiff(i.info.properties),{}),e=t.IEnumerator.getEnumerator(i.getAllEndpoints()),r,f;e.moveNext();)r=e.get_current(),t.keyExists(this.get__endpointData(),r.get__info().endpointId)?(f=this.endpointData[r.get__info().endpointId].createDiff(r),t.getKeyCount(f.properties)>0&&(u.endpointData[r.get__info().endpointId]=f)):u.endpointData[r.get__info().endpointId]=r.clone();return u},propertyEquals:function(n,t){return this.info.properties[n]===t},_updateProperty:function(n,i){if(i==null){if(t.keyExists(this.info.properties,n)){var r=this.get_item(n)!=="";return delete this.info.properties[n],r}}else if(!t.keyExists(this.info.properties,n)||!this.propertyEquals(n,i))return this.info.properties[n]=i,!0;return!1},_createDictionaryDiff:function(i){var r,f={},h=i,e,o,s,u;for(e in h)r={key:e,value:h[e]},t.keyExists(this.info.properties,r.key)&&this.propertyEquals(r.key,r.value)||(f[r.key]=r.value);o=this.info.properties;for(s in o)r={key:s,value:o[s]},u=r.key,t.keyExists(i,u)||n.ServiceDataHelper.shouldPublishProperty(u,!0,this.info.service)&&(f[u]=null);return f},get_item:function(n){return t.keyExists(this.info.properties,n)?this.info.properties[n]:""},set_item:function(n,t){return this.info.properties[n]=t,t}}}(),function(){var i=window.MC,n=i.ServiceData,r=i.CMServiceData=function(t){n.call(this,t)},t=r.prototype=new n;t.constructor=r,t.update=function(n){return this._updateAggregatedProperties$1(n,!1)},t.Delete=function(n){return this._updateAggregatedProperties$1(n,!0)},t._updateAggregatedProperties$1=function(t,i){return i?n.prototype.Delete.call(this,t):n.prototype.update.call(this,t)}}(),function(){var r=window,f=r.ss,t=r.MC,i=t.ServiceData,u=t.SKPServiceData=function(n){i.call(this,n)},n;t.SKPServiceData._emailNotVerified$1="(E-mail Address Not Verified)",n=u.prototype=new i,n.constructor=u,n.get_mood=function(){return this.get_item(t.SKPServiceDataProperties.mood)},n.set_mood=function(n){return this.set_item(t.SKPServiceDataProperties.mood,n),n},n.get_skypeName=function(){return this.get_item(t.SKPServiceDataProperties.skypeName)},n.set_skypeName=function(n){return this.set_item(t.SKPServiceDataProperties.skypeName,n),n},n.getEndpointData=function(n){return f.keyExists(this.get__endpointData(),n)?this.get__endpointData()[n]:null},n.update=function(n){return i.prototype.update.call(this,n)}}(),function(){var f=window,e=f.ss,t=f.MC,i=t.IMServiceEndpointDataProperties,r=t.CapabilitiesFlags,u=t.ServiceEndpointData,o=t.IMServiceEndpointData=function(n){u.call(this,n)},n=o.prototype=new u;n.constructor=o,n.get_capabilities=function(){return t.ServiceDataHelper.parseCapabilities(this.get_item(i.capabilities))},n.set_capabilities=function(n){return this.set_item(i.capabilities,t.ServiceDataHelper.formatCapabilities(n)),n},n.get_domain=function(){return this.get_item(i.domain)},n.set_domain=function(n){return this.set_item(i.domain,n),n},n.get_isOnlineViaMobileDevice=function(){return t.ServiceDataHelper.isSet(0,r.onlineViaMobile,this.get_capabilities())},n.get_isOnlineViaWeb=function(){return t.ServiceDataHelper.isSet(0,r.onlineViaWebIM,this.get_capabilities())},n.get_videoCallSupports16By9AspectRatio=function(){return t.ServiceDataHelper.isSet(1,r.videoCallSupports16By9AspectRatio,this.get_capabilities())},n.get_supportsTunneledSip=function(){return t.ServiceDataHelper.isSet(0,r.supportsTunneledSip,this.get_capabilities())},n.get_sipTunnelVersion2=function(){return t.ServiceDataHelper.isSet(1,r.sipTunnelVersion2,this.get_capabilities())},n.get_fTurnCapable=function(){return t.ServiceDataHelper.isSet(1,r.fTurnCapable,this.get_capabilities())},n.get_rtcVideoEnabled=function(){return t.ServiceDataHelper.isSet(1,r.rtcVideoEnabled,this.get_capabilities())},n.get_supportsMultipartyConversations=function(){return t.ServiceDataHelper.isSet(1,r.supportsMultipartyConversations,this.get_capabilities())},n.get_version=function(){var n=this.get_capabilities();return n!=null&&n.length>=1?r.appVersionMask&n[0]:r.none},n._update=function(n,t){var f=this.get_isOnlineViaMobileDevice(),o=this.get_isOnlineViaWeb(),s=this.get_supportsMultipartyConversations(),h=this.get_videoCallSupports16By9AspectRatio(),c=this.get_version(),r;u.prototype._update.call(this,n,t),e.keyExists(t.updatedEndpoints,this.get__info().endpointId)&&(r=t.updatedEndpoints[this.get__info().endpointId],r.contains(i.capabilities)&&(f!==this.get_isOnlineViaMobileDevice()&&r.push(i.isOnlineViaMobileDevice),o!==this.get_isOnlineViaWeb()&&r.push(i.isOnlineViaWeb),h!==this.get_videoCallSupports16By9AspectRatio()&&r.push(i.videoCallSupports16By9AspectRatio),s!==this.get_supportsMultipartyConversations()&&r.push(i.supportsMultipartyConversations),c!==this.get_version()&&r.push(i.version)))},n.propertyEquals=function(n,t){return u.prototype.propertyEquals.call(this,n,t)},n.propertyIsNullOrEmpty=function(n){return u.prototype.propertyIsNullOrEmpty.call(this,n)},n._getObject$1=function(n){return e.keyExists(this.info.properties,n)?this.info.properties[n]:null},n._setObject$1=function(n,t){this.info.properties[n]=t}}(),function(){var o=window,r=o.MC,u=o.ss,e=r.PresenceInfoStatus,t=r.IMServiceDataProperties,i=r.CapabilitiesFlags,f=r.ServiceData,s=r.IMServiceData=function(n){f.call(this,n)},n=s.prototype=new f;n.constructor=s,n.get_isOnline=function(){switch(this.get_status()){case e.none:case e.offline:case e.appearOffline:return!1;default:return!0}},n.get_status=function(){return r.ServiceDataHelper.parseStatus(this.get_item(t.status))},n.set_status=function(n){return this.set_item(t.status,r.ServiceDataHelper.formatStatus(n)),n},n.get_isOnlineViaMobileDevice=function(){return this._isSetAnd$1(0,i.onlineViaMobile)},n.get_isOnlineViaWeb=function(){return this._isSetAnd$1(0,i.onlineViaWebIM)},n.get_videoCallSupports16By9AspectRatio=function(){return this._isSetAnd$1(1,i.videoCallSupports16By9AspectRatio)},n.get_supportsTunneledSip=function(){return this._isSetOr$1(0,i.supportsTunneledSip)},n.get_sipTunnelVersion2=function(){return this._isSetAnd$1(1,i.sipTunnelVersion2)},n.get_fTurnCapable=function(){return this._isSetAnd$1(1,i.fTurnCapable)},n.get_supportsMultipartyConversations=function(){return this._isSetOr$1(1,i.supportsMultipartyConversations)},n.get_version=function(){var n=i.appVersionMask,u=this.endpointData,t,f,r;for(t in u)f={key:t,value:u[t]},r=f.value.get_version(),r<n&&(n=r);return n===i.appVersionMask?i.none:n},n.getEndpointData=function(n){return u.keyExists(this.get__endpointData(),n)?this.get__endpointData()[n]:null},n.update=function(n){return this._updateAggregatedProperties$1(n,!1)},n.Delete=function(n){return this._updateAggregatedProperties$1(n,!0)},n._updateAggregatedProperties$1=function(n,i){var o=this.get_isOnline(),s=this.get_isOnlineViaMobileDevice(),h=this.get_isOnlineViaWeb(),c=this.get_supportsMultipartyConversations(),l=this.get_videoCallSupports16By9AspectRatio(),a=this.get_version(),e=i?f.prototype.Delete.call(this,n):f.prototype.update.call(this,n);return i&&u.getKeyCount(this.endpointData)===0&&this.get_status()!==r.PresenceInfoStatus.offline&&(this.set_status(r.PresenceInfoStatus.offline),e.updatedProperties.push(t.status)),(u.getKeyCount(e.deletedEndpoints)>0||u.getKeyCount(e.newEndpoints)>0||u.getKeyCount(e.updatedEndpoints)>0)&&(this.get_isOnlineViaMobileDevice()!==s&&e.updatedProperties.push(t.isOnlineViaMobileDevice),this.get_isOnlineViaWeb()!==h&&e.updatedProperties.push(t.isOnlineViaWeb),this.get_videoCallSupports16By9AspectRatio()!==l&&e.updatedProperties.push(t.videoCallSupports16By9AspectRatio),this.get_supportsMultipartyConversations()!==c&&e.updatedProperties.push(t.supportsMultipartyConversations),this.get_version()!==a&&e.updatedProperties.push(t.version)),e.updatedProperties.contains(t.status)&&o!==this.get_isOnline()&&e.updatedProperties.push(t.isOnline),e},n._isSetAnd$1=function(n,t){var r,f,e,i;if(u.getKeyCount(this.endpointData)===0)return!1;r=this.get__endpointData();for(f in r)if(e={key:f,value:r[f]},i=e.value.get_capabilities(),i==null||i.length<=n||(i[n]&t)==0)return!1;return!0},n._isSetOr$1=function(n,t){var u=this.get__endpointData(),r,f,i;for(r in u)if(f={key:r,value:u[r]},i=f.value.get_capabilities(),i!=null&&i.length>n&&(i[n]&t)!=0)return!0;return!1}}(),function(){var u=window,o=u.ss,n=u.MC,i=n.PDServiceEndpointDataProperties,r=n.ClientType,f=n.ServiceEndpointData,e=n.PDServiceEndpointData=function(n){f.call(this,n)},t=e.prototype=new f;t.constructor=e,t.get_name=function(){return this.get_item(i.epName)},t.set_name=function(n){return this.set_item(i.epName,n),n},t.get_clientType=function(){var u=this.get_item(i.clientType),t;return o.isNullOrEmpty(u)?r.unknown:(t=n.ServiceDataHelper._tryParseInt(u),t<0?r.unknown:t)},t.set_clientType=function(t){return this.set_item(i.clientType,n.enumToString(r,t)),t}}(),function(){var n=window,f=n.ss,t=n.MC,i=t.ServiceData,r=t.PDServiceData=function(n){i.call(this,n)},u=r.prototype=new i;u.constructor=r,u.getEndpointData=function(n){return f.keyExists(this.get__endpointData(),n)?this.get__endpointData()[n]:null}}(),function(){var e=window,r=e.ss,i=e.MC,t=i.PEServiceEndpointDataProperties,u=i.ClientType,f=i.ServiceEndpointData,o=i.PEServiceEndpointData=function(n){f.call(this,n)},n=o.prototype=new f;n.constructor=o,n.get_capabilities=function(){return i.ServiceDataHelper.parseCapabilities(this.get_item(t.capabilities))},n.set_capabilities=function(n){return this.set_item(t.capabilities,i.ServiceDataHelper.formatCapabilities(n)),n},n.get_client=function(){return this.get_item(t.client)},n.set_client=function(n){return this.set_item(t.client,n),n},n.get_clientName=function(){var n=this.get_client();return this._validateClient$1(n)?n.split(":")[0]:""},n.set_clientName=function(n){var t=this.get_client();return this._validateClient$1(t)?this.set_client(r.format("{0}:{1}",n,t.split(":")[1])):this.set_client(r.format("{0}:",n)),n},n.get_clientType=function(){var f=this.get_item(t.clientType),n;return r.isNullOrEmpty(f)?u.unknown:(n=i.ServiceDataHelper._tryParseInt(f),n<0?u.unknown:n)},n.set_clientType=function(n){return this.set_item(t.clientType,i.enumToString(u,n)),n},n.get_clientVersion=function(){var n=this.get_client();return this._validateClient$1(n)?n.split(":")[1]:""},n.set_clientVersion=function(n){var t=this.get_client();return this._validateClient$1(t)?this.set_client(r.format("{0}:{1}",t.split(":")[0],n)):this.set_client(r.format(":{0}",n)),n},n._update=function(n,i){var e=this.get_clientName(),o=this.get_clientVersion(),u;f.prototype._update.call(this,n,i),r.keyExists(i.updatedEndpoints,this.get__info().endpointId)&&(u=i.updatedEndpoints[this.get__info().endpointId],u.contains(t.client)&&(e!==this.get_clientName()&&u.push(t.clientName),o!==this.get_clientVersion()&&u.push(t.clientVersion)))},n._validateClient$1=function(n){return!r.isNullOrEmpty(n)&&n.split(":").length===2}}(),function(){var f=window,e=f.ss,i=f.MC,t=i.PEServiceDataProperties,u=i.ServiceData,r=i.PEServiceData=function(n){u.call(this,n)},n;r._emailNotVerified$1="(E-mail Address Not Verified)",n=r.prototype=new u,n.constructor=r,n.get_personalMessage=function(){return this.get_item(t.personalMessage)},n.set_personalMessage=function(n){return this.set_item(t.personalMessage,n),n},n.get_displayName=function(){var n=this.get_item(t.displayName),i;return n!=null&&n.endsWith(r._emailNotVerified$1)?(i=n.length-r._emailNotVerified$1.length,n.substr(0,i).rTrim()):n},n.set_displayName=function(n){return this.set_item(t.displayName,n),n},n.get_userTileLocation=function(){return this.get_item(t.userTileLocation)},n.set_userTileLocation=function(n){return this.set_item(t.userTileLocation,n),n},n.get_isIdentityVerified=function(){var n=this.get_item(t.displayName);return n!=null&&!n.endsWith(r._emailNotVerified$1)},n.get_displayPictureUrl=function(){return this.get_item(t.displayPictureUrl)},n.set_displayPictureUrl=function(n){return this.set_item(t.displayPictureUrl,n),n},n.get_richUserMessage=function(){return this.get_item(t.richUserMessage)},n.set_richUserMessage=function(n){return this.set_item(t.richUserMessage,n),this.get_richLinkType()===i.RichPsmLinkType.none&&this.set_richLinkType(i.RichPsmLinkType.simpleText),n},n.get_richUrl=function(){return this.get_item(t.richUrl)},n.set_richUrl=function(n){return this.set_item(t.richUrl,n),n},n.get_richLinkType=function(){return i.ServiceDataHelper.parseRichLinkType(this.get_item(t.richLinkType))},n.set_richLinkType=function(n){return this.set_item(t.richLinkType,i.ServiceDataHelper.convertToRawLinkType(n)),n},n.get_safeUrl=function(){return this.get_item(t.safeUrl)},n.set_safeUrl=function(n){return this.set_item(t.safeUrl,n),n},n.getEndpointData=function(n){return e.keyExists(this.get__endpointData(),n)?this.get__endpointData()[n]:null},n.update=function(n){var r=this.get_isIdentityVerified(),i=u.prototype.update.call(this,n);return i.updatedProperties.contains(t.displayName)&&r!==this.get_isIdentityVerified()&&i.updatedProperties.push(t.isIdentityVerified),i}}(),function(){var r=window,u=r.ss,n=r.MC,t=n.ServiceType,i=n.ServiceEndpointDataSet=function(i,r){this.id=i;for(var u=0;u<r.length;u++)switch(r[u].service){case t.IM:this.imEndpointData=n.ServiceEndpointData.create(r[u]);break;case t.PD:this.pdEndpointData=n.ServiceEndpointData.create(r[u]);break;case t.PE:this.peEndpointData=n.ServiceEndpointData.create(r[u]);break;case t.CM:this.cmEndpointData=n.ServiceEndpointData.create(r[u]);break;case t.SKP:this.skpEndpointData=n.ServiceEndpointData.create(r[u])}};i.create=function(t){return new i(t,[new n.ServiceEndpointDataInfo(t,n.ServiceType.IM,{}),new n.ServiceEndpointDataInfo(t,n.ServiceType.PE,{}),new n.ServiceEndpointDataInfo(t,n.ServiceType.PD,{})])},i.prototype={imEndpointData:null,pdEndpointData:null,peEndpointData:null,cmEndpointData:null,skpEndpointData:null,id:null,toArray:function(){for(var n=[],t=u.IEnumerator.getEnumerator(this.toServiceDataArray()),i;t.moveNext();)i=t.get_current(),n.push(i.get__info());return n},toServiceDataArray:function(){var n=[];return this.imEndpointData!=null&&n.push(this.imEndpointData),this.peEndpointData!=null&&n.push(this.peEndpointData),this.pdEndpointData!=null&&n.push(this.pdEndpointData),n}}}(),function(){var u=window,n=u.MC,i=u.ss,t=n.ServiceType,r=n.ServiceDataSet=function(i){for(var u,r=0;r<i.length;r++){u=i[r].service;switch(u){case t.IM:this.imServiceData=n.ServiceData.create(i[r]);break;case t.PD:this.pdServiceData=n.ServiceData.create(i[r]);break;case t.PE:this.peServiceData=n.ServiceData.create(i[r]);break;case t.CM:this.cmServiceData=n.ServiceData.create(i[r]);break;case t.SKP:this.skpServiceData=n.ServiceData.create(i[r])}}};r.create=function(){return new r([new n.ServiceDataInfo(t.IM,{},{}),new n.ServiceDataInfo(t.PE,{},{}),new n.ServiceDataInfo(t.PD,{},{}),new n.ServiceDataInfo(t.CM,{},{}),new n.ServiceDataInfo(t.SKP,{},{})])},r.createMessengerUpdate=function(t,u){for(var e=[],c=new n.ServiceDataSet(u),h=i.IEnumerator.getEnumerator(t.toServiceDataArray()),f,o,s;h.moveNext();)f=h.get_current(),c.getServiceData(f.get_service())!=null&&e.push(f.clone());for(o=i.IEnumerator.getEnumerator(u);o.moveNext();)f=o.get_current(),t.getServiceData(f.service)==null&&e.push(f);return s=new r(e),s.updateAll(u),s},r.prototype={imServiceData:null,pdServiceData:null,peServiceData:null,cmServiceData:null,skpServiceData:null,clone:function(){for(var n=[],t=i.IEnumerator.getEnumerator(this.toServiceDataArray()),u;t.moveNext();)u=t.get_current(),n.push(u.clone());return new r(n)},addEndpoint:function(n){var t=this.getServiceData(n.get_service());t!=null&&t.addEndpoint(n)},getEndpointSet:function(t){for(var u=[],f=i.IEnumerator.getEnumerator(this.toServiceDataArray()),r;f.moveNext();)r=f.get_current(),i.keyExists(r.get__endpointData(),t)?u.push(r.get__endpointData()[t].get__info()):u.push(new n.ServiceEndpointDataInfo(t,r.get_service(),{}));return new n.ServiceEndpointDataSet(t,u)},createDiff:function(n){for(var u=[],e=i.IEnumerator.getEnumerator(n.toServiceDataArray()),t,f,r;e.moveNext();)t=e.get_current(),f=this.getServiceData(t.get_service()),f==null?u.push(t.clone()):(r=f.createDiff(t),(i.getKeyCount(r.properties)>0||i.getKeyCount(r.endpointData)>0)&&u.push(r));return u},toArray:function(){for(var n=[],t=i.IEnumerator.getEnumerator(this.toServiceDataArray()),r;t.moveNext();)r=t.get_current(),n.push(r.get_info());return n},toServiceDataArray:function(){var n=[];return this.imServiceData!=null&&n.push(this.imServiceData),this.peServiceData!=null&&n.push(this.peServiceData),this.pdServiceData!=null&&n.push(this.pdServiceData),this.cmServiceData!=null&&n.push(this.cmServiceData),this.skpServiceData!=null&&n.push(this.skpServiceData),n},update:function(t){var i=this.getServiceData(t.service);return i!=null?i.update(t):new n.ServiceDataDiff(t.service)},Delete:function(t){var i=this.getServiceData(t.service);return i!=null?i.Delete(t):new n.ServiceDataDiff(t.service)},updateAll:function(n){for(var t=[],r=i.IEnumerator.getEnumerator(n),u;r.moveNext();)u=r.get_current(),t.push(this.update(u));return t},deleteAll:function(n){for(var t=[],r=i.IEnumerator.getEnumerator(n),u;r.moveNext();)u=r.get_current(),t.push(this.Delete(u));return t},getServiceData:function(n){switch(n){case t.IM:return this.imServiceData;case t.PD:return this.pdServiceData;case t.PE:return this.peServiceData;case t.CM:return this.cmServiceData;case t.SKP:return this.skpServiceData}return null},getEndpointServiceData:function(n,t){var r=this.getServiceData(n);return r!=null&&i.keyExists(r.get__endpointData(),t)?r.get__endpointData()[t]:null}}}(),function(){var r=window,i=r.MC,n=i.WebmainHelper,t=i.Logger=function(){};t.logAction=function(t){n.peopleLog({eventType:t})},t.logDetails=function(t,i){n.peopleLog({eventType:t,resultDetails:i})},t.logError=function(t,i){n.peopleLog({eventType:t,error:i})},t.logResult=function(t,i){n.peopleLog({eventType:t,resultCode:i})}}(),function(){var n=window.MSH;n.Timeout={infinite:-1}}(),function(){var e=window,o=e.MSCo,f=e.MSM,l=e.MSP,s=o.Environment=function(){},i,t,r,u,n,h,c;s.production=1,s.dogfood=2,s.integration=3,i=o.HttpMethod=function(){},i.Get=0,i.Post=1,i.Put=2,i.Delete=3,t=o.HttpStatusCode=function(){},t.none=0,t.aborted=1,t.OK=200,t.created=201,t.accepted=202,t.noContent=204,t.movedPermanently=301,t.found=302,t.notModified=304,t.badRequest=400,t.unauthorized=401,t.forbidden=403,t.notFound=404,t.requestTimeout=408,t.conflict=409,t.gone=410,t.serverError=500,t.notImplemented=501,t.badGateway=502,t.serviceUnavailable=503,r=f.ContentDocumentType=function(){},r.none=0,r.circleDocument=1,r.userDocument=2,r.networkDocument=3,u=f.MriCompareOptions=function(){},u.none=0,u.address=1,u.epId=2,u.addressAndEpId=3,n=f.MsnpStatusCode=function(){},n.success=0,n.invalidParameter=201,n.invalidFederatedUser=203,n.unroutableUser=204,n.invalidUser=205,n.invalidUsername=208,n.invalidFriendlyName=209,n.contactListFull=210,n.alreadyThere=215,n.notAcceptingIMs=217,n.notAcceptingPages=220,n.invalidMsisdn=232,n.unknownMsisdn=233,n.unknownKeitaiDomain=234,n.invalidXmlData=240,n.detailedErrorInPayload=241,n.unknownP2PApp=282,n.unknownUunApp=283,n.messageTooLong=285,n.smsJustOutOfFunds=290,n.addressBookError=403,n.smsSubscriptionRequired=413,n.smsSubscriptionDisabled=414,n.smsOutOfFunds=415,n.smsDisabledMarket=416,n.smsDisabledGlobal=417,n.tryAgainLater=418,n.noMarketSpecified=419,n.internalServerError=500,n.upsDown=504,n.federatedPartnerError=508,n.pageModeMessageError=509,n.detailedError=511,n.oimNotSupported=537,n.smsAccountMuted=550,n.smsAccountDisabled=551,n.smsAccountMaxed=552,n.smsInternalServerError=580,n.smsCarrierInvalid=590,n.smsCarrierNoRoute=591,n.smsCarrierErrored=592,n.smsAddressMappingFull=593,n.smsIncorrectSourceCountry=594,n.smsMobileCacheFull=595,n.smsIncorrectFormat=596,n.smsInvalidText=597,n.smsMessageTooLong=598,n.serverUnavailable=601,n.pagingUnavailable=606,n.sessionRestricted=711,n.sessionOverloaded=712,n.userTooActive=713,n.notExpected=715,n.userRestricted=718,n.sessionFederated=719,n.userFederated=726,n.roamingLogoff=733,n.tooManyEndpoints=734,n.rateLimitExceeded=800,n.perUserLoginLimitExceeded=803,n.authFailed=911,n.accountCompromised=915,n.timedOut=921,n.childWithoutFullConsent=923,n.managedUserLimitedAccessWrongClient=926,n.managedUserAccessDenied=927,n.authError=928,n.domainReserved=931,n.invalidContactList=933,n.invalidSignature=935,h=f.NotificationType=function(){},h.partialNotify=0,h.fullNotify=1,c=l.ServiceDataDocumentType=function(){},c.put=0,c.del=1}(),function(){var f="0123456789abcdef",e=16,i=3,r=window,u=r.ss,t=r.MSH,n=t.BigInt=function(n,t){this._elements=[],this._radix=n,this._elements.insert(0,t),this._length=1,this._normalize()};n.hexRadix=16,n.decRadix=1e3,n._createDec=function(i){return new t.BigInt(n.decRadix,i)},n._createHex=function(t){return new n(n.hexRadix,t)},n._computeHexNegative=function(n,i){for(var u=[],r=0;r<i;r++)u.insert(r,n[r]);for(r=0;r<u.length;r++)u[r]>0&&(u[r]=t.BigInt.hexRadix-u[r],r+1<u.length?u[r+1]=u[r+1]+1:u.length<e&&u.insert(r+1,1));return u},n.parseDecInt=function(t,i){switch(t){case n.decRadix:return n._parseDecIntToDecRadixBigInt(i);case n.hexRadix:return n._parseDecIntToHexRadixBigInt(i);default:return null}},n._parseDecIntToHexRadixBigInt=function(i){var e,s;if(u.isNullOrEmpty(i))return null;e=i.charAt(0)==="-",e&&(i=i.substr(1));var r=9,a=t.BigInt._createHex(1e9),o=t.BigInt._createHex(0),v=Math.ceil(i.length/r),h=t.BigInt._createHex(1),f=i.length;for(s=0;s<v;s++){var c=f-r<0?0:f-r,y=parseInt(i.substr(c,f-c),10),l=n._createHex(y);l.multiply(h),o.add(l),h.multiply(a),f-=r}return o._isNegative=e,o},n._parseDecIntToDecRadixBigInt=function(t){var e,f,r,u;if(t.length===0)return n._createDec(0);for(e=!1,f=[],t.charAt(0)==="-"&&(e=!0,t=t.substr(1,t.length-1)),r=0;i*(r+1)<=t.length;r++)f.insert(r,parseInt(t.substring(t.length-i*(r+1),t.length-i*r),10));return 0!=t.length%i&&f.insert(r++,parseInt(t.substring(0,t.length%i),10)),u=n._createDec(0),u._elements=f,u._length=r,u._isNegative=e,u},n._getHexValues=function(t){for(var r=new Array(t.length),i=0;i<t.length;i++)if(r[i]=n._hexCharValue(t.charAt(i)),r[i]<0)return null;return r},n._hexCharValue=function(n){if(n>="0"&&n<="9")return n-"0";switch(n){case"a":return 10;case"b":return 11;case"c":return 12;case"d":return 13;case"e":return 14;case"f":return 15}return-1},n._toNegativeValues=function(n){for(var t=n.length-1;t>=0;t--)n[t]>0&&(n[t]=16-n[t],t>0&&(n[t-1]+=1));return n},n.prototype={_isNegative:!1,_length:0,_radix:0,_normalize:function(){for(var i,t,n=this._length-1;n>=0;n--)if(this._elements[n]===0)this._length--;else break;for(i=0;i<2;i++)if(this._length===0)this._isNegative=!1;else{if(this._elements[this._length-1]<0){for(n=0;n<this._length;n++)this._elements[n]=-this._elements[n];this._isNegative=!this._isNegative}for(n=0;n<this._length-1;n++)this._elements[n]<0&&(t=Math.ceil(-this._elements[n]/this._radix),this._elements[n]=this._elements[n]+this._radix*t,this._elements[n+1]=this._elements[n+1]-t),this._elements[n]>=this._radix&&(t=Math.floor(this._elements[n]/this._radix),this._elements[n]=this._elements[n]%this._radix,this._elements[n+1]=this._elements[n+1]+t);while(this._elements[this._length-1]>=this._radix)this._ensureCapacity(),this._elements[this._length]=Math.floor(this._elements[this._length-1]/this._radix),this._elements[this._length-1]=this._elements[this._length-1]%this._radix,this._length++;if(this._elements[this._length-1]<0){for(n=0;n<this._length;n++)this._elements[n]=-this._elements[n];this._isNegative=!this._isNegative}else break}},_ensureCapacity:function(){this._length===this._elements.length&&this._elements.push(0)},add:function(n){for(var t=0;t<this._length-n._length;t++)n._elements.insert(n._length+t,0);for(t=0;t<n._length-this._length;t++)this._elements.insert(this._length+t,0);if(this._length=Math.max(n._length,this._length),this._isNegative===n._isNegative)for(t=0;t<this._length;t++)this._elements[t]=this._elements[t]+n._elements[t];else for(t=0;t<this._length;t++)this._elements[t]=this._elements[t]-n._elements[t];this._normalize()},multiply:function(n){for(var r=new t.BigInt(this._radix,0),u,i=0;i<n._length+this._length;i++)i<r._elements.length?r._elements[i]=0:r._elements.insert(i,0);for(i=0;i<n._length;i++){for(u=0;u<this._length;u++)r._elements[i+u]=r._elements[i+u]+n._elements[i]*this._elements[u],r._elements[i+u]!==0&&(r._length=Math.max(r._length,i+u+1));r._normalize()}r._isNegative=n._isNegative!==this._isNegative,this._elements=r._elements,this._isNegative=r._isNegative,this._length=r._length},modulus:function(n){for(var i,r,u,f,t;;){if(n._length===0||this._length===0)break;if(i=this._length-n._length,i<0)break;if(r=this._elements[this._length-1],u=n._elements[n._length-1],r>=u){for(f=Math.floor(r/u),t=0;t<n._length;t++)this._elements[t+i]=this._elements[t+i]-f*n._elements[t];this._normalize();continue}if(i===0)break;this._elements[this._length-2]=this._elements[this._length-2]+this._radix*this._elements[this._length-1],this._length--}this._isNegative&&(n._isNegative?(n._isNegative=!1,this.add(n),n._isNegative=!0):this.add(n)),this._normalize()},toString:function(){switch(this._radix){case n.hexRadix:return this._toHexString();case n.decRadix:return this._toDecString();default:return""}},_toHexString:function(){var t,e,r,i;if(this._elements.length===0)return"0";for(t=this._elements,this._isNegative&&(t=n._computeHexNegative(t,this._length)),e=new u.StringBuilder,r=!1,i=t.length-1;i>=0;i--)r||t[i]!==0&&(r=!0),r&&e.append(f.charAt(t[i]));return e.toString()},_toDecString:function(){var n,t,i;if(this._length===0)return"0";for(n="",t=0;t<this._length;t++)if(n=this._elements[t]+n,t<this._length-1)for(i=10;i<this._radix;i*=10)this._elements[t]<i&&(n=0+n);return this._isNegative&&(n="-"+n),n}}}(),function(){var n=window,t=n.MSH;t.ConvertHelper={tryParseInt:function(n){var t=parseInt(n,10);return isNaN(t)?-1:t},parseHexInt:function(n){var t=parseInt(n,16);return isNaN(t)?0:t}}}(),function(){var n=window,t=n.MSH;t.DateTimeHelper={minValue:new Date(0),parseTimeStamp:function(n){var i=new RegExp("^(\\d{4})-(\\d{2})-(\\d{2})(T|\\s{1})(\\d{2}):(\\d{2}):(\\d{2})\\.(\\d*)Z$"),r=9,t=i.exec(n);return t!=null&&t.length===r?new Date(Date.UTC(parseInt(t[1],10),parseInt(t[2],10)-1,parseInt(t[3],10),parseInt(t[5],10),parseInt(t[6],10),parseInt(t[7],10),parseInt(t[8],10))):new Date},subtract:function(n,t){return n.getTime()-t.getTime()},addMilliseconds:function(n,t){return n.setTime(n.getTime()+t),n}}}(),function(){var t=window,n=t.MSM;n._timedEntry=function(n,t,i){this._key=n,this._obj=t,this._expires=i},n._timedEntry.prototype={_key:0,_obj:null,_expires:null,hasExpired:function(n){return n.getTime()>=this._expires.getTime()},get_key:function(){return this._key},get_object:function(){return this._obj}}}(),function(){var n=window,i=n.MC,t=n.MSM,r=n.MSH;t._timeoutQueue=function(n){this._entries=[],this._timeout=n*1e3},t._timeoutQueue.prototype={_timeout:0,schedule:function(n,i){var u=r.DateTimeHelper.addMilliseconds(new Date,this._timeout);this._entries.push(new t._timedEntry(n,i,u))},cancel:function(n){var t,i,r;if(n>0)for(t=0;t<this._entries.length;t++)if(i=this._entries[t],i.get_key()===n)return r=i.get_object(),this._entries.splice(t,1),r;return null},expireEntries:function(){var t,n,r;if(this._entries.length!==0)for(t=new Date,n=0;n<this._entries.length;n++)r=this._entries[n],r.hasExpired(t)&&(i.Logger.logAction("TimeoutQueueExpireEntries"),this._entries.splice(n--,1))}}}(),function(){function ft(n,t,i){return n&t|~n&i}function et(n,t,i){return n&i|t&~i}function ot(n,t,i){return n^t^i}function st(n,t,i){return t^(n|~i)}function g(n,t){return n<<t|n>>>32-t}function n(n,t,i,r,u,f,e){return n+=ft(t,i,r)+u+e,n=g(n,f),n+=t}function t(n,t,i,r,u,f,e){return n+=et(t,i,r)+u+e,n=g(n,f),n+=t}function i(n,t,i,r,u,f,e){return n+=ot(t,i,r)+u+e,n=g(n,f),n+=t}function r(n,t,i,r,u,f,e){return n+=st(t,i,r)+u+e,n=g(n,f),n+=t}function it(n,t,i,r,u){for(var f=0;f<u;f++)i[r+f]=n[t+f]}var nt=window,tt=nt.MSP,rt=nt.ss,u=7,f=12,e=17,o=22,s=5,h=9,c=14,l=20,a=4,v=11,y=16,p=23,w=6,b=10,k=15,d=21,ut=[128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];tt._mD5=function(){this._state=[0,0,0,0],this._count=[0,0],this._buffer=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this._init()},tt._mD5.prototype={_init:function(){this._count[0]=this._count[1]=0,this._state[0]=1732584193,this._state[1]=4023233417,this._state[2]=2562383102,this._state[3]=271733878},_updateOperation:function(n,t,i){var r,u,f;if(u=this._count[0]>>>3&63,(this._count[0]+=i<<3)<i<<3&&this._count[1]++,this._count[1]+=i>>>29,f=64-u,i>=f){for(it(n,t,this._buffer,u,f),this._transform(this._buffer,0),r=f;r+63<i;r+=64)this._transform(n,t+r);u=0}else r=0;it(n,t+r,this._buffer,u,i-r)},_finalOperation:function(){var t=new Array(16),i=new Array(8),n,r;return this._encode(i,0,this._count,0,8),n=this._count[0]>>>3&63,r=n<56?56-n:120-n,this._updateOperation(ut,0,r),this._updateOperation(i,0,8),this._encode(t,0,this._state,0,16),this._count[0]=this._count[1]=0,this._state[0]=0,this._state[1]=0,this._state[2]=0,this._state[3]=0,this._init(),t},_transform:function(g,nt){var tt=this._state[0],it=this._state[1],rt=this._state[2],ut=this._state[3],ft=new Array(16),et;for(this._decode(ft,0,g,nt,64),tt=n(tt,it,rt,ut,ft[0],u,3614090360),ut=n(ut,tt,it,rt,ft[1],f,3905402710),rt=n(rt,ut,tt,it,ft[2],e,606105819),it=n(it,rt,ut,tt,ft[3],o,3250441966),tt=n(tt,it,rt,ut,ft[4],u,4118548399),ut=n(ut,tt,it,rt,ft[5],f,1200080426),rt=n(rt,ut,tt,it,ft[6],e,2821735955),it=n(it,rt,ut,tt,ft[7],o,4249261313),tt=n(tt,it,rt,ut,ft[8],u,1770035416),ut=n(ut,tt,it,rt,ft[9],f,2336552879),rt=n(rt,ut,tt,it,ft[10],e,4294925233),it=n(it,rt,ut,tt,ft[11],o,2304563134),tt=n(tt,it,rt,ut,ft[12],u,1804603682),ut=n(ut,tt,it,rt,ft[13],f,4254626195),rt=n(rt,ut,tt,it,ft[14],e,2792965006),it=n(it,rt,ut,tt,ft[15],o,1236535329),tt=t(tt,it,rt,ut,ft[1],s,4129170786),ut=t(ut,tt,it,rt,ft[6],h,3225465664),rt=t(rt,ut,tt,it,ft[11],c,643717713),it=t(it,rt,ut,tt,ft[0],l,3921069994),tt=t(tt,it,rt,ut,ft[5],s,3593408605),ut=t(ut,tt,it,rt,ft[10],h,38016083),rt=t(rt,ut,tt,it,ft[15],c,3634488961),it=t(it,rt,ut,tt,ft[4],l,3889429448),tt=t(tt,it,rt,ut,ft[9],s,568446438),ut=t(ut,tt,it,rt,ft[14],h,3275163606),rt=t(rt,ut,tt,it,ft[3],c,4107603335),it=t(it,rt,ut,tt,ft[8],l,1163531501),tt=t(tt,it,rt,ut,ft[13],s,2850285829),ut=t(ut,tt,it,rt,ft[2],h,4243563512),rt=t(rt,ut,tt,it,ft[7],c,1735328473),it=t(it,rt,ut,tt,ft[12],l,2368359562),tt=i(tt,it,rt,ut,ft[5],a,4294588738),ut=i(ut,tt,it,rt,ft[8],v,2272392833),rt=i(rt,ut,tt,it,ft[11],y,1839030562),it=i(it,rt,ut,tt,ft[14],p,4259657740),tt=i(tt,it,rt,ut,ft[1],a,2763975236),ut=i(ut,tt,it,rt,ft[4],v,1272893353),rt=i(rt,ut,tt,it,ft[7],y,4139469664),it=i(it,rt,ut,tt,ft[10],p,3200236656),tt=i(tt,it,rt,ut,ft[13],a,681279174),ut=i(ut,tt,it,rt,ft[0],v,3936430074),rt=i(rt,ut,tt,it,ft[3],y,3572445317),it=i(it,rt,ut,tt,ft[6],p,76029189),tt=i(tt,it,rt,ut,ft[9],a,3654602809),ut=i(ut,tt,it,rt,ft[12],v,3873151461),rt=i(rt,ut,tt,it,ft[15],y,530742520),it=i(it,rt,ut,tt,ft[2],p,3299628645),tt=r(tt,it,rt,ut,ft[0],w,4096336452),ut=r(ut,tt,it,rt,ft[7],b,1126891415),rt=r(rt,ut,tt,it,ft[14],k,2878612391),it=r(it,rt,ut,tt,ft[5],d,4237533241),tt=r(tt,it,rt,ut,ft[12],w,1700485571),ut=r(ut,tt,it,rt,ft[3],b,2399980690),rt=r(rt,ut,tt,it,ft[10],k,4293915773),it=r(it,rt,ut,tt,ft[1],d,2240044497),tt=r(tt,it,rt,ut,ft[8],w,1873313359),ut=r(ut,tt,it,rt,ft[15],b,4264355552),rt=r(rt,ut,tt,it,ft[6],k,2734768916),it=r(it,rt,ut,tt,ft[13],d,1309151649),tt=r(tt,it,rt,ut,ft[4],w,4149444226),ut=r(ut,tt,it,rt,ft[11],b,3174756917),rt=r(rt,ut,tt,it,ft[2],k,718787259),it=r(it,rt,ut,tt,ft[9],d,3951481745),this._state[0]+=tt,this._state[1]+=it,this._state[2]+=rt,this._state[3]+=ut,et=0;et<ft.length;et++)ft[et]=0},_encode:function(n,t,i,r,u){for(var o=t+u,e=r,f=t;f<o;e++,f+=4)n[f]=i[e]&255,n[f+1]=i[e]>>>8&255,n[f+2]=i[e]>>>16&255,n[f+3]=i[e]>>>24&255},_decode:function(n,t,i,r,u){for(var o=r+u,e=t,f=r;f<o;e++,f+=4)n[e]=i[f]|i[f+1]<<8|i[f+2]<<16|i[f+3]<<24},digest:function(n){for(var i=new Array(n.length),t=0;t<n.length;t++)i[t]=n.charCodeAt(t);this._updateOperation(i,0,i.length);var r=this._finalOperation(),f="0123456789abcdef",u=new rt.StringBuilder;for(t=0;t<r.length;t++)u.append(f.charAt(r[t]>>>4&15)),u.append(f.charAt(r[t]&15));return u.toString()}}}(),function(){function f(n){return(new u._mD5).digest(n)}function i(n,i){for(var u=n.toString(2),f=i.toString(2),o=new t.StringBuilder,e=new t.StringBuilder,s=Math.abs(u.length-f.length),r=0;r<s;r++)e.append("0");for(u.length<f.length?(e.append(u),u=e.toString()):f.length<u.length&&(e.append(f),f=e.toString()),r=0;r<u.length;r++)o.append(u.charAt(r)===f.charAt(r)?"0":"1");return parseInt(o.toString(),2)}var r=window,u=r.MSP,n=r.MSH,t=r.ss;u._mD5Auth=function(){},u._mD5Auth.prototype={_int32ToHexString:function(n){for(var u="0123456789abcdef",r=new t.StringBuilder,i=0;i<=3;i++)r.append(u.charAt(n>>i*8+4&15)),r.append(u.charAt(n>>i*8&15));return r.toString()},getMacMD5Hash:function(r,u,e){var w=r+u,l=w,y=8-l.length%8,p,c,o,s,h,v,a;for(y!==8&&(l=t.padRight(l,l.length+y,"0")),p=l.length/4,c=[],o=0,s=0;o<p;o++)c.insert(o,0),c[o]=c[o]+l.charCodeAt(s++)*1,c[o]=c[o]+l.charCodeAt(s++)*256,c[o]=c[o]+l.charCodeAt(s++)*65536,c[o]=c[o]+l.charCodeAt(s++)*16777216;for(h=new Array(4),v=f(r+e),o=0,s=0;o<h.length;o++)h[o]=0,h[o]+=n.ConvertHelper.parseHexInt(v.substr(s,2))*1,s+=2,h[o]+=n.ConvertHelper.parseHexInt(v.substr(s,2))*256,s+=2,h[o]+=n.ConvertHelper.parseHexInt(v.substr(s,2))*65536,s+=2,h[o]+=n.ConvertHelper.parseHexInt(v.substr(s,2))*16777216,s+=2;a=new Array(2),this._cS64_C(c,h,a);var b=i(h[0],a[0]),k=i(h[1],a[1]),d=i(h[2],a[0]),g=i(h[3],a[1]);return this._int32ToHexString(b)+this._int32ToHexString(k)+this._int32ToHexString(d)+this._int32ToHexString(g)},_cS64_C:function(t,i,r){var f=2147483647,h;if(t.length<2||(t.length&1)==1)return!1;var v=i[0]&f,y=i[1]&f,p=i[2]&f,w=i[3]&f,b=242854337,k=n.BigInt.parseDecInt(n.BigInt.decRadix,v.toString()),c=n.BigInt.parseDecInt(n.BigInt.decRadix,y.toString()),d=n.BigInt.parseDecInt(n.BigInt.decRadix,p.toString()),l=n.BigInt.parseDecInt(n.BigInt.decRadix,w.toString()),g=n.BigInt.parseDecInt(n.BigInt.decRadix,b.toString()),a=0,e=n.BigInt.parseDecInt(n.BigInt.decRadix,f.toString()),s=n.BigInt.parseDecInt(n.BigInt.decRadix,"0"),u=n.BigInt.parseDecInt(n.BigInt.decRadix,"0"),o=n.BigInt.parseDecInt(n.BigInt.decRadix,"0");for(h=0;h<t.length/2;h++)s=n.BigInt.parseDecInt(n.BigInt.decRadix,t[a++].toString()),s.multiply(g),s.modulus(e),u.add(s),u.multiply(k),u.add(c),u.modulus(e),o.add(u),u.add(n.BigInt.parseDecInt(n.BigInt.decRadix,t[a++].toString())),u.multiply(d),u.add(l),u.modulus(e),o.add(u);return u.add(c),u.modulus(e),o.add(l),o.modulus(e),r[0]=parseInt(u.toString(),10),r[1]=parseInt(o.toString(),10),!0}}}(),function(){var f=window,t=f.ss,i=f.MC,u=f.MSH,r=i.RoleLists,n=i.IMAddressInfoType,e=wLive.People.Reporter;u.ContactHelper={getIMAddressInfoKey:function(n){return u.ContactHelper.computeIMAddressKey(n.address,n.type,n.network,null)},computeIMAddressKey:function(i,r,u,f){var e;switch(r){case n.connect:e="13:"+i+";via=14:"+u.toLowerCase();break;default:e=r+":"+(i||""),t.isNullOrEmpty(f)||(e+=";path="+f),e=e.toLowerCase()}return e},computeIMAddressId:function(i){var r,u;switch(i.type){case n.windowsLive:r=t.isNullOrEmpty(i.cid)?"1:"+i.address:"11:"+i.cid;break;case n.cid:u=i.cid,r="11:"+u;break;case n.connect:r="13:{0};via=14:"+i.network;break;case n.telephone:r="4:tel:"+i.address;break;case n.smtp:r="16:smtp:"+i.address;break;case n.officeCommunicator:case n.skype:case n.shortCircuit:case n.temporaryGroup:r=i.type+":"+i.address;break;default:return""}return r=r.toLowerCase(),i.type===n.connect&&(r=t.format(r,i.address)),r},createAddressInfos:function(n){var s=[],h=r.allow|r.forward,e=n.getPerson(),i,f,o,c;if((e.getOnHideList()||e.getTrustLevel()===3)&&(h|=r.hide),f=n.getMessagingAddresses(),f!=null&&f.length>0)for(o=t.IEnumerator.getEnumerator(f);o.moveNext();)c=o.get_current(),i=u.ContactHelper.createAddressInfoFromMessagingAddress(c,h),i!=null&&(i.cid=e.getCid(),i.skypeId=n.getSkypeId(),s.push(i));return s},createAddressInfoFromMessagingAddress:function(f,o){var c=null,h=f._getMri().trim().split(":"),y=f._getContact(),p,s,l,a,v,w;return h!=null&&(p=u.ConvertHelper.tryParseInt(h[0]),p!==-1&&(s=p,h.length===2?(s===n.windowsLive||s===n.officeCommunicator||s===n.skype||s===n.shortCircuit||s===n.temporaryGroup||s===n.telephone)&&(c=new i.IMAddressInfo(h[1],s,o,f)):h.length===3&&((s===n.skype||s===n.shortCircuit)&&h[1]==="live"?c=new i.IMAddressInfo("live:"+h[2],s,o,f):s===n.connect&&(l=y.getSourceId(),a="",l==="GOOG"?(v=h[1].trim().split(";"),v!=null&&v.length>0&&(a=v[0])):a=y.getObjectId(),t.isNullOrEmpty(a)||t.isNullOrEmpty(l)||(w=r.allow|r.forward,c=new i.IMAddressInfo(a,n.connect,w,f),c.network=l),l==="FB"&&(c.isFacebookMobileEnabled=y.getOfflineImEnabled()))))),c==null&&e.logError("InvalidMri",t.format("Failed to parse mri {0}",f._getMri())),c},areIMAddressesEqual:function(t,i){if(t===i)return!0;if(t==null||i==null)return!1;if(t.type===i.type)switch(t.type){case n.connect:return t.address===i.address&&t.network===i.network;case n.cid:return t.cid===i.cid;default:return t.address===i.address}return!1}}}(),function(){var n=window,t=n.MSH,i=n.ss;t.Timer=function(n,t,i,r){this._callback=n,this._state=t,this._initialize(i,r)},t.Timer.prototype={_callback:null,_state:null,_period:0,_timeoutId:0,_intervalId:0,change:function(n,t){this._clear(),this._initialize(n,t)},_initialize:function(r,u){this._period=u,r===t.Timeout.infinite||(r===0?this._onTimeout():r>0&&(this._timeoutId=n.setTimeout(i.Delegate.create(this,this._onTimeout),r)))},_clear:function(){this._timeoutId!==0&&(n.clearTimeout(this._timeoutId),this._timeoutId=0),this._intervalId!==0&&(n.clearInterval(this._intervalId),this._intervalId=0)},_onTimeout:function(){this._callback.invoke(this._state),this._timeoutId=0,this._period>0&&(this._intervalId=n.setInterval(i.Delegate.create(this,this._onInterval),this._period))},_onInterval:function(){this._callback.invoke(this._state)},dispose:function(){this._clear()}}}(),function(){var t=window,n=t.MSH;n.Scheduler={defer:function(t){var i=null;i=new n.Timer(function(){i.dispose(),t.invoke()},null,1,n.Timeout.infinite)}}}(),function(){var n=window,t=n.ss,i=n.MSH,r=n.document;i.UriHelper={addParameter:function(n,t,i){var r="?",u=n.indexOf("?");return u!==-1&&(r=n.indexOf("=",u)!==-1?"&":""),n+r+t+"="+i},updateUrlProtocol:function(n){return i.UriHelper.get_isSecureContext()&&n!=null&&n.startsWith("http:")&&(n=t.replaceAll(n,"http:","https:")),n},updateDisplayPictureUrl:function(n){var u;if(n=i.UriHelper.updateUrlProtocol(n),t.isNullOrEmpty(n))return"";if(u="https://",n.startsWith(u)){n=n.substr(u.length);var r=n,e="",f=n.indexOf("/");f>0&&(r=n.substring(0,f),e=n.substr(f)),r.indexOf("messenger.services.live.com")<0&&r.indexOf(".live.com")>0&&(r=t.replaceAll(r,".live.com",".msn.com")),r.indexOf("messenger.live-int.com")<0&&r.indexOf(".live-int.com")>0&&(r=t.replaceAll(r,".live-int.com",".msn-int.com")),n=u+r+e}return n},get_isSecureContext:function(){return i.UriHelper.get_windowLocationProtocol()==="https:"},get_windowLocationProtocol:function(){try{return n.location.protocol.toLowerCase()}catch(i){try{var t=r.location;return t.protocol.toLocaleLowerCase()}catch(u){return"http:"}}}}}(),function(){var n=new RegExp("[\\x00-\\x08\\x0b-\\x0c\\x0e-\\x1f\\x22\\x26\\x27\\x3c\\x3e\\x60]","g"),t=window,r=t.MSH,i=t.ss;r.XmlHelper={getAttribute:function(n,t){var i=n.attributes.getNamedItem(t);return i!=null?i.value:null},isElement:function(n,t){return n.nodeType!==1?!1:n.nodeName===t},xmlNodeValue:function(n){var r,t,u;if(n==null)return"";if(n.nodeType===3)return n.nodeValue;if(n.childNodes.length===0)return n.text||"";for(r=new i.StringBuilder,t=0;t<n.childNodes.length;t++)u=n.childNodes[t],u.nodeType===3&&r.append(u.nodeValue);return r.toString()},xmlEscape:function(t){return t==null?null:(n.lastIndex=0,n.test(t)&&(t=t.replace(n,function(n){return"&#x"+i.padLeft(n.charCodeAt(0).toString(16),2,"0")+";"})),t)}}}(),function(){var n=window.MC;n.IConnectionServiceEvents=function(){},n.IConnectionServiceEvents.prototype={onABChangeNotificationReceived:null,onNetworkStatusChanged:null,onServiceDataChanged:null,onServiceDataDeleted:null,onMailNotificationReceived:null,onDatagramReceived:null,onDisconnected:null,onTransferred:null,onSignInEventsEmpty:null,onTridChanged:null,onRegistrationTokenChanged:null}}(),function(){var n=window.MC;n.IUserServiceEvents=function(){},n.IUserServiceEvents.prototype={onABChangeNotificationReceived:null,onUpdateNetworkCompleted:null,onNetworkStatusChanged:null,onSignedIn:null,onSignedOut:null,onUserServicesUpdated:null,onUserServiceDataUpdated:null,onSignedOutRemotely:null,onMailNotification:null,onServicesChanged:null,onServiceDataChanged:null,onServiceDataDeleted:null,onConversationCreated:null,onConversationGroupCreated:null,onConversationGroupUpdated:null,onConversationAddMembersCompleted:null,onConversationRemoveMembersCompleted:null,onConversationAddressJoined:null,onConversationAddressLeft:null,onConversationGetRecentListCompleted:null,onConversationMessageReceived:null,onConversationHistoryMessagesReceived:null,onConversationConsumptionHorizonUpdated:null,onConversationClearedAtUpdated:null,onConversationClosed:null,onConversationSendMessageFailed:null,onConversationUpdatedId:null,onLogRequestReceived:null,onNotifyWebSignInPendingEventsCompleted:null}}(),function(){function w(){var n=t[o.WebIM.ev];switch(n){case t.dogfood:case t.production:case t.integration:break;default:n=t.production}return n}function b(n){return h(n,"live.com",0)!=null?"mail.live.com":h(n,"live-int.com",0)!=null?"mail.live-int.com":n.toLowerCase()}function h(n,t,i){if(t.startsWith(".")&&(t=t.substr(1)),t=t.toLowerCase(),n=n.toLowerCase(),!n.endsWith("."+t)&&n!==t)return null;if(i===0)return t;var r=n.split("."),u=i+t.split(".").length;return u>r.length&&(u=r.length),r.slice(-1*u).join(".")}var c=1e3,l=1500,a=1200,v=200,u=window,r=u.ss,o=u.$Config,f=u.MSCo,t=f.Environment,y="msmsgs",s=o.WebIM.cn,i="",e="6.4.0.0",p=w(),n=f.Configuration=function(){};n.maximumContactCount=c,n.maximumAllowedContactCount=l,n.maximumBlockedContactCount=a,n.maximumGroupCount=v,n.get_clientId=function(){return r.isNullOrEmpty(s)?"msgrlib":s},n.get_clientVersion=function(){return e},n.get_domainName=function(){return r.isNullOrEmpty(i)&&f.Configuration._initializeDomainName(),i},n.set_domainName=function(n){if(r.isNullOrEmpty(n))throw new Error("Invalid domain name.");return i=b(n),n},n.get_clientDomain=function(){return r.isNullOrEmpty(i)?y:i},n.get_clientVersion=function(){return e},n.set_clientVersion=function(n){return e=n,n},n.get_endpointName=function(){return i},n.get_presenceHostName=function(){return n._getEnvironmentString("geo.gateway.messenger.live.com","dogfood.gateway.messenger.live.com","vip.gateway.edge.messenger.live-int.com")},n.get_sendMessageUrlFormat=function(){var t="http://mail.live.com/?rru=compose%3fto={0}";return n._getEnvironmentString(t,t,"http://mail.live-int.com/?rru=compose%3fto={0}")},n.get_photoUrlFormat=function(){var t="http://cid-{0}.photos.live.com/albums.aspx";return n._getEnvironmentString(t,t,"http://cid-{0}.photos.live-int.com/albums.aspx")},n.get_profileUrlFormat=function(){var t="http://profile.live.com/cid-{0}/";return n._getEnvironmentString(t,t,"http://profile.live-int.com/cid-{0}/")},n.get_displayPictureUrlFormat=function(){var t="http://storage.live.com/users/{0}/myprofile/expressionprofile/profilephoto";return n._getEnvironmentString(t,t,"http://storage.live-int.com/users/{0}/myprofile/expressionprofile/profilephoto")},n.get_messageUrlFormat=function(){var t="http://www.hotmail.msn.com{0}";return n._getEnvironmentString(t,t,"http://www.hotmail.msn-int.com{0}")},n.get_storedMessengerSessionLifetime=function(){return 12e4},n.get_silentReauthDetectionUrl=function(){return""},n.get_silentReauthUrlFormat=function(){return""},n.get_reauthCompletedPageUrl=function(){return""},n.get_httpHeadersRestricted=function(){return!1},n._initializeDomainName=function(){var t=window.location.hostname;r.isNullOrEmpty(t)||n.set_domainName(t)},n._getEnvironmentString=function(n,i,r){switch(p){case t.production:return n;case t.integration:return r;case t.dogfood:return i}return""}}(),function(){var r=window,t=r.MSCo,i=r.ss,n=t.HttpStatusCode;t.HttpResponse=function(n,t,i){this._request$1=n,this._state$1=t,this._status$1=i},t.HttpResponse.prototype={_responseXml:null,_request$1:null,_state$1:null,_status$1:n.none,_content$1:null,get_responseData:function(){return null},get_responseXml:function(){return this._responseXml==null&&(this._responseXml=i.parseXml(this.get_responseText())),this._responseXml},toString:function(){return this.get_responseText()},get_state:function(){return this._state$1},get_responseText:function(){try{return this._content$1==null&&(this._content$1=this._request$1.responseText),this._content$1}catch(n){return""}},get_hasContent:function(){return!i.isNullOrEmpty(this.get_responseText())},get_status:function(){try{if(this._status$1!==n.none)return this._status$1;if(this._request$1.readyState===0)return n.requestTimeout;if(i.isUndefined(this._request$1.status))return n.none;switch(this._request$1.status){case 1223:return n.noContent;case 12002:return n.requestTimeout;case 12007:case 12029:case 12030:case 12031:return n.aborted;case 12152:return n.serverError;default:return this._request$1.status}}catch(t){}return n.none},get_statusText:function(){try{if(this._request$1.readyState===0)return"Request Timeout";switch(this._request$1.status){case 1223:return"No Content";default:return this._request$1.statusText}}catch(n){}return""},getResponseHeader:function(n){try{return this._request$1.getResponseHeader(n)}catch(t){return null}}}}(),function(){function e(n){var i=new RegExp("^https?://([a-z0-9-]+(\\.[a-z0-9-]+)+)(\\:[0-9]+)?([/?].*)?","i"),t=i.exec(n);return t&&t.length>1?t[1]:null}var u=window,n=u.MSCo,f=u.MSH,i=u.ss,r=n.HttpStatusCode,t=n.HttpRequest=function(r,u,f,o,s){this._method=r,this._url=u,this._headers=o,this._postData=f||"",this._onResponse=s,this._timeout=t._requestTimeout,this._domain=e(this._url),i.isNullOrEmpty(this._domain)&&(this._domain=n._httpRequestManager.get_currentDomain()),this._domain!==n._httpRequestManager.get_currentDomain()&&(this._requiresProxy=!0),this._manager=n._httpRequestManager.getManager(this._domain,!0)};t._requestTimeout=3e4,t.get_defaultScheme=function(){return f.UriHelper.get_windowLocationProtocol()+"//"},t._abortRequest=function(n){if(n!=null&&typeof n.abort!="undefined")try{n.abort()}catch(t){}},t._attachOnAbort=function(n,t){if(n!=null)try{n.onabort=t}catch(i){}},t._mapMethodToString=function(t){switch(t){case n.HttpMethod.Get:return"GET";case n.HttpMethod.Post:return"POST";case n.HttpMethod.Put:return"PUT";case n.HttpMethod.Delete:return"DELETE";default:return null}},t.prototype={_method:n.HttpMethod.Get,_url:null,_postData:null,_headers:null,_onResponse:null,_domain:null,_requiresProxy:!1,_state:null,_timeout:0,_xmlHttp:null,_cachedXmlHttp:null,_manager:null,_timer:null,_executing:!1,_abortInvoked:!1,_aborted:!1,get_state:function(){return this._state},set_state:function(n){return this._state=n,n},get__method:function(){return this._method},setTimeout:function(n){this._timeout=n},execute:function(){if(!this._executing){this._executing=!0;this._manager.onExecute(this)}},abort:function(){this._abortInvoked=!0,this._aborted=!0,this._executing&&t._abortRequest(this._xmlHttp)},_send:function(){var r,f,e,o;if(this._startTimeoutTimer(),this._requiresProxy)r={},r.type=this._method===n.HttpMethod.Post?"XMLPost":"XMLGet",r.verb=t._mapMethodToString(this._method),r.timeout=null,r.url=this._url,r.headers=this._headers,r.postString=this._postData,this._xmlHttp=this._manager.proxyRequest(r,i.Delegate.create(this,this._onComplete)),t._attachOnAbort(this._xmlHttp,i.Delegate.create(this,this._onAbort));else{if(this._xmlHttp=new u.XMLHttpRequest,this._xmlHttp.open(t._mapMethodToString(this._method),this._url,!0),this._xmlHttp.onreadystatechange=i.Delegate.create(this,this._onReadyStateChange),t._attachOnAbort(this._xmlHttp,i.Delegate.create(this,this._onAbort)),this._headers!=null&&i.getKeyCount(this._headers)>0){f=this._headers;for(e in f)o={key:e,value:f[e]},this._xmlHttp.setRequestHeader(o.key,o.value)}try{this._xmlHttp.send(this._postData)}catch(s){this._onComplete(this._xmlHttp)}}},_onReadyStateChange:function(){4===this._xmlHttp.readyState&&this._onComplete(this._xmlHttp)},_onAbort:function(){this._aborted=!0},_onComplete:function(n){var t=this;f.Scheduler.defer(function(){t._onCompleteImpl(n)})},_onCompleteImpl:function(t){this._stopTimeoutTimer();var u=new n.HttpResponse(t,this._state,this._aborted?r.aborted:r.none);if(this._cachedXmlHttp!=null)u.get_status()===r.notModified&&(u=new n.HttpResponse(this._cachedXmlHttp,this._state,this._aborted?r.aborted:r.none)),this._cachedXmlHttp=null;else if(this._method===n.HttpMethod.Get&&i.isNullOrEmpty(u.getResponseHeader("Date"))){this._cachedXmlHttp=t,this._headers["If-Modified-Since"]=u.getResponseHeader("Last-Modified")||f.DateTimeHelper.minValue.toUTCString(),this._send();return}if(this._executing=!1,this._xmlHttp=null,this._aborted&&!this._abortInvoked)this._manager.onComplete(this,null,u);else this._manager.onComplete(this,this._onResponse,u)},_onTimeout:function(){this._abortInvoked=!0,t._abortRequest(this._xmlHttp)},_failRequest:function(t){t===r.none&&this._aborted&&(t=r.aborted);var i=new u.XMLHttpRequest,f=new n.HttpResponse(i,this._state,t);this._onResponse.invoke(f)},_startTimeoutTimer:function(){this._stopTimeoutTimer(),this._timer=new f.Timer(i.Delegate.create(this,this._onTimeout),null,this._timeout,f.Timeout.infinite)},_stopTimeoutTimer:function(){this._timer!=null&&(this._timer.dispose(),this._timer=null)}}}(),function(){var o="9.090515.0",s=4,n=window,t=n.document,i=n.MSCo,f=n.MSH,r=n.ss,e={},h=n.location.host.toLowerCase(),u=i._httpRequestManager=function(n){if(this._domain=n,this._pendingRequests=[],this._activeRequests=[],this._domain!==i._httpRequestManager.get_currentDomain()){var r=n.endsWith(t.domain),u=n.indexOf(":");u>0&&n.substring(0,u).endsWith(t.domain)&&(r=!0),r&&(this._requiresProxy=!0,this._generateProxy())}};u.get_currentDomain=function(){return h},u.getManager=function(t,i){t=t.toLowerCase();var f=e[t];if(f!=null||i)f==null?(f=new u(t),e[t]=f,n.attachEvent("onunload",r.Delegate.create(f,f.dispose))):f._ensureInitialized();else return null;return f},u.prototype={_domain:null,_pendingRequests:null,_activeRequests:null,_requiresProxy:!1,_iframeProxy:null,_proxyFailed:!1,_proxy:null,_proxyTimer:null,_disposed:!1,assignProxy:function(n){this._proxy=n,this._proxyFailed=!1,this._stopTimer(),this._process()},_generateProxy:function(){this._proxyFailed=!1,this._iframeProxy=t.createElement("iframe"),this._iframeProxy.style.display="none",this._iframeProxy.src=r.format("{0}//{1}/xmlProxy.htm?vn={2}&domain={3}",f.UriHelper.get_windowLocationProtocol(),this._domain,o,t.domain),this._proxyTimer=new f.Timer(r.Delegate.create(this,this._onTimeout),null,i.HttpRequest._requestTimeout,f.Timeout.infinite),t.body.appendChild(this._iframeProxy)},_ensureInitialized:function(){this._requiresProxy&&this._proxyFailed&&this._generateProxy()},_onTimeout:function(){this._proxy==null&&(this._proxyFailed=!0,t.body.removeChild(this._iframeProxy),this._iframeProxy=null,this._failAllRequests()),this._stopTimer()},onExecute:function(n){this._pendingRequests.push(n),this._process()},onComplete:function(n,t,i){(this._activeRequests.remove(n),this._process(),this._disposed)||t!=null&&t.invoke(i)},proxyRequest:function(n,t){return this._proxy.fetchXML(n,i.Network,this,t)},_process:function(){if(!this._disposed)if(this._requiresProxy&&this._proxy==null)this._proxyFailed&&this._failAllRequests();else while(this._pendingRequests.length>0&&this._activeRequests.length<s){var n=this._pendingRequests.shift();this._activeRequests.push(n),n._send()}},_failAllRequests:function(){while(this._pendingRequests.length>0){var n=this._pendingRequests.shift();n._failRequest(i.HttpStatusCode.notFound)}},_stopTimer:function(){this._proxyTimer!=null&&(this._proxyTimer.dispose(),this._proxyTimer=null)},dispose:function(){var n,t;if(!this._disposed)for(this._disposed=!0,n=r.IEnumerator.getEnumerator(this._activeRequests);n.moveNext();)t=n.get_current(),t.abort()}}}(),function(){var t=window,i=t.Web,r=t.MSCo,n=r.Network=function(){};n._registerProxy=n.registerProxy=function(n){var i=n.location.hostname,t=r._httpRequestManager.getManager(i,!1);t!=null&&t.assignProxy(n)},n.Type={XMLPost:"XMLPost"},n.oninvoke={fire:function(){}},n.onhttperror={fire:function(){}},i.Network=n,i.Browser={isIE:function(){}}}(),function(){var n=window,t=n.ss,i=n.MSM;i.MimeParser=function(n){this._rawHeaders={},this._normalizedHeaders={};var t,i=n.indexOf("\r\n\r\n");i===-1?(t=n,this._body=""):(t=n.substr(0,i),this._body=n.substr(i+4)),this._parseHeaders(t)},i.MimeParser.prototype={_rawHeaders:null,_normalizedHeaders:null,_body:null,_parseHeaders:function(n){for(var r=0,o=n.length,t,i,u,f,e;r<o;)t=n.indexOf("\r\n",r),t===-1&&(t=o),i=n.substring(r,t),i.length>0&&(u=i.indexOf(": "),u!==-1&&(f=i.substring(0,u),e=i.substr(u+2),this._rawHeaders[f]=e,this._normalizedHeaders[f.toLowerCase()]=e)),r=t+2},getHeaders:function(){return this._rawHeaders},getHeader:function(n){return n=n.toLowerCase(),this._normalizedHeaders[n]||null},getBody:function(){return this._body},_getHeaderCount:function(){return t.getKeyCount(this._normalizedHeaders)},getIntHeader:function(n,i){var r=i,u=this.getHeader(n);return t.isNullOrEmpty(u)||(r=parseInt(u,10)),r}}}(),function(){function r(t){var i,u,r;if(n.isNullOrEmpty(t))return 0;for(i=0,u=0;u<t.length;u++)r=t.charCodeAt(u),r<=127?i++:i+=r<=2047?2:r>=55296&&r<=57343?2:3;return i}var t=window,u=t.MSM,n=t.ss,i=u.MimeBuilder=function(){this._headers=[]};i.prototype={_headers:null,_body:null,_disableContentLengthHeader:!1,get_disableContentLengthHeader:function(){return this._disableContentLengthHeader},set_disableContentLengthHeader:function(n){return this._disableContentLengthHeader=n,n},toString:function(){for(var t=new n.StringBuilder,f=n.IEnumerator.getEnumerator(this._headers),i,u;f.moveNext();)i=f.get_current(),t.appendLine(n.format("{0}: {1}",i[0],i[1]));return u=r(this._body),this.get_disableContentLengthHeader()||t.appendLine(n.format("{0}: {1}","Content-Length",u)),t.appendLine(""),u!==0&&t.append(this._body),t.toString()},addHeaders:function(n){var r=n,t,i;for(t in r)i={key:t,value:r[t]},this.setStringHeader(i.key,i.value)},setStringHeader:function(t,i){n.isNullOrEmpty(i)||this._headers.push([t,i])},setIntHeader:function(n,t){t!==-1&&this._headers.push([n,t.toString()])},setBody:function(n){this._body=n}},i.getByteCount=r}(),function(){var e="IM",r=window,f=r.MC,o=r.MSM,s=r.MSH,n=r.ss,t=f.IMAddressInfoType,u=o.MriCompareOptions,i=o.Mri=function(n){this._appId="",this._endpointId="",this._address="",this._path="",this._networkId="";var t=i.tryParse(n);t!=null&&(this._appId=t._appId,this._addressType=t._addressType,this._address=t._address,this._endpointId=t._endpointId,this._path=t._path,this._networkId=t._networkId)};i.getIMAddressInfo=function(i){var r="",e=t.none,u;return n.isNullOrEmpty(i.get_liveId())||(r=i.get_liveId(),e=t.windowsLive),n.isNullOrEmpty(r)&&(n.isNullOrEmpty(i._address)||(r=i._address,e=i._addressType)),u=new f.IMAddressInfo(r,e,f.RoleLists.none),n.isNullOrEmpty(i.get_appId())||(u.applicationId=i.get_appId()),n.isNullOrEmpty(i._networkId)||(u.network=i._networkId),u},i.create=function(r,u,f,o,s){var h=new i("");return h._address=r,h._addressType=u,n.isNullOrEmpty(f)||(h._endpointId=f),n.isNullOrEmpty(o)||(h._appId=o),n.isNullOrEmpty(s)||(h._networkId=s),u===t.temporaryGroup&&(h._path=e),h},i.createFromIMAddressInfo=function(r){var u=new i("");return u._address=r.address,u._addressType=r.type,n.isNullOrEmpty(r.applicationId)||(u._appId=r.applicationId),n.isNullOrEmpty(r.network)||(u._networkId=r.network),r.type===t.temporaryGroup&&(u._path=e),u},i.tryParse=function(r){var u,o,s,f,h,c,l,e;if(!n.isNullOrEmpty(r)){for(u=new i(""),o=r.split(";"),o==null,s=n.IEnumerator.getEnumerator(o);s.moveNext();)if(f=s.get_current(),f.startsWith("appid=")){if(h=f.substr("appid=".length),u.get_appId()!==""||n.isNullOrEmpty(h))return null;u._appId=h}else if(f.startsWith("epid=")){if(c=f.substr("epid=".length),u._endpointId!==""||n.isNullOrEmpty(c))return null;u._endpointId=c}else if(f.startsWith("path=")){if(l=f.substr("path=".length),u._path!==""||n.isNullOrEmpty(l))return null;u._path=l}else if(f.startsWith("via=14:"))u._networkId=f.substr("via=14:".length),u._networkId=u._networkId.toUpperCase();else if(f.startsWith(n.format("{0}:",t.skype)))u._addressType=t.skype,u._address=f.substr(2);else{if(e=f.split(":"),!n.isNullOrEmpty(u._address)||e==null||e.length!==2)return null;u._addressType=parseInt(e[0],10),u._address=e[1],u._addressType===t.remoteNetwork&&(u._address=u._address.toUpperCase())}return u}return null},i.prototype={_addressType:t.none,get_cid:function(){return this._addressType===t.cid?this._address:""},get_appId:function(){return this._appId},get_liveId:function(){return this._addressType===t.windowsLive?this._address:""},get_networkId:function(){return this._networkId},get_endpointId:function(){return this._endpointId},get_address:function(){return this._address},get_addressType:function(){return this._addressType},toString:function(){var i=new n.StringBuilder;return n.isNullOrEmpty(this._address)||i.append(n.format("{0}:{1}",this._addressType,this._address)),n.isNullOrEmpty(this._endpointId)||(i.append(";epid="),i.append(this._endpointId)),n.isNullOrEmpty(this._path)||(i.append(";path="),i.append(this._path)),this._addressType===t.connect&&(i.append(";via=14:"),i.append(this._networkId.toLowerCase())),i.toString()},equals:function(i,r){return(r&u.address)!==u.none&&(this._addressType!==i._addressType||this._address!==i._address||this._addressType===t.connect&&n.compare(this._networkId,i._networkId,!0)!==0)?!1:(r&u.epId)!==u.none&&this._endpointId!==i._endpointId?!1:!0},toConversationId:function(){return s.ContactHelper.computeIMAddressKey(this._address,this._addressType,this._networkId,this._path)}}}(),function(){var t=window,n=t.MSM,i=t.ss;n._msnpCommand=function(n,t){this._fragments=n,this._onResponse=t},n._msnpCommand.prototype={_fragments:null,_onResponse:null,get_name:function(){return this._fragments[0].toString()},toString:function(){for(var t=new i.StringBuilder,f=this._fragments.length,u=0;u<f-2;u++)t.append(this._fragments[u].toString()),t.append(" ");var o=this._fragments[f-2],s=this._fragments[f-1],e=n.MimeBuilder.getByteCount(o),r=n.MimeBuilder.getByteCount(s),h=e+(e>0&&r>0?2:0)+r+(r===0?0:2);return t.append(h.toString()),t.append("\r\n"),t.append(o),e>0&&r>0&&t.append("\r\n"),r>0&&t.append("\r\n"),t.append(s),t.toString()},get_trid:function(){return this._fragments[1]},onComplete:function(n,t){this._onResponse!=null&&this._onResponse.invoke(n,t)}}}(),function(){var n=window,t=n.MSM,i=n.ss;t.MsnpServerCommand=function(n,t){this._name=n,this._parameters=t,this._parseHeaders()},t.MsnpServerCommand.prototype={_name:null,_parameters:null,_skypeIdHeader:null,_ackId:null,_registrationToken:null,get_name:function(){return this._name},get_ackId:function(){return this._ackId},get_registrationToken:function(){return this._registrationToken},get_parameters:function(){return this._parameters},get_skypeIdHeader:function(){return this._skypeIdHeader},set_skypeIdHeader:function(n){return this._skypeIdHeader=n,n},get_allParameters:function(){var n=[],t;return n.addRange(this._parameters),t=this.get__payload(),t!=null&&n.push(this.get__payload()),n},get__payload:function(){return null},_parseHeaders:function(){var r=this._parameters[2],u,t,f,n;if(this._parameters.splice(2,1),!i.isNullOrEmpty(r))for(u=r.split("\r\n"),t=i.IEnumerator.getEnumerator(u);t.moveNext();)if(f=t.get_current(),n=f.split(": "),n.length>1)switch(n[0]){case"Ack-Id":this._ackId=n[1];break;case"Set-Registration":this._registrationToken=n[1]}}}}(),function(){var t=window,i=t.ss,n=t.MSM;n._msnpTextParser=function(){this._buffer$1=""},n._msnpTextParser.prototype={_buffer$1:null,_currCommand$1:null,textMode:!0,addTextToBuffer:function(n){this._buffer$1+=n},_onIncomplete$1:function(){return this._currCommand$1=null,!1},_onSuccess$1:function(t,i){return this._currCommand$1=new n.MsnpServerCommand(t,i),!0},moveNext:function(){for(var o,f,t,h,e,r,c,a;this._buffer$1.length>0;){if(o=this._buffer$1.indexOf("\r\n"),o<=0)return this._onIncomplete$1();var y=this._buffer$1.substring(0,3),n=[],l=this._buffer$1.substring(3,o).split(" ");for(f=0;f<l.length;f++)l[f].length>0&&n.push(l[f]);var s=o+2,v=n.length-1,u=parseInt(n[v]);for(n.splice(v,1),t=u,h=s;u>0;){if(this._buffer$1.length<=h)return!1;e=this._buffer$1.charCodeAt(h),e<=127?u--:e<=2047?(u-=2,t--):e>=55296&&e<=57343?(u-=2,t--):(u-=3,t-=2),h++}return t>0&&(r=this._buffer$1.substr(s,t),r.startsWith("\r\n")?(n.push(""),n.push(r.trim())):(c=r.substr(0,r.indexOf("\r\n\r\n")),n.push(c.trim()),a=r.substr(c.length,r.length-c.length).trim(),i.isNullOrEmpty(a)||n.push(a))),s+=t,this._buffer$1=this._buffer$1.substr(s),this._onSuccess$1(y,n)}return this._onIncomplete$1()},get_currentCommand:function(){return this._currCommand$1},get_textMode:function(){return this.textMode},get_bytesMode:function(){return!this.textMode},addBytesToBuffer:function(){throw new Error("Invalid operation!");}}}(),function(){function a(n){return n>=0?Math.floor(n):Math.ceil(n)}var f=5e3,c=3e4,l=1.5,v=15,y=1e3,p=5,w="/gateway/gateway.dll",t=window,s=t.MC,e=t.MSM,i=t.MSH,h=t.MSCo,n=t.ss,o=h.HttpStatusCode,r=s.Logger,u=e._httpMsnpResponse=function(){};u.success=0,u.closed=1,e._httpMsnpTransport=function(t,i,r,u){this._headers={},this._sendQueue=[],this._parser=new e._msnpTextParser,this._currentNonLongPollInterval=f,this._maxPollInterval=60,this._sessionCookie="",this._useLongPoll=!0,this._events=t,this._debugId=i,this._server=r.toLowerCase(),this._isSecure=u,this._sendCallback=n.Delegate.create(this,this._onSendTimerExpired),this._headers["X-Requested-Session-Content-Type"]="text/html",this._headers["Content-Type"]="text/html; charset=utf-8",this._headers.Pragma="No-Cache",this._headers["X-MSN-Auth"]="Use-Cookie"},e._httpMsnpTransport.prototype={_events:null,_serverType:"NS",_debugId:0,_identity:null,_lastTrid:0,_lastRequestId:0,_sendTimer:null,_maxPollInterval:0,_currentNonLongPollInterval:0,_msnpSendRequestPending:!1,_isSecure:!1,_server:null,_serverName:null,_sessionCookie:null,_sendCallback:null,_sessionPausedCallback:null,_actualInterval:0,_disconnected:!1,_disposed:!1,_hasPendingServerCommands:!1,_pendingRequest:null,_useLongPoll:!1,_consecutiveErrorResponseCount:0,_cachedPostData:null,_hasIssuedFirstRequest:!1,get__responseTimeout:function(){return this._maxPollInterval*1e3+1e4},get__pollDelay:function(){return this._useLongPoll?v:this._currentNonLongPollInterval},_updateCurrentNonLongPollInterval:function(n){n?(this._currentNonLongPollInterval=a(this._currentNonLongPollInterval/l),this._currentNonLongPollInterval<f&&(this._currentNonLongPollInterval=f)):(this._currentNonLongPollInterval=a(this._currentNonLongPollInterval*l),this._currentNonLongPollInterval>c&&(this._currentNonLongPollInterval=c))},_scheduleSendTimer:function(n){this._disposed||(this._sendTimer==null?this._createSendTimer(n):(this._actualInterval===i.Timeout.infinite||this._actualInterval>n)&&(this._actualInterval=n,this._sendTimer.change(n,i.Timeout.infinite)))},_pauseSendTimer:function(){this._cancelSendTimer()},_createSendTimer:function(n){this._actualInterval=n,this._sendTimer=new i.Timer(this._sendCallback,null,n,i.Timeout.infinite)},_cancelSendTimer:function(){this._sendTimer!=null&&(this._sendTimer.dispose(),this._sendTimer=null)},_onSendTimerExpired:function(){(this._pauseSendTimer(),this._msnpSendRequestPending||this._disposed||this._disconnected)||this._sendBatch()},_buildUrl:function(t){var i=new n.StringBuilder;return i.append(this._isSecure?"https://":"http://"),i.append(this._server),i.append(w),i.append("?"),this._sessionCookie.length===0?(i.append("Version=1&Protocol=mtp&Action=open&Server="),i.append(this._serverType),i.append("&IP=none")):(t&&(i.append("Action=poll&"),this._useLongPoll&&this._hasIssuedFirstRequest&&(i.append("Lifespan="),i.append(this._maxPollInterval),i.append("&"))),i.append("SessionID="),i.append(this._sessionCookie)),i.toString()},_getHeaderValue:function(n,t){var u=t+"=",i=n.indexOf(u),r;return i!==-1?(i+=u.length,r=n.indexOf(";",i),r!==-1?n.substring(i,r):n.substr(i)):null},_parseHeaders:function(i){var e={};e["X-MSNSERVER"]=i.getResponseHeader("X-MSNSERVER"),e["X-MSN-Messenger"]=i.getResponseHeader("X-MSN-Messenger"),e["X-MSN-Host"]=i.getResponseHeader("X-MSN-Host"),this._serverName=e["X-MSNSERVER"];var o=e["X-MSN-Messenger"],f=e["X-MSN-Host"],s=this._getHeaderValue(o,"SessionID"),h=this._getHeaderValue(o,"Session");return(t.maxConnectionsPerServer&&t.maxConnectionsPerServer<=2&&(n.isNullOrEmpty(i.getResponseHeader("Via"))||(this._useLongPoll=!1)),n.isNullOrEmpty(f)?f=null:(f=f.toLowerCase(),f!==this._server?(r.logDetails("HttpMsnpTransportParseHeaders",{newHost:f}),this._server=f):f=null),s!=null&&(this._sessionCookie=s),h==="close")?u.closed:u.success},_onResponse:function(t){var h=o.OK,b=null,c=null,k=[],d=!1,e,l,a,v,f,nt,w,g;if(!this._disposed&&(e=t.get_state(),!(e<this._lastRequestId))){if(this._updateCurrentNonLongPollInterval(t.get_hasContent()),this._pendingRequest=null,this._msnpSendRequestPending=!1,t.get_status()===o.OK){if(this._consecutiveErrorResponseCount=0,l=u.success,l=this._parseHeaders(t),t.get_hasContent())try{for(this._parser.get_textMode()?this._parser.addTextToBuffer(t.get_responseText()):this._parser.addBytesToBuffer(t.get_responseData()),a=t.getResponseHeader("X-MSN-SkypeId");this._parser.moveNext();)v=this._parser.get_currentCommand(),n.isNullOrEmpty(a)||v.set_skypeIdHeader(a),k.push(v),this._hasPendingServerCommands=!0}catch(tt){r.logError("HttpMsnpTransportOnResponseParsingContentFailure",tt);throw tt;}l===u.closed&&(r.logAction("HttpMsnpTransportOnResponseConnectionClosed"),this._disconnected=!0,this._cancelSendTimer(),h=o.none,d=!0)}else{if(r.logDetails("HttpMsnpTransportOnResponseParsingContentFailure",{status:t.get_status()}),this._consecutiveErrorResponseCount++,this._consecutiveErrorResponseCount<p&&this._isRecoverableStatus(t.get_status())){this._cachedPostData.length>0&&(this._msnpSendRequestPending=!0),f=this,nt=new i.Timer(function(){(r.logDetails("HttpMsnpTransportOnResponse",{requestId:e}),f._disposed)||f._sendRequest(f._buildUrl(f._cachedPostData.length===0),f._cachedPostData,e)},null,y*this._consecutiveErrorResponseCount,i.Timeout.infinite);return}this._disconnected=!0,this._cancelSendTimer(),h=t.get_status()}for(this._disconnected&&this.dispose(),w=n.IEnumerator.getEnumerator(k);w.moveNext();){g=w.get_current();this._events.onCommand(g)}if(this._disconnected){this._events.onDisconnect(h,d);return}this._hasPendingServerCommands=!1,this._sessionPausedCallback!=null&&this._sendQueue.length===0?(c=this._sessionPausedCallback,b=new s.MessengerSessionInfo(this._server,this._sessionCookie,this._lastTrid,null),this._sessionPausedCallback=null,this.dispose()):this._scheduleSendTimer(this.get__pollDelay()),c!=null&&c.invoke(b)}},_isRecoverableStatus:function(n){if(n===o.requestTimeout)return!0;var t=Math.floor(n/100);return t===5||t===0?!0:!1},_sendBatch:function(){var t,i,u,e;for(this._pauseSendTimer(),t=new n.StringBuilder;this._sendQueue.length>0;)i=this._sendQueue.shift(),t.append(i.toString()),this._lastTrid=i.get_trid();u=t.toString(),e=u.length===0,e||(this._msnpSendRequestPending=!0,this._currentNonLongPollInterval=f,r.logAction("SendBatch")),this._sendRequest(this._buildUrl(e),u,++this._lastRequestId)},_sendRequest:function(t,i,r){this._hasIssuedFirstRequest=!0,this._cachedPostData=i;var u=new h.HttpRequest(h.HttpMethod.Post,t,i,this._headers,n.Delegate.create(this,this._onResponse));this._pendingRequest=u,u.set_state(r),u.setTimeout(this.get__responseTimeout()),u.execute()},sendCommand:function(n){if(!this._disconnected&&!this._disposed&&(this._sendQueue.push(n),!this._msnpSendRequestPending&&!this._hasPendingServerCommands)){if(n.get_name()==="OUT"){this._sendBatch();return}this._scheduleSendTimer(1)}},resume:function(n){(this._sessionCookie=n,this._disposed)||this._pendingRequest!=null||this._hasPendingServerCommands||this._sendBatch()},dispose:function(){if(!this._disposed){this._disposed=!0,this._cancelSendTimer();var n=this._pendingRequest;n!=null&&n.abort()}},pauseSession:function(n){var t=!1,i;this._disposed||(this._hasPendingServerCommands||this._sendQueue.length>0?this._sessionPausedCallback=n:(t=!0,this.dispose()),t&&(i=new s.MessengerSessionInfo(this._server,this._sessionCookie,this._lastTrid,null),n.invoke(i)))},setRpsTicket:function(t){var i="Cookie",r="RPSTAuth=";n.isNullOrEmpty(t)?delete this._headers[i]:this._headers[i]=t.indexOf(";")>0||t.startsWith(r)?t:r+t},setConnectionTimeout:function(n){n>0},get_serverName:function(){return this._serverName},get_identity:function(){return this._identity},set_identity:function(n){return this._identity=n,n}}}(),function(){var r=window,e=r.MC,t=r.MSM,u=r.ss,i=e.Logger,o=0,f=t.MsnpConnection=function(n,i){u.isNullOrUndefined(n)||(this._requests=new t._timeoutQueue(30),this._transport=new t._httpMsnpTransport(this,f._getNewDebugId(),n,i))};f._getNewDebugId=function(){return o++},f.prototype={_transport:null,_currentTrid:0,_disposed:!1,_identity:null,_registrationToken:null,onCommandReceived:null,onTridChanged:null,onDisconnected:null,get_serverName:function(){return this._transport.get_serverName()},get_identity:function(){return this._identity},set_identity:function(n){return this._identity=n,this._transport.set_identity(this._identity),n.authenticationInfo!=null&&n.authenticationInfo.authType===e.AuthenticationType.rpsAuth&&this._transport.setRpsTicket(n.authenticationInfo.ticket),n},get_registrationToken:function(){return this._registrationToken},set_registrationToken:function(n){return this._registrationToken=n,n},setConnectionTimeout:function(n){this._transport.setConnectionTimeout(n)},resume:function(n,t){this._transport.resume(n),this._currentTrid=t},pauseSession:function(n){this._transport.pauseSession(n)},get_nextTrid:function(){this._currentTrid++;this.onTridChanged(this._currentTrid);return this._currentTrid},sendCommand:function(n,r){var f,e;if(this._disposed){i.logAction("MsnpConnectionSendCommand");return}f=n.length,n[f]=n[f-1],n[f-1]="",u.isNullOrEmpty(this._registrationToken)||(n[f-1]=u.format("Registration: {0}",this._registrationToken)),e=new t._msnpCommand(n,r),this._requests.schedule(e.get_trid(),e);this.onSendCommand(e)},onSendCommand:function(n){this._transport.sendCommand(n)},getPendingCommand:function(n){return this._requests.cancel(n)},onCommand:function(n){if(this._disposed){i.logAction("MsnpConnectionOnCommand");return}this._requests.expireEntries();try{this.onCommandReceived(n)}catch(t){i.logError("MsnpConnectionOnCommandFailure",t)}},onDisconnect:function(n,t){if(this._disposed){i.logAction("MsnpConnectionOnDisconnect");return}this.onDisconnected(n,t);this._disposed=!0},dispose:function(){this._disposed=!0,this._transport.dispose()}}}(window.originaljQuery||jQuery),function(){var i=window,r=i.ss,n=i.MSM,t=n.ContentLayer=function(){};t.contentTypeHeader="Content-Type",t.contentTypeCircleDocument="application/circles+xml",t.contentTypeUserDocument="application/user+xml",t.contentTypeNetworkDocument="application/network+xml",t.contentTypeEndOfCallReport="qosreport/xml",t.deserialize=function(t){var i=new n.MimeParser(t);return i.getHeader(n.MessagingLayer._messagingVersionHeader)!=null?n.MessagingLayer.create(i):i.getHeader(n.PublicationLayer._publicationVersionHeader)!=null?n.PublicationLayer.create(i):i.getHeader(n.NotificationLayer._notificationVersionHeader)!=null?n.NotificationLayer.create(i):null},t.prototype={get_appId:null,serialize:null,get_body:null,getDocumentType:function(t,i){if(r.isNullOrEmpty(t))return null;switch(i){case n.ContentDocumentType.circleDocument:return n.ContentLayer.contentTypeCircleDocument;case n.ContentDocumentType.userDocument:return n.ContentLayer.contentTypeUserDocument}return null}}}(),function(){var u=window,h=u.ss,i=u.MSM,f=i.ContentLayer,e="2.0",c="Content-Transfer-Encoding",o="7bit",s="Application-ID",r="Messaging",t=i.MessagingLayer=function(n,t){f.call(this),this._headers$1=n,this._contentEncoding$1=o,this._body$1=t||""},n;t._messagingVersionHeader=r,t.create=function(n){var i=n.getHeader(r);return h.compare(i,e)!==0?null:new t(n.getHeaders(),n.getBody())},n=t.prototype=new f,n.constructor=t,n._headers$1=null,n._contentEncoding$1=null,n._body$1=null,n.get_appId=function(){return this.getHeader(s)},n.set_appId=function(n){return this._setHeader$1(s,n),n},n.get_contentEncoding=function(){return this._contentEncoding$1},n.set_contentEncoding=function(n){return this._contentEncoding$1=n,n},n.get_body=function(){return this._body$1},n.get_headers=function(){return this._headers$1},n.getHeader=function(n){return this._headers$1[n]||""},n._setHeader$1=function(n,t){this._headers$1[n]=t},n.serialize=function(){var n=new i.MimeBuilder;return n.setStringHeader(r,e),this._contentEncoding$1!==o&&n.setStringHeader(c,this._contentEncoding$1),n.addHeaders(this._headers$1),n.setBody(this._body$1),n.toString()}}(),function(){var e=window,t=e.MSM,o=e.MSH,i=e.ss,u=t.NotificationType,f=t.ContentDocumentType,s=t.ContentLayer,h="1.0",c="Uri",l="NotifNum",a="NotifType",v="Full",y="Partial",r=t.NotificationLayer=function(n,t,i,r,u){s.call(this),this._uri$1=n,this._notificationSegment$1=t,this._notificationType$1=i,this._docType$1=r,this._content$1=u},n;r._notificationVersionHeader="Notification",r.create=function(n){var w=n.getHeader(r._notificationVersionHeader),b=n.getHeader(c),o=n.getHeader(t.ContentLayer.contentTypeHeader),p=n.getIntHeader(l,-1),k=n.getBody(),d=n.getHeader(a),e,s;if(i.compare(w,h)!==0||p===-1)return null;if(i.compare(o,t.ContentLayer.contentTypeCircleDocument,!0)===0)e=f.circleDocument;else if(i.compare(o,t.ContentLayer.contentTypeUserDocument,!0)===0)e=f.userDocument;else if(i.compare(o,t.ContentLayer.contentTypeNetworkDocument,!0)===0)e=f.networkDocument;else return null;switch(d){case v:s=u.fullNotify;break;case y:s=u.partialNotify;break;default:return null}return new r(b,p,s,e,k)},n=r.prototype=new s,n.constructor=r,n._notificationType$1=u.partialNotify,n._uri$1=null,n._notificationSegment$1=0,n._docType$1=f.none,n._content$1=null,n._users$1=null,n._headers$1=null,n.get_body=function(){return this._content$1},n.get_documentType=function(){return this._docType$1},n.get_uri=function(){return this._uri$1},n.get_notificationSegment=function(){return this._notificationSegment$1},n.get_notificationType=function(){return this._notificationType$1},n.get_users=function(){return this._users$1==null&&this._parseBody$1(),this._users$1},n.get_pendingUsers=function(){return this._pendingUsers$1==null&&this._parseBody$1(),this._pendingUsers$1},n.serialize=function(){var n=new t.MimeBuilder;return n.setStringHeader(r._notificationVersionHeader,h),n.setStringHeader(c,this._uri$1),this._docType$1!==f.none&&n.setStringHeader(t.ContentLayer.contentTypeHeader,this.getDocumentType(this._content$1,this._docType$1)),n.setIntHeader(l,this._notificationSegment$1),n.setStringHeader(a,this._getNotifyType$1()),n.setBody(this._content$1),n.toString()},n._getNotifyType$1=function(){switch(this._notificationType$1){case u.partialNotify:return y;case u.fullNotify:return v;default:return null}},n._parseBody$1=function(){var f=[],v=[],e,s,y,p,h,c,r,u,a;if(i.isNullOrEmpty(this._content$1))e="roster(IM)/user(",s=this._uri$1.indexOf(e),s!==-1&&(y=this._uri$1.lastIndexOf(")"),p=this._uri$1.substring(s+e.length,y),f.push(new t.Mri(p)));else if(h=i.parseXml(this._content$1),h!=null&&(c=h.documentElement.selectSingleNode("roster"),c!=null&&(r=c.selectNodes("user"),r!=null)))for(u=0;u<r.length;u++){var l=r[u],n=new t.Mri(l.selectSingleNode("id").text),w=l.selectSingleNode("ep/id"),b=l.selectSingleNode("state");w!=null&&(a=o.XmlHelper.xmlNodeValue(w),i.isNullOrEmpty(a)||(n=t.Mri.create(n.get_address(),n.get_addressType(),a,null,null))),b!=null&&o.XmlHelper.xmlNodeValue(b)==="Pending"?v.push(n):f.push(n)}this._users$1=f,this._pendingUsers$1=v}}(),function(){var h="Publication",u="1.0",f="Uri",c="Status-Priority",l="low",e=window,o=e.ss,n=e.MSM,r=n.ContentDocumentType,s=n.ContentLayer,i=n.PublicationLayer=function(n,t,i,r){s.call(this),this._uri$1=n,this._body$1=i,this._docType$1=t,this._statusPriorityLow$1=r},t;i._publicationVersionHeader=h,i.create=function(t){var s=t.getHeader(n.PublicationLayer._publicationVersionHeader),e=t.getHeader(f),h=t.getHeader(n.ContentLayer.contentTypeHeader)||null,c=t.getBody();return o.compare(s,u)===0&&!o.isNullOrEmpty(e)&&h!==n.ContentLayer.contentTypeCircleDocument?new i(e,r.circleDocument,c,!1):null},t=i.prototype=new s,t.constructor=i,t._uri$1=null,t._body$1=null,t._docType$1=r.none,t._statusPriorityLow$1=!1,t.get_body=function(){return this._body$1},t.serialize=function(){var t=new n.MimeBuilder;return t.setStringHeader(n.PublicationLayer._publicationVersionHeader,u),t.setStringHeader(f,this._uri$1),this._docType$1!==r.none&&t.setStringHeader(n.ContentLayer.contentTypeHeader,this.getDocumentType(this._body$1,this._docType$1)),this._statusPriorityLow$1&&t.setStringHeader(c,l),t.setBody(this._body$1),t.toString()}}(),function(){var i="Reliability",r="1.0",u=window,f=u.ss,n=u.MSM,t=n.ReliabilityLayer=function(){};t.deserialize=function(u){var e=new n.MimeParser(u),o=e.getHeader(i)||"";return f.compare(o,r)!==0?null:new t},t.prototype={serialize:function(){var t=new n.MimeBuilder;return t.set_disableContentLengthHeader(!0),t.setStringHeader(i,r),t.toString()}}}(),function(){function nt(t){var i=t.split("/");if(i.length>1)switch(i[1]){case w:return n.online;case b:return n.offline;case d:return n.mobile;case k:return n.history;default:return n.none}return n.none}function tt(n){var i=n.split("/");switch(i[0]){case v:return t.IM;case y:return t.PE;case p:return t.PD;default:return t.none}}function it(n){return n?"0":""}function rt(i,r){var e="",f="",o="";switch(i){case t.PE:e=y;break;case t.PD:e=p;break;case t.IM:e=v}switch(r){case n.mobile:f=d;break;case n.offline:f=b;break;case n.online:f=w;break;case n.history:f=k}return u.isNullOrEmpty(e)||(o=e,u.isNullOrEmpty(f)||(o+="/",o+=f)),o}var s="Routing",h="1.0",c="To",l="From",g="Options",a="Service-Channel",v="IM",y="PE",p="PD",w="Online",b="Offline",k="History",d="Mobile",f=window,u=f.ss,e=f.MC,i=f.MSM,t=e.ServiceType,o=e.IMAddressInfoType,n=e.MessageChannelType,r=i.RoutingLayer=function(n,t){this._to=n,this._from=t};r.deserialize=function(f){var e=new i.MimeParser(f),k=e.getHeader(s)||"",p=e.getHeader(c),w=e.getHeader(l),o;if(u.compare(k,h)!==0||p==null||w==null)return null;var d=r._createMri(p),g=r._createMri(w),v=e.getHeader(a)||"",y=t.IM,b=n.online;return!u.isNullOrEmpty(v)&&(y=tt(v),b=nt(v),y===t.none)?null:(o=new r(d,g),o.set_service(y),o.set_channel(b),o)},r._createMri=function(n){return n.startsWith("4:tel:")?i.Mri.create(n.substr(6),o.telephone,null,null,null):new i.Mri(n)},r.prototype={_service:t.none,_channel:n.none,_to:null,_from:null,_disableSelfFanOut:!1,get_to:function(){return this._to},get_from:function(){return this._from},get_service:function(){return this._service},set_service:function(n){return this._service=n,n},get_channel:function(){return this._channel},set_channel:function(n){return this._channel=n,n},get_disableSelfFanOut:function(){return this._disableSelfFanOut},set_disableSelfFanOut:function(n){return this._disableSelfFanOut=n,n},mapInterLayerInfo:function(n){var r=n instanceof i.MessagingLayer?n:null,t,f,e;r!=null&&(t=r.get_appId(),u.isNullOrEmpty(t)||(f=i.Mri.create(this._from.get_address(),this._from.get_addressType(),this._from.get_endpointId(),t,this._from.get_networkId()),this._from=f,e=i.Mri.create(this._to.get_address(),this._to.get_addressType(),this._to.get_endpointId(),t,this._to.get_networkId()),this._to=e))},serialize:function(){var r=this._to.toString(),u=this._from.toString(),f=rt(this._service,this._channel),e=it(this._disableSelfFanOut),t;return this._to.get_addressType()===o.telephone&&(r=this._to.get_addressType()+":tel:"+this._to.get_address()),t=new i.MimeBuilder,t.set_disableContentLengthHeader(!0),t.setStringHeader(s,h),t.setStringHeader(c,r),t.setStringHeader(l,u),this._channel===n.offline&&this.get_to().get_addressType()===o.skype||t.setStringHeader(a,f),t.setStringHeader(g,e),t.toString()}}}(),function(){var i=window,n=i.MC,r=i.MSP,o=i.MSM,s=i.MSH,f=i.ss,t=n.MailNotificationFolderType,u=n.MailNotificationInfoType,e=r._mailNotificationParser=function(n){this._message=n};e._mapStringToFolder=function(n){if(f.isNullOrEmpty(n))return t.hidden;switch(n.toLowerCase()){case"active":return t.inbox;case"saved":return t.sent;case"draft":return t.drafts;case"trash":return t.trash;case"hm_bulkmail_":return t.junkMail;case"00000000-0000-0000-0000-000000000006":case"00000000-0000-0000-0000-000000000007":case"00000000-0000-0000-0000-000000000008":case"00000000-0000-0000-0000-000000000009":return t.hidden}return t.other},e.prototype={_message:null,_notifications:null,get_notifications:function(){return this._notifications},parse:function(){var t=new o.MimeParser(this._message.getBody()),w=this._message.getHeader("Content-Type").split(";")[0],c,l,a,v,i,e,y,p,h;switch(w){case"text/x-msmsgsinitialmdatanotification":if(c=f.parseXml(t.getHeader("Mail-Data")),l=c!=null?c.documentElement:null,l==null)return n.Logger.logAction("MailNotificationParserParseFailure"),!1;if(a=l.selectSingleNode("E"),a==null)return!1;for(v=["IU","I","OU","O"],i=[0,0,0,0],e=0;e<v.length;e++)y=a.selectSingleNode(v[e]),y!=null&&(p=s.XmlHelper.xmlNodeValue(y.firstChild),p!=null&&(i[e]=parseInt(p,10)));return this._notifications=[new n.MailNotificationInfo(new n.MailNotificationInitialInfo(i[0],i[1],i[2],i[3]),u.initial)],!0;case"text/x-msmsgsemailnotification":return h=r._mailNotificationParser._mapStringToFolder(t.getHeader("Dest-Folder")),this._notifications=[new n.MailNotificationInfo(new n.MailNotificationIncomingInfo(t.getHeader("From"),t.getHeader("From-Addr"),t.getHeader("Message-URL"),t.getHeader("Subject"),h,t.getHeader("id")),u.incoming),new n.MailNotificationInfo(new n.MailNotificationActivityInfo(h,h,-1),u.activity)],!0;case"text/x-msmsgsactivemailnotification":return this._notifications=[new n.MailNotificationInfo(new n.MailNotificationActivityInfo(r._mailNotificationParser._mapStringToFolder(t.getHeader("Src-Folder")),r._mailNotificationParser._mapStringToFolder(t.getHeader("Dest-Folder")),parseInt(t.getHeader("Message-Delta"),10)),u.activity)],!0}return!1}}}(),function(){function o(n){for(var f="\r\n\r\n",u=new Array(3),i=0,t,r=0;r<2;r++){if(t=n.indexOf(f,i),t===-1)break;u[r]=n.substring(i,t),t=t+f.length,i=t}return i<n.length&&(u[r]=n.substr(i)),u}var r=window,e=r.MC,t=r.MSM,f=r.ss,n=e.DatagramInfoType,i=t.ContentDocumentType,u=t.PagedMessage=function(n,t,i,r){this._pageType=n,this._routingLayer=t,this._reliabilityLayer=i,this._contentLayer=r};u.createPagedMessage=function(r,e){var h=o(e),l=t.RoutingLayer.deserialize(h[0]),a,s,c;if(l==null||(a=t.ReliabilityLayer.deserialize(h[1]),a==null))return null;if(s=null,h.length===3&&!f.isNullOrEmpty(h[2])){if(s=t.ContentLayer.deserialize(h[2]),s==null)return null;if(c=s instanceof t.NotificationLayer?s:null,c!=null)if(r===n.del)r=c.get_documentType()===i.userDocument?n.serviceDataDel:n.imGroupDel;else if(r===n.put)switch(c.get_documentType()){case i.networkDocument:r=n.networkDataPut;break;case i.userDocument:r=n.serviceDataPut;break;case i.circleDocument:r=n.imGroupPut}}return l.mapInterLayerInfo(s),new u(r,l,a,s)},u.prototype={_pageType:n.sdg,_routingLayer:null,_reliabilityLayer:null,_contentLayer:null,payLoad:function(){var n=new f.StringBuilder;return n.append(this._routingLayer.serialize()),n.append(this._reliabilityLayer.serialize()),n.append(this._contentLayer.serialize()),n.toString()},get_pageType:function(){return this._pageType},get_routing:function(){return this._routingLayer},get_reliability:function(){return this._reliabilityLayer},get_content:function(){return this._contentLayer}}}(),function(){var t=window,i=t.MC,r=t.MSP,u=t.ss,n=i.NetworkInfoStatus;r._networkDataReader=function(n){this._message=n,this._parse()},r._networkDataReader.prototype={_message:null,_status:n.signedOut,_hasStatus:!1,get_hasStatusData:function(){return this._hasStatus},get_networkId:function(){return this._message.get_routing().get_from().get_address()},get_networkStatus:function(){return this._status},_parse:function(){var o=u.parseXml(this._message.get_content().get_body()),r=o.documentElement,t,f,e;if(r==null||r.nodeName!=="network"){i.Logger.logAction("NetworkDataReaderParseFailure");return}if(f=r.selectSingleNode("status"),f!=null){switch(f.text){case"SigningIn":t=n.signingIn;break;case"SignedIn":t=n.signedIn;break;case"SignedOut":if(t=n.signedOut,e=r.selectSingleNode("details"),e!=null)switch(e.text){case"AbnormalDisconnect":case"CredentialsFetchFailed":case"InternalServerError":t=n.autoReconnectWaiting}break;default:i.Logger.logAction("NetworkDataReaderParseFailure");return}this._status=t,this._hasStatus=!0}}}}(),function(){var r=window,n=r.MC,f=r.MSP,u=r.MSH,t=r.ss,i=n.Logger;f._serviceDataReader=function(t,i,r){this._sender=t,this._documentString=r,this._fromUser=t.type===n.IMAddressInfoType.windowsLive&&t.address===i},f._serviceDataReader.prototype={_documentString:null,_parsed:!1,_result:!1,_serviceData:null,_sender:null,_fromUser:!1,get_serviceData:function(){return this._serviceData},parse:function(){var g,h,o,a,r,v,y,s,l,p,w,f,b,k,d;if(this._parsed)return this._result;if(g=t.parseXml(this._documentString),h=g.documentElement,h==null)return i.logAction("ParseCommandInvalidXml"),this._onFailure(),this._result;if(!u.XmlHelper.isElement(h,"user"))return i.logDetails("ParseCommandInvalidXmlRoot",{element:h.nodeName}),this._onFailure(),this._result;for(var e={},c={},nt=t.IEnumerator.getEnumerator(h.childNodes);nt.moveNext();)if(o=nt.get_current(),a=o.nodeName,a==="s"||a==="sep"){if(r=u.XmlHelper.getAttribute(o,"n"),t.isNullOrEmpty(r))return i.logDetails("ParseCommandMissingServiceName",{element:o.nodeName}),this._onFailure(),this._result;v=this._parseProperties(o,r);switch(a){case"s":if(t.keyExists(e,r))return i.logDetails("ParseCommandDuplicateGlobalSericeData",{serviceName:r}),this._onFailure(),this._result;y=n.ServiceDataHelper.parseServiceName(r),y!==n.ServiceType.none&&(e[r]=new n.ServiceDataInfo(y,v,null));break;case"sep":if(s=u.XmlHelper.getAttribute(o,"epid"),t.isNullOrEmpty(s))return i.logDetails("ParseCommandMisingEpidAttribute",{element:o.nodeName}),this._onFailure(),this._result;if(t.keyExists(c,r)){if(t.keyExists(c[r],s))return i.logDetails("ParseCommandDuplicateEpidAttribute",{serviceName:r,epid:s}),this._onFailure(),this._result}else c[r]={};c[r][s]=new n.ServiceEndpointDataInfo(s,n.ServiceDataHelper.parseServiceName(r),v)}}l=[],p=c;for(w in p)f={key:w,value:p[w]},t.keyExists(e,f.key)?(e[f.key].endpointData=f.value,l.push(e[f.key]),delete e[f.key]):l.push(new n.ServiceDataInfo(n.ServiceDataHelper.parseServiceName(f.key),{},f.value));b=e;for(k in b)d={key:k,value:b[k]},d.value.endpointData={},l.push(d.value);return this._serviceData=l,this._onSuccess(),this._result},_parseProperties:function(n,i){for(var f={},e=t.IEnumerator.getEnumerator(n.childNodes),r,u;e.moveNext();){r=e.get_current(),u=r.nodeName;switch(u){case"Scene":case"UserTileLocation":case"DDP":this._fromUser&&(f[u]=r.text);break;default:f[u]=i==="CM"?r.xml:r.text}}return f},_onFailure:function(){this._parsed=!0,this._result=!1},_onSuccess:function(){this._parsed=!0,this._result=!0},get__isValid:function(){return this._parsed&&this._result}}}(),function(){var i=window,t=i.MC,r=i.MSP,u=i.MSH,n=i.ss,f=r.ServiceDataDocumentType;r.ServiceDataWriter=function(t,i,r,u){this._payload=new n.StringBuilder,this._serviceData=t,this._endpoint=i,this._services=r,this._docType=u},r.ServiceDataWriter.prototype={_serviceData:null,_endpoint:null,_services:0,_docType:0,_generated:!1,getPayload:function(){var i,r,t;if(this._generated)return this._payload.toString();for(this._payload.append("<user>"),i=!1,r=n.IEnumerator.getEnumerator(this._serviceData);r.moveNext();)if(t=r.get_current(),this._shouldAppend(t.service)){switch(this._docType){case f.put:this._appendGlobalData(t),this._appendEndpointData(t);break;case f.del:this._appendEmptyEndpoints(t)}i=!0}return i?(this._payload.append("<\/user>"),this._generated=!0,this._payload.toString()):null},_shouldAppend:function(n){return(n&this._services)===n},_appendGlobalData:function(i){var r=this._formatProperties(i.properties,!0,i.service);r.length>0&&(this._payload.append(n.format('<s n="{0}">',t.ServiceDataHelper.formatServiceType(i.service))),this._payload.append(r),this._payload.append("<\/s>"))},_appendEndpointData:function(i){var r=this._endpoint,u=i.service;n.keyExists(i.endpointData,r)||(i.endpointData[r]=new t.ServiceEndpointDataInfo(r,u,t.ServiceDataHelper.getDefaultOfflineEndpointData(u))),this._payload.append(n.format('<sep n="{0}">',t.ServiceDataHelper.formatServiceType(u))),this._payload.append(this._formatProperties(i.endpointData[r].properties,!1,u)),this._payload.append("<\/sep>")},_appendEmptyEndpoints:function(i){var u=i.endpointData,r,f;for(r in u)f={key:r,value:u[r]},this._payload.append(n.format('<sep n="{0}" epid="{1}"/>',t.ServiceDataHelper.formatServiceType(i.service),f.key))},_formatProperties:function(i,r,f){var h=new n.StringBuilder,c=i,o,e,s;for(o in c)e={key:o,value:c[o]},s=e.key,e.value!=null&&t.ServiceDataHelper.shouldPublishProperty(s,r,f)&&h.append(n.format("<{0}>{1}<\/{0}>",u.XmlHelper.xmlEscape(s),u.XmlHelper.xmlEscape(e.value)));return h.toString()}}}(),function(){function c(n){return parseInt(n,10)}function d(n){return n.indexOf("&")<0?n:n.replace(b,function(n){return n==="&"?"&amp;":n})}var w="&amp;|&lt;|&gt;|&apos;|&quot;|&#[0-9]{1,5};|&#x[0-9a-f]{1,5};|&",b=new RegExp(w,"ig"),s=window,u=s.MC,l=s.MSP,h=s.MSM,a=s.MSH,k=s.MSCo,t=s.ss,v=k.HttpStatusCode,e=u.DatagramInfoType,i=u.ConnectionServiceResultCode,r=u.SignOutReasonCode,f=h.MsnpStatusCode,o=u.Logger,y=h.MsnpConnection,p=l._csConnection=function(n,t,i,r){this._getRequestTimer$1=-1,y.call(this,t,r),this._events$1=n,this._outTrid$1=0,this._sessionInfo$1=new u.MessengerSessionInfo(t,null,0,new Array(0)),this._sessionInfo$1.registrationToken=i,this.set_registrationToken(i),this._getRequestQueue$1=[],this._getRequestCount$1=0},n=p.prototype=new y;n.constructor=p,n._events$1=null,n._sessionInfo$1=null,n._disconnectRaised$1=!1,n._outTrid$1=0,n._getRequestQueue$1=null,n._getRequestCount$1=0,n._getRequestLimit$1=20,n.get__sessionInfo=function(){return this._sessionInfo$1},n._onServerCnt$1=function(n){var t,i;if(n.length!==3){this._onUnexpectedArgumentCount$1("CNT",n);return}if(t=this.getPendingCommand(c(n[0])),t!=null){i=n[2];t.onComplete(f.success,i)}},n._onServerAth$1=function(n,i){if(n.length!==2&&n.length!==3){this._onUnexpectedArgumentCount$1("ATH",n);return}t.isNullOrEmpty(i)||(this.get_identity().skypeId=i);var r=this.getPendingCommand(c(n[0]));if(r!=null)r.onComplete(f.success,null)},n._onServerBnd$1=function(n){var t,i;if(n.length!==3){this._onUnexpectedArgumentCount$1("BND",n);return}if(t=this.getPendingCommand(c(n[0])),t!=null){i=n[2];t.onComplete(f.success,i)}},n._onServerDel$1=function(n){var t,i;if(n.length!==2&&n.length!==3){this._onUnexpectedArgumentCount$1("DEL",n);return}if(t=this._getPendingRequest$1("DEL",n),t!=null){i=n.length>2?n[2]:null;t.onComplete(f.success,i)}},n._onHotmailAlert$1=function(n){var r=new h.MimeParser(n),u=r.getHeader("Content-Type").split(";")[0],t,i;switch(u){case"text/x-msmsgsinitialmdatanotification":case"text/x-msmsgsactivemailnotification":case"text/x-msmsgsemailnotification":case"text/x-msmsgsoimnotification":if(t=new l._mailNotificationParser(r),t.parse())for(i=0;i<t.get_notifications().length;i++)this._events$1.onMailNotificationReceived(t.get_notifications()[i]);else o.logAction("ParseMailNotificationFailure")}},n._onServerNfy$1=function(n){var i,t,r,f,o,s;if(n.length!==3){this._onUnexpectedArgumentCount$1("NFY",n);return}switch(n[1]){case"MSGR\\NETWORKS":case"MSGR\\PUT":i=e.put;break;case"MSGR\\DEL":i=e.del;break;case"MSGR\\CONVERSATION":this._events$1.onDatagramReceived(new u.DatagramInfo(e.conversationPut,n[2]));return;case"MSGR\\THREAD":this._events$1.onDatagramReceived(new u.DatagramInfo(e.imGroupPut,n[2]));return;case"MSGR\\ABCH":this._onAbchAlert$1(n[2]);return;case"MSGR\\HOTMAIL":this._onHotmailAlert$1(n[2]);return;default:return}if(t=h.PagedMessage.createPagedMessage(i,n[2]),t!=null)switch(t.get_pageType()){case e.networkDataPut:if(r=new l._networkDataReader(t),r.get_hasStatusData())this._events$1.onNetworkStatusChanged(r.get_networkId(),r.get_networkStatus());break;case e.serviceDataDel:case e.serviceDataPut:if(f=h.Mri.getIMAddressInfo(t.get_routing().get_from()),o=new l._serviceDataReader(f,this.get_identity().liveId,t.get_content().get_body()),!o.parse())return;if(s=new u.ServiceDataSet(o.get_serviceData()),t.get_pageType()===e.serviceDataPut)this._events$1.onServiceDataChanged(f,s);else this._events$1.onServiceDataDeleted(f,s);break;default:this._events$1.onDatagramReceived(new u.DatagramInfo(i,n[1]))}},n._onServerOut$1=function(n){var u,o;if(n.length!==3){this._onUnexpectedArgumentCount$1("OUT",n);this._events$1.onDisconnected(i.failure,r.serverError,-1);return}this._disconnectRaised$1=!0;var f="",s=t.parseXml(n[2]),e=s.documentElement;e!=null&&(u=e.selectSingleNode("reason"),u==null||t.isNullOrEmpty(u.text)||(f=u.text));switch(f){case"OTH":case"RemoteLogout":this._events$1.onDisconnected(i.signedOutRoaming,r.signedOutByRemoteEndpoint,-1);break;case"TME":this._events$1.onDisconnected(i.signedOutExceededMaxEndpointCount,r.endpointLimitExceeded,-1);break;case"RCT":if(n.length!==2){this._onUnexpectedArgumentCount$1("OUT",n);return}o=parseInt(n[1],10);this._events$1.onDisconnected(i.success,r.signedOutForReconnect,o);break;case"SessionTimeout":this._events$1.onDisconnected(i.signedOutSessionTimeout,r.sessionTimeout,-1);break;case"BadUIC":this._events$1.onDisconnected(i.badUic,r.badUic,-1);break;case"SSD":default:this._events$1.onDisconnected(i.failure,r.serverError,-1)}},n._onServerPut$1=function(n){var t,i;if(n.length!==2&&n.length!==3){this._onUnexpectedArgumentCount$1("PUT",n);return}if(t=this._getPendingRequest$1("PUT",n),t!=null){i=n.length>2?n[2]:null;t.onComplete(f.success,i)}},n._onServerGet$1=function(n){var t,i;if(n.length!==2&&n.length!==3){this._onUnexpectedArgumentCount$1("GET",n);return}if(t=this._getPendingRequest$1("GET",n),t!=null){i=n.length>2?n[2]:null;t.onComplete(f.success,i)}},n._onServerSdg$1=function(n){if(n[0]!=="0"){var t=this._getPendingRequest$1("SDG",n);if(t!=null)t.onComplete(f.success,n[2]);return}if(n.length!==3){this._onUnexpectedArgumentCount$1("SDG",n);return}this._events$1.onDatagramReceived(new u.DatagramInfo(e.sdg,n[2]))},n._onServerXfr$1=function(n){var i,r,s;if(n.length!==3){this._onUnexpectedArgumentCount$1("XFR",n);return}var h=t.parseXml(n[2]),u=h.documentElement,f="",e="";if(u!=null&&(i=u.selectSingleNode("target"),i==null||t.isNullOrEmpty(i.text)||(f=i.text),r=u.selectSingleNode("state"),r==null||t.isNullOrEmpty(r.text)||(e=r.text)),!t.isNullOrEmpty(f)){this._disconnectRaised$1=!0,s=f.split(":"),o.logAction("CsConnection");this._events$1.onTransferred(s[0],e,!1)}},n._getPendingRequest$1=function(n,t){if(t.length<1)return this._onUnexpectedArgumentCount$1(n,t),null;var i=c(t[0]);return this.getPendingCommand(i)},n._onServerError$1=function(n,i,r){var c=this.getPendingCommand(i),e,s,u,h,l;if(o.logResult("CsConnectionOnServerError",n),c!=null){e=n,e===f.detailedError&&(e=f.internalServerError,t.isNullOrEmpty(r)||(s="<msnp>",u=r.indexOf(s),u>=0&&(u+=s.length,h=r.indexOf("<\/msnp>",u),h>=0&&(l=r.substr(u,h-u),e=parseInt(l,10)))));c.onComplete(e,r)}},n._onUnexpectedArgumentCount$1=function(n,t){o.logDetails("CsConnectionOnUnexpectedArgument",{cmd:n,argCount:t.length})},n._onAbchAlert$1=function(n){var u,i,r;if(n=d(n),u=t.parseXml(n),i=u.documentElement,i==null){o.logAction("CsConnectionOnAlert");return}a.XmlHelper.isElement(i,"NOTIFICATION")&&(r=a.XmlHelper.getAttribute(i,"siteurl")||"",(r.endsWith("contacts.msn.com")||r.endsWith("contacts.msn-int.com"))&&this._onABChangeNotificationReceived$1(i))},n._onABChangeNotificationReceived$1=function(n){var t=n.selectSingleNode("MSG/BODY");if(t!=null)this._events$1.onABChangeNotificationReceived(t.text)},n._createAbsoluteUrl$1=function(n,i){return t.isNullOrEmpty(n)?n:n.startsWith("http://")||n.startsWith("https://")||n.startsWith("ftp://")?n:n=n.charAt(0)==="/"?i+n:i+"/"+n},n._doCnt=function(n,i){var f="winnt",e="en-us",r,u;this._updateRegistrationToken$1(""),t.isNullOrEmpty(n)?(r="<connect><ver>2<\/ver><agent><os>{0}<\/os><osVer>5.2<\/osVer><proc>x86<\/proc><lcid>{1}<\/lcid><\/agent><\/connect>",u=t.format(r,f,e)):(r="<connect><ver>2<\/ver><agent><os>{0}<\/os><osVer>5.2<\/osVer><proc>x86<\/proc><lcid>{1}<\/lcid><\/agent><xfr><state>{2}<\/state><\/xfr><\/connect>",u=t.format(r,f,e,n)),this.sendCommand(["CNT",this.get_nextTrid(),"CON",u],i)},n._doAth=function(n,i){var r,u;t.isNullOrEmpty(n)?r="<user><web-compact-ticket /><\/user>":(u="<user><uic>{0}<\/uic><web-compact-ticket /><\/user>",r=t.format(u,n)),this.sendCommand(["ATH",this.get_nextTrid(),"CON\\USER",r],i)},n._doBnd=function(n,i,r,u){var f="<msgr><ver>2<\/ver><client><name>{0}<\/name><ver>{1}<\/ver><\/client><epid>{2}<\/epid><\/msgr>",e=t.format(f,n,i,r);this.sendCommand(["BND",this.get_nextTrid(),"CON\\MSGR",e],u)},n._doDel=function(n,t,i){this.sendCommand(["DEL",this.get_nextTrid(),n,t],i)},n._doOut=function(n){this._outTrid$1=this.get_nextTrid(),this.sendCommand(["OUT",this._outTrid$1,"CON",null],n)},n._doGet=function(n,t,i){this._queueGetRequest$1(["GET",this.get_nextTrid(),n,t],i)},n._doPut=function(n,t,i){this.sendCommand(["PUT",this.get_nextTrid(),n,t],i)},n._doSdg=function(n,t){this.sendCommand(["SDG",this.get_nextTrid(),"MSGR",n],t)},n.onDisconnected=function(n,t){var h,u,e,s;if(!this._disconnectRaised$1){if(this._disconnectRaised$1=!0,this._outTrid$1!==0&&(h=this.getPendingCommand(this._outTrid$1),h!=null)){h.onComplete(f.success,null);return}o.logResult("CsConnectionOnDisconnected",n),s=-1;switch(n){case v.none:t?(u=i.success,e=r.serverError,s=0):(u=i.success,e=r.connectionLost);break;case v.badRequest:u=i.failure,e=r.connectionLost,s=0;break;default:u=i.failure,e=r.connectionLost}this._events$1.onDisconnected(u,e,s)}},n.onCommandReceived=function(n){var i=n.get_allParameters(),r,u;t.isNullOrEmpty(n.get_registrationToken())||this._updateRegistrationToken$1(n.get_registrationToken());switch(n.get_name()){case"CNT":this._onServerCnt$1(i);break;case"ATH":this._onServerAth$1(i,n.get_skypeIdHeader());break;case"BND":this._onServerBnd$1(i);break;case"DEL":this._onServerDel$1(i);break;case"NFY":this._onServerNfy$1(i);break;case"OUT":this._onServerOut$1(i);break;case"PUT":this._onServerPut$1(i);break;case"GET":this._onServerGet$1(i);break;case"SDG":this._onServerSdg$1(i);break;case"XFR":this._onServerXfr$1(i);break;case"SBS":break;default:if(r=a.ConvertHelper.tryParseInt(n.get_name()),r<0){o.logDetails("CsConnectionOnCommandReceived",{msnpError:r});return}u=c(i[0]),this._onServerError$1(r,u,i.length>2?i[2]:null)}},n.onTridChanged=function(n){if(this._sessionInfo$1.transactionID=n,this._events$1!=null)this._events$1.onTridChanged(n)},n._updateRegistrationToken$1=function(n){if(this.get_registrationToken()!==n&&(this.set_registrationToken(n),this._sessionInfo$1.registrationToken=n,this._events$1!=null))this._events$1.onRegistrationTokenChanged(n)},n._queueGetRequest$1=function(n,t){this._getRequestCount$1<this._getRequestLimit$1?(this._getRequestCount$1++,this.sendCommand(n,t),this._setGetRequestTimer$1()):this._getRequestQueue$1.push([n,t])},n._dequeueGetRequests$1=function(){while(this._getRequestQueue$1.length>0&&this._getRequestCount$1<this._getRequestLimit$1){this._getRequestCount$1++;var n=this._getRequestQueue$1[0];this.sendCommand(n[0],n[1]),this._getRequestQueue$1.splice(0,1),this._setGetRequestTimer$1()}},n._setGetRequestTimer$1=function(){var n=this;n._getRequestTimer$1===-1&&(n._getRequestTimer$1=window.setTimeout(t.Delegate.create(n,function(){n._getRequestTimer$1=-1,n._getRequestCount$1=0,n._dequeueGetRequests$1()}),6e4))}}(),function(n){var t=window,r=t.MC,i=t.MSP,u=t.MSM,f=t.ss;i._csCommand=function(){},i._csCommand.prototype={_executing:!1,_completed:!1,onExecuted:null,execute:function(){this._executing=!0,this.onExecuted()},fail:function(){this._completed||(this._completed=!0,this.onCompleted())},getError:function(n){return f.format("{0}-{1}",n,r.enumToString(u.MsnpStatusCode,n))},complete:function(){this._completed||(this._completed=!0,this.onCompleted())},onCompleted:function(){n(this).triggerHandler("completed",[this,{}])}}}(window.originaljQuery||jQuery),function(){var t=window,r=t.MC,u=t.MSP,o=t.MSM,f=t.ss,s=r.ConnectionServiceResultCode,i=u._csCommand,e=u._csUpdateConversationPropertyCommand=function(n,t,r,u,f){i.call(this),this._id$1=t,this._propertyName$1=r,this._propertyValue$1=u,this._connection$1=n,this._callback$1=f},n=e.prototype=new i;n.constructor=e,n._connection$1=null,n._callback$1=null,n._putFormat$1="<conversation><id>{0}<\/id><properties><{1}>{2}<\/{1}><\/properties><\/conversation>",n._id$1=null,n._propertyName$1=null,n._propertyValue$1=null,n._result$1=s.success,n.get_resultCode=function(){return this._result$1},n.onExecuted=function(){var n=f.format(this._putFormat$1,this._id$1,this._propertyName$1,this._propertyValue$1);this._connection$1._doPut("MSGR\\CONVERSATION",n,f.Delegate.create(this,this._onPutCompleted$1))},n._onPutCompleted$1=function(n){switch(n){case o.MsnpStatusCode.success:this._result$1=n;break;default:this._result$1=n,r.Logger.logResult("UpdateConversationPropertyCommandOnPutCompletedFailure",n)}this.complete()},n.onCompleted=function(){this._callback$1!=null&&this._callback$1.invoke(this._result$1),i.prototype.onCompleted.call(this)}}(),function(){var t=window,f=t.MC,e=t.MSP,s=t.MSM,i=t.ss,r=f.ConnectionServiceResultCode,u=e._csCommand,o=e._csGetGroupInfoCommand=function(n,t,i){u.call(this),this._ids$1=t,this._connection$1=n,this._callback$1=i},n=o.prototype=new u;n.constructor=o,n._connection$1=null,n._callback$1=null,n._getFormat$1="<threads>{0}<\/threads>",n._threadFormat$1="<thread><id>{0}<\/id><\/thread>",n._ids$1=null,n._response$1=null,n._result$1=r.success,n.get_resultCode=function(){return this._result$1},n.onExecuted=function(){for(var t=new i.StringBuilder,r,n=0;n<this._ids$1.length;n++)t.append(i.format(this._threadFormat$1,this._ids$1[n]));r=i.format(this._getFormat$1,t.toString()),this._connection$1._doGet("MSGR\\THREADS",r,i.Delegate.create(this,this._onGetCompleted$1))},n._onGetCompleted$1=function(n,t){switch(n){case s.MsnpStatusCode.success:this._result$1=r.success;break;default:this._result$1=r.failure,f.Logger.logResult("GetGroupInfoCommandOnGetCompletedFailure",n)}this._response$1=t,this.complete()},n.onCompleted=function(){this._callback$1!=null&&this._callback$1.invoke(this._result$1,this._response$1,null),u.prototype.onCompleted.call(this)}}(),function(){var t=window,u=t.MC,f=t.MSP,s=t.MSM,e=t.ss,i=u.ConnectionServiceResultCode,r=f._csCommand,o=f._csGetConversationInfoCommand=function(n,t,i){r.call(this),this._id$1=t,this._connection$1=n,this._callback$1=i},n=o.prototype=new r;n.constructor=o,n._connection$1=null,n._callback$1=null,n._getFormat$1="<conversations><conversation><id>{0}<\/id><\/conversation><\/conversations>",n._id$1=null,n._response$1=null,n._result$1=i.success,n.get_resultCode=function(){return this._result$1},n.onExecuted=function(){var n=e.format(this._getFormat$1,this._id$1);this._connection$1._doGet("MSGR\\CONVERSATIONS",n,e.Delegate.create(this,this._onGetCompleted$1))},n._onGetCompleted$1=function(n,t){switch(n){case s.MsnpStatusCode.success:this._result$1=i.success;break;default:this._result$1=i.failure,u.Logger.logResult("GetConversationDataCommandOnGetCompletedFailure",n)}this._response$1=t,this.complete()},n.onCompleted=function(){this._callback$1!=null&&this._callback$1.invoke(this._result$1,this._response$1),r.prototype.onCompleted.call(this)}}(),function(){var i=window,t=i.MC,e=i.MSP,o=i.MSM,r=i.ss,u=t.ConnectionServiceResultCode,s=o.MsnpStatusCode,f=e._csCommand,h=e._csCreateGroupConversationCommand=function(n,t,i){this._response$1="",f.call(this),this._connection$1=n,this._members$1=t,this._callback$1=i},n=h.prototype=new f;n.constructor=h,n._connection$1=null,n._members$1=null,n._callback$1=null,n._createThreadFormat$1="<thread><id><\/id><members>{0}<\/members><\/thread>",n._memberNode$1="<member><mri>{0}<\/mri><role>{1}<\/role><\/member>",n._startTime$1=0,n._qosScenario$1=null,n._result$1=t.ConnectionServiceResultCode.success,n.get_resultCode=function(){return this._result$1},n.onExecuted=function(){for(var i=new r.StringBuilder,u,f,n=0;n<this._members$1.length;n++)u=this._members$1[n],i.append(r.format(this._memberNode$1,o.Mri.createFromIMAddressInfo(u.address).toString(),this._members$1[n].isAdmin?"admin":"user"));f=r.format(this._createThreadFormat$1,i.toString()),this._connection$1._doPut("MSGR\\THREAD",f,r.Delegate.create(this,this._onPutCompleted$1)),this._startTime$1=+new Date,this._qosScenario$1=t.WebmainHelper.startQoS(t.WebmainHelper.qoSScenarioGroupChatCreateGroup)},n._onPutCompleted$1=function(n,i){switch(n){case s.success:this._result$1=u.success,this._response$1=i,t.WebmainHelper.addQoSStats(t.WebmainHelper.qoSApiGroupChatCreateGroup,null,this._startTime$1,this._qosScenario$1,!1),t.WebmainHelper.stopQoS(this._qosScenario$1,!0,null);break;case s.detailedErrorInPayload:this._result$1=u.partialFailure,this._response$1=i;break;default:this._result$1=u.failure;var r=this.getError(n);t.WebmainHelper.addQoSStats(t.WebmainHelper.qoSApiGroupChatCreateGroup,r,this._startTime$1,this._qosScenario$1,!1),t.WebmainHelper.stopQoS(this._qosScenario$1,!1,r)}this.complete()},n.onCompleted=function(){this._callback$1!=null&&this._callback$1.invoke(this._result$1,this._response$1),f.prototype.onCompleted.call(this)}}(),function(){var i=window,r=i.MC,f=i.MSP,t=i.ss,u=f._csCommand,e=f._csGetConversationHistoryCommand=function(n,t,i,r){u.call(this),this._id$1=t,this._syncState$1=i,this._connection$1=n,this._callback$1=r},n=e.prototype=new u;n.constructor=e,n._connection$1=null,n._callback$1=null,n._getFormat$1="<messagesbyconversation><id>{0}<\/id><start>0<\/start><pagesize>{1}<\/pagesize>{2}<\/messagesbyconversation>",n._syncStateFormat$1="<messagessyncstate>{0}<\/messagessyncstate>",n._pageSize$1=20,n._id$1=null,n._syncState$1=null,n._result$1=r.ConnectionServiceResultCode.success,n.get_resultCode=function(){return this._result$1},n.onExecuted=function(){var n=t.format(this._getFormat$1,this._id$1,this._pageSize$1,t.isNullOrEmpty(this._syncState$1)?"":t.format(this._syncStateFormat$1,this._syncState$1));this._connection$1._doGet("MSGR\\MESSAGESBYCONVERSATION",n,t.Delegate.create(this,this._onGetCompleted$1)),this._startTime$1=+new Date,this._qosScenario$1=r.WebmainHelper.startQoS(r.WebmainHelper.qoSScenarioConversationHistory)},n._onGetCompleted$1=function(n,t){this._result$1=n,this._response$1=t,this.complete()},n.onCompleted=function(){this._callback$1!=null&&this._callback$1.invoke(this._result$1,this._response$1),u.prototype.onCompleted.call(this)}}(),function(){var t=window,u=t.MC,f=t.MSP,o=t.MSM,i=t.ss,r=f._csCommand,e=f._csGetRecentConversationsCommand=function(n,t,i,u){r.call(this),this._connection$1=n,this._syncState$1=t,this._syncStartTime=i,this._callback$1=u},n=e.prototype=new r;n.constructor=e,n._connection$1=null,n._callback$1=null,n._fullSyncFormat$1="<recentconversations><start>{0}<\/start><pagesize>{1}<\/pagesize><includenetworks>fb,goog<\/includenetworks><\/recentconversations>",n._deltaSyncFormat$1="<recentconversations><syncstate>{0}<\/syncstate><pagesize>{1}<\/pagesize><\/recentconversations>",n._pageSize$1=100,n._syncState$1=String,n._syncStartTime=null,n._response$1=String,n._result$1=u.ConnectionServiceResultCode.success,n.get_resultCode=function(){return this._result$1},n.onExecuted=function(){var n;n=i.isNullOrEmpty(this._syncState$1)?i.format(this._fullSyncFormat$1,this._syncStartTime.getTime(),this._pageSize$1):i.format(this._deltaSyncFormat$1,this._syncState$1,this._pageSize$1),this._connection$1._doGet("MSGR\\RECENTCONVERSATIONS",n,i.Delegate.create(this,this._onGetCompleted$1))},n._onGetCompleted$1=function(n,t){n!=o.MsnpStatusCode.success&&u.Logger.logResult("GetRecentConversationsCommandOnGetCompletedFailure",n),this._result$1=n,this._response$1=t,this.complete()},n.onCompleted=function(){this._callback$1!=null&&this._callback$1.invoke(this._result$1,this._response$1),r.prototype.onCompleted.call(this)}}(),function(){var t=window,u=t.MC,f=t.MSP,s=t.MSM,e=t.ss,i=u.ConnectionServiceResultCode,r=f._csCommand,o=f._reportAbuseCommand=function(n,t,i){r.call(this),this._connection$1=n,this._callback$1=t,this._alias$1=i},n=o.prototype=new r;n.constructor=o,n._connection$1=null,n._callback$1=null,n._reportSpamFormat$1="<reportspam><alias>{0}<\/alias><\/reportspam>",n._alias$1=null,n._result$1=i.success,n.get_resultCode=function(){return this._result$1},n.onExecuted=function(){this._connection$1._doPut("MSGR\\REPORTSPAM",e.format(this._reportSpamFormat$1,this._alias$1),e.Delegate.create(this,this._onPutCompleted$1))},n._onPutCompleted$1=function(n){switch(n){case s.MsnpStatusCode.success:this._result$1=i.success;break;default:this._result$1=i.failure,u.Logger.logResult("ReportAbuseCommandOnPutCompletedFailure",n)}this.complete()},n.onCompleted=function(){this._callback$1!=null&&this._callback$1.invoke(this._result$1),r.prototype.onCompleted.call(this)}}(),function(){var i=window,r=i.MC,e=i.MSP,h=i.MSM,t=i.ss,u=r.SubscriptionType,o=r.ConnectionServiceResultCode,f=e._csCommand,s=e._updateSubscriptionsCommand=function(n,t,i){this._error$1="",f.call(this),this._subscriptionType$1=n,this._connection$1=t,this._callback$1=i},n=s.prototype=new f;n.constructor=s,n._connection$1=null,n._subscriptionType$1=0,n._callback$1=null,n._subscriptionPayload$1="<subscribe>{0}<\/subscribe>",n._buddySubscriptionPayload$1="<presence><buddies><all /><\/buddies><\/presence><messaging><im /><conversations /><\/messaging>",n._partnerSubscriptionPayload$1="<notifications><partners><partner>Hotmail<\/partner><partner>ABCH<\/partner><\/partners><\/notifications>",n._commandNamespace$1="MSGR\\SUBSCRIPTIONS",n._result$1=r.ConnectionServiceResultCode.success,n.get_resultCode=function(){return this._result$1},n.get_error=function(){return this._error$1},n.onExecuted=function(){switch(this._subscriptionType$1){case u.notificationSubscribe:this._connection$1._doPut(this._commandNamespace$1,t.format(this._subscriptionPayload$1,this._partnerSubscriptionPayload$1),t.Delegate.create(this,this._onUpdateCompleted$1));break;case u.presenceAndNotificationSubscribe:this._connection$1._doPut(this._commandNamespace$1,t.format(this._subscriptionPayload$1,this._partnerSubscriptionPayload$1+this._buddySubscriptionPayload$1),t.Delegate.create(this,this._onUpdateCompleted$1));break;case u.presenceUnsubscribe:this._connection$1._doDel(this._commandNamespace$1,t.format(this._subscriptionPayload$1,this._buddySubscriptionPayload$1),t.Delegate.create(this,this._onUpdateCompleted$1));break;case u.presenceAndNotificationUnsubscribe:this._connection$1._doDel(this._commandNamespace$1,t.format(this._subscriptionPayload$1,this._partnerSubscriptionPayload$1+this._buddySubscriptionPayload$1),t.Delegate.create(this,this._onUpdateCompleted$1))}},n._onUpdateCompleted$1=function(n){switch(n){case h.MsnpStatusCode.success:this._result$1=o.success;break;default:this._error$1=t.format("UpdateSubscriptions PUT response error: {0}",this.getError(n)),this._result$1=o.failure,r.Logger.logResult("UpdateSubscriptionsCommandOnUpdateCompletedFailure",n)}this.complete()},n.onCompleted=function(){this._callback$1!=null&&this._callback$1.invoke(this._result$1),f.prototype.onCompleted.call(this)}}(),function(){var t=window,r=t.MC,e=t.MSP,h=t.MSM,i=t.ss,o=r.NetworkOperationType,u=r.ConnectionServiceResultCode,f=e._csCommand,s=e._updateNetworkSubscriptionsCommand=function(n,t,i,r){f.call(this),n!=null&&(this._networkId$1=n.toLowerCase()),this._operation$1=t,this._connection$1=i,this._callback$1=r,this._result$1=u.success},n=s.prototype=new f;n.constructor=s,n._networkId$1=null,n._operation$1=0,n._connection$1=null,n._callback$1=null,n._updatePayload$1="<networks><network>{0}<\/network><\/networks>",n._commandNamespace$1="MSGR\\NETWORKS",n._result$1=0,n.onExecuted=function(){switch(this._operation$1){case o.enableIM:this._connection$1._doPut(this._commandNamespace$1,i.format(this._updatePayload$1,this._networkId$1),i.Delegate.create(this,this._onResponse$1));break;case o.disableIM:this._connection$1._doDel(this._commandNamespace$1,i.format(this._updatePayload$1,this._networkId$1),i.Delegate.create(this,this._onResponse$1))}},n._onResponse$1=function(n){switch(n){case h.MsnpStatusCode.success:this._result$1=u.success;break;default:this._result$1=u.failure,r.Logger.logResult("UpdateNetworkSubscriptionsCommandOnResponseFailure",n)}this.complete()},n.onCompleted=function(){this._callback$1!=null&&this._callback$1.invoke(this._result$1),f.prototype.onCompleted.call(this)}}(),function(){var f=window,o=f.MC,s=f.MSP,a=f.MSM,c=f.MSCo,i=f.ss,n=o.ConnectionServiceResultCode,u=a.MsnpStatusCode,e=o.Logger,h=s._csCommand,r={initial:0,failure:1,cntAthBndSent:2,bndReceived:3,challengeResponseReceived:4},l=s._authenticateCommand=function(n,t,i,r,u,f){this._error$1="",h.call(this),this._identity$1=n,this._clientId$1=t,this._services$1=r,this._transferState$1=i,this._connection$1=u,this._onCompleted$1=f},t=l.prototype=new h;t.constructor=l,t._identity$1=null,t._clientId$1=null,t._transferState$1=null,t._connection$1=null,t._onCompleted$1=null,t._state$1=0,t._resultCode$1=0,t._services$1=0,t.onExecuted=function(){this._process$1(n.success,null)},t.onCompleted=function(){this._onCompleted$1.invoke(this._resultCode$1,this._error$1),h.prototype.onCompleted.call(this)},t._process$1=function(t,u){var f;t!==n.success&&(this._state$1=r.failure);switch(this._state$1){case r.initial:this._connection$1._doCnt(this._transferState$1,i.Delegate.create(this,this._onCnt$1));switch(this._identity$1.authenticationInfo.authType){case o.AuthenticationType.rpsAuth:this._state$1=r.cntAthBndSent,this._connection$1._doAth(this._identity$1.authenticationInfo.uicTicket,i.Delegate.create(this,this._onAth$1)),this._connection$1._doBnd(c.Configuration.get_clientId(),c.Configuration.get_clientVersion(),this._identity$1.endpointId,i.Delegate.create(this,this._onBnd$1));break;default:this._error$1="Unsupported authentication type.",this._resultCode$1=n.failure,this.complete()}break;case r.bndReceived:var a=u,v=i.parseXml(a),h=v.documentElement;if(h!=null)if(f=h.selectSingleNode("nonce"),f==null||i.isNullOrEmpty(f.text))this._resultCode$1=n.success,this.complete();else{var l="PROD0090YUAUV{2B",y=(new s._mD5Auth).getMacMD5Hash(f.text,l,"YMM8C_H7KCQ2S_KL"),p=i.format("<challenge><appId>{0}<\/appId><response>{1}<\/response><\/challenge>",l,y);this._connection$1._doPut("MSGR\\CHALLENGE",p,i.Delegate.create(this,this._onPut$1))}else{this._error$1="Authenticate BND response invalid.",this._resultCode$1=n.failure,this.complete();return}break;case r.challengeResponseReceived:this._resultCode$1=n.success,this.complete();break;case r.failure:e.logAction("AuthenticateCommandProcessFailure"),this._resultCode$1=t,this.complete()}},t._onCnt$1=function(t,r){switch(t){case u.success:this._process$1(n.success,r);break;default:this._error$1=i.format("Authenticate CNT response error: {0}",this.getError(t)),this._process$1(n.failure,r),e.logResult("AuthenticateCommandOnCntFailure",t)}},t._onAth$1=function(t,r){switch(t){case u.success:this._process$1(n.success,r);break;default:this._error$1=i.format("Authenticate ATH response error: {0}",this.getError(t)),this._process$1(t===u.authFailed||t===u.authError?n.unauthenticated:n.failure,r),e.logResult("AuthenticateCommandOnCthFailure",t)}},t._onBnd$1=function(t,f){this._state$1=r.bndReceived;switch(t){case u.success:this._process$1(n.success,f);break;default:this._error$1=i.format("Authenticate BND response error: {0}",this.getError(t)),this._process$1(t===u.perUserLoginLimitExceeded||t===u.accountCompromised?n.unauthenticated:n.failure,f),e.logResult("AuthenticateCommandOnBndFailure",t)}},t._onPut$1=function(t,f){this._state$1=r.challengeResponseReceived;switch(t){case u.success:this._process$1(n.success,f);break;default:this._error$1=i.format("Authenticate PUT response error: {0}",this.getError(t)),this._process$1(n.failure,f),e.logResult("AuthenticateCommandOnPutFailure",t)}}}(),function(){var u=window,t=u.MSP,i=t._csCommand,r=t._disconnectedCommand=function(n,t,r,u){i.call(this),this._resultCode$1=n,this._events$1=t,this._reason$1=r,this._reconnectWaitTime$1=u},n=r.prototype=new i;n.constructor=r,n._resultCode$1=0,n._events$1=null,n._reason$1=0,n._reconnectWaitTime$1=0,n.onExecuted=function(){this._events$1.onDisconnected(this._resultCode$1,this._reason$1,this._reconnectWaitTime$1)}}(),function(){var u=window,t=u.MSP,i=t._csCommand,r=t._csDatagramReceivedCommand=function(n,t){i.call(this),this._page$1=n,this._events$1=t},n=r.prototype=new i;n.constructor=r,n._page$1=null,n._events$1=null,n.onExecuted=function(){this.onCompleted()},n.onCompleted=function(){this._events$1.onDatagramReceived(this._page$1)}}(),function(){var r=window,i=r.MC,u=r.MSP,t=r.MSM,e=r.ss,o=i.ServiceType,f=u._csCommand,s=u._csDeleteServiceDataCommand=function(n,t,i,r){f.call(this),this._identity$1=n,this._serviceData$1=t,this._connection$1=i,this._onCompleted$1=r},n=s.prototype=new f;n.constructor=s,n._identity$1=null,n._serviceData$1=null,n._connection$1=null,n._onCompleted$1=null,n._result$1=0,n.onExecuted=function(){for(var r=o.none,s=e.IEnumerator.getEnumerator(this._serviceData$1.toServiceDataArray()),f,c;s.moveNext();)f=s.get_current(),f.getAllEndpoints().length>0&&(r|=f.get_service());if(r!==o.none){var n=new i.IMAddressInfo(this._identity$1.liveId,i.IMAddressInfoType.windowsLive,i.RoleLists.none),l=new u.ServiceDataWriter(this._serviceData$1.toArray(),null,r,u.ServiceDataDocumentType.del),a=t.Mri.createFromIMAddressInfo(n),v=t.Mri.create(n.address,n.type,this._identity$1.endpointId,n.applicationId,n.network),h=l.getPayload();if(h==null){this.complete();return}c=new t.PagedMessage(i.DatagramInfoType.serviceDataDel,new t.RoutingLayer(a,v),new t.ReliabilityLayer,new t.PublicationLayer("/user",t.ContentDocumentType.userDocument,h,!1)),this._connection$1._doDel("MSGR\\PRESENCE",c.payLoad(),e.Delegate.create(this,this._onDel$1))}else this.complete()},n.onCompleted=function(){this._onCompleted$1!=null&&this._onCompleted$1.invoke(this._result$1),f.prototype.onCompleted.call(this)},n._onDel$1=function(n){n!==t.MsnpStatusCode.success?(this._result$1=i.ConnectionServiceResultCode.failure,this.fail()):this.complete()}}(),function(){var u=window,t=u.MSP,i=t._csCommand,r=t._csMailNotificationReceivedCommand=function(n,t){i.call(this),this._mailNotification$1=n,this._events$1=t},n=r.prototype=new i;n.constructor=r,n._mailNotification$1=null,n._events$1=null,n.onExecuted=function(){this._events$1.onMailNotificationReceived(this._mailNotification$1)}}(),function(){function l(n){switch(n){case s.full:case s.normal:return r.IM|r.PD|r.PE|r.CM|r.SKP}return r.none}var f=window,i=f.MC,u=f.MSP,t=f.MSM,e=f.ss,s=i.SessionServiceOptions,r=i.ServiceType,o=u._csCommand,h=i.ConnectionServiceResultCode,c=u._publishServiceDataCommand=function(n,t,r,u,f,e,s){this._error$1="",o.call(this),this._address$1=new i.IMAddressInfo(n.liveId,i.IMAddressInfoType.windowsLive,i.RoleLists.none),this._identity$1=n,this._serviceData$1=t,this._services$1=l(r),this._connection$1=u,this._csEvents$1=f,this._overrideGlobalPresence$1=e,this._onCompleted$1=s},n=c.prototype=new o;n.constructor=c,n._address$1=null,n._identity$1=null,n._serviceData$1=null,n._services$1=r.none,n._connection$1=null,n._csEvents$1=null,n._onCompleted$1=null,n._overrideGlobalPresence$1=!1,n._resultCode$1=h.success,n.get_imAddress=function(){return this._address$1},n.get_serviceData=function(){return this._serviceData$1},n.onExecuted=function(){var r,n;if(this._services$1===i.ServiceType.none)this.complete();else{if(r=new u.ServiceDataWriter(this._serviceData$1.toArray(),this._identity$1.endpointId,this._services$1,u.ServiceDataDocumentType.put),n=r.getPayload(),n==null){this.complete();return}var f=t.Mri.createFromIMAddressInfo(this._address$1),o=t.Mri.create(this._address$1.address,this._address$1.type,this._identity$1.endpointId,this._address$1.applicationId,this._address$1.network),s=new t.PagedMessage(i.DatagramInfoType.serviceDataPut,new t.RoutingLayer(f,o),new t.ReliabilityLayer,new t.PublicationLayer("/user",t.ContentDocumentType.userDocument,n,!this._overrideGlobalPresence$1));this._connection$1._doPut("MSGR\\PRESENCE",s.payLoad(),e.Delegate.create(this,this._onPutCompleted$1))}},n.onCompleted=function(){this._onCompleted$1!=null&&this._onCompleted$1.invoke(this._resultCode$1),o.prototype.onCompleted.call(this)},n.get_resultCode=function(){return this._resultCode$1},n.get_error=function(){return this._error$1},n._onPutCompleted$1=function(n,r){var o,f,l;if(n!==t.MsnpStatusCode.success){this._error$1=e.format("PublishService PUT Response error: {0}",this.getError(n)),this._resultCode$1=h.failure,this.fail();return}if(!e.isNullOrEmpty(r)&&(o=e.parseXml(r),f=o.documentElement,f!=null&&f.nodeName==="presence-response")){var a=f.selectSingleNode("from"),v=f.selectSingleNode("user"),s=t.Mri.getIMAddressInfo(new t.Mri(a.text)),c=new u._serviceDataReader(s,this._identity$1.liveId,v.xml);if(c.parse()){l=new i.ServiceDataSet(c.get_serviceData());this._csEvents$1.onServiceDataChanged(s,l)}}this.complete()}}(),function(){var u=window,n=u.MC,o=u.MSP,c=u.MSM,f=u.ss,e=n.DatagramInfoType,t=c.MsnpStatusCode,r=n.SendDatagramResultCode,s=o._csCommand,l=/\nMessage-Type: (Text)|(RichText)\r\n/,h=o._csSendDatagramCommand=function(n,t,i){s.call(this),this._message$1=n,this._connection$1=t,this._onCompleted$1=i},i=h.prototype=new s;i.constructor=h,i._message$1=null,i._connection$1=null,i._onCompleted$1=null,i._resultCode$1=0,i._response$1=null,i._startTime$1=0,i._qosScenario$1=null,i._qosApi$1=null,i._qosTimer=-1,i.onExecuted=function(){var t=this;n.Logger.logDetails("SendPageCommandOnExecuted",{type:n.enumToString(n.DatagramInfoType,t._message$1.datagramType)});switch(t._message$1.datagramType){case e.sdg:t._connection$1._doSdg(t._message$1.payload,f.Delegate.create(t,t._onServerResponse$1)),l.test(t._message$1.payload)&&(t._startTime$1=+new Date,t._qosApi$1=n.WebmainHelper.qoSApiSendIm,t._qosScenario$1=n.WebmainHelper.startQoS(n.WebmainHelper.qoSScenarioSendIm),t._qosTimer=u.setTimeout(function(){n.WebmainHelper.addQoSStats(t._qosApi$1,null,t._startTime$1,t._qosScenario$1,!1),n.WebmainHelper.stopQoS(t._qosScenario$1,!0,null)},3e4));break;case e.get:t._connection$1._doGet("",t._message$1.payload,f.Delegate.create(t,t._onServerResponse$1));break;case e.imGroupPut:t._connection$1._doPut("MSGR\\THREAD",t._message$1.payload,f.Delegate.create(t,t._onServerResponse$1)),t._startTime$1=+new Date,t._qosApi$1=n.WebmainHelper.qoSApiGroupChatAddContacts,t._qosScenario$1=n.WebmainHelper.startQoS(n.WebmainHelper.qoSScenarioGroupChatAddContacts);break;case e.imGroupDel:t._connection$1._doDel("MSGR\\THREAD",t._message$1.payload,f.Delegate.create(t,t._onServerResponse$1)),t._startTime$1=+new Date,t._qosApi$1=n.WebmainHelper.qoSApiGroupChatLeaveGroup,t._qosScenario$1=n.WebmainHelper.startQoS(n.WebmainHelper.qoSScenarioGroupChatLeaveGroup)}},i.onCompleted=function(){this._onCompleted$1.invoke(this._resultCode$1,this._response$1)},i._onServerResponse$1=function(i,f){var o,s,h;if(this._qosTimer!=-1&&u.clearTimeout(this._qosTimer),this._message$1.datagramType===n.DatagramInfoType.imGroupPut&&f!=null&&(this._response$1=new n.DatagramInfo(this._message$1.datagramType,f)),i===t.success)this._resultCode$1=r.success,n.WebmainHelper.addQoSStats(this._qosApi$1,null,this._startTime$1,this._qosScenario$1,!1),n.WebmainHelper.stopQoS(this._qosScenario$1,!0,null),this._message$1.datagramType===n.DatagramInfoType.imGroupPut&&f!=null&&(this._response$1=new n.DatagramInfo(this._message$1.datagramType,f)),this.complete();else{o=this.getError(i),(this._message$1.datagramType==e.imGroupPut||this._message$1.datagramType==e.imGroupDel)&&i==t.detailedErrorInPayload&&(s=this._getDetailedErrorString(i,f),s&&(o=s)),h=!1,i===t.oimNotSupported&&(h=!0),n.WebmainHelper.addQoSStats(this._qosApi$1,o,this._startTime$1,this._qosScenario$1,h),n.WebmainHelper.stopQoS(this._qosScenario$1,!1,o);switch(i){case t.notAcceptingIMs:this._resultCode$1=r.recipientNotAcceptingIMs;break;case t.messageTooLong:case t.smsMessageTooLong:this._resultCode$1=r.tooLong;break;case t.invalidXmlData:this._resultCode$1=r.invalidData;break;case t.detailedErrorInPayload:this._resultCode$1=r.partialFailure;break;case t.smsIncorrectFormat:case t.smsCarrierInvalid:case t.smsCarrierNoRoute:this._resultCode$1=r.recipientInvalid;break;case t.smsAccountMuted:case t.smsAccountDisabled:case t.smsMobileCacheFull:this._resultCode$1=r.recipientDisabled;break;default:this._resultCode$1=r.failure}this._response$1==null&&(this._response$1=this._message$1),this.fail()}},i._getDetailedErrorString=function(n,t){var i=[],e,r;try{var s=f.parseXml(t),h=s.documentElement,u=h.selectSingleNode("errors");if(u!=null)for(e=u.selectNodes("error"),r=f.IEnumerator.getEnumerator(e);r.moveNext();){var c=r.get_current(),l=c.selectSingleNode("code"),o=parseInt(l.text);i.contains(o)||i.push(o)}}catch(a){wLive.People.Reporter.logError("GroupChat","Failed to parse detailed error data.")}return i.length>0?n.toString()+"-"+i.join(","):""}}(),function(){var u=window,t=u.MSP,i=t._csCommand,r=t._csServiceDataChangedCommand=function(n,t,r){i.call(this),this._address$1=n,this._serviceData$1=t,this._events$1=r},n=r.prototype=new i;n.constructor=r,n._address$1=null,n._serviceData$1=null,n._events$1=null,n.get_imAddress=function(){return this._address$1},n.get_serviceData=function(){return this._serviceData$1},n.onExecuted=function(){this._events$1.onServiceDataChanged(this._address$1,this._serviceData$1)}}(),function(){var f=window,t=f.MC,r=f.MSCr,s=f.MSH,i=f.ss,e=t.IMAddressInfoType,u=t.MailNotificationInfoType,o=t.Logger,n=r._messengerStatusSnapshotHelper=function(){};n._markNetworkContactsOffline=function(r,u){for(var p=r.events,c={},h,f,l,a,w,v,y,b,o=p.length-1;o>=0;o--)if(h=p[o],h[0].toString()==="OnServiceDataChanged"){if(f=h[1][0],f==null)continue;f.type===e.connect&&u===f.network&&(l=s.ContactHelper.getIMAddressInfoKey(f),i.keyExists(c,l)||(c[l]=h))}a={},a.Status="FLN",w=new t.ServiceDataSet([new t.ServiceDataInfo(t.ServiceType.IM,a,{})]),v=c;for(y in v)b={key:y,value:v[y]},n._updateServiceDataEvent(b.value,w,!1)},n._updateSignInServiceData=function(t,i,u,f){var o=t.events,e=r._messengerStatusSnapshotHelper._findServiceDataEvent(o,i);return e!=null?n._updateServiceDataEvent(e,u,f):f?null:(n._appendServiceDataEvent(t,i,u),u.toArray())},n._getServiceDataInfo=function(i,r){var o=i.events,u=n._findServiceDataEvent(o,r),f,e;return u!=null?(f=u[1],e=new t.ServiceDataSet(f[1]),e.clone().toArray()):new Array(0)},n._findServiceDataEvent=function(n,t){var o=null,f,r,u;if(n==null)return null;for(f=n.length-1;f>=0;f--)if(r=n[f],r[0].toString()==="OnServiceDataChanged"){if(u=r[1][0],u==null)continue;if(t.type===e.cid&&u.type===e.cid&&!i.isNullOrEmpty(t.cid)&&t.cid===u.cid){o=r;break}if(!i.isNullOrEmpty(t.address)&&s.ContactHelper.areIMAddressesEqual(t,u)){o=r;break}}return o},n._appendServiceDataEvent=function(t,i,r){var u=new Array(2);u[0]="OnServiceDataChanged",u[1]=[i,r.clone().toArray()],n._appendSigninInfoSessionEvent(t,u)},n._appendSigninInfoSessionEvent=function(n,t){for(var r=new Array(n.events.length+1),i=0,u=n.events.length;i<u;i++)r[i]=n.events[i];r[n.events.length]=t,n.events=r},n._updateServiceDataEvent=function(n,i,u){var o=n[1],f=new t.ServiceDataSet(o[1]),e,s;return u?(f.deleteAll(i.toArray()),o[1]=f.toArray(),e=null):(e=f.createDiff(i),s=r._messengerStatusSnapshotHelper._mergeServiceDataEventInfo(f,i),s.updateAll(e),o[1]=s.toArray()),e},n._mergeServiceDataEventInfo=function(n,r){for(var u,f=[],o=i.IEnumerator.getEnumerator(n.toArray()),e;o.moveNext();)u=o.get_current(),f.push(u);for(e=i.IEnumerator.getEnumerator(r.toServiceDataArray());e.moveNext();)u=e.get_current(),n.getServiceData(u.get_service())==null&&f.push(u.clone());return new t.ServiceDataSet(f)},n._appendMailNotificationEvent=function(i,r){if(r.type===u.initial){o.logDetails("AppendMailNotificationEvent",{type:t.enumToString(t.MailNotificationInfoType,r.type)});var f=["OnMailNotification",[r]];n._appendSigninInfoSessionEvent(i,f)}},n._updateFromActivityNotification=function(n,i){var r=n.notification;r.source===t.MailNotificationFolderType.inbox?(i.inboxUnread-=r.delta,r.destination!==t.MailNotificationFolderType.inbox&&r.destination!==t.MailNotificationFolderType.hidden&&(i.foldersUnread+=r.delta)):r.source!==t.MailNotificationFolderType.hidden?(i.foldersUnread-=r.delta,r.destination===t.MailNotificationFolderType.inbox&&(i.inboxUnread+=r.delta)):r.destination===t.MailNotificationFolderType.inbox?i.inboxUnread+=r.delta:r.destination!==t.MailNotificationFolderType.hidden&&(i.foldersUnread+=r.delta),i.foldersUnread<0&&(i.foldersUnread=0)},n._updateSignInMailNotification=function(i,r){o.logDetails("UpdateSignInMailNotification",{type:t.enumToString(t.MailNotificationInfoType,r.type)});var f=i.events,u=n._findInitialMailNotificationEvent(f);u!=null?n._updateMailNotificationEvent(u,r):n._appendMailNotificationEvent(i,r)},n._updateMailNotificationEvent=function(n,i){o.logDetails("UpdateMailNotificationEvent",{type:t.enumToString(t.MailNotificationInfoType,i.type)});var e=n[1],f=e[0],s=f.notification;switch(i.type){case u.initial:f.notification=i.notification;break;case u.activity:r._messengerStatusSnapshotHelper._updateFromActivityNotification(i,s)}},n._findInitialMailNotificationEvent=function(n){var r=null,t,i,f,e;if(n==null)return null;for(t=n.length-1;t>=0;t--)if(i=n[t],i[0].toString()==="OnMailNotification"&&(f=i[1],e=f[0],e.type===u.initial)){r=i;break}return r},n._normalizeSignInEvents=function(f){for(var s=[],h={},c=null,y=i.IEnumerator.getEnumerator(f.events),o,l,a,e,v;y.moveNext();){e=y.get_current();switch(e[0]){case"OnDatagramReceived":break;case"OnServiceDataChanged":o=r._messengerStatusSnapshotHelper._serviceDataEventAddressKey(e),i.keyExists(h,o)?(l=e[1],a=l[1],n._updateServiceDataEvent(h[o],new t.ServiceDataSet(a),!1)):(h[o]=e,s.push(e));break;case"OnServiceDataDeleted":o=n._serviceDataEventAddressKey(e),i.keyExists(h,o)&&(l=e[1],a=l[1],r._messengerStatusSnapshotHelper._updateServiceDataEvent(h[o],new t.ServiceDataSet(a),!0));break;case"OnMailNotification":v=e[1][0];switch(v.type){case u.initial:c!=null&&s.remove(c),s.push(e),c=e;break;case u.activity:c!=null&&r._messengerStatusSnapshotHelper._updateMailNotificationEvent(c,v)}break;default:s.push(e)}}f.events=s},n._serviceDataEventAddressKey=function(n){var t=n[1][0];return i.format("{0}:{1}",t.type,t.type===e.cid?t.cid:t.address)}}(),function(){function e(n,t,i,r,u){for(var f=0;f<u;f++)i[r+f]=n[t+f]}var i=window,n=i.MC,t=i.MSCr,r=i.MSH,u=i.ss,f=n.SignOutReasonCode;t.MessengerStatusSnapshot=function(n){this._lastModified=r.DateTimeHelper.minValue,this._liveId=n},t.MessengerStatusSnapshot.prototype={_networkStatusEvents:null,_messengerSessionState:null,_messengerSessionEvents:null,_liveId:null,_switchingServices:!1,get_lastModified:function(){return this._lastModified},get_ageInMilliSeconds:function(){return r.DateTimeHelper.subtract(new Date,this.get_lastModified())},get_networkStatusEvents:function(){return this._networkStatusEvents},set_networkStatusEvents:function(n){return this._networkStatusEvents!==n&&(this._networkStatusEvents=n,this._onSnapshotChanged()),n},get_messengerSessionState:function(){return this._messengerSessionState},set_messengerSessionState:function(n){return this._messengerSessionState!==n&&(this._messengerSessionState=n),n},get_messengerSessionEvents:function(){return this._messengerSessionEvents},set_messengerSessionEvents:function(n){return this._messengerSessionEvents!==n&&(this._messengerSessionEvents=n),n},get_services:function(){var t=this.get_messengerSessionState();return t!=null?t.services:n.SessionServiceOptions.normal},set_services:function(n){var t=this.get_messengerSessionState();return t!=null&&t.services!==n&&(t.services=n,this._onSnapshotChanged()),n},get_switchingServices:function(){return this._switchingServices},set_switchingServices:function(n){return this._switchingServices=n,n},updateSessionId:function(n){var t=this.get_messengerSessionState();t!=null&&(t.sessionToken=n,this._onSnapshotChanged())},updateTrid:function(n){var t=this.get_messengerSessionState();t!=null&&(t.transactionID=n,this._onSnapshotChanged())},updateRegistrationToken:function(n){var t=this.get_messengerSessionState();t!=null&&(t.registrationToken=n,this._onSnapshotChanged())},expire:function(){this._clearSignedInState(),this._onSnapshotChanged()},onSignedOut:function(n){if(n===f.signedOutByLocalEndpoint||n===f.signedOutByRemoteEndpoint)this._clearSignedInState();else{var t=this.get_messengerSessionState();t!=null&&(t.disconnected=!0,t.sessionToken=null,this._onSnapshotChanged())}},normalizeSignInEvents:function(){var n=this.get_messengerSessionEvents();n!=null&&(t._messengerStatusSnapshotHelper._normalizeSignInEvents(n),this._onSnapshotChanged())},onNetworkStatusChanged:function(i,r){var f=this.get_networkStatusEvents(),o=!1,l=!1,c,s,h;if(f==null)this._networkStatusEvents=[[i,r]],o=!0;else{for(c=u.IEnumerator.getEnumerator(f);c.moveNext();)if(s=c.get_current(),u.compare(s[0],i,!0)===0){s[1]!==r&&(s[1]=r,o=!0),l=!0;break}l||(h=new Array(f.length+1),e(f,0,h,0,f.length),h[f.length]=[i,r],this._networkStatusEvents=h,o=!0)}o&&(r===n.NetworkInfoStatus.signedOut&&t._messengerStatusSnapshotHelper._markNetworkContactsOffline(this.get_messengerSessionEvents(),i),this._onSnapshotChanged())},serviceDataChanged:function(n,i,r){var u=this.get_messengerSessionEvents(),f;return u==null?i.toArray():(f=t._messengerStatusSnapshotHelper._updateSignInServiceData(u,n,i,r),this._onSnapshotChanged(),f)},getServiceDataInfo:function(n){var i=this.get_messengerSessionEvents();return i==null?new Array(0):t._messengerStatusSnapshotHelper._getServiceDataInfo(i,n)},getLocalNetworkServiceData:function(){var e=this.get_messengerSessionEvents(),c=[],l={},o,i,f,t,s,h,a;if(e!=null&&e.events!=null)for(o=e.events,i=o.length-1;i>=0;i--)(f=o[i],f[0].toString()==="OnServiceDataChanged")&&(t=f[1][0],t!=null)&&t.type!==n.IMAddressInfoType.connect&&(t.address!==this._liveId||t.type!==n.IMAddressInfoType.windowsLive)&&(s=r.ContactHelper.getIMAddressInfoKey(t),u.keyExists(l,s)&&(h=f[1],l[s]=h,a=new n.ServiceDataSet(h[1]),c.push([t,new n.ServiceDataSet(a.clone().toArray())])));return c},mailNotificationReceived:function(n){var i=this.get_messengerSessionEvents();i!=null&&(t._messengerStatusSnapshotHelper._updateSignInMailNotification(i,n),this._onSnapshotChanged())},_onSnapshotChanged:function(){this._lastModified=new Date},_clearSignedInState:function(){this._networkStatusEvents=null,this._messengerSessionState=null,this._messengerSessionEvents=null}}}(),function(){var u=window,t=u.MSP,i=t._csCommand,r=t._csServiceDataDeletedCommand=function(n,t,r){i.call(this),this._address$1=n,this._serviceData$1=t,this._events$1=r},n=r.prototype=new i;n.constructor=r,n._address$1=null,n._serviceData$1=null,n._events$1=null,n.get_imAddress=function(){return this._address$1},n.get_serviceData=function(){return this._serviceData$1},n.onExecuted=function(){this._events$1.onServiceDataDeleted(this._address$1,this._serviceData$1)}}(),function(){var t=window,f=t.MC,i=t.MSP,r=i._csCommand,u=i._signedInCommand=function(n,t){this._error$1="",r.call(this),this._events$1=n,this._onCompleted$1=t},n=u.prototype=new r;n.constructor=u,n._events$1=null,n._onCompleted$1=null,n._resultCode$1=null,n._address$1=null,n._serviceData$1=null,n.setResults=function(n,t,i,r){this._resultCode$1=n,this._error$1=t,this._address$1=i,this._serviceData$1=r},n.onExecuted=function(){if(this._onCompleted$1.invoke(this._resultCode$1,this._error$1),this._resultCode$1===f.ConnectionServiceResultCode.success)this._events$1.onServiceDataChanged(this._address$1,this._serviceData$1)}}(),function(){var i=window,t=i.MC,r=i.MSP,s=i.MSM,u=i.ss,e=t.ConnectionServiceResultCode,f=r._csCommand,o=r._csSignOutCommand=function(n,t,i,r,u,e,o,s,h){f.call(this),this._identity$1=n,this._userServiceData$1=t,this._locations$1=i,this._initiatedRemotely$1=u,this._connection$1=e,this._service$1=o,this._events$1=s,this._onCompleted$1=h,r!=null&&(this._remoteEndpointIds$1=[],this._remoteEndpointIds$1.addRange(r))},n=o.prototype=new f;n.constructor=o,n._identity$1=null,n._userServiceData$1=null,n._locations$1=null,n._remoteEndpointIds$1=null,n._initiatedRemotely$1=!1,n._connection$1=null,n._service$1=null,n._events$1=null,n._onCompleted$1=null,n._deleteData$1=null,n._delCommand$1=null,n._result$1=0,n.onExecuted=function(){var n=this._signOutRemoteEndpoints$1();this.get_includesLocalEndpoint()?this._connection$1._doOut(u.Delegate.create(this,this._onOut$1)):n||this.complete()},n._onOut$1=function(n){n!==s.MsnpStatusCode.success&&(this._result$1=e.failure),this.complete()},n._signOutRemoteEndpoints$1=function(){return(this._shouldSignOutOfLocation$1(t.SignOutLocationFlags.specificEndpoints)||this._shouldSignOutOfLocation$1(t.SignOutLocationFlags.remoteEndpoints))&&(this._createServiceData$1(),this._deleteData$1!=null)?(this._delCommand$1=new r._csDeleteServiceDataCommand(this._identity$1,this._deleteData$1,this._connection$1,u.Delegate.create(this,this._onDel$1)),this._delCommand$1.execute(),!0):!1},n._shouldSignOut$1=function(n){return n===this._identity$1.endpointId?this.get_includesLocalEndpoint():this._shouldSignOutOfLocation$1(t.SignOutLocationFlags.remoteEndpoints)?!0:this._shouldSignOutOfLocation$1(t.SignOutLocationFlags.specificEndpoints)&&this._remoteEndpointIds$1.contains(n)?!0:!1},n._shouldSignOutOfLocation$1=function(n){return(this._locations$1&n)===n},n._createServiceData$1=function(){var i=this._userServiceData$1.imServiceData,r,f,n;if(i!=null){for(this._deleteData$1=new t.ServiceDataSet([new t.ServiceDataInfo(t.ServiceType.IM,{},{})]),r=!1,f=u.IEnumerator.getEnumerator(i.getAllEndpoints());f.moveNext();)n=f.get_current(),this._shouldSignOut$1(n.get_endpointId())&&(i.deleteEndpoint(n.get_endpointId()),n.get_endpointId()!==this._identity$1.endpointId&&(this._deleteData$1.addEndpoint(t.ServiceEndpointData.createEmpty(t.ServiceType.IM,n.get_endpointId())),r=!0));r||(this._deleteData$1=null)}},n.get_includesLocalEndpoint=function(){return this._shouldSignOutOfLocation$1(t.SignOutLocationFlags.localEndpoint)},n.onCompleted=function(){if(this._onCompleted$1!=null)this._onCompleted$1.invoke(this._result$1);else if(this._initiatedRemotely$1)this._events$1.onDisconnected(t.ConnectionServiceResultCode.signedOutRoaming,t.SignOutReasonCode.signedOutByRemoteEndpoint,-1);f.prototype.onCompleted.call(this)},n._onDel$1=function(n){this.get_includesLocalEndpoint()||(this._result$1=n,n!==e.success?this.fail():this.complete())}}(),function(){var u=window,t=u.MSP,i=t._csCommand,r=t._abChangeNotificationReceivedCommand=function(n,t){i.call(this),this._events$1=n,this._notificationData$1=t},n=r.prototype=new i;n.constructor=r,n._notificationData$1=null,n._events$1=null,n.onExecuted=function(){this._events$1.onABChangeNotificationReceived(this._notificationData$1)}}(),function(){var u=window,t=u.MSP,i=t._csCommand,r=t._csTransferredCommand=function(n,t,r,u,f){i.call(this),this._hostName$1=n,this._transferState$1=t,this._otherEndpointRequested$1=r,this._service$1=u,this._events$1=f},n=r.prototype=new i;n.constructor=r,n._hostName$1=null,n._transferState$1=null,n._otherEndpointRequested$1=!1,n._service$1=null,n._events$1=null,n.onExecuted=function(){this._service$1.setTransferServer(this._hostName$1,this._transferState$1);this._events$1.onTransferred(this._hostName$1,this._transferState$1,this._otherEndpointRequested$1)}}(),function(){var t=window,n=t.MSP;n._connectionServiceState=function(n){this._cxnService=n},n._connectionServiceState.prototype={_cxnService:null,get_service:function(){return this._cxnService},authenticate:function(){},updateBuddySubscriptions:function(){},updateNetworks:function(){},getRecentConversations:function(){},getConversationHistory:function(){},getConversationInfo:function(){},updateConversationProperty:function(){},getGroupInfo:function(){},createGroupConversation:function(){},reportAbuse:function(){},signIn:function(){},signOut:function(){},deleteServiceData:function(){},publishServiceData:function(){},sendPage:function(){},onServiceDataChanged:function(){},onServiceDataDeleted:function(){},onTransferred:function(){},onDisconnected:function(){},onMailNotificationReceived:function(){},onABChangeNotificationReceived:function(){},onPageReceived:function(){}}}(),function(n){var u=window,e=u.MC,i=u.MSP,s=u.MSH,r=u.ss,f=e.ConnectionServiceResultCode,h=i._connectionServiceState,o=e.SessionServiceOptions,c=i._csSigningInState=function(n){this._queuedCommands$1=[],h.call(this,n)},t=c.prototype=new h;t.constructor=c,t._userServiceDataCommand$1=null,t._updateNetworkSubscriptionCommands$1=null,t._updateSubscriptionsCommand$1=null,t._userServiceDataPublished$1=!1,t._userServiceDataPublishCompleted$1=!1,t._updateNetworkSubscriptionsCompleted$1=!1,t._updateSubscriptionsIssued$1=!1,t._updateSubscriptionsCompleted$1=!1,t._commandQueueEmptied$1=!1,t._signedInCommand$1=null,t._serviceData$1=null,t._serviceOptions$1=o.normal,t.signIn=function(n,t,i,r,u){this._updateSubscriptionsCommand$1=t,this._updateNetworkSubscriptionCommands$1=i,this._userServiceDataCommand$1=r,this._signedInCommand$1=u,this._serviceData$1=this._userServiceDataCommand$1.get_serviceData(),this._serviceOptions$1=n,this._emptyPendingQueue$1(),this._updateSubscriptions$1(),n!==o.notifications&&(this._updateNetworkSubscriptions$1(),this._publishServiceData$1())},t.signOut=function(n){n.get_includesLocalEndpoint()&&this.get_service()._updateState(new i._csSigningOutState(this.get_service(),n)),this.get_service()._execute(n)},t.onServiceDataChanged=function(n){this._serviceData$1==null?this._queuedCommands$1.push(n):s.ContactHelper.areIMAddressesEqual(n.get_imAddress(),this._userServiceDataCommand$1.get_imAddress())?(this._serviceData$1.updateAll(n.get_serviceData().toArray()),this._publishServiceData$1()):this._queuedCommands$1.push(n)},t.onServiceDataDeleted=function(n){this._serviceData$1==null?this._queuedCommands$1.push(n):s.ContactHelper.areIMAddressesEqual(n.get_imAddress(),this._userServiceDataCommand$1.get_imAddress())?this._serviceData$1.deleteAll(n.get_serviceData().toArray()):this._queuedCommands$1.push(n)},t.onPageReceived=function(n){this._queuedCommands$1.push(n)},t.onABChangeNotificationReceived=function(n){this._queuedCommands$1.push(n)},t.onMailNotificationReceived=function(n){this._queuedCommands$1.push(n)},t.onTransferred=function(n){this.get_service()._updateState(new i._csSignedOutState(this.get_service())),this.get_service()._execute(n)},t.onDisconnected=function(n){this.get_service()._updateState(new i._csSignedOutState(this.get_service())),this.get_service()._execute(n)},t._emptyPendingQueue$1=function(){var t,u,r,n;if(this._queuedCommands$1.length>0)for(e.Logger.logAction("CsSigningInStateSignIn"),t=this._queuedCommands$1,this._queuedCommands$1=[],u=t.length,r=0;r<u;r++)if(n=t.shift(),n instanceof i._csServiceDataChangedCommand)this.onServiceDataChanged(n);else if(n instanceof i._csServiceDataDeletedCommand)this.onServiceDataDeleted(n);else this._queuedCommands$1.push(n);this._commandQueueEmptied$1=!0},t._updateSubscriptions$1=function(){this._updateSubscriptionsIssued$1||(this._updateSubscriptionsIssued$1=!0,n(this._updateSubscriptionsCommand$1).bind("completed",r.Delegate.create(this,this._onBuddySubscriptionsCompleted$1)),this.get_service()._execute(this._updateSubscriptionsCommand$1))},t._onBuddySubscriptionsCompleted$1=function(){this._updateSubscriptionsCompleted$1=!0,n(this._updateSubscriptionsCommand$1).unbind("completed",r.Delegate.create(this,this._onBuddySubscriptionsCompleted$1)),this._checkCompleteState$1(this._updateSubscriptionsCommand$1.get_resultCode(),this._updateSubscriptionsCommand$1.get_error())},t._updateNetworkSubscriptions$1=function(){var n,t;if(this._updateNetworkSubscriptionCommands$1==null){this._updateNetworkSubscriptionsCompleted$1=!0;return}if(!this._updateNetworkSubscriptionsCompleted$1){for(this._updateNetworkSubscriptionsCompleted$1=!0,n=r.IEnumerator.getEnumerator(this._updateNetworkSubscriptionCommands$1);n.moveNext();)t=n.get_current(),this.get_service()._execute(t);this._checkCompleteState$1(f.success,"")}},t._publishServiceData$1=function(){this._userServiceDataPublished$1||this._commandQueueEmptied$1&&(this._userServiceDataPublished$1=!0,n(this._userServiceDataCommand$1).bind("completed",r.Delegate.create(this,this._onServiceDataPublished$1)),this.get_service()._execute(this._userServiceDataCommand$1))},t._onServiceDataPublished$1=function(){this._userServiceDataPublishCompleted$1=!0,n(this._userServiceDataCommand$1).unbind("completed",r.Delegate.create(this,this._onServiceDataPublished$1)),this._checkCompleteState$1(this._userServiceDataCommand$1.get_resultCode(),this._userServiceDataCommand$1.get_error())},t._checkCompleteState$1=function(n,t){(n!==f.success||this._updateNetworkSubscriptionsCompleted$1&&this._userServiceDataPublishCompleted$1&&this._updateSubscriptionsCompleted$1||this._serviceOptions$1===o.notifications&&this._updateSubscriptionsCompleted$1)&&this._completeState$1(n,t)},t._completeState$1=function(n,t){var u,r;if(n===f.success?this.get_service()._updateState(new i._csSignedInState(this.get_service())):this.get_service()._updateState(new i._csSignedOutState(this.get_service())),this._signedInCommand$1.setResults(n,t,this._userServiceDataCommand$1.get_imAddress(),this._serviceData$1),this.get_service()._execute(this._signedInCommand$1),n===f.success){for(u=this._queuedCommands$1.length,r=0;r<u;r++)this.get_service()._execute(this._queuedCommands$1.shift());this.get_service().onSignInEventsEmpty()}}}(window.originaljQuery||jQuery),function(){var u=window,n=u.MSP,t=n._connectionServiceState,i=n._csSignedOutState=function(n){t.call(this,n)},r=i.prototype=new t;r.constructor=i,r.authenticate=function(t){this.get_service()._updateState(new n._csSigningInState(this.get_service())),this.get_service()._execute(t)}}(),function(){var u=window,t=u.MSP,i=t._connectionServiceState,r=t._csSignedInState=function(n){i.call(this,n),n.setTransferServer(null,null)},n=r.prototype=new i;n.constructor=r,n.signOut=function(n){n.get_includesLocalEndpoint()&&this.get_service()._updateState(new t._csSigningOutState(this.get_service(),n)),this.get_service()._execute(n)},n.deleteServiceData=function(n){this.get_service()._execute(n)},n.onServiceDataChanged=function(n){this.get_service()._execute(n)},n.onServiceDataDeleted=function(n){this.get_service()._execute(n)},n.onMailNotificationReceived=function(n){this.get_service()._execute(n)},n.onPageReceived=function(n){this.get_service()._execute(n)},n.onABChangeNotificationReceived=function(n){this.get_service()._execute(n)},n.publishServiceData=function(n){this.get_service()._execute(n)},n.sendPage=function(n){this.get_service()._execute(n)},n.updateBuddySubscriptions=function(n){this.get_service()._execute(n)},n.updateNetworks=function(n){this.get_service()._execute(n)},n.getRecentConversations=function(n){this.get_service()._execute(n)},n.getConversationHistory=function(n){this.get_service()._execute(n)},n.getConversationInfo=function(n){this.get_service()._execute(n)},n.updateConversationProperty=function(n){this.get_service()._execute(n)},n.getGroupInfo=function(n){this.get_service()._execute(n)},n.createGroupConversation=function(n){this.get_service()._execute(n)},n.reportAbuse=function(n){this.get_service()._execute(n)},n.onTransferred=function(n){this.get_service()._updateState(new t._csSignedOutState(this.get_service())),this.get_service()._execute(n)},n.onDisconnected=function(n){this.get_service()._updateState(new t._csSignedOutState(this.get_service())),this.get_service()._execute(n)}}(),function(){var u=window,n=u.MSP,i=n._connectionServiceState,r=n._csSigningOutState=function(n,t){i.call(this,n),this._signOutCommand$1=t},t=r.prototype=new i;t.constructor=r,t._signOutCommand$1=null,t.onDisconnected=function(){this.get_service()._updateState(new n._csSignedOutState(this.get_service())),this._signOutCommand$1.complete()}}(),function(){var r=window,i=r.MC,t=r.MSP,o=r.MSCo,u=r.ss,f=i.IConnectionServiceEvents,e=t.ConnectionService=function(n,i,r){f.call(this),this._identity=n,this._events=i,this._isSecure=r,this._currentState=new t._csSignedOutState(this)},n=e.prototype=new f;n.constructor=e,n._identity=null,n._events=null,n._connection=null,n._transferServer=null,n._transferState=null,n._currentState=null,n._isSecure=!1,n.get__identity=function(){return this._identity},n.get_serverName=function(){return this._connection!=null?this._connection.get_serverName():""},n.get_isSignedIn=function(){return this._currentState instanceof t._csSignedInState},n.authenticate=function(n,i,r,f,e){u.isNullOrEmpty(i)&&(i=this._transferServer!=null?this._transferServer:o.Configuration.get_presenceHostName()),f==null&&(f=this._transferState),this._connection=new t._csConnection(this,i,"",this._isSecure),this._connection.set_identity(this._identity),this._currentState.authenticate(new t._authenticateCommand(this._identity,n,f,r,this._connection,e))},n.resumeSession=function(n){var r,i,f;if(this._connection=new t._csConnection(this,n.server,n.registrationToken,this._isSecure),this._connection.set_identity(this._identity),this._connection.resume(n.sessionToken,n.transactionID),this._updateState(new t._csSignedInState(this)),n.pendingEvents!=null)for(r=u.IEnumerator.getEnumerator(n.pendingEvents);r.moveNext();){i=r.get_current(),f=i[1];switch(i[0]){case"OnDatagramReceived":this.onDatagramReceived(f[0]);break;case"OnABChangeNotificationReceived":this.onABChangeNotificationReceived(f[0]);break;case"OnNetworkStatusChanged":this.onNetworkStatusChanged(i[1],i[2])}}},n.updateNetworks=function(n,i,r){this._currentState.updateNetworks(new t._updateNetworkSubscriptionsCommand(n,i,this._connection,r))},n.updateBuddySubscriptions=function(n,i){this._currentState.updateBuddySubscriptions(new t._updateSubscriptionsCommand(n,this._connection,i))},n.getSession=function(){return this._connection!=null?this._connection.get__sessionInfo():null},n._setCsConnnection=function(n){this._connection=n,this._identity!=null&&this._connection.set_identity(this._identity)},n.sendDatagram=function(n,i){this._currentState.sendPage(new t._csSendDatagramCommand(n,this._connection,i))},n.signIn=function(n,r,u,f){var c=r!==i.SessionServiceOptions.notifications?i.SubscriptionType.presenceAndNotificationSubscribe:i.SubscriptionType.notificationSubscribe,l=new t._updateSubscriptionsCommand(c,this._connection,null),o=null,e,s,h;if(u!=null)for(o=new Array(u.length),e=0;e<u.length;e++)o[e]=new t._updateNetworkSubscriptionsCommand(u[e],i.NetworkOperationType.enableIM,this._connection,null);s=new t._publishServiceDataCommand(this._identity,n,r,this._connection,this._events,!1,null),h=new t._signedInCommand(this._events,f),this._currentState.signIn(r,l,o,s,h)},n.signOut=function(n,i,r,u,f){this._currentState.signOut(new t._csSignOutCommand(this._identity,n,i,r,u,this._connection,this,this._events,f))},n.deleteServiceData=function(n,i){this._currentState.deleteServiceData(new t._csDeleteServiceDataCommand(this._identity,n,this._connection,i))},n.publishServiceData=function(n,i,r){this._currentState.publishServiceData(new t._publishServiceDataCommand(this._identity,n,i,this._connection,this._events,!0,r))},n.getRecentConversations=function(n,i,r){this._currentState.getRecentConversations(new t._csGetRecentConversationsCommand(this._connection,n,i,r))},n.getConversationHistory=function(n,i,r){this._currentState.getConversationHistory(new t._csGetConversationHistoryCommand(this._connection,n,i,r))},n.getConversationInfo=function(n,i){this._currentState.getConversationInfo(new t._csGetConversationInfoCommand(this._connection,n,i))},n.updateConversationProperty=function(n,i,r,u){this._currentState.updateConversationProperty(new t._csUpdateConversationPropertyCommand(this._connection,n,i,r,u))},n.getGroupInfo=function(n,i){this._currentState.getGroupInfo(new t._csGetGroupInfoCommand(this._connection,n,i))},n.createGroupConversation=function(n,i){this._currentState.createGroupConversation(new t._csCreateGroupConversationCommand(this._connection,n,i))},n.reportAbuse=function(n,i){this._currentState.reportAbuse(new t._reportAbuseCommand(this._connection,i,n))},n.onNetworkStatusChanged=function(n,t){this._events.onNetworkStatusChanged(n,t)},n.onTridChanged=function(n){if(this._events!=null&&this._events!==this)this._events.onTridChanged(n)},n.onRegistrationTokenChanged=function(n){if(this._events!=null&&this._events!==this)this._events.onRegistrationTokenChanged(n)},n.onServiceDataChanged=function(n,i){this._currentState.onServiceDataChanged(new t._csServiceDataChangedCommand(n,i,this._events))},n.onServiceDataDeleted=function(n,i){this._currentState.onServiceDataDeleted(new t._csServiceDataDeletedCommand(n,i,this._events))},n.onMailNotificationReceived=function(n){this._currentState.onMailNotificationReceived(new t._csMailNotificationReceivedCommand(n,this._events))},n.onABChangeNotificationReceived=function(n){this._currentState.onABChangeNotificationReceived(new t._abChangeNotificationReceivedCommand(this._events,n))},n.onDatagramReceived=function(n){this._currentState.onPageReceived(new t._csDatagramReceivedCommand(n,this._events))},n.onDisconnected=function(n,i,r){this._disposeConnection();this._currentState.onDisconnected(new t._disconnectedCommand(n,this._events,i,r))},n.onTransferred=function(n,i,r){this._disposeConnection();this._currentState.onTransferred(new t._csTransferredCommand(n,i,r,this,this._events))},n.onSignInEventsEmpty=function(){this._events.onSignInEventsEmpty()},n._disposeConnection=function(){this._connection!=null&&this._connection.dispose()},n._execute=function(n){n.execute()},n._updateState=function(n){this._currentState=n,this._currentState instanceof t._csSignedOutState&&this._disposeConnection()},n.setTransferServer=function(n,t){this._transferServer=n,this._transferState=t},n.abort=function(){this._disposeConnection()},n.pauseSession=function(n){this._connection.pauseSession(n)}}(),function(n){var s=1e4,h=1,t=window,r=t.document,c=t.MC,u=t.MSCo,e=t.MSH,o=t.MSI,i=t.ss,f=c.IdentityServiceResultCode;o._identityReauthenticateCommand=function(n){this._callbacks=[],this._callbacks.push(n)},o._identityReauthenticateCommand.prototype={_callbacks:null,_image:null,_identityIframe:null,_timer:null,_completed:!1,execute:function(){this._timer=new e.Timer(i.Delegate.create(this,this._onTimedOut),null,s,e.Timeout.infinite),this._image=r.createElement("img"),this._image.attachEvent("onload",i.Delegate.create(this,this._onImageLoaded)),this._image.attachEvent("onerror",i.Delegate.create(this,this._onImageLoaded)),this._image.src=u.Configuration.get_silentReauthDetectionUrl()},addCallback:function(n){this._callbacks.push(n)},_registerCallback:function(){window.____ReauthenticationCompleted=i.Delegate.create(this,this._onSucceeded)},_onImageLoaded:function(){this._image.width===h?(this._registerCallback(),this._identityIframe=r.createElement("iframe"),this._identityIframe.style.display="none",this._identityIframe.src=i.format(u.Configuration.get_silentReauthUrlFormat(),encodeURIComponent(u.Configuration.get_reauthCompletedPageUrl())),r.body.appendChild(this._identityIframe)):this._onCompleted(f.failure)},_onSucceeded:function(){this._timer!=null&&(this._timer.dispose(),this._timer=null),this._onCompleted(f.success)},_onTimedOut:function(){this._onCompleted(f.failure)},_onCompleted:function(t){var u,f;if(!this._completed){for(this._completed=!0,this._identityIframe!=null&&(r.body.removeChild(this._identityIframe),this._identityIframe=null),u=i.IEnumerator.getEnumerator(this._callbacks);u.moveNext();)f=u.get_current(),f.invoke(t);n(this).triggerHandler("completed",[this,{}])}}}}(window.originaljQuery||jQuery),function(n){var i=window,t=i.MSI,r=i.ss;t.IdentityService=function(){},t.IdentityService.prototype={_pendingCommand:null,reauthenticate:function(i){this._pendingCommand==null?(this._pendingCommand=new t._identityReauthenticateCommand(i),n(this._pendingCommand).bind("completed",r.Delegate.create(this,this._onReauthenticateCompleted)),this._pendingCommand.execute()):this._pendingCommand.addCallback(i)},_onReauthenticateCompleted:function(){this._pendingCommand=null}}}(window.originaljQuery||jQuery),function(){var rt="Content-Type",s="Message-Type",ut="Safe-Url",ft="Message-ID",c="Client-Message-ID",l="IM-Display-Name",et="Original-Arrival-Time",a="X-MMS-IM-Format",v="Text",y="RichText",p="Event/Call",ot="Signal/RequestLogs",st="Text/",w="Control/Typing",b="ThreadActivity/AddMember",k="ThreadActivity/DeleteMember",d="ThreadActivity/TopicUpdate",g="ThreadActivity/PictureUpdate",nt="RichText/Files",tt="RichText/Contacts",o=window,r=o.MC,ht=o.MSCh,e=o.MSM,h=o.MSH,i=o.ss,t=r.MessageInfoType,it=r.MessageChannelType,u=r.ThreadActivityMessageType,f={regular:0,bold:1,italic:2,strikeout:4,underline:8},n=ht._messageInfoHandler=function(n){this._message=n};n.parseMessageType=function(t){var i=t.getHeader(s);return n.parseMessageTypeText(i)},n.parseMessageTypeText=function(n){switch(n){case v:case y:return t.textMessage;case ot:return t.logRequestMessage;case w:return t.typingUserMessage;case p:return t.callEventMessage;case b:case k:case g:case d:case nt:case tt:return t.threadActivityMessage;default:return n.startsWith(st)?t.textMessage:t.unknownMessage}},n.parseMessage=function(u,f){var h=n.parseMessageType(u),e=null,c=u.get_headers(),s=u.get_body(),o;switch(h){case t.textMessage:e=n.parseTextMessage(c,s);break;case t.callEventMessage:e=n.parseCallEventMessage(s);break;case t.logRequestMessage:e=n.parseLogRequestMessage(s);break;case t.typingUserMessage:e=new r.MessageInfo(h,null);break;case t.threadActivityMessage:e=n.parseThreadActivityMessage(f.get_from(),c,s)}if(e!=null&&(e.id=u.getHeader(ft),e.timestamp=new r.DateInfo(n._getTimestamp(u)),o=u.getHeader(l),i.isNullOrEmpty(o)||(o=decodeURIComponent(o)),e.displayNameOverride=o,f.get_service()===r.ServiceType.IM))switch(f.get_channel()){case it.offline:e.isOfflineMessage=!0;break;case it.history:e.isHistoryMessage=!0}return e},n.createMessagingLayer=function(t){var i=new n(t);return new e.MessagingLayer(i._getHeaders(),i.getBody())},n._getTimestamp=function(n){var t=n.getHeader(et);return i.isNullOrEmpty(t)?new Date:h.DateTimeHelper.parseTimeStamp(t)},n.parseTextMessage=function(u,f){var e,o,h,l,v,p,w;return i.isNullOrEmpty(f)?null:(e=null,o=u[a],i.isNullOrEmpty(o)||(e=n.parseTextMessageFormat(o)),h=f,u[s]===y&&(h=n.parseRichTextBody(f)),l=new r.TextMessageInfo(h,e),v=u[ut],i.isNullOrEmpty(v)||(l.safeUrl=v),p=new r.MessageInfo(t.textMessage,l),w=u[c],i.isNullOrEmpty(w)||(p.clientId=w),p)},n.parseCallEventMessage=function(n){var u,f,e;return i.isNullOrEmpty(n)?null:(u=parseInt(n),!(u>=0))?null:(f=new r.CallEventMessageInfo(u),e=new r.MessageInfo(t.callEventMessage,f),e)},n.parseLogRequestMessage=function(n){var a=i.parseXml(n),f=a.documentElement,u,c,l;if(f==null||!h.XmlHelper.isElement(f,"LogRequest"))return null;for(var e=null,o=null,s=i.IEnumerator.getEnumerator(f.childNodes);s.moveNext();){u=s.get_current(),c=u.nodeName;switch(c){case"Url":e=u.text;break;case"AuthToken":o=u.text}}return i.isNullOrEmpty(e)||i.isNullOrEmpty(o)?null:(l=new r.LogRequestMessageInfo(e,o),new r.MessageInfo(t.logRequestMessage,l))},n.parseThreadActivityMessage=function(n,f,o){var h=u.none,l,v,p;switch(f[s]){case b:h=u.addMember;break;case k:h=u.deleteMember;break;case d:h=u.topicUpdate;break;case g:h=u.pictureUpdate;break;case nt:h=u.fileShared;break;case tt:h=u.contactShared}try{if(h===u.fileShared||h===u.contactShared)l=new r.ThreadActivityMessageInfo(h,e.Mri.getIMAddressInfo(n),null,null);else{var rt=i.parseXml(o),a=rt.documentElement,ut=a.selectSingleNode("initiator"),ft=e.Mri.getIMAddressInfo(new e.Mri(ut.text)),c=null,y=a.selectNodes("target");if(y.length>0)for(c=[],v=i.IEnumerator.getEnumerator(y);v.moveNext();)p=v.get_current(),c.push(e.Mri.getIMAddressInfo(new e.Mri(p.text)));var et=c==null?null:c,w=null,it=a.selectSingleNode("value");it!=null&&(w=it.text),l=new r.ThreadActivityMessageInfo(h,ft,et,w)}return new r.MessageInfo(t.threadActivityMessage,l)}catch(ot){return null}},n.parseTextMessageFormat=function(n){for(var c="",l=0,u=f.regular,a=!1,y=n.split(";"),v=i.IEnumerator.getEnumerator(y),s,e;v.moveNext();)if(s=v.get_current(),e=s.split(s,"=",2),e.length===2){var o=e[0].trim(),t=decodeURIComponent(e[1].trim()),p="@|(expression)|\\(|\\\\",w=new RegExp(p,"gi");o!=="FN"||w.test(t)?o==="EF"?(t.indexOf("B")>=0&&(u|=f.bold),t.indexOf("I")>=0&&(u|=f.italic),t.indexOf("U")>=0&&(u|=f.underline),t.indexOf("S")>=0&&(u|=f.strikeout)):o==="CO"?l=h.ConvertHelper.parseHexInt(t)&16777215:o==="RL"&&(a=t==="1"):c=t}return new r.TextMessageFormatInfo(l,c,u,a)},n.formatTextMessageFormat=function(n){var t=new i.StringBuilder,r;return t.append("FN="),t.append(encodeURIComponent(n.fontFamily)),t.append("; EF="),(n.fontStyle&f.bold)>0&&t.append("B"),(n.fontStyle&f.italic)>0&&t.append("I"),(n.fontStyle&f.strikeout)>0&&t.append("S"),(n.fontStyle&f.underline)>0&&t.append("U"),r=n.fontColor.toString(16),t.append("; CO="),t.append(encodeURIComponent(r)),n.rightToLeft&&t.append("; RL=1"),t.toString()},n.toDebugString=function(n){var u=new i.StringBuilder,f;return u.append(i.format("Message Type: {0} ",r.enumToString(t,n.type))),n.type===t.textMessage&&(f=n.info,u.append(i.format("Text: {0}",f.text))),n.sender!=null&&u.append(i.format("Sender: {0}:{1} ",n.sender.type,n.sender.address)),u.toString()},n.parseRichTextBody=function(t){var r=t,u;t.lTrim().toLowerCase().startsWith("<?xml")||(r=i.format('<?xml version="1.0"?><root>{0}<\/root>',t));try{return u=i.parseXml(r),n._parseRichTextNode(u.documentElement)}catch(f){return""}},n._parseRichTextNode=function(t){var r,u,f,e;if(t.nodeType===1){if(r=t.attributes.getNamedItem("alt"),i.isNullOrUndefined(r)){for(u=new i.StringBuilder,f=i.IEnumerator.getEnumerator(t.childNodes);f.moveNext();)e=f.get_current(),u.append(n._parseRichTextNode(e));return u.toString()}return r.text}return t.nodeType===3?t.text:""},n._parseBoolean=function(n){var t=n.trim().toLowerCase();if(t==="false")return!1;if(t==="true")return!0;throw new Error("Expected true or false. Received: "+t);},n.prototype={_message:null,_getHeaders:function(){var n={};return n[rt]=this._getContentType(),n[s]=this._getMessageType(),n[l]=this._message.displayNameOverride,this.getAdditionalHeaders(n),n},_getContentType:function(){switch(this._message.type){case t.textMessage:case t.typingUserMessage:case t.callEventMessage:return"text/plain; charset=UTF-8";default:return null}},_getMessageType:function(){switch(this._message.type){case t.textMessage:return v;case t.typingUserMessage:return w;case t.callEventMessage:return p;default:return null}},getAdditionalHeaders:function(i){switch(this._message.type){case t.textMessage:var r=this._message.info;r.format!=null&&(i[a]=n.formatTextMessageFormat(r.format)),this._message.clientId!=null&&(i[c]=this._message.clientId)}},getBody:function(){switch(this._message.type){case t.textMessage:return this._message.info.text;case t.callEventMessage:return this._message.info.duration.toString();default:return""}}}}(),function(){var n=window,r=n.MC,t=n.MSCh,u=n.MSM,f=n.MSH,e=n.ss,i=r.MessageInfoType;t._messageDataReader=function(n){this._data=n,this._parsed=!1},t._messageDataReader.prototype={_data:null,_parsed:!1,_message:null,get_parsed:function(){return this._parsed},get_message:function(){return this._message},parse:function(){var a,o,h,c;try{var v=e.parseXml(this._data),n=v.documentElement,l=n.selectSingleNode("messagetype").text,s=t._messageInfoHandler.parseMessageTypeText(l);(s===i.textMessage||s===i.threadActivityMessage)&&(a=n.selectSingleNode("content").text,o={},o["Message-Type"]=l,h=n.selectSingleNode("safeurl"),h!=null&&(o["Safe-Url"]=h.text),c=new u.Mri(n.selectSingleNode("from").text),this._message=this._parseMessageBody(s,c,o,a),this._message.id=n.selectSingleNode("messageid").text,this._message.timestamp=new r.DateInfo(f.DateTimeHelper.parseTimeStamp(n.selectSingleNode("originalarrivaltime").text)),this._message.sender=u.Mri.getIMAddressInfo(c),this._message.isHistoryMessage=!0),this._parsed=!0}catch(y){this._message=null}},_parseMessageBody:function(n,u,f,e){var o;switch(n){case i.textMessage:o=t._messageInfoHandler.parseTextMessage(f,e);break;case i.threadActivityMessage:o=t._messageInfoHandler.parseThreadActivityMessage(u,f,e);break;default:o=new r.MessageInfo(i.textMessage,new r.TextMessageInfo("",null))}return o}}}(),function(){var i=window,t=i.MSCh,n=i.ss;t._conversationDataReader=function(n){this._data=n,this._parsed=!1,this._conversationInfo={},this._messages=[]},t._conversationDataReader.prototype={_data:null,_parsed:!1,_conversationInfo:null,_messages:null,get_parsed:function(){return this._parsed},get_conversationInfo:function(){return this._conversationInfo!=null&&n.getKeyCount(this._conversationInfo)>0?this._conversationInfo:null},parse:function(){var s,i,f,e,u,a,r,o;try{if(s=n.parseXml(this._data),i=s.documentElement,this._conversationInfo.id=i.selectSingleNode("id").text,f=i.selectSingleNode("properties"),e=f.selectSingleNode("consumptionhorizon"),e!=null){var v=e.text,h=v.split(";"),c=new Date(parseInt(h[0]));c.setMilliseconds(999),this._conversationInfo.lastreadmessagetimestamp=c,this._conversationInfo.lastreadmessageid=h[2]}u=f.selectSingleNode("clearedat"),u==null||n.isNullOrEmpty(u.text)||(this._conversationInfo.clearedat=u.text);for(var y=i.selectSingleNode("messages"),p=y.selectNodes("message"),l=n.IEnumerator.getEnumerator(p);l.moveNext();)a=l.get_current(),r=new t._messageDataReader(a.xml),r.parse(),r.get_message()!=null&&(r.get_message().isRecentMessage=!0,this._messages.push(r.get_message()));this._messages.length>0&&(this._conversationInfo.messages=this._messages),this._conversationInfo.id.startsWith("19:")&&(o=i.selectSingleNode("thread"),this._conversationInfo.threadversion=o.selectSingleNode("version").text,this._conversationInfo.threadtopic=o.selectSingleNode("topic").text),this._parsed=!0}catch(w){this._conversationInfo=null}}}}(),function(){var i=window,n=i.MSCh,t=i.ss;n._conversationHistoryDataReader=function(n){this._data=n,this._parsed=!1,this._hasMore=!1,this._syncState="",this._messages=[]},n._conversationHistoryDataReader.prototype={_data:null,_parsed:!1,_messages:null,_hasMore:!1,_syncState:null,get_parsed:function(){return this._parsed},get_messages:function(){return this._messages!=null&&this._messages.length>0?this._messages:null},get_hasMore:function(){return this._hasMore},get_syncState:function(){return this._syncState},parse:function(){var f,i,e,o;if(!this._parsed)try{for(var s=t.parseXml(this._data),r=s.documentElement,h=r.selectSingleNode("messages"),c=h.selectNodes("message"),u=t.IEnumerator.getEnumerator(c);u.moveNext();)f=u.get_current(),i=new n._messageDataReader(f.xml),i.parse(),i.get_message()!=null&&this._messages.push(i.get_message());this._messages.sort(t.Delegate.create(this,this._compareMessages)),e=r.selectSingleNode("messagessyncstate"),this._syncState=e.text,o=r.selectSingleNode("hasmore"),this._hasMore=n._messageInfoHandler._parseBoolean(o.text),this._parsed=!0}catch(l){this._hasMore=!1,this._syncState="",this._messages=null}},_compareMessages:function(n,t){return n.timestamp.utcMilliseconds-t.timestamp.utcMilliseconds}}}(),function(){var n=window,u=n.MC,t=n.MSCh,i=n.MSM,f=n.MSH,r=n.ss;t._groupConversationErrorDataReader=function(n){this._data=n,this._parsed=!1},t._groupConversationErrorDataReader.prototype={_data:null,_parsed:!1,_threadId:null,_failedMembers:null,get_parsed:function(){return this._parsed},get_threadId:function(){return this._threadId},get_failedMembers:function(){return this._failedMembers},parse:function(){var o,n,t,e,c,l,a;try{if(o=r.parseXml(this._data),n=o.documentElement,this._threadId=f.XmlHelper.xmlNodeValue(n.selectSingleNode("id")),t=n.selectSingleNode("errors"),t!=null){for(var v=t.selectNodes("error"),s=[],h=r.IEnumerator.getEnumerator(v);h.moveNext();)(e=h.get_current(),c=parseInt(e.selectSingleNode("code").text),c!=735)&&(l=e.selectSingleNode("mri"),a=i.Mri.getIMAddressInfo(new i.Mri(l.text)),s.push(new u.GroupConversationMemberInfo(a,null)));this._failedMembers=s}this._parsed=!0}catch(y){}}}}(),function(){var t=window,r=t.MC,i=t.MSCh,n=t.MSM,u=t.MSH,f=t.ss;i._groupConversationDataReader=function(n){this._data=n,this._parsed=!1},i._groupConversationDataReader.prototype={_data:null,_parsed:!1,_groupConversationInfo:null,get_parsed:function(){return this._parsed},get_groupConversationInfo:function(){return this._groupConversationInfo},parse:function(){var o,l,w,b,h;try{var k=f.parseXml(this._data),t=k.documentElement,c=u.XmlHelper.xmlNodeValue(t.selectSingleNode("id")),e=t.selectSingleNode("properties");if(c.endsWith("p2p.thread.skype")&&(o=e.selectSingleNode("migrationcompleted"),f.isNullOrUndefined(o)||!i._messageInfoHandler._parseBoolean(o.text)))return;l=u.XmlHelper.xmlNodeValue(t.selectSingleNode("version")),this._groupConversationInfo=new r.GroupConversationInfo(c,parseInt(l));for(var d=t.selectSingleNode("members"),g=d.selectNodes("member"),s=[],a=f.IEnumerator.getEnumerator(g);a.moveNext();){var v=a.get_current(),nt=v.selectSingleNode("mri"),y=new n.Mri(nt.text),p=v.selectSingleNode("linkedmri");p!=null?(w=new n.Mri(p.text),s.push(new r.GroupConversationMemberInfo(n.Mri.getIMAddressInfo(y),n.Mri.getIMAddressInfo(w)))):s.push(new r.GroupConversationMemberInfo(n.Mri.getIMAddressInfo(y),null))}this._groupConversationInfo.members=s,b=u.XmlHelper.xmlNodeValue(e.selectSingleNode("creator")),this._groupConversationInfo.creator=n.Mri.getIMAddressInfo(new n.Mri(b)),h=e.selectSingleNode("topic"),h!=null&&(this._groupConversationInfo.title=i._messageInfoHandler.parseRichTextBody(h.text)),this._parsed=!0}catch(tt){this._groupConversationInfo=null}}}}(),function(){var i=window,n=i.MSCh,t=i.ss;n._recentConversationsDataReader=function(n){this._data=n,this._parsed=!1,this._hasMore=!1,this._syncState="",this._conversations=[]},n._recentConversationsDataReader.prototype={_data:null,_parsed:!1,_conversations:null,_hasMore:!1,_syncState:null,get_parsed:function(){return this._parsed},get_conversations:function(){return this._conversations!=null&&this._conversations.length>0?this._conversations:null},get_hasMore:function(){return this._hasMore},get_syncState:function(){return this._syncState},parse:function(){var o,u,s,f,i,h,c;if(!this._parsed)try{var l=t.parseXml(this._data),r=l.documentElement,e=r.selectSingleNode("conversations");if(e!=null){for(o=e.selectNodes("conversation"),u=t.IEnumerator.getEnumerator(o);u.moveNext();)s=u.get_current(),f=new n._conversationDataReader(s.xml),f.parse(),i=f.get_conversationInfo(),i!=null&&i.id!=null&&i.messages!=null&&this._conversations.push(i);this._conversations.sort(t.Delegate.create(this,this._compareConversations))}h=r.selectSingleNode("syncstate"),this._syncState=h.text,c=r.selectSingleNode("hasmore"),this._hasMore=n._messageInfoHandler._parseBoolean(c.text),this._parsed=!0}catch(a){this._hasMore=!1,this._syncState="",this._conversations=null}},_compareConversations:function(n,t){var i=n.messages[0],r=t.messages[0];return i.timestamp.utcMilliseconds-r.timestamp.utcMilliseconds}}}(),function(){var i=window,u=i.MC,n=i.MSCh,t=i.MSM,r=i.ss,f=u.MessageInfoType;n.MessagingContext=function(n,t,i,r,u){this._messagingService=n,this._messagingEvents=i,this._userService=t,this._self=r,this._recipient=u},n.MessagingContext.prototype={_messagingService:null,_messagingEvents:null,_userService:null,_self:null,_recipient:null,_initialAddress:null,_initialAddressAdded:!1,get__from:function(){return this._self},get__to:function(){return this._recipient},sendMessage:function(t,i){var r=new n._sendPagedMessageCommand(this._messagingService,this,t,i);this._execute(r)},addMembers:function(t,i){var r=new n._addMembersCommand(this._messagingService,this,this._recipient.toString(),t,i);r.execute()},removeMembers:function(t,i){var r=new n._removeMembersCommand(this._messagingService,this,this._recipient.toString(),t,i);r.execute()},close:function(){},_onMessageReceived:function(n,i,r){r.sender=t.Mri.getIMAddressInfo(n),this._self.equals(n,t.MriCompareOptions.address)&&(r.isOfflineMessage=!1);this._messagingEvents.onReceivedMessage(n,r)},_onSendMessageFailed:function(n,t,i){this._messagingEvents.onSendMessageFailed(n,t,i)},_onAddressLeft:function(n,t,i){for(var u=r.IEnumerator.getEnumerator(i),f;u.moveNext();){f=u.get_current();this._messagingEvents.onAddressLeft(f)}},_onAddressJoined:function(n,i,u){for(var e=r.IEnumerator.getEnumerator(u),f;e.moveNext();)if(f=e.get_current(),this._self.equals(f,t.MriCompareOptions.address)&&!this._initialAddressAdded&&this._initialAddress!=null)this._initialAddressAdded=!0;else this._messagingEvents.onAddressJoined(f)},_onAddressPending:function(n,i,u,f){var e,o;for(u.length===1&&f.length===1&&this._self.equals(u[0],t.MriCompareOptions.address)&&(this._recipient=n,this._messagingService.updateSession(f[0],n)),e=r.IEnumerator.getEnumerator(u);e.moveNext();)if(o=e.get_current(),this._self.equals(o,t.MriCompareOptions.address))break},_setInitialAddress:function(n){this._initialAddress=n},_execute:function(n){n.execute()}}}(),function(){var i=window,r=i.MC,t=i.MSCh,u=i.MSM,n=r.IMAddressInfoType;t._conversationState=function(n){n&&(this._conversation=n,this._messagingContext=n.get_messaging(),this._events=n.get_conversationEvents())},t._conversationState.create=function(i,r){var u=null;switch(i.get_addressType()){case n.none:case n.officeCommunicator:case n.windowsLive:case n.cid:case n.skype:case n.smtp:case n.telephone:case n.connect:case n.shortCircuit:u=new t._pageState(i,r);break;case n.temporaryGroup:u=new t._groupState(r)}return u},t._conversationState.prototype={_conversation:null,_events:null,_messagingContext:null,addMembers:null,removeMembers:null,onAddressJoined:null,onAddressLeft:null,get_conversation:function(){return this._conversation},get_events:function(){return this._events},get_messagingContext:function(){return this._messagingContext},sendMessage:function(n,t){this.get_messagingContext().sendMessage(n,t)},onMessageReceived:function(n,t){this._conversation.get_isExposed()||this._conversation.expose(),t.sender=u.Mri.getIMAddressInfo(n);this._conversation.get_service().onConversationMessageReceived(this._conversation.get_id(),t)},onOpened:function(){},onClosed:function(){this._conversation.get_service().onConversationClosed(this._conversation.get_id())},close:function(){this._messagingContext.close()}}}(),function(){var o=5e3,r=window,n=r.MC,u=r.MSCh,f=r.MSM,e=r.MSH,t=r.ss,h=n.ConnectionServiceResultCode,s=n.MessageInfoType,i=n.Logger;u._conversation=function(t,i,r,e,o,s){this._consumptionHorizon=null,this._clearedAt=null,this._roster=[],this._id=t,this._service=i,this._events=e,this._mri=o,this._roster.push(this._mri),this._pendingMessages={};var h=new f.Mri(t);h.get_addressType()===n.IMAddressInfoType.temporaryGroup&&(s=h),this._messaging=r.getMessagingContext(this._mri,s,this),this._currentState=u._conversationState.create(s,this)},u._conversation.prototype={_service:null,_messaging:null,_events:null,_mri:null,_roster:null,_id:null,_messageSyncState:null,_hasMoreHistory:!0,_currentState:null,_pendingMessages:null,_isExposed:!1,_getInfoPending:!1,_getHistoryPending:!1,_consumptionHorizonUpdateTimer:null,_consumptionHorizonUpdateWhenReady:!1,_consumptionHorizonUpdateThrottled:!1,get_id:function(){return this._id},get_conversationEvents:function(){return this._events},get_messaging:function(){return this._messaging},get_service:function(){return this._service},get_mri:function(){return this._mri},get_isExposed:function(){return this._isExposed},set_isExposed:function(n){return this._isExposed=n,n},get_clearedAt:function(){return this._clearedAt},set_clearedAt:function(n){this._clearedAt!==n&&(this._clearedAt=n)},get_consumptionHorizon:function(){return this._consumptionHorizon},set_consumptionHorizon:function(n){this._consumptionHorizon&&this._consumptionHorizon.lastReadMessageId===n.lastReadMessageId&&this._consumptionHorizon.lastReadMessageTimestamp===n.lastReadMessageTimestamp||(this._consumptionHorizon=n)},get_roster:function(){return this._roster},open:function(){this._isExposed=!0},close:function(){this._currentState.close(),this._consumptionHorizon=null,this._disposeConsumptionHorizonUpdateTimer()},addMembers:function(n,t){this._currentState.addMembers(n,t)},removeMembers:function(n,t){this._currentState.removeMembers(n,t)},sendMessage:function(n,t){this._currentState.sendMessage(n,t),i.logAction("ChatConversationSendMessage")},updateState:function(n){this._currentState=n},updateId:function(n){var t=this._id;this._id=n,this._service.conversationUpdateId(t,n)},updateConsumptionHorizon:function(n){this.set_consumptionHorizon(n),this.get_consumptionHorizon()==n&&this._sendConsumptionHorizonUpdate()},expose:function(){var t,i,n;if(!this._isExposed){for(t=this._roster.length,i=new Array(t),n=0;n<t;n++)i[n]=f.Mri.getIMAddressInfo(this._roster[n]);this._isExposed=!0,this._service.conversationExpose(this._id,i,this.get_consumptionHorizon())}},rosterAdd:function(n){this._findExistingAddress(n)==null&&this._roster.push(n)},rosterRemove:function(n){if(n=this._findExistingAddress(n),n!=null&&this._roster.length>2&&(this._roster.remove(n),this._roster.length===0)){var i=this.findOtherAddress(),t=i.toConversationId();this._service.isValidConversation(t)||this.updateId(t)}},isRosterAddress:function(n){return this._findExistingAddress(n)!=null},findOtherAddress:function(){var n=this._roster[0];return n.get_address()===this.get_mri().get_address()?this._roster.length>1?this._roster[1]:null:n},getHistory:function(){var i=this,r;if(i._getInfoPending){i._getHistoryPending=!0;return}if(i._hasMoreHistory)r={},r.startTime=+new Date,r.scenario=n.WebmainHelper.startQoS(n.WebmainHelper.qoSScenarioConversationHistory),i._service.getConversationHistory(i._id,i._messageSyncState,function(n,u){t.Delegate.create(i,i._onGetHistoryCompleted)(n,u,r)});else i._events.onConversationHistoryMessagesReceived(i._id,null,!1)},getInfo:function(n){n&&(this._getInfoPending=!0,this._service.getConversationInfo(this._id,t.Delegate.create(this,this._onGetInfoCompleted)))},_sendConsumptionHorizonUpdate:function(){if(this._consumptionHorizonUpdateThrottled){this._consumptionHorizonUpdateWhenReady=!0;return}this._consumptionHorizonUpdateWhenReady=!1;var n=new Array(3);n[0]=this.get_consumptionHorizon().lastReadMessageTimestamp.getTime().toString(),n[1]=(+new Date).toString(),n[2]=this.get_consumptionHorizon().lastReadMessageId,this._service.updateConversationProperty(this._id,"consumptionhorizon",n.join(";"),null),this._scheduleConsumptionHorizonUpdateTimer()},_onConsumptionHorizonUpdateTimeout:function(){this._consumptionHorizonUpdateThrottled=!1,this._consumptionHorizonUpdateWhenReady&&this._sendConsumptionHorizonUpdate()},_scheduleConsumptionHorizonUpdateTimer:function(){this._consumptionHorizonUpdateTimer==null?this._consumptionHorizonUpdateTimer=new e.Timer(t.Delegate.create(this,this._onConsumptionHorizonUpdateTimeout),null,o,e.Timeout.infinite):this._consumptionHorizonUpdateTimer.change(o,e.Timeout.infinite),this._consumptionHorizonUpdateThrottled=!0},_disposeConsumptionHorizonUpdateTimer:function(){this._consumptionHorizonUpdateTimer!=null&&(this._consumptionHorizonUpdateTimer.dispose(),this._consumptionHorizonUpdateTimer=null),this._consumptionHorizonUpdateThrottled=!1,this._consumptionHorizonUpdateWhenReady=!1},_onGetHistoryCompleted:function(i,r,e){var h,s,o;this.expose(),h=null,s=null,i!==f.MsnpStatusCode.success||t.isNullOrEmpty(r)?(s=t.format("{0}-{1}",i,n.enumToString(f.MsnpStatusCode,i)),this._hasMoreHistory=!1):(o=new u._conversationHistoryDataReader(r),o.parse(),o.get_parsed()||(s="Client - Conversation History response parsing failed."),o.get_messages()!=null&&(o.get_messages()[o.get_messages().length-1].isLastHistoryMessage=!0,h=o.get_messages()),this._messageSyncState=o.get_syncState(),this._hasMoreHistory=o.get_hasMore()),n.WebmainHelper.addQoSStats(n.WebmainHelper.qoSApiConversationHistory,s,e.startTime,e.scenario,!1),n.WebmainHelper.stopQoS(e.scenario,s==null,s);this._events.onConversationHistoryMessagesReceived(this._id,h,this._hasMoreHistory)},_onGetInfoCompleted:function(i,r){var e,f,o,s,c;if(this._getInfoPending=!1,e=null,i===h.success&&!t.isNullOrEmpty(r))try{var a=t.parseXml(r),v=a.documentElement,y=v.selectSingleNode("conversations"),l=y.selectNodes("conversation");l!=null&&(f=new u._conversationDataReader(l[0].xml),f.parse(),o=f.get_conversationInfo().lastreadmessageid,s=f.get_conversationInfo().lastreadmessagetimestamp,(o||s)&&this.set_consumptionHorizon(new n.ConsumptionHorizonInfo(o,s)),c=f.get_conversationInfo().clearedat,t.isNullOrUndefined(c)||this.set_clearedAt(c),f.get_conversationInfo()!=null&&f.get_conversationInfo().messages!=null&&(e=f.get_conversationInfo().messages[0]))}catch(p){}if(e==null){this._hasMoreHistory=!1;this._events.onConversationHistoryMessagesReceived(this._id,null,this._hasMoreHistory)}else{this._service.onConversationMessageReceived(this._id,e);this._getHistoryPending&&this.getHistory()}this._getHistoryPending=!1},onAddressLeft:function(n){this._currentState.onAddressLeft(n);i.logAction("ChatConversationOnAddressLeft")},onAddressJoined:function(n){this._currentState.onAddressJoined(n);i.logAction("ChatConversationOnAddressJoined")},onOpened:function(){this._currentState.onOpened(),i.logAction("ChatConversationOnOpened")},onClosed:function(){this._isExposed=!1,this._consumptionHorizon=null,this._currentState.onClosed(),this._disposeConsumptionHorizonUpdateTimer(),i.logAction("ChatConversationOnClosed")},onNotificationReceived:function(t){var r=t.lastreadmessageid,u=t.lastreadmessagetimestamp,i;if((r||u)&&(i=new n.ConsumptionHorizonInfo(r,u),this.set_consumptionHorizon(i),this.get_consumptionHorizon()==i))this._service.onConversationConsumptionHorizonUpdated(this.get_id(),this.get_consumptionHorizon());if(this.get_clearedAt()!=t.clearedat){this.set_clearedAt(t.clearedat);this._service.onConversationClearedAtUpdated(this.get_id(),this.get_clearedAt())}},onReceivedMessage:function(t,r){if((this._isExposed||r.type!==s.typingUserMessage)&&(this._messaging.get__to().get_addressType()!==n.IMAddressInfoType.temporaryGroup||!t.equals(this._messaging.get__from(),f.MriCompareOptions.addressAndEpId))){this._currentState.onMessageReceived(t,r);i.logAction("ChatConversationOnReceivedMessage")}},onSendMessageFailed:function(n,t,r){if(t.type!==s.typingUserMessage){this._events.onConversationSendMessageFailed(this.get_id(),n,t,r);i.logResult("ChatConversationOnSendMessageFailed",n)}},_findExistingAddress:function(n){for(var r=t.IEnumerator.getEnumerator(this._roster),i;r.moveNext();)if(i=r.get_current(),n.get_address()===i.get_address()&&n.get_addressType()===i.get_addressType())return i;return null}}}(),function(){var f=window,n=f.MC,u=f.MSCh,t=f.MSM,i=f.ss,r=n.IMAddressInfoType,e=n.MessengerServiceResultCode,o=n.ConnectionServiceResultCode,c=n.GroupChatPhase,s=new Date,h;s.setMonth(-1),h=new Date,h.setMonth(-4),u.ConversationService=function(n,t,r){this._identity=n,this._service=t,this._serviceEvents=r,this.conversations={},this._messagingService=new u.MessagingService(n,this,this._service,i.Delegate.create(this,this.onIncomingRequest)),this._syncStartTime=s},u.ConversationService.prototype={conversations:null,_service:null,_serviceEvents:null,_messagingService:null,_identity:null,_syncState:null,_syncStartTime:null,_pendingConversations:[],_hasMoreRecentConversations:!0,get_cid:function(){return this._identity.cid},get_liveId:function(){return this._identity.liveId},get_skypeId:function(){return this._identity.skypeId},get_localEndpoint:function(){return this._identity.endpointId},isValidConversation:function(n){return this._getConversationById(n)!=null},_getConversationById:function(n){return i.keyExists(this.conversations,n)?this.conversations[n]:null},conversationCreate:function(n,i,r){var f,e,o;this._getConversationById(n)==null?(e=this._createUserMri(i.type,null),o=t.Mri.create(i.address,i.type,null,null,i.network),f=new u._conversation(n,this,this._messagingService,this,e,o),f.open(r),f.getInfo(r),this.conversations[n]=f):(f=this.conversations[n],f.open(r))},conversationCreateGroup:function(n){this._service.createConversationGroup(n,i.Delegate.create(this,this._onConversationGroupCreated))},conversationSendMessage:function(n,t,i){var r=this._getConversationById(n);r!=null&&r.sendMessage(t,i)},conversationAddMembers:function(n,t,i){var r=this._getConversationById(n);r!=null&&r.addMembers(t,i)},conversationRemoveMembers:function(n,t,i){var r=this._getConversationById(n);r!=null&&r.removeMembers(t,i)},conversationClose:function(n,t){var i=this._getConversationById(n);i!=null&&(i.close(t),i.get_roster().length>2?delete this.conversations[n]:i.set_isExposed(!1))},conversationDelete:function(r,u,f){var o=this,s=o._getConversationById(r),e;s!=null&&(s.set_isExposed(!1),delete o.conversations[r],s.get_clearedAt()!=u?(e={},e.startTime=+new Date,e.scenario=n.WebmainHelper.startQoS(n.WebmainHelper.qoSScenarioDeleteConversations),o._service.updateConversationProperty(r,"clearedat",u,function(r){var u=null;r!=t.MsnpStatusCode.success&&(u=i.format("{0}-{1}",r,n.enumToString(t.MsnpStatusCode,r))),n.WebmainHelper.addQoSStats(n.WebmainHelper.qoSApiDeleteConversations,u,e.startTime,e.scenario,!1),n.WebmainHelper.stopQoS(e.scenario,u==null,u),f.invoke(r)})):f.invoke(t.MsnpStatusCode.success))},conversationExpose:function(n,t,i){this._service.conversationExpose(n,t,i);var r=this._getConversationById(n);r!=null&&r.set_isExposed(!0)},conversationUpdateId:function(n,t){var r=this.conversations[n],u=i.keyExists(this.conversations,t);u&&r.set_isExposed(this.conversations[t].get_isExposed()),this.conversations[t]=r,delete this.conversations[n],r.get_isExposed()&&!u&&this._service.conversationUpdateId(n,t)},conversationUpdateConsumptionHorizon:function(n,t){var i=this._getConversationById(n);i!=null&&i.updateConsumptionHorizon(t)},conversationGetRecentList:function(){var r={},t;r.startTime=+new Date,r.scenario=n.WebmainHelper.startQoS(n.WebmainHelper.qoSScenarioRecentConversations),t=this,t._service.getRecentConversations(t._syncState,t._syncStartTime,function(n,u){i.Delegate.create(t,t._onGetRecentConversationsCompleted)(n,u,r)})},conversationGetHistory:function(n){var t=this._getConversationById(n);t!=null&&t.getHistory()},getConversationHistory:function(n,t,i){this._service.getConversationHistory(n,t,i)},getConversationInfo:function(n,t){this._service.getConversationInfo(n,t)},updateConversationProperty:function(n,t,i,r){this._service.updateConversationProperty(n,t,i,r)},getGroupInfo:function(n,t,i){this._service.getGroupInfo(n,t,i)},sendDatagram:function(n,t,i){this._service.sendDatagram(n,t,i)},onDatagramReceived:function(t){var r,i,f;if(t.datagramType===n.DatagramInfoType.imGroupPut)this._onConversationGroupNotificationReceived(t.payload);else if(t.datagramType===n.DatagramInfoType.conversationPut){if(r=new u._conversationDataReader(t.payload),r.parse(),i=r.get_conversationInfo(),i&&(f=this._getConversationById(i.id),f))f.onNotificationReceived(i);return}this._messagingService.onDatagramReceived(t)},onIncomingRequest:function(i,f){var s=this._createUserMri(i.get_addressType(),i.get_appId()),e=i.toConversationId(),h=t.Mri.create(i.get_address(),i.get_addressType(),null,i.get_appId(),i.get_networkId()),o=new u._conversation(e,this,this._messagingService,this,s,h);return i.get_addressType()===r.temporaryGroup&&f.datagramType===n.DatagramInfoType.sdg?(o.close(!1),!1):(this.conversations[e]=o,!0)},close:function(n){n&&this._closeAllConversations()},onConversationAddMembersCompleted:function(t,i,r,f){var o=new u._groupConversationErrorDataReader(r),e;o.parse(),e=o.get_failedMembers();this._serviceEvents.onConversationAddMembersCompleted(t,e&&e.length>0?i:n.GroupConversationOperationResult.success,e,f)},onConversationRemoveMembersCompleted:function(t,i,r,f){var o=new u._groupConversationErrorDataReader(r),e;o.parse(),e=o.get_failedMembers();this._serviceEvents.onConversationRemoveMembersCompleted(t,e&&e.length>0?i:n.GroupConversationOperationResult.success,e,f)},onConversationAddressJoined:function(n,t){this._serviceEvents.onConversationAddressJoined(n,t)},onConversationAddressLeft:function(n,t){this._serviceEvents.onConversationAddressLeft(n,t)},onConversationMessageReceived:function(n,t){this._serviceEvents.onConversationMessageReceived(n,t)},onConversationHistoryMessagesReceived:function(n,t,i){this._serviceEvents.onConversationHistoryMessagesReceived(n,t,i)},onConversationConsumptionHorizonUpdated:function(n,t){this._serviceEvents.onConversationConsumptionHorizonUpdated(n,t)},onConversationClearedAtUpdated:function(n,t){this._serviceEvents.onConversationClearedAtUpdated(n,t)},onConversationClosed:function(n){this._serviceEvents.onConversationClosed(n)},onConversationSendMessageFailed:function(t,i,r,u){var f=e.failure;switch(i){case n.SendDatagramResultCode.tooLong:f=e.messageTooLong;break;case n.SendDatagramResultCode.recipientInvalid:f=e.messageRecipientInvalid;break;case n.SendDatagramResultCode.recipientDisabled:f=e.messageRecipientDisabled}this._serviceEvents.onConversationSendMessageFailed(t,f,r,u)},_closeAllConversations:function(){var r=[],u=this.conversations,n,f,t,e;for(n in u)f={key:n,value:u[n]},r.push(f.key);for(t=i.IEnumerator.getEnumerator(r);t.moveNext();)e=t.get_current(),this.conversationClose(e,!1)},_createUserMri:function(n,u){var f;return f=n===r.cid?t.Mri.create(this.get_cid(),r.cid,this.get_localEndpoint(),u,null):n!==r.skype&&n!==r.temporaryGroup||i.isNullOrEmpty(this.get_skypeId())?n!==r.shortCircuit||i.isNullOrEmpty(this.get_cid())?t.Mri.create(this.get_liveId(),r.windowsLive,this.get_localEndpoint(),null,null):t.Mri.create(this.get_cid(),r.shortCircuit,this.get_localEndpoint(),null,null):t.Mri.create(this.get_skypeId(),r.skype,this.get_localEndpoint(),null,null)},_onConversationGroupCreated:function(f,e){var h,s,c,v,l;if((f===o.success||f===o.partialFailure)&&(h=new u._groupConversationErrorDataReader(e),h.parse(),s=h.get_threadId(),!i.isNullOrEmpty(s))){var y=this._createUserMri(r.skype,null),p=new t.Mri(h.get_threadId()),a=new u._conversation(s,this,this._messagingService,this,y,p);a.open(!0),this.conversations[s]=a,c=new n.GroupConversationInfo(s,0),c.creator=new n.IMAddressInfo(this._identity.skypeId,r.skype,n.RoleLists.none),c.userInitiated=!0;this._serviceEvents.onConversationGroupCreated(c,a.get_consumptionHorizon());f===o.partialFailure&&(v=this,l=h.get_failedMembers(),window.setTimeout(function(){v._serviceEvents.onConversationAddMembersCompleted(s,l&&l.length>0?f:n.GroupConversationOperationResult.success,l,null)},2e3))}},_onConversationGroupNotificationReceived:function(f){var e,v,y,l,h;if(n.GroupChatFeatures.phase!==c.disabled&&(e=new u._groupConversationDataReader(f),e.parse(),e.get_groupConversationInfo()!=null)){var s=e.get_groupConversationInfo().id,a=!1,o=this.conversations[s];for(o==null&&(v=this._createUserMri(r.skype,null),y=new t.Mri(s),o=new u._conversation(s,this,this._messagingService,this,v,y),this.conversations[s]=o,a=!0),o.get_roster().length=0,l=i.IEnumerator.getEnumerator(e.get_groupConversationInfo().members);l.moveNext();)h=l.get_current(),o.rosterAdd(t.Mri.createFromIMAddressInfo(h.address)),h.linkedAddress!=null&&o.rosterAdd(t.Mri.createFromIMAddressInfo(h.linkedAddress));if(a)this._serviceEvents.onConversationGroupCreated(e.get_groupConversationInfo(),o.get_consumptionHorizon());else this._serviceEvents.onConversationGroupUpdated(e.get_groupConversationInfo())}},_onGetRecentConversationsCompleted:function(r,f,e){var c=null,o;if(r!==t.MsnpStatusCode.success||i.isNullOrEmpty(f)?(c=i.format("{0}-{1}",r,n.enumToString(t.MsnpStatusCode,r)),this._hasMoreRecentConversations=!1):(o=new u._recentConversationsDataReader(f),o.parse(),o.get_parsed()||(c="Client - Recent Conversations response parsing failed."),o.get_conversations()!=null&&(this._pendingConversations=this._pendingConversations.concat(o.get_conversations())),this._syncState=o.get_syncState(),this._hasMoreRecentConversations=o.get_hasMore()),n.WebmainHelper.addQoSStats(n.WebmainHelper.qoSApiRecentConversations,c,e.startTime,e.scenario,!1),n.WebmainHelper.stopQoS(e.scenario,c==null,c),this._hasMoreRecentConversations)this.conversationGetRecentList();else{this._syncStartTime==s&&(this._syncStartTime=h,this._syncState=null,this._hasMoreRecentConversations=!0),this._processRecentConversations(this._pendingConversations),this._pendingConversations=[];this._serviceEvents.onConversationGetRecentListCompleted(this._hasMoreRecentConversations,r!==t.MsnpStatusCode.success)}},_processRecentConversations:function(f){for(var y=[],d=i.IEnumerator.getEnumerator(f),p,e,w,b,k,v,a;d.moveNext();){var o=d.get_current(),s=o.id,l=new t.Mri(s),h=l.get_addressType();if((h===r.windowsLive||h===r.skype||h===r.connect||h===r.temporaryGroup||h===r.shortCircuit)&&(p=this._createUserMri(l.get_addressType(),null),!p.equals(l,t.MriCompareOptions.address)&&(h!==r.temporaryGroup||n.GroupChatFeatures.phase!==c.disabled))&&(e=this._getConversationById(s),!e))if(e=new u._conversation(s,this,this._messagingService,this,p,l),this.conversations[s]=e,w=o.lastreadmessageid,b=o.lastreadmessagetimestamp,(w||b)&&e.set_consumptionHorizon(new n.ConsumptionHorizonInfo(w,b)),k=o.clearedat,i.isNullOrUndefined(k)||e.set_clearedAt(k),v=o.messages[0],l.get_addressType()===r.temporaryGroup){y.push(s),a=new n.GroupConversationInfo(s,parseInt(o.threadversion)),a.members=[new n.GroupConversationMemberInfo(v.sender,null)],a.title=o.threadtopic;this._serviceEvents.onConversationGroupCreated(a,e.get_consumptionHorizon());this._serviceEvents.onConversationMessageReceived(a.id,v)}else{e.expose();this.onConversationMessageReceived(s,v)}}y.length>0&&this.getGroupInfo(y,i.Delegate.create(this,this._onGetGroupInfoCompleted))},_onGetGroupInfoCompleted:function(n,r){var v,e,s,h,l,c;if(n===o.success&&!i.isNullOrEmpty(r))try{for(var y=i.parseXml(r),p=y.documentElement,w=p.selectSingleNode("threads"),b=w.selectNodes("thread"),a=i.IEnumerator.getEnumerator(b);a.moveNext();)if(v=a.get_current(),e=new u._groupConversationDataReader(v.xml),e.parse(),s=e.get_groupConversationInfo(),s){for(h=this._getConversationById(s.id),h.get_roster().length=0,l=i.IEnumerator.getEnumerator(e.get_groupConversationInfo().members);l.moveNext();)c=l.get_current(),h.rosterAdd(t.Mri.createFromIMAddressInfo(c.address)),c.linkedAddress!=null&&h.rosterAdd(t.Mri.createFromIMAddressInfo(c.linkedAddress));this._serviceEvents.onConversationGroupUpdated(s)}}catch(k){}}}}(),function(){var r=window,u=r.MSCh,i=r.MSM,t=r.ss,f=u._conversationState,e=u._groupState=function(n){f.call(this,n),this._userInvitedAddress$1={}},n=e.prototype=new f;n.constructor=e,n._userInvitedAddress$1=null,n.addMembers=function(n){this.get_messagingContext().addMembers(n,t.Delegate.create(this,this._onAddMembersCompleted$1))},n.removeMembers=function(n){this.get_messagingContext().removeMembers(n,t.Delegate.create(this,this._onRemoveMembersCompleted$1))},n.onAddressJoined=function(n){var u=new i.Mri(this.get_conversation().get_id()),r;if(u.equals(this.get_messagingContext().get__to(),i.MriCompareOptions.address)||this.get_conversation().updateId(this.get_messagingContext().get__to().toConversationId()),!this.get_conversation().isRosterAddress(n))if(this.get_conversation().rosterAdd(n),r=i.Mri.getIMAddressInfo(n),t.keyExists(this._userInvitedAddress$1,n.get_address())&&(this._getUserState$1(n),this._removeInvitedAddress$1(n)),this.get_conversation().get_isExposed())this.get_events().onConversationAddressJoined(this.get_conversation().get_id(),r);else this.get_conversation().expose()},n.onAddressLeft=function(n){if(this.get_conversation().isRosterAddress(n)){this.get_conversation().rosterRemove(n),this._removeInvitedAddress$1(n);var t=i.Mri.getIMAddressInfo(n);this.get_events().onConversationAddressLeft(this.get_conversation().get_id(),t)}},n._removeInvitedAddress$1=function(n){t.keyExists(this._userInvitedAddress$1,n.get_address())&&delete this._userInvitedAddress$1[n.get_address()]},n._getUserState$1=function(n){if(t.keyExists(this._userInvitedAddress$1,n.get_address())){var i=this._userInvitedAddress$1[n.get_address()];return i[1]}return null},n._onAddMembersCompleted$1=function(n,t){this.get_events().onConversationAddMembersCompleted(this.get_conversation().get_id(),n,t,null)},n._onRemoveMembersCompleted$1=function(n,t){this.get_events().onConversationRemoveMembersCompleted(this.get_conversation().get_id(),n,t,null)}}(),function(){var u=window,t=u.MSCh,i=t._conversationState,r=t._pageState=function(n,t){i.call(this,t),this._initialAddress$1=n,this.get_conversation().rosterAdd(n)},n=r.prototype=new i;n.constructor=r,n._initialAddress$1=null,n.addMembers=function(){},n.removeMembers=function(){},n.onAddressJoined=function(n){var i=new t._groupState(this.get_conversation());this.get_conversation().updateState(i);i.onAddressJoined(n)},n.onAddressLeft=function(){}}(),function(n){var i=window,t=i.MSCh;t._messagingCommand=function(n){this._userState=n},t._messagingCommand.prototype={_userState:null,_completed:!1,onExecuted:null,get_userState:function(){return this._userState},execute:function(){this.onExecuted()},complete:function(){this._completed||(this._completed=!0,n(this).triggerHandler("completed",[this,{}]))}}}(window.originaljQuery||jQuery),function(){var t=window,i=t.MSCh,r=t.MSM,e=t.ss,u=i._messagingCommand,f=i._pagedMessagingCommand=function(n,t,i){u.call(this,i),this._service$1=n,this._context$1=t},n=f.prototype=new u;n.constructor=f,n._context$1=null,n._service$1=null,n._routingLayer$1=null,n._reliabilityLayer$1=null,n.get_messagingContext=function(){return this._context$1},n.get_routing=function(){return this._routingLayer$1==null&&(this._routingLayer$1=new r.RoutingLayer(this._context$1.get__to(),this._context$1.get__from())),this._routingLayer$1},n.get_reliability=function(){return this._reliabilityLayer$1==null&&(this._reliabilityLayer$1=new r.ReliabilityLayer),this._reliabilityLayer$1},n.sendMessage=function(n){this._service$1.sendDatagram(n,e.Delegate.create(this,this.onSendCompleted),this.get_userState())},n.onSendCompleted=function(){this.complete()}}(),function(){var o="<thread><id>{0}<\/id><members>{1}<\/members><\/thread>",s="<member><mri>{0}<\/mri><\/member>",i=window,t=i.MC,f=i.MSCh,h=i.MSM,r=i.ss,u=f._pagedMessagingCommand,e=f._removeMembersCommand=function(n,t,i,r,f){u.call(this,n,t,null),this._id$2=i,this._members$2=r,this._onCompleted$2=f},n=e.prototype=new u;n.constructor=e,n._members$2=null,n._id$2=null,n._onCompleted$2=null,n.get_delDocument=function(){for(var t=new r.StringBuilder,i,n=0;n<this._members$2.length;n++)i=this._members$2[n],t.append(r.format(s,h.Mri.createFromIMAddressInfo(i.address).toString()));return r.format(o,this._id$2,t.toString())},n.onExecuted=function(){var n=new t.DatagramInfo(t.DatagramInfoType.imGroupDel,this.get_delDocument());this.sendMessage(n)},n.onSendCompleted=function(n,i){u.prototype.onSendCompleted.call(this,n,i);var r=t.GroupConversationOperationResult.success;n!==t.SendDatagramResultCode.success&&(r=t.GroupConversationOperationResult.failure),this._onCompleted$2!=null&&this._onCompleted$2.invoke(r,i?i.payload:null)}}(),function(){var r=window,e=r.MC,n=r.MSCh,t=e.DatagramInfoType,u=n._pagedMessagingCommand,f=n._pagedMessageReceivedCommand=function(n,t){u.call(this,null,n,null),this._message$2=t},i=f.prototype=new u;i.constructor=f,i._message$2=null,i.onExecuted=function(){var i;switch(this._message$2.get_pageType()){case t.sdg:var u=this._message$2.get_routing(),f=this._message$2.get_content(),r=n._messageInfoHandler.parseMessage(f,u);if(r==null)return;this.get_messagingContext()._onMessageReceived(this._message$2.get_routing().get_from(),this._message$2.get_routing().get_to(),r);break;case t.imGroupPut:i=this._message$2.get_content(),this.get_messagingContext()._onAddressPending(this._message$2.get_routing().get_from(),this._message$2.get_routing().get_to(),i.get_pendingUsers(),i.get_users()),this.get_messagingContext()._onAddressJoined(this._message$2.get_routing().get_from(),this._message$2.get_routing().get_to(),i.get_users());break;case t.imGroupDel:i=this._message$2.get_content(),this.get_messagingContext()._onAddressLeft(this._message$2.get_routing().get_from(),this._message$2.get_routing().get_to(),i.get_users())}}}(),function(){var h="<thread><id>{0}<\/id><members>{1}<\/members><\/thread>",c="<member><mri>{0}<\/mri><role>{1}<\/role><\/member>",t=window,i=t.MC,e=t.MSCh,l=t.MSM,r=t.ss,u=i.GroupConversationOperationResult,o=i.SendDatagramResultCode,f=e._pagedMessagingCommand,s=e._addMembersCommand=function(n,t,i,r,u){f.call(this,n,t,null),this._id$2=i,this._invitedParties$2=r,this._onCompleted$2=u},n=s.prototype=new f;n.constructor=s,n._invitedParties$2=null,n._id$2=null,n._onCompleted$2=null,n.get_putDocument=function(){for(var t=new r.StringBuilder,i,n=0;n<this._invitedParties$2.length;n++)i=this._invitedParties$2[n],t.append(r.format(c,l.Mri.createFromIMAddressInfo(i.address).toString(),this._invitedParties$2[n].isAdmin?"admin":"user"));return r.format(h,this._id$2,t.toString())},n.onExecuted=function(){var n=new i.DatagramInfo(i.DatagramInfoType.imGroupPut,this.get_putDocument());this.sendMessage(n)},n.onSendCompleted=function(n,t){f.prototype.onSendCompleted.call(this,n,t);var i=u.success;n===o.partialFailure?i=u.partialFailure:n!==o.success&&(i=u.failure),this._onCompleted$2!=null&&this._onCompleted$2.invoke(i,t.payload)}}(),function(){var i=window,n=i.MC,r=i.MSCh,u=i.MSM,f=n.SendDatagramResultCode,o=n.ServiceType,h=n.MessageInfoType,e=r._pagedMessagingCommand,s=r._sendPagedMessageCommand=function(n,t,i,r){e.call(this,n,t,r),this._messageInfo$2=i},t=s.prototype=new e;t.constructor=s,t._messageInfo$2=null,t.onExecuted=function(){var t=this.get_routing(),i,f,e;this._messageInfo$2.targetEndpointId!=null&&(t=new u.RoutingLayer(u.Mri.create(this.get_routing().get_to().get_address(),this.get_routing().get_to().get_addressType(),this._messageInfo$2.targetEndpointId,null,null),this.get_routing().get_from()),t.set_disableSelfFanOut(!0)),this._messageInfo$2.isOfflineMessage&&(t.set_service(o.IM),t.set_channel(n.MessageChannelType.offline)),(t.get_to().get_addressType()===n.IMAddressInfoType.smtp||t.get_to().get_addressType()===n.IMAddressInfoType.telephone)&&(t.set_service(o.IM),t.set_channel(n.MessageChannelType.mobile)),i=r._messageInfoHandler.createMessagingLayer(this._messageInfo$2),i.set_appId(this.get_messagingContext().get__from().get_appId()),f=new u.PagedMessage(n.DatagramInfoType.sdg,t,this.get_reliability(),i),e=new n.DatagramInfo(n.DatagramInfoType.sdg,f.payLoad()),this.sendMessage(e)},t.onSendCompleted=function(n,t){if(n===f.recipientNotAcceptingIMs&&this._messageInfo$2.type===h.textMessage){var i=this._messageInfo$2.info.text;i.length<=400&&(this._messageInfo$2.isOfflineMessage=!0,this.get_messagingContext().sendMessage(this._messageInfo$2,this.get_userState()),n=f.success)}n!==f.success&&this.get_messagingContext()._onSendMessageFailed(n,this._messageInfo$2,this.get_userState()),e.prototype.onSendCompleted.call(this,n,t)}}(),function(){var r=window,t=r.ss,u=r.MC,i=r.MSCh,f=r.MSM,e=u.DatagramInfoType,n=u.IMAddressInfoType;i.MessagingService=function(n,t,i,r){this._identity=n,this._service=t,this._msgrService=i,this._onUnboundMessage=r,this._contexts={}},i.MessagingService.prototype={_identity:null,_service:null,_contexts:null,_onUnboundMessage:null,_msgrService:null,getMessagingContext:function(n,t,r){var u=this._getContext(t);return u==null&&(u=new i.MessagingContext(this,this._msgrService,r,n,t),this._contexts[this._getSessionKey(t)]=u),u},onDatagramReceived:function(n){var t=f.PagedMessage.createPagedMessage(n.datagramType,n.payload),o,s,h,l,p,a,r,v,c,y;t!=null&&((o=t.get_routing().get_from(),s=t.get_routing().get_to(),t.get_pageType()===e.sdg&&(h=t.get_routing(),l=t.get_content(),this._isSelfMri(h.get_to())&&this._isSelfMri(h.get_from())&&(a=i._messageInfoHandler.parseMessageType(l),a===u.MessageInfoType.logRequestMessage)))||(t.get_pageType()===e.imGroupPut&&(r=t.get_content(),r.get_notificationType()===f.NotificationType.fullNotify&&r.get_pendingUsers().length===1&&r.get_users().length===1&&(o=r.get_users()[0],s=r.get_pendingUsers()[0])),v=this._getOtherMri(o,s),c=this._getOrCreateContext(v,n),c!=null&&(y=new i._pagedMessageReceivedCommand(c,t),y.execute())))},sendDatagram:function(n,t,i){this._service.sendDatagram(n,t,i)},shutdown:function(){},updateSession:function(n,t){var i=this._getContext(n);i!=null&&(delete this._contexts[this._getSessionKey(n)],this._contexts[this._getSessionKey(t)]=i)},deleteSession:function(n){var t=this._getContext(n);t!=null&&delete this._contexts[this._getSessionKey(n)]},_getSessionKey:function(n){return t.format("{0}:{1}",n.get_addressType(),n.get_address())},_getContext:function(n){var i=this._getSessionKey(n);return t.keyExists(this._contexts,i)?this._contexts[i]:null},_getOrCreateContext:function(n,t){var i=this._getContext(n);return i==null&&this._onUnboundMessage.invoke(n,t)&&(i=this._getContext(n),i==null&&u.Logger.logAction("OnDatagramReceivedGetMessagingContextFailure")),i},_getOtherMri:function(i,r){var u=i;return i.get_addressType()===n.temporaryGroup?i:r.get_addressType()===n.temporaryGroup?r:(i.get_addressType()===n.windowsLive?u=t.compare(this._identity.liveId,i.get_address())===0?r:i:i.get_addressType()===n.skype?u=t.compare(this._identity.skypeId,i.get_address())===0?r:i:(i.get_addressType()===n.shortCircuit||i.get_addressType()===n.cid)&&(u=t.compare(this._identity.cid,i.get_address())===0?r:i),u)},_isSelfMri:function(t){var i=f.Mri.create(this._identity.liveId,n.windowsLive,null,null,t.get_networkId());return i.equals(t,f.MriCompareOptions.address)}}}(),function(n){var i=window,t=i.MSCr;t._serviceCommand=function(){},t._serviceCommand.prototype={_startTime:null,_executing:!1,_succeeded:!1,_completed:!1,onExecuted:null,onCompleted:null,get_succeeded:function(){return this._succeeded},execute:function(){this._startTime=new Date,this._executing=!0,this.onExecuted()},timeOut:function(){this._completed||(this._completed=!0,this.onCompleted())},fail:function(){this._completed||(this._completed=!0,this.onCompleted())},complete:function(){this._completed||(this._completed=!0,this._succeeded=!0,this.onCompleted(),n(this).triggerHandler("completed",[this,{}]))}}}(window.originaljQuery||jQuery),function(){var u=window,t=u.MSCr,i=t._serviceCommand,r=t._abChangeNotificationReceivedCommand=function(n,t){i.call(this),this._notificationData$1=n,this._events$1=t},n=r.prototype=new i;n.constructor=r,n._notificationData$1=null,n._events$1=null,n.onExecuted=function(){this.complete()},n.onCompleted=function(){this._events$1.onABChangeNotificationReceived(this._notificationData$1)}}(),function(){var t=window,i=t.MSCr,f=t.ss,r=i._serviceCommand,u=i._updateConversationPropertyCommand=function(n,t,i,u,f){r.call(this),this._id$1=t,this._propertyName$1=i,this._propertyValue$1=u,this._connService$1=n,this._callback$1=f},n=u.prototype=new r;n.constructor=u,n._connService$1=null,n._callback$1=null,n._id$1=null,n._propertyName$1=null,n._propertyValue$1=null,n.onExecuted=function(){this._connService$1.updateConversationProperty(this._id$1,this._propertyName$1,this._propertyValue$1,f.Delegate.create(this,this._onSendMessageCompleted$1))},n.onCompleted=function(){},n._onSendMessageCompleted$1=function(n){this._callback$1!=null&&this._callback$1.invoke(n),this.complete()}}(),function(){var t=window,i=t.MSCr,f=t.ss,r=i._serviceCommand,u=i._getGroupInfoCommand=function(n,t,i,u){r.call(this),this._ids$1=t,this._connService$1=n,this._callback$1=i,this._state$1=u},n=u.prototype=new r;n.constructor=u,n._connService$1=null,n._callback$1=null,n._ids$1=null,n._state$1=null,n.onExecuted=function(){this._connService$1.getGroupInfo(this._ids$1,f.Delegate.create(this,this._onSendMessageCompleted$1))},n.onCompleted=function(){},n._onSendMessageCompleted$1=function(n,t){this._callback$1!=null&&this._callback$1.invoke(n,t,this._state$1),this.complete()}}(),function(){var t=window,i=t.MSCr,f=t.ss,r=i._serviceCommand,u=i._getConversationInfoCommand=function(n,t,i){r.call(this),this._id$1=t,this._connService$1=n,this._callback$1=i},n=u.prototype=new r;n.constructor=u,n._connService$1=null,n._callback$1=null,n._id$1=null,n.onExecuted=function(){this._connService$1.getConversationInfo(this._id$1,f.Delegate.create(this,this._onSendMessageCompleted$1))},n.onCompleted=function(){},n._onSendMessageCompleted$1=function(n,t){this._callback$1!=null&&this._callback$1.invoke(n,t),this.complete()}}(),function(){var t=window,i=t.MSCr,f=t.ss,r=i._serviceCommand,u=i._getRecentConversationsCommand=function(n,t,i,u){r.call(this),this._syncState$1=t,this._syncStartTime=i,this._connService$1=n,this._callback$1=u},n=u.prototype=new r;n.constructor=u,n._connService$1=null,n._callback$1=null,n._syncState$1=null,n._syncStartTime=null,n.onExecuted=function(){this._connService$1.getRecentConversations(this._syncState$1,this._syncStartTime,f.Delegate.create(this,this._onSendMessageCompleted$1))},n.onCompleted=function(){},n._onSendMessageCompleted$1=function(n,t){this._callback$1!=null&&this._callback$1.invoke(n,t),this.complete()}}(),function(){var t=window,i=t.MSCr,f=t.ss,r=i._serviceCommand,u=i._createGroupConversationCommand=function(n,t,i){r.call(this),this._connService$1=n,this._members$1=t,this._onCompleted$1=i},n=u.prototype=new r;n.constructor=u,n._connService$1=null,n._onCompleted$1=null,n._members$1=null,n.onExecuted=function(){this._connService$1.createGroupConversation(this._members$1,f.Delegate.create(this,this._onCreateThreadCompleted$1))},n.onCompleted=function(){},n._onCreateThreadCompleted$1=function(n,t){this._onCompleted$1!=null&&this._onCompleted$1.invoke(n,t),this.complete()}}(),function(){var u=window,t=u.MSCr,i=t._serviceCommand,r=t._datagramReceivedCommand=function(n,t){i.call(this),this._convService$1=n,this._message$1=t},n=r.prototype=new i;n.constructor=r,n._convService$1=null,n._message$1=null,n.onExecuted=function(){this._convService$1.onDatagramReceived(this._message$1)},n.onCompleted=function(){}}(),function(){var u=window,t=u.MSCr,i=t._serviceCommand,r=t._mailNotificationReceivedCommand=function(n,t){i.call(this),this._events$1=t,this._notification$1=n},n=r.prototype=new i;n.constructor=r,n._notification$1=null,n._events$1=null,n.onExecuted=function(){this._events$1.onMailNotification(this._notification$1)},n.onCompleted=function(){}}(),function(){var u=window,t=u.MSCr,i=t._serviceCommand,r=t._networkStatusChangeReceivedCommand=function(n,t,r,u){i.call(this),this._networkId$1=n,this._status$1=t,this._events$1=r,this._snapshot$1=u},n=r.prototype=new i;n.constructor=r,n._networkId$1=null,n._status$1=null,n._events$1=null,n._snapshot$1=null,n.onExecuted=function(){this.complete()},n.onCompleted=function(){this._events$1.onNetworkStatusChanged(this._networkId$1,this._status$1);this._snapshot$1.onNetworkStatusChanged(this._networkId$1,this._status$1)}}(),function(){var t=window,i=t.MSCr,f=t.ss,r=i._serviceCommand,u=i._sendDatagramCommand=function(n,t,i,u){r.call(this),this._message$1=n,this._connService$1=t,this._callback$1=i,this._userState$1=u},n=u.prototype=new r;n.constructor=u,n._message$1=null,n._connService$1=null,n._callback$1=null,n._userState$1=null,n.onExecuted=function(){this._connService$1.sendDatagram(this._message$1,f.Delegate.create(this,this._onSendMessageCompleted$1))},n.onCompleted=function(){},n._onSendMessageCompleted$1=function(n,t){this._callback$1!=null&&this._callback$1.invoke(n,t)}}(),function(){var t=window,i=t.MSCr,f=t.ss,r=i._serviceCommand,u=i._getConversationHistoryCommand=function(n,t,i,u){r.call(this),this._id$1=t,this._syncState$1=i,this._connService$1=n,this._callback$1=u},n=u.prototype=new r;n.constructor=u,n._connService$1=null,n._callback$1=null,n._id$1=null,n._syncState$1=null,n.onExecuted=function(){this._connService$1.getConversationHistory(this._id$1,this._syncState$1,f.Delegate.create(this,this._onSendMessageCompleted$1))},n.onCompleted=function(){},n._onSendMessageCompleted$1=function(n,t){this._callback$1!=null&&this._callback$1.invoke(n,t),this.complete()}}(),function(){var t=window,f=t.MC,i=t.MSCr,r=i._serviceCommand,u=i._serviceDataChangedCommand=function(n,t,i,u,f){r.call(this),this._address$1=n,this._serviceData$1=t,this._userIdentity$1=i,this._snapshot$1=u,this._events$1=f},n=u.prototype=new r;n.constructor=u,n._address$1=null,n._serviceData$1=null,n._userIdentity$1=null,n._snapshot$1=null,n._events$1=null,n.get_address=function(){return this._address$1},n.onExecuted=function(){this.complete()},n.onCompleted=function(){var n=this._snapshot$1.serviceDataChanged(this._address$1,this._serviceData$1,!1);this._address$1.type===f.IMAddressInfoType.windowsLive&&this._address$1.address===this._userIdentity$1.liveId&&(n=this._serviceData$1.toArray());this._events$1.onServiceDataChanged(this._address$1,n)}}(),function(){var u=window,t=u.MC,f=u.MSCr,s=u.ss,i=t.ServiceType,r=t.SessionServiceOptions,e=f._serviceCommand,o=f._serviceDataDeletedCommand=function(n,t,i,r,u,f,o,s){e.call(this),this._address$1=n,this._serviceData$1=t,this._service$1=i,this._identity$1=r,this._snapshot$1=u,this._connService$1=f,this._convService$1=o,this._events$1=s},n=o.prototype=new e;n.constructor=o,n._address$1=null,n._serviceData$1=null,n._identity$1=null,n._snapshot$1=null,n._connService$1=null,n._convService$1=null,n._events$1=null,n._service$1=null,n._removedUserServices$1=i.none,n._remoteEndpointsRemoved$1=!1,n._bubbleEvent$1=!1,n.onExecuted=function(){this._detectRemoteSignOut$1(),this.complete()},n.onCompleted=function(){this._bubbleEvent$1&&this._deleteEndpoints$1()},n._detectRemoteSignOut$1=function(){if(this._address$1.type!==t.IMAddressInfoType.windowsLive||this._address$1.address!==this._identity$1.liveId){this._bubbleEvent$1=!0;return}if(this._filterEndpoints$1(),this._removedUserServices$1===i.none||this._snapshot$1.get_switchingServices()){this._remoteEndpointsRemoved$1&&this._deleteEndpoints$1(),this._removedUserServices$1!==i.none&&this._snapshot$1.set_switchingServices(!1),this._checkForOfflineStatus$1();return}switch(this._snapshot$1.get_services()){case r.full:this._remoteEndpointsRemoved$1&&this._deleteEndpoints$1(),this._service$1.updateServices(r.notifications,!1,null);break;default:this._service$1.signOut(t.SignOutLocationFlags.localEndpoint,null,!1,null)}},n._checkForOfflineStatus$1=function(){var u,n;if((this._removedUserServices$1!==i.none||this._snapshot$1.get_services()!==r.normal&&this._snapshot$1.get_services()!==r.full)&&(u=new t.ServiceDataSet(this._snapshot$1.getServiceDataInfo(this._address$1)),!(u.imServiceData.getAllEndpoints().length>1))){n=t.ServiceData.createEmpty(i.IM),n.set_status(t.PresenceInfoStatus.offline);this._events$1.onServiceDataChanged(this._address$1,[n.get_info()])}},n._filterEndpoints$1=function(){var t,n;for(this._removedUserServices$1=i.none,t=s.IEnumerator.getEnumerator(this._serviceData$1.toServiceDataArray());t.moveNext();)n=t.get_current(),n.getEndpoint(this._identity$1.endpointId)!=null&&(this._removedUserServices$1|=n.get_service(),n.deleteEndpoint(this._identity$1.endpointId)),n.getAllEndpoints().length!==0&&(this._remoteEndpointsRemoved$1=!0)},n._deleteEndpoints$1=function(){this._snapshot$1.serviceDataChanged(this._address$1,this._serviceData$1,!0);this._events$1.onServiceDataDeleted(this._address$1,this._serviceData$1.toArray())}}(),function(){var t=window,e=t.MC,i=t.MSCr,r=i._serviceCommand,u=e.ConnectionServiceResultCode,f=i._signedOutRemotelyCommand=function(n,t,i,u,f){r.call(this),this._convService$1=n,this._events$1=t,this._resultCode$1=i,this._reason$1=u,this._reconnectWaitTime$1=f},n=f.prototype=new r;n.constructor=f,n._convService$1=null,n._events$1=null,n._resultCode$1=u.success,n._reason$1=0,n._reconnectWaitTime$1=0,n.onExecuted=function(){var n=this._resultCode$1===u.signedOutRoaming;this._convService$1.close(n),this.complete()},n.onCompleted=function(){this._events$1.onSignedOutRemotely(this._reason$1,this._reconnectWaitTime$1)}}(),function(){var r=window,e=r.MSCr,c=r.MSH,u=r.MC,l=r.MSCo,f=r.ss,a=r.Microsoft.Live.Messenger.Services.SkyJSHelper,o=u.ConnectionServiceResultCode,i=u.MessengerServiceResultCode,h=e._serviceCommand,t=e._signInCommandStates=function(){},s,n;t.initial=0,t.authenticated=1,t.needsToReauth=2,t.reauthenticated=4,t.signedIn=8,s=e._signInCommand=function(n,t,i,r,u,f,e,o,s,c){this._error$1="",h.call(this),this._serviceData$1=n.clone(),this._services$1=t,this._reconnect$1=i,this._connectNetworks$1=r,this._snapshot$1=f,this._connService$1=e,this._identityService$1=o,this._callback$1=s,this._userState$1=c,this._clientId$1=l.Configuration.get_clientDomain(),this._startTime$1=new Date,this._identity$1=u},n=s.prototype=new h,n.constructor=s,n._connService$1=null,n._callback$1=null,n._identityService$1=null,n._identity$1=null,n._reconnect$1=!1,n._connectNetworks$1=null,n._userState$1=null,n._clientId$1=null,n._state$1=t.initial,n._serviceData$1=null,n._services$1=0,n._snapshot$1=null,n._startTime$1=null,n._resultCode$1=i.success,n.get__reauthenticationInProgress$1=function(){return this._stateContains$1(t.needsToReauth)&&!this._stateContains$1(t.reauthenticated)},n.onTransferred=function(n,t){this._connService$1.authenticate(this._clientId$1,n,this._services$1,t,f.Delegate.create(this,this._onAuthenticated$1))},n.onDisconnected=function(){this.get__reauthenticationInProgress$1()||(u.Logger.logAction("SignInCommandOnDisconnected"),this._error$1="SignInCommand.OnDisconnected - Transferred",this._process$1(i.transferred))},n.onExecuted=function(){this._process$1(i.success)},n.onCompleted=function(){if(this._callback$1!=null){this._resultCode$1===i.success?this._updateSnapshot$1():this._resultCode$1===i.unauthenticated&&this._snapshot$1.expire();this._callback$1.onSignedIn(this._resultCode$1,this._error$1,c.DateTimeHelper.subtract(new Date,this._startTime$1).toString(),this._connService$1.get_serverName(),this._identity$1.skypeId,this._userState$1)}},n._authenticate$1=function(){this._connService$1.authenticate(this._clientId$1,null,this._services$1,null,f.Delegate.create(this,this._onAuthenticated$1))},n._onAuthenticated$1=function(n,r){if(n!==o.success){this._error$1=r;switch(n){case o.unauthenticated:this._process$1(i.unauthenticated);break;default:this._process$1(i.failure)}}else this._state$1|=t.authenticated,this._process$1(i.success)},n._onReauthenticated$1=function(n){if(n!==u.IdentityServiceResultCode.success){this._process$1(i.unauthenticated);return}this._state$1|=t.reauthenticated,this._authenticate$1()},n._onSignedIn$1=function(n,r){this._state$1|=t.signedIn,n!==o.success?(this._error$1=r,this._process$1(i.failure)):this._process$1(i.success)},n._process$1=function(n){if(n!==i.success){this._resultCode$1=n,this.fail();return}if(this._state$1===t.initial){this._authenticate$1();return}if(this._stateContains$1(t.signedIn)){this._resultCode$1=i.success,this.complete();return}if(this._stateContains$1(t.authenticated)){var r=a.skypeAudioVideoEnabled;r&&!f.isNullOrEmpty(this._identity$1.skypeId)&&this._serviceData$1.skpServiceData.set_skypeName(this._identity$1.skypeId),this._connService$1.signIn(this._serviceData$1,this._services$1,this._connectNetworks$1,f.Delegate.create(this,this._onSignedIn$1));return}if(this._stateContains$1(t.needsToReauth)){this._identityService$1.reauthenticate(f.Delegate.create(this,this._onReauthenticated$1));return}},n._updateSnapshot$1=function(){this._snapshot$1.set_messengerSessionState(this._getMessengerSessionState$1()),this._snapshot$1.set_messengerSessionEvents(new u.MessengerSessionEvents([]))},n._getMessengerSessionState$1=function(){var n=this._connService$1.getSession(),t=new u.MessengerSessionState(n.server,n.sessionToken,n.transactionID,this._services$1,!1,this._identity$1);return t.registrationToken=n.registrationToken,t},n._stateContains$1=function(n){return(this._state$1&n)===n}}(),function(){var i=window,t=i.MC,f=i.MSCr,h=i.ss,r=t.SignOutLocationFlags,u=t.SignOutReasonCode,e=t.MessengerServiceResultCode,o=f._serviceCommand,s=f._signOutCommand=function(n,t,i,r,u,f,e,s,h){o.call(this),this._userServiceData$1=n,this._locations$1=t,this._endpointIds$1=i,this._initiatedRemotely$1=r,this._connService$1=u,this._convService$1=f,this._callback$1=s,this._userState$1=h,this._snapshot$1=e},n=s.prototype=new o;n.constructor=s,n._userServiceData$1=null,n._locations$1=r.none,n._endpointIds$1=null,n._initiatedRemotely$1=!1,n._connService$1=null,n._convService$1=null,n._callback$1=null,n._userState$1=null,n._resultCode$1=0,n._snapshot$1=null,n.get_includesLocalEndpoint=function(){return(this._locations$1&r.localEndpoint)===r.localEndpoint},n.onExecuted=function(){this.get_includesLocalEndpoint()&&this._convService$1.close(!0),this._connService$1.signOut(this._userServiceData$1,this._locations$1,this._endpointIds$1,this._initiatedRemotely$1,h.Delegate.create(this,this._onSignedOut$1))},n.onCompleted=function(){if(this.get_includesLocalEndpoint())this._snapshot$1.onSignedOut(this._initiatedRemotely$1?u.signedOutByRemoteEndpoint:u.signedOutByLocalEndpoint);if(this._initiatedRemotely$1)this._callback$1.onSignedOutRemotely(u.signedOutByRemoteEndpoint,-1);else this._callback$1.onSignedOut(this._resultCode$1,this._locations$1,this._userState$1)},n._onSignedOut$1=function(n){n===t.ConnectionServiceResultCode.success?(this._resultCode$1=e.success,this.complete()):(this._resultCode$1=e.failure,this.fail())}}(),function(){var t=window,i=t.MC,r=t.MSCr,u=r._serviceCommand,f=r._transferredCommand=function(n,t,i,r,f){u.call(this),this._hostName$1=n,this._transferState$1=t,this._snapshot$1=r,this._connServiceEvents$1=f},n=f.prototype=new u;n.constructor=f,n._hostName$1=null,n._transferState$1=null,n._snapshot$1=null,n._connServiceEvents$1=null,n.get_hostName=function(){return this._hostName$1},n.get_transferState=function(){return this._transferState$1},n.onExecuted=function(){this.complete()},n.onCompleted=function(){this._connServiceEvents$1.onDisconnected(i.ConnectionServiceResultCode.success,i.SignOutReasonCode.userTransferred,0)}}(),function(){var t=window,i=t.MC,r=t.MSCr,o=t.ss,u=i.MessengerServiceResultCode,f=r._serviceCommand,e=r._updateNetworkCommand=function(n,t,i,r,u,e){f.call(this),this._networkId$1=n,this._operation$1=t,this._imEnabledOperation$1=this._operation$1,this._events$1=r,this._snapshot$1=u,this._connectionService$1=i,this._writeToAbch$1=e},n=e.prototype=new f;n.constructor=e,n._networkId$1=null,n._operation$1=0,n._connectionService$1=null,n._chang_events$1e$1=null,n._result$1=0,n._snapshot$1=null,n._imEnabledOperation$1=0,n._writeToAbch$1=!1,n.onExecuted=function(){this._connectionService$1.updateNetworks(this._networkId$1,this._operation$1,o.Delegate.create(this,this._onUpdateNetworkCompleted$1))},n.onCompleted=function(){this._events$1.onUpdateNetworkCompleted(this._result$1,this._networkId$1,this._operation$1,this._writeToAbch$1)},n._onUpdateNetworkCompleted$1=function(n){this._result$1=n===i.ConnectionServiceResultCode.success?u.success:u.failedToConnect,this.complete()}}(),function(){var i=window,t=i.MC,r=i.MSCr,o=i.MSCo,s=i.ss,u=t.MessengerServiceResultCode,f=r._serviceCommand,e=r._updateServiceDataCommand=function(n,t,i,r,u,e){f.call(this),this._change$1=n,this._identity$1=t,this._snapshot$1=i,this._connService$1=r,this._events$1=u,this._userState$1=e},n=e.prototype=new f;n.constructor=e,n._change$1=null,n._identity$1=null,n._snapshot$1=null,n._connService$1=null,n._events$1=null,n._userState$1=null,n._didCallback$1=!1,n._resultCode$1=0,n.onExecuted=function(){var i=new t.IMAddressInfo(this._identity$1.liveId,t.IMAddressInfoType.windowsLive,t.RoleLists.none),r=new t.ServiceDataSet(this._snapshot$1.getServiceDataInfo(i)),n=t.ServiceDataSet.createMessengerUpdate(r,this._change$1);this._getCorrectDomainForUpdate$1(n),this._snapshot$1.serviceDataChanged(i,n,!1),this._connService$1.publishServiceData(n,this._snapshot$1.get_services(),s.Delegate.create(this,this._onPublishServiceDataCompleted$1))},n.onCompleted=function(){this._events$1.onUserServiceDataUpdated(this._resultCode$1,this._userState$1)},n._getCorrectDomainForUpdate$1=function(n){if(n.imServiceData!=null){var t=n.imServiceData.getEndpoint(this._identity$1.endpointId);t.set_domain(o.Configuration.get_domainName())}},n._onPublishServiceDataCompleted$1=function(n){this._didCallback$1||(this._didCallback$1=!0,n!==t.ConnectionServiceResultCode.success?(this._resultCode$1=u.failure,this.fail()):(this._resultCode$1=u.success,this.complete()))}}(),function(){var e=window,i=e.MC,s=e.MSCr,u=e.ss,f=i.ConnectionServiceResultCode,r=i.SessionServiceOptions,o=i.MessengerServiceResultCode,h=s._serviceCommand,n={none:0,updateSubscriptions:1,addServices:2,removeServices:4,surfaceData:8,deleteContactData:16,clearConversations:32,unsubscribeFromBuddies:64,unsubscribeFromConnectNetworks:128,subscribeToBuddies:256,subscribeToConnectNetworks:512},c=s._updateServicesCommand=function(n,t,r,u,f,e,o,s,c){h.call(this),this._address$1=new i.IMAddressInfo(t.liveId,i.IMAddressInfoType.windowsLive,i.RoleLists.none),this._connService$1=u,this._convService$1=f,this._connServiceEvents$1=e,this._connectNetworks$1=o,this._events$1=s,this._identity$1=t,this._services$1=n,this._snapshot$1=r,this._userInitiated$1=c},t=c.prototype=new h;t.constructor=c,t._services$1=r.normal,t._connService$1=null,t._convService$1=null,t._connServiceEvents$1=null,t._events$1=null,t._snapshot$1=null,t._address$1=null,t._resultCode$1=o.success,t._tasks$1=0,t._identity$1=null,t._connectNetworks$1=null,t._userInitiated$1=!1,t.get_services=function(){return this._services$1},t.onExecuted=function(){this._tasks$1=this._mapServicesToTasks$1(this._snapshot$1.get_services(),this._services$1),this._snapshot$1.set_switchingServices((this._tasks$1&n.removeServices)===n.removeServices),this._process$1()},t.onCompleted=function(){if(this._snapshot$1.set_services(this._services$1),this._userInitiated$1)this._events$1.onUserServicesUpdated(this._resultCode$1);else this._events$1.onServicesChanged(this._services$1)},t._process$1=function(){var t,f,r,e;if(this._resultCode$1===o.failure){this.fail();return}if((this._tasks$1&n.addServices)===n.addServices)this._addServices$1();else if((this._tasks$1&n.subscribeToBuddies)===n.subscribeToBuddies)this._connService$1.updateBuddySubscriptions(i.SubscriptionType.presenceAndNotificationSubscribe,u.Delegate.create(this,this._onBuddiesSubscribed$1));else if((this._tasks$1&n.subscribeToConnectNetworks)===n.subscribeToConnectNetworks){if(this._connectNetworks$1!=null)for(t=u.IEnumerator.getEnumerator(this._connectNetworks$1);t.moveNext();)f=t.get_current(),this._connService$1.updateNetworks(f.toLowerCase(),i.NetworkOperationType.enableIM,u.Delegate.create(this,this._onConnectNetworkSubscribed$1))}else if((this._tasks$1&n.unsubscribeFromBuddies)===n.unsubscribeFromBuddies)this._connService$1.updateBuddySubscriptions(i.SubscriptionType.presenceUnsubscribe,u.Delegate.create(this,this._onBuddiesUnsubscribed$1));else if((this._tasks$1&n.unsubscribeFromConnectNetworks)===n.unsubscribeFromConnectNetworks){if(this._connectNetworks$1!=null)for(r=u.IEnumerator.getEnumerator(this._connectNetworks$1);r.moveNext();)e=r.get_current(),this._connService$1.updateNetworks(e.toLowerCase(),i.NetworkOperationType.disableIM,u.Delegate.create(this,this._onConnectNetworkSubscribed$1))}else(this._tasks$1&n.clearConversations)===n.clearConversations?this._clearConversations$1():(this._tasks$1&n.deleteContactData)===n.deleteContactData?this._deleteContactData$1():(this._tasks$1&n.removeServices)===n.removeServices?this._removeServices$1():(this._tasks$1&n.surfaceData)===n.surfaceData?this._surfaceData$1():this.complete()},t._addServices$1=function(){var t=this._snapshot$1.getServiceDataInfo(this._address$1),n;t!=null&&t.length>0?(n=new i.ServiceDataSet(t),n.imServiceData.get_status()===i.PresenceInfoStatus.offline&&n.imServiceData.set_status(i.PresenceInfoStatus.online),this._connService$1.publishServiceData(n,this._services$1,u.Delegate.create(this,this._onServiceDataPublished$1))):this._onServiceDataPublished$1(f.success)},t._removeServices$1=function(){var t=this._identity$1.endpointId,n=i.ServiceDataSet.create();n.addEndpoint(i.ServiceEndpointData.createEmpty(i.ServiceType.IM,t)),n.addEndpoint(i.ServiceEndpointData.createEmpty(i.ServiceType.PD,t)),n.addEndpoint(i.ServiceEndpointData.createEmpty(i.ServiceType.PE,t)),this._connService$1.deleteServiceData(n,u.Delegate.create(this,this._onServiceDataDeleted$1))},t._surfaceData$1=function(){var t=this._snapshot$1.getServiceDataInfo(this._address$1);if(t!=null&&t.length>0)this._events$1.onServiceDataChanged(this._address$1,t);this._onTaskCompleted$1(f.success,n.surfaceData)},t._deleteContactData$1=function(){for(var h=this._snapshot$1.getLocalNetworkServiceData(),s=u.IEnumerator.getEnumerator(h),e,t,o,r;s.moveNext();){e=s.get_current();this._connServiceEvents$1.onServiceDataDeleted(e[0],e[1])}for(t=this._snapshot$1.getServiceDataInfo(this._address$1),o=!1,r=0;r<t.length;r++)u.keyExists(t[r].endpointData,this._identity$1.endpointId)&&delete t[r].endpointData[this._identity$1.endpointId],u.getKeyCount(t[r].endpointData)>0&&(o=!0);if(o)this._connServiceEvents$1.onServiceDataDeleted(this._address$1,new i.ServiceDataSet(t));this._onTaskCompleted$1(f.success,n.deleteContactData)},t._clearConversations$1=function(){this._convService$1.close(!0),this._onTaskCompleted$1(f.success,n.clearConversations)},t._mapServicesToTasks$1=function(t,i){if(t===r.full&&(t=r.normal),i===r.full&&(i=r.normal),t===r.contactPresence){if(i===r.normal)return n.subscribeToConnectNetworks|n.addServices|n.surfaceData;if(i===r.notifications)return n.unsubscribeFromBuddies|n.deleteContactData}else if(t===r.normal){if(i===r.contactPresence)return n.unsubscribeFromBuddies|n.removeServices|n.clearConversations;if(i===r.notifications)return n.unsubscribeFromBuddies|n.unsubscribeFromConnectNetworks|n.removeServices|n.deleteContactData|n.clearConversations}else if(t===r.notifications){if(i===r.contactPresence)return n.subscribeToBuddies;if(i===r.normal)return n.subscribeToBuddies|n.subscribeToConnectNetworks|n.addServices|n.surfaceData}return n.none},t._onServiceDataPublished$1=function(t){this._onTaskCompleted$1(t,n.addServices)},t._onServiceDataDeleted$1=function(t){this._onTaskCompleted$1(t,n.removeServices)},t._onConnectNetworkSubscribed$1=function(t){this._onTaskCompleted$1(t,n.subscribeToConnectNetworks)},t._onBuddiesSubscribed$1=function(t){this._onTaskCompleted$1(t,n.subscribeToBuddies)},t._onBuddiesUnsubscribed$1=function(t){this._onTaskCompleted$1(t,n.unsubscribeFromBuddies)},t._onTaskCompleted$1=function(n,t){n!==f.success&&(this._resultCode$1=o.failure),this._tasks$1&=~t,this._process$1()}}(),function(){var t=window,i=t.MSCr,f=t.ss,r=i._serviceCommand,u=i._reportAbuseCommand=function(n,t,i){r.call(this),this._connService$1=n,this._onCompleted$1=t,this._alias$1=i},n=u.prototype=new r;n.constructor=u,n._connService$1=null,n._onCompleted$1=null,n._alias$1=null,n.onExecuted=function(){this._connService$1.reportAbuse(this._alias$1,f.Delegate.create(this,this._onReportAbuseCompleted$1))},n.onCompleted=function(){},n._onReportAbuseCompleted$1=function(n){this._onCompleted$1!=null&&this._onCompleted$1.invoke(n),this.complete()}}(),function(){var t=window,n=t.MSCr;n._userServiceState=function(n){this._service=n},n._userServiceState.prototype={_service:null,get_service:function(){return this._service},updateNetwork:function(){},reportAbuse:function(){},createGroupConversation:function(){},getRecentConversations:function(){},getConversationHistory:function(){},getConversationInfo:function(){},updateConversationProperty:function(){},getGroupInfo:function(){},onNetworkStatusChanged:function(){},sendPage:function(){},signIn:function(){},signOut:function(){},updateServices:function(){},updateServiceData:function(){},onABChangeNotificationReceived:function(){},onTicketUpdated:function(){},onServiceDataChanged:function(){},onServiceDataDeleted:function(){},onSignedOutRemotely:function(){},onPageReceived:function(){},onTransferred:function(){},onMailNotificationReceived:function(){}}}(),function(){var u=window,n=u.MSCr,t=n._userServiceState,i=n._initialState=function(n){t.call(this,n)},r=i.prototype=new t;r.constructor=i,r.signIn=function(t){this.get_service()._updateState(new n._signingInState(this.get_service(),t)),this.get_service()._execute(t)}}(),function(n){var u=window,i=u.MSCr,r=u.ss,f=i._userServiceState,e=i._signedInState=function(n){this._pendingAuthenticationCommands$1=[],this._pendingUpdateServicesCommands$1=[],f.call(this,n)},t=e.prototype=new f;t.constructor=e,t._currentUpdateServicesCommand$1=null,t.updateNetwork=function(n){this.get_service()._execute(n)},t.onNetworkStatusChanged=function(n){this.get_service()._execute(n)},t.onTransferred=function(n){this.get_service()._execute(n)},t.signOut=function(n){n.get_includesLocalEndpoint()&&(this._clearCommandQueues$1(),this.get_service()._updateState(new i._signingOutState(this.get_service(),n))),this.get_service()._execute(n)},t.onTicketUpdated=function(){while(this._pendingAuthenticationCommands$1.length>0)this._pendingAuthenticationCommands$1[0].retry(),this._pendingAuthenticationCommands$1.splice(0,1)},t.updateServices=function(n){this._pendingUpdateServicesCommands$1.push(n),this._processPendingUpdateServicesCommands$1()},t.updateServiceData=function(n){this._pendingUpdateServicesCommands$1.push(n),this._processPendingUpdateServicesCommands$1()},t.onABChangeNotificationReceived=function(n){this.get_service()._execute(n)},t.onPageReceived=function(n){this.get_service()._execute(n)},t.onMailNotificationReceived=function(n){this.get_service()._execute(n)},t.onServiceDataChanged=function(n){this.get_service()._execute(n)},t.onServiceDataDeleted=function(n){this.get_service()._execute(n)},t.onSignedOutRemotely=function(n){this._clearCommandQueues$1(),this.get_service()._updateState(new i._signedOutState(this.get_service())),this.get_service()._execute(n)},t.sendPage=function(n){this.get_service()._execute(n)},t.getRecentConversations=function(n){this.get_service()._execute(n)},t.getConversationHistory=function(n){this.get_service()._execute(n)},t.getConversationInfo=function(n){this.get_service()._execute(n)},t.updateConversationProperty=function(n){this.get_service()._execute(n)},t.getGroupInfo=function(n){this.get_service()._execute(n)},t.createGroupConversation=function(n){this.get_service()._execute(n)},t.reportAbuse=function(n){this.get_service()._execute(n)},t._onUpdateServicesCompleted$1=function(){n(this._currentUpdateServicesCommand$1).unbind("completed",r.Delegate.create(this,this._onUpdateServicesCompleted$1)),this._currentUpdateServicesCommand$1=null,this._processPendingUpdateServicesCommands$1()},t._processPendingUpdateServicesCommands$1=function(){while(this._currentUpdateServicesCommand$1==null&&this._pendingUpdateServicesCommands$1.length!==0){var t=this._pendingUpdateServicesCommands$1.shift();this._currentUpdateServicesCommand$1=t instanceof i._updateServicesCommand?t:null,this._currentUpdateServicesCommand$1!=null&&n(this._currentUpdateServicesCommand$1).bind("completed",r.Delegate.create(this,this._onUpdateServicesCompleted$1)),this.get_service()._execute(t)}},t._clearCommandQueues$1=function(){this._currentUpdateServicesCommand$1!=null&&(n(this._currentUpdateServicesCommand$1).unbind("completed",r.Delegate.create(this,this._onUpdateServicesCompleted$1)),this._currentUpdateServicesCommand$1=null),this._pendingUpdateServicesCommands$1.length=0}}(window.originaljQuery||jQuery),function(){var u=window,n=u.MSCr,t=n._userServiceState,i=n._signedOutState=function(n){t.call(this,n)},r=i.prototype=new t;r.constructor=i,r.signIn=function(t){this.get_service()._updateState(new n._signingInState(this.get_service(),t)),this.get_service()._execute(t)}}(),function(n){var u=window,i=u.MSCr,r=u.ss,f=i._userServiceState,e=i._signingInState=function(t,i){this._pendingServiceCommands$1=[],f.call(this,t),this._pendingSignInCommand$1=i,n(this._pendingSignInCommand$1).bind("completed",r.Delegate.create(this,this._onSignInCompleted$1))},t=e.prototype=new f;t.constructor=e,t._pendingSignInCommand$1=null,t.signOut=function(n){n.get_includesLocalEndpoint()&&this.get_service()._updateState(new i._signingOutState(this.get_service(),n)),this.get_service()._execute(n)},t.updateServices=function(n){this._pendingServiceCommands$1.push(n)},t.updateNetwork=function(n){this.get_service()._execute(n)},t.onTransferred=function(n){this._pendingSignInCommand$1.onTransferred(n.get_hostName(),n.get_transferState())},t.onSignedOutRemotely=function(){this.get_service()._updateState(new i._signedOutState(this.get_service())),this._pendingSignInCommand$1.onDisconnected()},t._onSignInCompleted$1=function(){var t,u,f;if(n(this._pendingSignInCommand$1).unbind("completed",r.Delegate.create(this,this._onSignInCompleted$1)),this._pendingSignInCommand$1.get_succeeded())for(t=new i._signedInState(this.get_service()),this.get_service()._updateState(t),u=r.IEnumerator.getEnumerator(this._pendingServiceCommands$1);u.moveNext();)f=u.get_current(),t.updateServices(f);else this.get_service()._updateState(new i._signedOutState(this.get_service()))}}(window.originaljQuery||jQuery),function(n){var r=window,t=r.MSCr,e=r.ss,u=t._userServiceState,f=t._signingOutState=function(t,i){u.call(this,t),n(i).bind("completed",e.Delegate.create(this,this._onSignedOut$1))},i=f.prototype=new u;i.constructor=f,i._onSignedOut$1=function(){this.get_service()._updateState(new t._signedOutState(this.get_service()))},i.sendPage=function(n){this.get_service()._execute(n)}}(window.originaljQuery||jQuery),function(){var r=window,i=r.MC,t=r.MSCr,u=r.MSCo,o=r.MSM,s=r.ss,f=i.IConnectionServiceEvents,e=t.UserService=function(n,i,r,u){f.call(this),this._identity=n,this._currentState=new t._initialState(this),this._connService=i.createConnectionService(n,this),this._idService=u,this._snapshot=new t.MessengerStatusSnapshot(n.liveId),this._convService=i.createConversationService(n,this,r),this._events=r},n=e.prototype=new f;n.constructor=e,n._identity=null,n._connService=null,n._idService=null,n._events=null,n._convService=null,n._currentState=null,n._snapshot=null,n._populateFinishedCallback=null,n._getHistoryPending=!0,n.updateNetwork=function(n,i,r){this._currentState.updateNetwork(new t._updateNetworkCommand(n,i,this._connService,this._events,this._snapshot,r))},n.conversationCreate=function(n,t){this._convService.conversationCreate(n,t,!0)},n.conversationCreateGroup=function(n){this._convService.conversationCreateGroup(n)},n.conversationSendMessage=function(n,t,i){this._convService.conversationSendMessage(n,t,i)},n.conversationGetRecentList=function(){this._convService.conversationGetRecentList()},n.conversationGetHistory=function(n){this._convService.conversationGetHistory(n)},n.conversationAddMembers=function(n,t,i){this._convService.conversationAddMembers(n,t,i)},n.conversationRemoveMembers=function(n,t,i){this._convService.conversationRemoveMembers(n,t,i)},n.conversationExpose=function(n,t,i){this._events.onConversationCreated(n,t,i)},n.conversationUpdateId=function(n,t){this._events.onConversationUpdatedId(n,t)},n.conversationUpdateConsumptionHorizon=function(n,t){this._convService.conversationUpdateConsumptionHorizon(n,t)},n.conversationClose=function(n){this._convService.conversationClose(n,!0)},n.conversationDelete=function(n,t,i){this._convService.conversationDelete(n,t,i)},n.signIn=function(n,i,r,u,f){this.updateTicket(n);var o=this._createSignInServiceData(i);this._currentState.signIn(new t._signInCommand(o,r,!1,u,this.get__identity(),this._snapshot,this._connService,this._idService,this._events,f))},n.reconnect=function(n,i,r,u){var f=this._createSignInServiceData(n);this._currentState.signIn(new t._signInCommand(f,i,!0,r,this.get__identity(),this._snapshot,this._connService,this._idService,this._events,u))},n.signOut=function(n,r,u,f){var e=null,o;u&&(e=new i.ServiceDataSet(this._snapshot.getServiceDataInfo(new i.IMAddressInfo(this._identity.liveId,i.IMAddressInfoType.windowsLive,i.RoleLists.none)))),o=new t._signOutCommand(e,n,r,!u,this._connService,this._convService,this._snapshot,this._events,f),this._currentState.signOut(o)},n.reportAbuse=function(n,i){var r=o.Mri.createFromIMAddressInfo(n);this._currentState.reportAbuse(new t._reportAbuseCommand(this._connService,i,r.toString()))},n.createConversationGroup=function(n,i){this._currentState.createGroupConversation(new t._createGroupConversationCommand(this._connService,n,i))},n.getRecentConversations=function(n,i,r){this._currentState.getRecentConversations(new t._getRecentConversationsCommand(this._connService,n,i,r))},n.getConversationHistory=function(n,i,r){this._currentState.getConversationHistory(new t._getConversationHistoryCommand(this._connService,n,i,r))},n.getConversationInfo=function(n,i){this._currentState.getConversationInfo(new t._getConversationInfoCommand(this._connService,n,i))},n.updateConversationProperty=function(n,i,r,u){this._currentState.updateConversationProperty(new t._updateConversationPropertyCommand(this._connService,n,i,r,u))},n.getGroupInfo=function(n,i,r){this._currentState.getGroupInfo(new t._getGroupInfoCommand(this._connService,n,i,r))},n.updateServices=function(n,i,r){this._currentState.updateServices(new t._updateServicesCommand(n,this._identity,this._snapshot,this._connService,this._convService,this,r,this._events,i))},n.updateServiceData=function(n,i){this._currentState.updateServiceData(new t._updateServiceDataCommand(n,this._identity,this._snapshot,this._connService,this._events,i))},n.sendDatagram=function(n,i,r){this._currentState.sendPage(new t._sendDatagramCommand(n,this._connService,i,r))},n._execute=function(n){n.execute()},n._updateState=function(n){this._currentState=n,this._getHistoryPending&&this._currentState instanceof t._signedInState&&(this._convService.conversationGetRecentList(),this._getHistoryPending=!1)},n._createSignInServiceData=function(n){var e=this._identity.endpointId,t=new i.ServiceDataSet(n),r=t.imServiceData.getEndpoint(e),o,f;return r.set_domain(u.Configuration.get_domainName()),this._identity.authenticationInfo.authType!==i.AuthenticationType.rpsAuth&&(o=r.get_capabilities(),r.set_capabilities(o)),f=t.peServiceData.getEndpoint(e),f.set_clientName(u.Configuration.get_clientId()),f.set_clientVersion(u.Configuration.get_clientVersion()),t},n.get__authenticationType=function(){return this._identity.authenticationInfo.authType},n.get__identity=function(){return this._identity},n.get__identityService=function(){return this._idService},n._notifyWebSignInPendingEvents=function(n){for(var r=s.IEnumerator.getEnumerator(n),i,t;r.moveNext();){i=r.get_current(),t=i[1];switch(i[0]){case"OnMailNotification":this._events.onMailNotification(t[0]);break;case"OnServiceDataChanged":this._events.onServiceDataChanged(t[0],t[1]);break;case"OnServiceDataDeleted":this._events.onServiceDataDeleted(t[0],t[1])}}},n.updateTicket=function(n){this._identity.liveId=n.liveId,this._identity.skypeId=n.skypeId,this._identity.authenticationInfo=n.authenticationInfo,this._identity.cid=n.cid,this._identity.endpointId=n.endpointId,i.Logger.logDetails("UserServiceUpdateTicket",{authType:this._identity.authenticationInfo==null?"Null":i.enumToString(i.AuthenticationType,this._identity.authenticationInfo.authType)}),this.onTicketUpdated()},n.onTicketUpdated=function(){this._currentState.onTicketUpdated()},n.onSignInPopulateCompleted=function(){this._populateFinishedCallback!=null&&(this._populateFinishedCallback.invoke(null,{}),this._populateFinishedCallback=null)},n.onNetworkStatusChanged=function(n,i){this._currentState.onNetworkStatusChanged(new t._networkStatusChangeReceivedCommand(n,i,this._events,this._snapshot))},n.onServiceDataChanged=function(n,i){this._currentState.onServiceDataChanged(new t._serviceDataChangedCommand(n,i,this._identity,this._snapshot,this._events))},n.onServiceDataDeleted=function(n,i){this._currentState.onServiceDataDeleted(new t._serviceDataDeletedCommand(n,i,this,this._identity,this._snapshot,this._connService,this._convService,this._events))},n.onMailNotificationReceived=function(n){this._currentState.onMailNotificationReceived(new t._mailNotificationReceivedCommand(n,this._events));this._snapshot.mailNotificationReceived(n)},n.onABChangeNotificationReceived=function(n){this._currentState.onABChangeNotificationReceived(new t._abChangeNotificationReceivedCommand(n,this._events))},n.onDatagramReceived=function(n){this._currentState.onPageReceived(new t._datagramReceivedCommand(this._convService,n))},n.onDisconnected=function(n,i,r){this._currentState.onSignedOutRemotely(new t._signedOutRemotelyCommand(this._convService,this._events,n,i,r));this._snapshot.onSignedOut(i)},n.onTransferred=function(n,i,r){this._currentState.onTransferred(new t._transferredCommand(n,i,r,this._snapshot,this))},n.onSignInEventsEmpty=function(){},n.onTridChanged=function(n){this._snapshot.updateTrid(n)},n.onRegistrationTokenChanged=function(n){this._snapshot.updateRegistrationToken(n)}}(),function(){var n=window,t=n.Microsoft.Live.Messenger;t._localization={defaultFontFamily:"Segoe UI",facebookMobile:"On Facebook Mobile",fullName:"{0} {1}",statusAppearOffline:"Appear offline",statusAway:"Away",statusBusy:"Busy",statusOffline:"Offline",statusOnline:"Available",networkWindowsLive:"Messenger",networkOfficeCommunicator:"Microsoft Lync™",networkTelephone:"SMS",networkSkype:"Skype"}}(),function(){var n=window.Microsoft.Live.Messenger,tt=n.AuthenticationResultCode=function(){},t,k,d,a,i,v,y,e,h,r,g,o,p,c,f,w,l,nt,b,s,u;tt.success=0,tt.failure=1,t=n.AuthenticationStatus=function(){},t.none=0,t.alreadySignedIn=1,t.unsupportedBrowser=2,t.multipleEndpointsNotSupported=4,t.blockedApplication=8,t.blockedUser=16,t.authenticationFailure=32,t.serviceUnavailable=64,t.insecureTransportNotSupported=128,k=n.DisplayNameMode=function(){},k.displayName=0,k.fullName=1,d=n.EmoticonSize=function(){},d.small=0,d.medium=1,a=n.GroupConversationOperationType=function(){},a.addMembers=0,a.removeMembers=1,a.leaveGroup=2,i=n.IMAddressType=function(){},i.none=0,i.windowsLive=1,i.officeCommunicator=2,i.telephone=4,i.skype=8,i.connect=13,i.smtp=16,i.temporaryGroup=19,i.shortCircuit=20,v=n.InviteMessageType=function(){},v.historyInvite=0,v.newInvite=1,v.inviteSeen=2,y=n.MessageType=function(){},y.textMessage=1,y.callEventMessage=6,y.threadActivityMessage=7,e=n.NetworkStatus=function(){},e.signedOut=0,e.signingIn=1,e.signedIn=2,e.signingOut=3,e.autoReconnectWaiting=4,h=n.NotifyCollectionChangedAction=function(){},h.add=0,h.remove=1,h.replaced=2,h.reset=3,r=n.PresenceStatus=function(){},r.offline=0,r.online=1,r.appearOffline=2,r.busy=3,r.idle=4,r.beRightBack=5,r.away=6,r.inACall=7,r.outToLunch=8,g=n.PrivacyMode=function(){},g.allowByDefault=0,g.blockByDefault=1,o=n.SendMessageResultCode=function(){},o.success=0,o.failure=1,o.messageTooLong=2,o.recipientInvalid=3,o.recipientDisabled=4,p=n.SignInPreference=function(){},p.none=0,p.autoSignIn=1,p.manualSignIn=2,c=n.SessionServices=function(){},c.normal=0,c.notifications=1,c.contactPresence=2,c.full=3,f=n.SignedOutReason=function(){},f.signedOutByLocalEndpoint=0,f.signedOutByRemoteEndpoint=1,f.connectionLost=2,f.serverError=3,f.endpointLimitExceeded=4,f.signedOutByServer=5,w=n.SignInResultCode=function(){},w.success=0,w.failure=1,w.authenticationFailure=2,l=n.SignOutLocations=function(){},l.local=1,l.remote=2,l.all=3,l.sameDomain=4,nt=n.SignOutResultCode=function(){},nt.success=0,nt.failure=1,b=n.UploadLogsPreference=function(){},b.none=0,b.accept=1,b.decline=2,s=n.UserStatus=function(){},s.signedOut=0,s.signingIn=1,s.signedIn=2,s.signingOut=3,s.autoReconnectWaiting=4,u=n._userState=function(){},u.initialized=0,u.signingIn=1,u.signedIn=2,u.signingOut=3,u.signedOut=4,u.autoReconnectWaiting=5,u.disposed=6}(),function(){var n=window,t=n.Microsoft.Live.Messenger;t._exceptions={argumentEmpty:"Value cannot be empty.",argumentInvalid:"Value is invalid: {1}\\r\\n{0}",argumentNull:"Value cannot be null: {0}.",argumentOutOfRange:"Specified argument was out of range.",argumentPositive:"Argument must be positive.",cantConvSelf:"Cannot create a conversation with self.",collectionItemDuplicate:"Collection already contains object.",collectionItemNotFound:"Collection does not contain object.",collectionReadOnly:"Collection is read-only.",contactAddressOperationUnsupported:"Cannot perform an IMAddress operation on a Contact that is not on WindowsLive network.",contactMustMemberUserContact:"The contact must be a member of User.Contacts to perform this operation.",endpointNameInvalid:"Endpoint name is invalid. Use Endpoint.IsNameValid() to validate user input.",endpointNotLocal:"Cannot update a contact's endpoint. Use User.LocalEndpoint to get the user's endpoint.",invalidOperation:"Operation is not valid due to the current state of the object. {0}",networkIMEnabledTogglingNotAllowed:"Cannot update Network.IMEnabled for networks that do not support instant messaging. Use Network.SupportsRemoteSignIn to determine whether it is possible.",objectDisposed:"Cannot access a disposed object named '{0}'.",objectNotBelongToUser:"Object does not belong to user.",objRetOnCreateMailboxInvalid:"Object returned by User.OnCreateMailbox is invalid.",onCreateConvRetInvalidConv:"Object returned by User.OnCreateConversation is invalid.",personalMessageInvalid:"Personal message is invalid. Use IMAddressPresence.IsPersonalMessageValid() to validate user input.",presenceReadOnly:"Cannot update a contact's presence.",sameTypeAddressExists:"An address of the same type already exists in the contact.",textMessageInvalid:"Text message is invalid. Use Conversation.IsTextMessageValid() to validate a message.",userAlreadySignedIn:"User is already signed in.",identityNotAuthenticated:"An Identity object must be authenticated prior to creating a User instance.",userMustBeSignedInForOperation:"User must be signed in in order to perform this operation.",userIdentityEnforceOneToOneBinding:"An Identity object cannot be associated with more than one User instance.",invalidOperationForCurrentAuthMode:"Invalid operation for the current authentication mode.",unsupportedContactOperation:"Cannot add or remove contact from the collection. To add email-only contacts, use User.AddContact().",conversationEmailOnly:"Cannot create a conversation with an email-only contact.",userInvalidServices:"Cannot perform operation in the current User.Services state.",unsupportedGroupOperation:"Cannot update group's AppearOfflineTo/AppearOnlineTo properties when User.Services is in Notifications or ContactPresence mode.",methodNotSupported:"This object does not support this method.",targetEndpointRosterCountInvalid:"A message can be sent to a single endpoint only when a conversation has 2 members."}}(),function(){var r=window,i=r.ss,n=r.Microsoft.Live.Messenger,t=n._exceptionHelper=function(){};t.createArgumentNullException=function(t){return new Error(i.format(n._exceptions.argumentNull,t))},t.createArgumentNullOrEmptyException=function(t,i){return i==null?n._exceptionHelper.createArgumentNullException(t):n._exceptionHelper.createArgumentException(n._exceptions.argumentEmpty,t)},t.createArgumentException=function(t,r){return new Error(i.format(n._exceptions.argumentInvalid,t,r))},t.createInvalidOperationException=function(t){return new Error(i.format(n._exceptions.invalidOperation,t))},t.createObjectDisposedException=function(t){return new Error(i.format(n._exceptions.objectDisposed,t))},t.createArgumentOutOfRangeException=function(){return new Error(n._exceptions.argumentOutOfRange)}}(),function(){var t=window,i=t.ss,r=t.$Config,u=t.MC,f=t.Microsoft.Live.Messenger,e=t.MSCo,n=f._globalConfiguration=function(){};n._disablePopulateBatching=-1,n._configuration=null,n.get__instance=function(){return n._configuration},n.get__tryGetInstance=function(){return n._configuration},n._initialize=function(){n._configuration=new n},n.get__domainName=function(){return t.location.hostname.toLowerCase()},n._getDisplayPictureUrl=function(t){var u=n.get__instance(),r;return u!=null&&(r=e.Configuration.get_displayPictureUrlFormat(),!i.isNullOrEmpty(r))?i.replaceAll(r,"{0}",t):null},n._getNetworkIconUrl=function(n){var t,u=$pwc.getService(n);return u!=null&&(t=u.getIconUrlThumbnail()),i.isNullOrEmpty(t)&&(t=r.WebIM.imgBase+"webim/networkicons/"+n.toLowerCase()+"_1.png"),t},n._getNetworkIconErrorUrl=function(n){return r.WebIM.imgBase+"webim/networkicons/"+n.toLowerCase()+"error.png"},n.get__maxEndpointNameLength=function(){return 50},n.get__maxApplicationNameLength=function(){return 129},n.get__defaultServices=function(){return u.SessionServiceOptions.normal},n.get__userPopulationBatchSize=function(){return 100}}(),function(){var t=window,n=t.Microsoft.Live.Messenger;n.ContactsReaderChangedEventArgs=function(n,t,i){this.added=n,this.changed=t,this.removed=i},n.ContactsReaderChangedEventArgs.prototype={added:null,changed:null,removed:null}}(),function(){var f=window,i=f.ss,r=f.Microsoft.Live.Messenger,n=r.NotifyCollectionChangedAction,t=i.NotifyCollectionChangedAction,u=r.NotifyCollectionChangedEventArgs=function(t,i,r,u){this._newStartingIndex$1=-1,this._oldStartingIndex$1=-1,this._action$1=t,this._action$1!==n.reset&&(this._newItems$1=[],this._oldItems$1=[]),this._action$1===n.add?(this._newItems$1.push(i),this._newStartingIndex$1=u):this._action$1===n.remove?(this._oldItems$1.push(r),this._oldStartingIndex$1=u):this._action$1===n.replaced&&(this._newItems$1.push(i),this._oldItems$1.push(r),this._newStartingIndex$1=u,this._oldStartingIndex$1=u)};u._create=function(n,t,i,r){var e=new u(n,t,i,r);return t!=null&&t.length>1&&(e._newItems$1.length=0,e._newItems$1.addRange(t)),i!=null&&i.length>1&&(e._oldItems$1.length=0,e._oldItems$1.addRange(i)),e},u.prototype={_action$1:r.NotifyCollectionChangedAction.add,_newItems$1:null,_oldItems$1:null,_changes$1:null,get_action:function(){return this._action$1},get_newItems:function(){return this._newItems$1},get_newStartingIndex:function(){return this._newStartingIndex$1},get_oldItems:function(){return this._oldItems$1},get_oldStartingIndex:function(){return this._oldStartingIndex$1},get_changes:function(){return this._changes$1==null&&this._initializesChanges$1(),this._changes$1},_initializesChanges$1:function(){switch(this._action$1){case n.add:case n.remove:case n.reset:this._changes$1=[new i.CollectionChange(this._getChangesAction$1(),this._newItems$1,this._newStartingIndex$1,this._oldItems$1,this._oldStartingIndex$1)];break;case n.replaced:this._changes$1=[new i.CollectionChange(t.remove,null,-1,this._oldItems$1,this._oldStartingIndex$1),new i.CollectionChange(t.add,this._newItems$1,this._newStartingIndex$1,null,-1)]}},_getChangesAction$1:function(){switch(this._action$1){case n.add:return t.add;case n.remove:return t.remove;case n.reset:return t.reset}return t.add}}}(),function(){var t=window,n=t.Microsoft.Live.Messenger;n.PropertyChangedEventArgs=function(n){this._propertyName$1=n},n.PropertyChangedEventArgs.prototype={_propertyName$1:null,get_propertyNamePascal:function(){return this._propertyName$1},get_propertyName:function(){return this._propertyName$1}}}(),function(){var i=window,r=i.ss,n=i.Microsoft.Live.Messenger,t=n.Guid=function(t){if(r.isNullOrEmpty(t))throw n._exceptionHelper.createArgumentNullOrEmptyException("g",t);t.charAt(0)!=="{"&&(t="{"+t+"}");var i="^\\{[a-f\\d]{8}\\-([a-f\\d]{4}\\-){3}[a-f\\d]{12}\\}$",u=new RegExp(i,"i");if(!u.test(t))throw n._exceptionHelper.createArgumentOutOfRangeException("g");this._g=t.toLowerCase()};t.newGuid=function(){for(var t=new Array(4),i=0;i<4;i++)t[i]=r.padLeft(Math.round(Math.random()*16777215).toString(16),8,"0");return new n.Guid("{"+t[0]+"-"+t[1].substr(0,4)+"-"+t[1].substr(4,4)+"-"+t[2].substr(0,4)+"-"+t[2].substr(4,4)+t[3]+"}")},t.prototype={_g:null,equals:function(n){return n==null?!1:this._g===n._g},toString:function(){return this._g}},t.empty=new n.Guid("{00000000-0000-0000-0000-000000000000}")}(),function(){var t=window,i=t.ss,n=t.Microsoft.Live.Messenger;n.Version=function(t,i,r,u){if(t<0||i<0||r<0||u<0)throw n._exceptionHelper.createArgumentOutOfRangeException(n._exceptions.argumentPositive);this._major=t,this._minor=i,this._build=r,this._revision=u},n.Version.prototype={_major:0,_minor:0,_build:0,_revision:0,get_major:function(){return this._major},get_minor:function(){return this._minor},get_build:function(){return this._build},get_revision:function(){return this._revision},toString:function(){return i.format("{0}.{1}.{2}.{3}",this._major,this._minor,this._build,this._revision)}}}(),function(){var n=window,t=n.Microsoft.Live.Messenger;t._safeUrlInfo=function(n,t,i){var r=this;r.urlPosition=n,r.urlLength=t,r.safeLink=i}}(),function(){var s=new RegExp("(\\(angel\\)|:@|:-@|:=@|x\\(|x-\\(|X\\(|X-\\(|x=\\(|X=\\(|\\(angry\\)|\\(bandit\\)|\\(headbang\\)|\\(banghead\\)|\\(beer\\)|:D|:-D|:=D|:d|:-d|:=d|\\(laugh\\)|\\(blush\\)|:\\$|:-\\$|:=\\$|:\">|\\(bow\\)|\\(u\\)|\\(U\\)|\\(brokenheart\\)|\\(bug\\)|\\(\\^\\)|\\(cake\\)|\\(call\\)|\\(cash\\)|\\(mo\\)|\\(\\$\\)|\\(clap\\)|\\(coffee\\)|8\\)|8-\\)|8=\\)|B\\)|B-\\)|B=\\)|\\(cool\\)|;\\(|;-\\(|;=\\(|:\\(|:-\\(|:=\\(|\\(cry\\)|\\(dance\\)|o/|:D/|:d/|\\(devil\\)|\\(doh\\)|\\(d\\)|\\(D\\)|\\(drink\\)|\\(drunk\\)|\\|-\\(|\\|\\(|\\|=\\(|\\(dull\\)|\\(emo\\)|\\(envy\\)|]:\\)|>:\\)|\\(grin\\)|\\(finger\\)|\\(F\\)|\\(f\\)|\\(flower\\)|\\(chuckle\\)|\\(giggle\\)|\\(handshake\\)|\\(happy\\)|\\(h\\)|\\(H\\)|\\(l\\)|\\(L\\)|\\(heart\\)|\\(love\\)|\\(hi\\)|\\(hug\\)|\\(bear\\)|\\(inlove\\)|\\(wasntme\\)|:\\*|:-\\*|:=\\*|\\(kiss\\)|\\(makeup\\)|\\(kate\\)|\\(mm\\)|\\(mmm\\)|\\(mmmm\\)|\\(mooning\\)|\\(~\\)|\\(film\\)|\\(movie\\)|\\(flex\\)|\\(muscle\\)|\\(music\\)|:x|:-x|:X|:-X|:#|:-#|:=x|:=X|:=#|8-\\||B-\\||8\\||B\\||8=\\||B=\\||\\(nerd\\)|\\(ninja\\)|\\(n\\)|\\(N\\)|\\(no\\)|\\(nod\\)|\\(party\\)|\\(mp\\)|\\(ph\\)|\\(phone\\)|\\(pi\\)|\\(pizza\\)|\\(poolparty\\)|\\(hrv\\)|:&|:-&|:=&|\\(punch\\)|\\(rain\\)|\\(st\\)|\\(london\\)|\\(rock\\)|\\(rofl\\)|:\\(|:-\\(|:=\\(|\\(sad\\)|\\(shake\\)|\\(skype\\)|\\(ss\\)|\\|-\\)|I-\\)|I=\\)|\\(snooze\\)|:\\)|:-\\)|:=\\)|\\(smile\\)|:P|:-P|:=P|:p|:-p|:=p|\\(tongueout\\)|\\(smirk\\)|\\(smoking\\)|\\(smoke\\)|\\(ci\\)|:\\||:-\\||:=\\||\\(speechless\\)|\\(\\*\\)|\\(star\\)|\\(sun\\)|:O|:-O|:=O|:o|:-o|:=o|\\(surprised\\)|\\(swear\\)|\\(sweat\\)|\\(:\\||\\(talk\\)|\\(think\\)|:-\\?|:\\?|:=\\?|\\(o\\)|\\(O\\)|\\(time\\)|\\(clock\\)|\\(toivo\\)|\\(tmi\\)|\\(wait\\)|\\(whew\\)|;\\)|;-\\)|;=\\)|\\(wink\\)|:\\^\\)|\\(wonder\\)|:S|:s|:-s|:-S|:=s|:=S|\\(worry\\)|\\(yawn\\)|\\|-\\(\\)|\\(y\\)|\\(Y\\)|\\(ok\\)|\\(yes\\)|\\(e\\)|\\(m\\)|\\(mail\\)|\\r\\n|\\r|\\n|((http|https):\\/\\/|\\/www|www\\.)[^\\s]*[^\\s?.!(;:'>\\[\\],])"),h="((http|https):\\/\\/)[^\\s]*[^\\s?.!(;:'>\\[\\],]",f=window,i=f.document,e=f.$Config,r=f.Microsoft.Live.Messenger,o=f.MSH,u=f.ss,t=r.MessengerUtility=function(){},n;t.getEmoticonUrlPath=function(){return e.WebIM.imgBase+"webim/emoticons/modern/"},t.getImagePath=function(){return e.WebIM.imgBase+"webim/"},t.emoticonEncode=function(n){if(n==null)throw r._exceptionHelper.createArgumentNullException("text");return t._replaceEmoticonsAndUrls(n,"",r.EmoticonSize.small)},t.replaceEmoticons=function(n,r){var u=i.createElement("span");return t._parseEmoticons(n,u,!1,r),u},t._replaceEmoticonsAndUrls=function(n,r,f){for(var o=i.createElement("span"),a=t._parseSafeUrls(r),s=0,l=u.IEnumerator.getEnumerator(a),e,h,c;l.moveNext();)e=l.get_current(),e.urlPosition>0&&t._parseEmoticons(n.substring(s,e.urlPosition),o,!0,f),h=n.substr(e.urlPosition,e.urlLength),c=t._createAnchorElement(h,e.safeLink),c.innerText=h,o.appendChild(c),s=e.urlPosition+e.urlLength+1;return s<n.length&&t._parseEmoticons(n.substr(s),o,!0,f),o},t._parseEmoticons=function(n,r,u,f){while(n.length>0){var e=!1;n.replace(s,function(){var s=arguments[1],h=arguments[4],a,c,l;h>0&&(a=n.substr(0,h),r.appendChild(i.createTextNode(a)));switch(s){case"\r\n":case"\r":case"\n":r.appendChild(i.createElement("br"));break;default:s.startsWith("http")||s.startsWith("www")?u?(c=t._createAnchorElement(s,null),c.innerText=s,r.appendChild(c)):r.appendChild(i.createTextNode(s)):s.startsWith("/www")?r.appendChild(i.createTextNode(s)):(l=t._createEmoticonElement(s,f),l==null?r.appendChild(i.createTextNode(s)):r.appendChild(l))}return n=n.substr(h+s.length),e=!0,""}),e||(r.appendChild(i.createTextNode(n)),n="")}},t._createAnchorElement=function(n,t){var r=i.createElement("a"),u=n;return u.startsWith("http://")||u.startsWith("https://")||(u="http://"+u),r.href=u,r.target="_blank",r.attachEvent("onclick",function(){r.className==="Disabled"?window.event.returnValue=!1:window.event.cancelBubble=!0,t!=null&&(t.startsWith("http://")||t.startsWith("https://")||(t="http://"+t),r.href=t,o.Scheduler.defer(function(){r.href=u}))}),r},t._createEmoticonElement=function(t,f){var h=n[t.toLowerCase()],s,o;return u.isNullOrEmpty(h)?null:(s=e.WebIM.imgBase+"webim/emoticons/modern/",s+=u.isNullOrUndefined(f)||f===r.EmoticonSize.small?"16px/":"19px/",s+=h+".png",o=i.createElement("img"),o.title=t,o.alt=t,o.className="Emoticon",o.src=s,o)},t._parseSafeUrls=function(n){var i=[],e,f,s,t;if(u.isNullOrEmpty(n))return i;for(e=n.split(" "),f=u.IEnumerator.getEnumerator(e);f.moveNext();)s=f.get_current(),t=s.split(","),i.push(new r._safeUrlInfo(o.ConvertHelper.tryParseInt(t[0]),o.ConvertHelper.tryParseInt(t[1]),t[2]));return i},t._createPersonalMessageElement=function(n,u){var f=i.createElement("span"),o,e;return f.className="PersonalMessage",o=u.get_safeUrl()||"",e=t._replaceEmoticonsAndUrls(n,o,r.EmoticonSize.small),e.className="PersonalMessage_Text",f.appendChild(e),f},t._validateUrl=function(n){if(u.isNullOrEmpty(n))return!1;var t=new RegExp(h,"i");return t.test(n)},n={},n["(angel)"]="29",n[":@"]=n[":-@"]=n[":=@"]=n["x("]=n["x-("]=n["X("]=n["X-("]=n["x=("]=n["X=("]=n["(angry)"]="20",n["(bandit)"]="47",n["(beer)"]="54",n[":D"]=n[":-D"]=n[":=D"]=n[":d"]=n[":-d"]=n[":=d"]=n["(laugh)"]="3",n["(blush)"]=n[":$"]=n[":-$"]=n[":=$"]=n[':">']="12",n["(bow)"]="36",n["(^)"]=n["(cake)"]="53",n["(cash)"]=n["(mo)"]=n["($)"]="51",n["(clap)"]="34",n["(coffee)"]="49",n["8)"]=n["8-)"]=n["8=)"]=n["B)"]=n["B-)"]=n["B=)"]=n["(cool)"]="4",n[";("]=n[";-("]=n[";=("]=n[":("]=n[":-("]=n[":=("]=n["(cry)"]="7",n["(dance)"]=n["o/"]=n[":D/"]=n[":d/"]="56",n["(devil)"]="28",n["(doh)"]="19",n["(d)"]=n["(D)"]=n["(drink)"]="55",n["|-("]=n["|("]=n["|=("]=n["(dull)"]="14",n["(envy)"]="30",n["(F)"]=n["(f)"]=n["(flower)"]="43",n["(chuckle)"]=n["(giggle)"]="33",n["(h)"]=n["(H)"]=n["(l)"]=n["(L)"]=n["(heart)"]=n["(love)"]="42",n["(hi)"]="27",n["(inlove)"]="15",n["(wasntme)"]="21",n[":*"]=n[":-*"]=n[":=*"]=n["(kiss)"]="10",n["(mm)"]=n["(mmm)"]=n["(mmmm)"]="24",n["(flex)"]=n["(muscle)"]="52",n["(music)"]="46",n[":x"]=n[":-x"]=n[":X"]=n[":-X"]=n[":#"]=n[":-#"]=n[":=x"]=n[":=X"]=n[":=#"]="26",n["8-|"]=n["B-|"]=n["8|"]=n["B|"]=n["8=|"]=n["B=|"]=n["(nerd)"]="25",n["(n)"]=n["(N)"]=n["(no)"]="41",n["(nod)"]="39",n["(party)"]="22",n["(pi)"]=n["(pizza)"]="50",n["(rain)"]=n["(st)"]=n["(london)"]="44",n["(rofl)"]="37",n[":("]=n[":-("]=n[":=("]=n["(sad)"]="2",n["|-)"]=n["I-)"]=n["I=)"]=n["(snooze)"]="13",n[":)"]=n[":-)"]=n[":=)"]=n["(smile)"]="1",n[":P"]=n[":-P"]=n[":=P"]=n[":p"]=n[":-p"]=n[":=p"]=n["(tongueout)"]="11",n["(smirk)"]="38",n[":|"]=n[":-|"]=n[":=|"]=n["(speechless)"]="9",n["(*)"]=n["(star)"]="57",n["(sun)"]="45",n[":O"]=n[":-O"]=n[":=O"]=n[":o"]=n[":-o"]=n[":=o"]=n["(surprised)"]="5",n["(think)"]=n[":-?"]=n[":?"]=n[":=?"]="35",n["(tmi)"]="48",n["(wait)"]="31",n[";)"]=n[";-)"]=n[";=)"]=n["(wink)"]="6",n[":^)"]=n["(wonder)"]="32",n[":S"]=n[":s"]=n[":-s"]=n[":-S"]=n[":=s"]=n[":=S"]=n["(worry)"]="23",n["(yawn)"]=n["|-()"]="17",n["(y)"]=n["(Y)"]=n["(ok)"]=n["(yes)"]="40"}(),function(n){var r=window,t=r.Microsoft.Live.Messenger,i=t.Services;i.ContactsReader=function(){},i.ContactsReader.prototype={_initializationCallback:null,notifyAddressBookChange:null,get_networks:null,get_persons:null,get_settings:null,initialize:function(n){this._initializationCallback=n},onInitialized:function(n){this._initializationCallback!=null&&(this._initializationCallback.invoke(n),this._initializationCallback=null)},onNetworksChanged:function(i,r,u){n(this).triggerHandler("networksChanged",[this,new t.ContactsReaderChangedEventArgs(i,r,u)])},onPersonsChanged:function(i,r,u){n(this).triggerHandler("personsChanged",[this,new t.ContactsReaderChangedEventArgs(i,r,u)])},onSettingsChanged:function(){n(this).triggerHandler("settingsChanged",[this,null])}}}(window.originaljQuery||jQuery),function(n){var s="$pwc",r=window,f=r.MC,e=r.Microsoft.Live.Messenger.Services,i=r.ss,u=e.ContactsReader,o=e.PeopleCache=function(n){this._changeProcessingTimer$1=-1,u.call(this),n==null&&(n=s),this._id$1=n,this._networksChanges$1=[],this._personsChanges$1=[]},t=o.prototype=new u;t.constructor=o,t._id$1=null,t._dataSource$1=null,t._checkInterval$1=5,t._networksChanges$1=null,t._personsChanges$1=null,t.get_networks=function(){return this._dataSource$1!=null?this._dataSource$1.services:null},t.get_persons=function(){return this._dataSource$1!=null?this._dataSource$1.persons:null},t.get_settings=function(){return this._dataSource$1!=null?this._dataSource$1.settings:null},t.initialize=function(n){u.prototype.initialize.call(this,n),this._checkPeopleCache$1()},t.notifyAddressBookChange=function(n){this._dataSource$1.processABChangedEvent(n)},t._checkPeopleCache$1=function(){var n=this.get__dataSource$1(),t,u;if(n!=null)if(n.isReady)this._onDataSourceReady$1();else if(n.isFailed)this.onInitialized(f.MessengerServiceResultCode.failure);else t=i.Delegate.create(this,this._onDataSourceReady$1),this._bindEvent$1(this.get__dataSource$1(),"$events","ready",t),u=i.Delegate.create(this,this._onDataSourceFailed),this._bindEvent$1(this.get__dataSource$1(),"$events","failed",u);else r.setTimeout(i.Delegate.create(this,this._checkPeopleCache$1),this._getCheckInterval$1())},t.get__dataSource$1=function(){return this._dataSource$1==null&&(this._dataSource$1=r[this._id$1]),this._dataSource$1},t._getCheckInterval$1=function(){return this._checkInterval$1<1e3&&(this._checkInterval$1+=10),this._checkInterval$1},t._onDataSourceReady$1=function(){this._bindChangedEvents$1();this.onInitialized(f.MessengerServiceResultCode.success)},t._onDataSourceFailed=function(){this.onInitialized(f.MessengerServiceResultCode.failure)},t._bindChangedEvents$1=function(){var t=i.Delegate.create(this,this._onPcNetworksChanged$1),r=i.Delegate.create(this,this._onPcPersonsChanged$1),u=i.Delegate.create(this,this._onPcSettingsChanged$1);this._bindEvent$1(this.get__dataSource$1(),"$services","changed",t),this._bindEvent$1(this.get__dataSource$1(),"$persons","changed",r),this._bindEvent$1(this.get__dataSource$1().settings,"$changes","changed",u),n(this.get__dataSource$1()).bind("fullSync",i.Delegate.create(this,this._onFullSync))},t._onFullSync=function(){this._onPcNetworksChanged$1(null,{changed:this.get__dataSource$1().services}),this._onPcPersonsChanged$1(null,{changed:this.get__dataSource$1().persons}),this._onPcSettingsChanged$1({changed:this.get__dataSource$1().settings})},t._bindEvent$1=function(n,t,r,u){var f=n[t];i.isNullOrUndefined(f)||f.bind(r,u)},t._onPcNetworksChanged$1=function(n,t){this._networksChanges$1.push(t),this._scheduleProcessChanges$1()},t._onPcPersonsChanged$1=function(n,t){this._personsChanges$1.push(t),this._scheduleProcessChanges$1()},t._onPcSettingsChanged$1=function(){u.prototype.onSettingsChanged.call(this)},t._scheduleProcessChanges$1=function(){this._changeProcessingTimer$1===-1&&(this._changeProcessingTimer$1=r.setTimeout(i.Delegate.create(this,this._processChanges$1),1))},t._processChanges$1=function(){var n,t;for(r.clearTimeout(this._changeProcessingTimer$1),this._changeProcessingTimer$1=-1,n=0;n<this._networksChanges$1.length;n++)t=this._networksChanges$1[n],u.prototype.onNetworksChanged.call(this,t.added,t.changed,t.removed);for(n=0;n<this._personsChanges$1.length;n++)t=this._personsChanges$1[n],u.prototype.onPersonsChanged.call(this,t.added,t.changed,t.removed)}}(window.originaljQuery||jQuery),function(){var r=window,e=r.MC,t=r.Microsoft.Live.Messenger,u=t.Services,i=u.ContactsReader,f=u._personInfoReader=function(n,r){i.call(this),n==null||n.length===0?t._exceptionHelper.createArgumentException("Persons must contain at least one item.","persons"):(r==null||r.length===0)&&t._exceptionHelper.createArgumentException("Networks must contain at least one item.","networks"),this._persons$1=n,this._networks$1=r},n=f.prototype=new i;n.constructor=f,n._persons$1=null,n._networks$1=null,n.get_networks=function(){return this._networks$1},n.get_persons=function(){return this._persons$1},n.get_settings=function(){return null},n.notifyAddressBookChange=function(){},n.initialize=function(n){i.prototype.initialize.call(this,n);this.onInitialized(e.MessengerServiceResultCode.success)}}(),function(){var i=window,t=i.Microsoft.Live.Messenger,n=t.AuthenticationStatus;t.AuthenticationCompletedEventArgs=function(t){this._identity$1=t,this._authStatus$1=n.none},t.AuthenticationCompletedEventArgs.prototype={_identity$1:null,_authStatus$1:n.none,_resultCode$1:t.AuthenticationResultCode.success,_serverName$1:null,get_status:function(){return this._authStatus$1},set_status:function(n){return this._authStatus$1=n,n},get_identity:function(){return this._identity$1},get_isAlreadySignedIn:function(){return(this._authStatus$1&n.alreadySignedIn)!=0},get_isUnsupportedBrowser:function(){return(this._authStatus$1&n.unsupportedBrowser)!=0},get_insecureTransportNotSupported:function(){return(this._authStatus$1&n.insecureTransportNotSupported)!=0},get_multipleEndpointsNotSupported:function(){return(this._authStatus$1&n.multipleEndpointsNotSupported)!=0},get_isBlockedApplication:function(){return(this._authStatus$1&n.blockedApplication)!=0},get_isBlockedUser:function(){return(this._authStatus$1&n.blockedUser)!=0},get_authenticationFailure:function(){return(this._authStatus$1&n.authenticationFailure)!=0||(this._authStatus$1&n.serviceUnavailable)!=0},get_serviceUnavailable:function(){return(this._authStatus$1&n.serviceUnavailable)!=0},get_resultCode:function(){return this._resultCode$1},set_resultCode:function(n){return this._resultCode$1=n,n},get_user:function(){return this.get_identity().get__user()},get_serverName:function(){return this._serverName$1},set_serverName:function(n){return this._serverName$1=n,n}}}(),function(n){var u=window,o=u.$Config,r=u.MC,t=u.Microsoft.Live.Messenger,i=t.Services,h=u.MSH,f=u.ss,e=t.AuthenticationStatus,s=t.AuthenticationResultCode;t.Identity=function(){this._identityInfo=new r.IdentityInfo(null,null),this._identityInfo.authenticationInfo=new r.AuthenticationInfo(r.AuthenticationType.rpsAuth,""),this._isAuthenticated=!0,this._services=t._globalConfiguration.get__defaultServices()},t.Identity.prototype={_identityInfo:null,_userService:null,_userEvents:null,_user:null,_isAuthenticated:!1,_disposed:!1,_reloaded:!1,_signinScenarioQoSObject:null,_reconnectScenarioQoSObject:null,isAuthenticationCompleted:!1,isGetMappingContainerCompleted:!1,_skypeInitTimeoutId:-1,_skypeLoginStartTime:null,skypeLoginTime:0,get_liveId:function(){return this._identityInfo.liveId},get_signinScenarioQoSObject:function(){return this._signinScenarioQoSObject},set_signinScenarioQoSObject:function(n){return this._signinScenarioQoSObject=n,n},get_reconnectScenarioQoSObject:function(){return this._reconnectScenarioQoSObject},set_reconnectScenarioQoSObject:function(n){return this._reconnectScenarioQoSObject=n,n},get_skypeId:function(){return this._identityInfo.skypeId},get_cid:function(){return this._identityInfo.cid},get_token:function(){return this.get__authenticationInfo().ticket},set_token:function(n){if(f.isNullOrEmpty(n))throw t._exceptionHelper.createArgumentNullOrEmptyException("value",n);return this.get__authenticationInfo().ticket=n,n},_setLiveId:function(n){if(this._identityInfo.liveId!==n){this._identityInfo.liveId=n;this.onPropertyChanged(new t.PropertyChangedEventArgs("LiveId"))}},_setCid:function(n){if(this._identityInfo.cid!==n){this._identityInfo.cid=n;this.onPropertyChanged(new t.PropertyChangedEventArgs("Cid"))}},_setSkypeId:function(n){if(this._identityInfo.skypeId!==n){this._identityInfo.skypeId=n;this.onPropertyChanged(new t.PropertyChangedEventArgs("SkypeId"))}},_initializeSkyJS:function(){var t=this,n;t._skypeLoginStartTime=new Date,n={},n.liveIframePath="/handlers",n.mwtEnv=o.WebIM.ev,n.region=o.mkt.toLowerCase(),n.cid=this._identityInfo.cid,n.hostProperty=o.WebIM.cn,n.mappingReady=f.Delegate.create(this,this.onSkyJSInitMappingReady),n.success=f.Delegate.create(this,this.onSkyJSInitSuccess),n.error=f.Delegate.create(this,this.onSkyJSInitFailure),n.callStarted=f.Delegate.create(this,this.onCallStarted),n.pluginStarted=f.Delegate.create(this,this.onpluginStarted),n.callFinished=f.Delegate.create(this,this.onCallFinished),i.SkyJSHelper.getInstance().Outlook.init&&i.SkyJSHelper.getInstance().Outlook.init(n)?u.InboxPage!=null&&u.InboxPage.Config!=null&&!u.Config.SkypeOptions.isSkypeIntegrated&&u.OptionsWriter&&u.OptionsWriter.fireOption(u.InboxPage.Config.SkypeOptions.skypeIntegratedSettingUrl):(t._onGetMappingContainerCompleted(),r.Logger.logAction("WebIM_Skype_DisabledByRollout")),t.isGetMappingContainerCompleted||(t._skypeInitTimeoutId=u.setTimeout(function(){t._skypeInitTimeoutId=-1;t.onSkyJSInitFailure({code:408,text:"WebIM timeout"})},3e4))},onSkyJSInitMappingReady:function(){if((this._clearInitTimeout(),!i.SkyJSHelper.get_skypeInitCompleted())&&(this.skypeLoginTime=Math.floor((new Date-this._skypeLoginStartTime)/1e3),!this.isGetMappingContainerCompleted)){var n=i.SkyJSHelper.getInstance().Outlook.getMappingContainer();f.isNullOrEmpty(n)?r.WebmainHelper.addQoSStats(r.WebmainHelper.qoSApiGetUic,"UicTicketMissing",r.WebmainHelper.qoSSigninApiStartTime,this.get_signinScenarioQoSObject(),!1):(this._setUicTicket(n),r.WebmainHelper.addQoSStats(r.WebmainHelper.qoSApiGetUic,null,r.WebmainHelper.qoSSigninApiStartTime,this.get_signinScenarioQoSObject(),!1))}},onSkyJSInitSuccess:function(){(this._clearInitTimeout(),i.SkyJSHelper.get_skypeInitCompleted())||i.SkyJSHelper.set_skypeInitCompleted()},onSkyJSInitFailure:function(n){var t,u,e;(this._clearInitTimeout(),i.SkyJSHelper.get_skypeInitCompleted())||(this.skypeLoginTime=Math.floor((new Date-this._skypeLoginStartTime)/1e3),i.SkyJSHelper.set_skypeInitCompleted(),t=n.code,t===403?(i.SkyJSHelper.skypeAudioVideoEnabled=!1,r.Logger.logAction("WebIM_Skype_AudioVideoDisabled_BrowserNotSupported")):(i.SkyJSHelper.reportSkypeLogin(!1,t.toString()),u=f.isNullOrEmpty(n.text)?t.toString():f.format("{0}-{1}",t,n.text),e=!1,t==413&&(e=!0,u="FailedToSignTrouterUrlTooManyConnections"),r.WebmainHelper.addQoSStats(r.WebmainHelper.qoSApiGetUic,u,r.WebmainHelper.qoSSigninApiStartTime,this.get_signinScenarioQoSObject(),e)),this._onGetMappingContainerCompleted())},onCallStarted:function(){i.SkyJSHelper.skypeCallStarted()},onCallFinished:function(){i.SkyJSHelper.skypeCallFinished()},onpluginStarted:function(){i.SkyJSHelper.skypePluginStarted()},get_isAuthenticated:function(){return this._isAuthenticated},get_reloaded:function(){return this._reloaded},set_reloaded:function(n){if(this._reloaded!==n){this._reloaded=n;this.onPropertyChanged(new t.PropertyChangedEventArgs("Reloaded"))}return n},_setIsAuthenticated:function(n){if(this._isAuthenticated!==n){this._isAuthenticated=n;this.onPropertyChanged(new t.PropertyChangedEventArgs("IsAuthenticated"))}},get__endpointId:function(){return f.isNullOrEmpty(this._identityInfo.endpointId)&&this.set__endpointId(t.Guid.newGuid().toString()),this._identityInfo.endpointId},set__endpointId:function(n){if(n=n.toLowerCase(),this._identityInfo.endpointId!==n){this._identityInfo.endpointId=n;this.onPropertyChanged(new t.PropertyChangedEventArgs("EndpointId"))}return n},get__initialServices:function(){return this._services},get__userEvents:function(){return this._userEvents==null&&(this._userEvents=new t._userEvents(this)),this._userEvents},_failSignInStatus:function(){var n=new t.AuthenticationCompletedEventArgs(this);n.set_status(e.serviceUnavailable|e.unsupportedBrowser),n.set_resultCode(s.failure);this.onAuthenticationCompleted(n)},_onInitialized:function(){this._setIsAuthenticated(!0),this.get_isAuthenticated()&&this.set__endpointId(t.Guid.newGuid().toString()),this.isAuthenticationCompleted=!0,this.isGetMappingContainerCompleted&&this._onInitializationCompleted()},_onGetMappingContainerCompleted:function(){this.isGetMappingContainerCompleted||(this.isGetMappingContainerCompleted=!0,this.isAuthenticationCompleted&&this._onInitializationCompleted())},_setUicTicket:function(n){f.isNullOrEmpty(n)?i.SkyJSHelper.reportSkypeLogin(!1,"UicTicketMissing"):(this.get__authenticationInfo().uicTicket=n,i.SkyJSHelper.skypeEnabled=!0,i.SkyJSHelper.skypeAudioVideoEnabled=!0,i.SkyJSHelper.reportSkypeLogin(!0,"success")),this._onGetMappingContainerCompleted()},_onInitializationCompleted:function(){var n=new t.AuthenticationCompletedEventArgs(this);this.get_isAuthenticated()?(n.set_status(e.none),n.set_resultCode(s.success)):(n.set_status(e.none),n.set_resultCode(s.failure));this.onAuthenticationCompleted(n)},onAuthenticationCompleted:function(t){var i=this;h.Scheduler.defer(function(){n(i).triggerHandler("authenticationCompleted",[i,t])})},get__authenticationInfo:function(){return this._identityInfo.authenticationInfo},set__authenticationInfo:function(n){return this._identityInfo.authenticationInfo=n,n},_getIdentityInfo:function(){var n=new r.IdentityInfo(this.get_liveId(),this.get__endpointId());return n.cid=this.get_cid(),n.authenticationInfo=this.get__authenticationInfo(),n.skypeId=this.get_skypeId(),n},get__userService:function(){return this._userService==null&&(this._userService=i.UserServiceFactory.create(this,this.get__userEvents())),this._userService},_setUserService:function(n){this._userService=n},onPropertyChanged:function(t){n(this).triggerHandler("propertyChanged",[this,t])},_onTokenExpired:function(){},get__user:function(){return this._user},set__user:function(n){if(this._user!=null&&this._user!==n)throw t._exceptionHelper.createInvalidOperationException(t._exceptions.userIdentityEnforceOneToOneBinding);return this._user=n,n},get__isDisposed:function(){return this._disposed},dispose:function(){this._disposed||(this._disposed=!0,n(this).triggerHandler("disposed",[this,{}]))},_clearInitTimeout:function(){this._skypeInitTimeoutId>-1&&(u.clearTimeout(this._skypeInitTimeoutId),this._skypeInitTimeoutId=-1)}}}(window.originaljQuery||jQuery),function(){var n=window,i=n.MC,r=n.MSP,t=n.MSCr,u=n.MSI,f=n.MSCh,e=n.MSCo;t.DelayedServiceFactory=function(){this._identityService=this._createIdentityService(),this._identity=new i.IdentityInfo(null,null)},t.DelayedServiceFactory.prototype={_identity:null,_identityService:null,_userServiceEvents:null,_userService:null,createUserService:function(n){return this._userServiceEvents=n,this._userService=new t.UserService(this._identity,this,this._userServiceEvents,this._createIdentityService())},createConnectionService:function(n,t){return new r.ConnectionService(n,t,e.HttpRequest.get_defaultScheme()==="https://")},createConversationService:function(n,t,i){return new f.ConversationService(n,t,i)},_createIdentityService:function(){return this._identityService==null&&(this._identityService=new u.IdentityService),this._identityService}}}(),function(){var i=window,r=i.Microsoft.Live.Messenger,u=r.Services,f=i.MSCr,n=null,t=u.UserServiceFactory=function(){};t.get__defaultImplementation=function(){return n},t.set__defaultImplementation=function(t){return n=t,t},t.create=function(t,i){if(n!=null)return n;var r=new f.DelayedServiceFactory;return r.createUserService(i)}}(),function(){var t=window,n=t.Microsoft.Live.Messenger;n._iContactCollectionOwner=function(){},n._iContactCollectionOwner.prototype={canAddContact:null,canRemoveContact:null,addContact:null,removeContact:null,containsContact:null,setCollection:null,get_capacity:null}}(),function(){var t=window,n=t.Microsoft.Live.Messenger;n._iimAddressCollectionOwner=function(){},n._iimAddressCollectionOwner.prototype={addAddress:null,removeAddress:null}}(),function(n){var i=window,t=i.Microsoft.Live.Messenger,r=i.ss;t.Collection=function(){this._items=[],this._resetting=!1},t.Collection.prototype={_resetting:!1,onCollectionChanged:function(t){n(this).triggerHandler("collectionChanged",[this,t])},onPropertyChanged:function(t){n(this).triggerHandler("propertyChanged",[this,t])},get__isResetting:function(){return this._resetting},get_count:function(){return this._items.length},get__items:function(){return this._items},_onPropertyChangedInternal:function(n){if(!this._resetting)this.onPropertyChanged(new t.PropertyChangedEventArgs(n))},_onCollectionChangedInternal:function(n,i,r,u){if(!this._resetting)this.onCollectionChanged(new t.NotifyCollectionChangedEventArgs(n,i,r,u))},_onCollectionChangedAddRange:function(n,i){if(!this._resetting)this.onCollectionChanged(t.NotifyCollectionChangedEventArgs._create(t.NotifyCollectionChangedAction.add,n,null,i,-1))},_beginReset:function(){this._resetting=!0},_endReset:function(){this._resetting=!1,this._onPropertyChangedInternal("Count"),this._onCollectionChangedInternal(t.NotifyCollectionChangedAction.reset,null,null,0)},_contains:function(n){return this._items.contains(n)},_addInternal:function(n){this._items.push(n),this._resetting||(this._onPropertyChangedInternal("Count"),this._onCollectionChangedInternal(t.NotifyCollectionChangedAction.add,n,null,this._items.length-1))},_removeInternal:function(n){var i=this._items.indexOf(n);i>=0&&(this._items.splice(i,1),this._onPropertyChangedInternal("Count"),this._onCollectionChangedInternal(t.NotifyCollectionChangedAction.remove,null,n,i))},_setInternal:function(n,i){var r=this._items[n];r!==i&&(this._items[n]=i,this._onCollectionChangedInternal(t.NotifyCollectionChangedAction.replaced,i,r,n))},_insertInternal:function(n,i,r){this._items.insert(n,i),this._onPropertyChangedInternal("Count"),r&&this._onCollectionChangedInternal(t.NotifyCollectionChangedAction.add,i,null,n)},_removeAtInternal:function(n,i){var r=this._items[n];this._items.splice(n,1),this._onPropertyChangedInternal("Count"),i&&this._onCollectionChangedInternal(t.NotifyCollectionChangedAction.remove,null,r,n)},_insertRangeInternal:function(n,t){for(var i=n;i<n+t.length;i++)t[i]!=null&&this._items.insert(i,t[i]);this._onPropertyChangedInternal("Count"),this._onCollectionChangedAddRange(t,n)},_moveInternal:function(n,i){if(i!==n&&n>=0&&n<=this.get_count()){var r=this._items[i];this._removeAtInternal(i,!1),this._insertInternal(n,r,!1),this._onCollectionChangedInternal(t.NotifyCollectionChangedAction.replaced,r,r,n)}},getItem:function(n){var i=this._items;if(n<0||n>=i.length)throw t._exceptionHelper.createArgumentOutOfRangeException("index");return i[n]},getEnumerator:function(){return r.IEnumerator.getEnumerator(this._items)}}}(window.originaljQuery||jQuery),function(n){function o(n,t,i,r,u){var f={},e;return f[0]=n,f[1]=t,f[3]=1,f[8]=i,f[9]=r,f[10]=u,e=new wLive.People.Service(f)}var e=window,f=e.MC,h=e.MSH,c=e.ss,i=e.Microsoft.Live.Messenger,u=f.NetworkConnectionType,r=f.NetworkOperationType,s=i.NetworkStatus,t=i.Network=function(n,t){this._pwcService=n,this._connectionType=t,this._imEnabled=n.getSupportsIm()&&!n.getOnHideList()};t._networkIdWindowsLive="WL",t._networkIdSkype="SKYPE",t._networkIdOfficeCommunicator="OCS",t._networkIdTelephone="SMS",t._networkIdFacebook="FB",t._networkIdGoogle="GOOG",t._networkIdMySpace="MYSP",t._windowsLive=null,t._officeCommunicator=null,t._telephone=null,t._skype=null,t.get__windowsLive=function(){if(t._windowsLive==null){var n=o(t._networkIdWindowsLive,i._localization.networkWindowsLive,MSCo.Configuration.get_profileUrlFormat(),MSCo.Configuration.get_photoUrlFormat(),MSCo.Configuration.get_sendMessageUrlFormat());t._windowsLive=new t(n,u.windowsLive)}return t._windowsLive},t.get__skype=function(){if(t._skype==null){var n=o(t._networkIdSkype,i._localization.networkSkype,null,null,null);t._skype=new t(n,u.windowsLive)}return t._skype},t.get__officeCommunicator=function(){if(t._officeCommunicator==null){var n=o(t._networkIdOfficeCommunicator,i._localization.networkOfficeCommunicator,null,null,null);t._officeCommunicator=new t(n,u.windowsLive)}return t._officeCommunicator},t.get_telephone=function(){if(t._telephone==null){var n=o(t._networkIdTelephone,i._localization.networkTelephone,null,null,null);t._telephone=new t(n,u.windowsLive)}return t._telephone},t.prototype={_pwcService:null,_imEnabled:!1,_user:null,_status:s.signedOut,_connectionType:u.none,get_iconUrl:function(){return i._globalConfiguration._getNetworkIconUrl(this._pwcService.getId())},get_iconErrorUrl:function(){return i._globalConfiguration._getNetworkIconErrorUrl(this._pwcService.getId())},get_id:function(){return this._pwcService.getId()},get_imEnabled:function(){return this._imEnabled},set_imEnabled:function(n){if(!this.get_supportsRemoteSignIn())throw i._exceptionHelper.createInvalidOperationException(i._exceptions.networkIMEnabledTogglingNotAllowed);if(this._imEnabled!==n){this._imEnabled=n;var t=n?r.enableIM:r.disableIM;this._user._updateNetwork(this.get_id(),t,!0),this._onPropertyChanged("IMEnabled")}return n},get_name:function(){return this._pwcService.getName()},get_status:function(){return this._status},get_tokenState:function(){return this._pwcService.getTokenState()},get_supportsIM:function(){return this._pwcService.getSupportsIm()},get_pwcService:function(){return this._pwcService},get_supportsRemoteSignIn:function(){return this._connectionType===u.connect},get_isWindowsLive:function(){return this._pwcService.getId()===t._networkIdWindowsLive},get_isOfficeCommunicator:function(){return this._pwcService.getId()===t._networkIdOfficeCommunicator},get_isFacebook:function(){return this._pwcService.getId()===t._networkIdFacebook},get_isGoogle:function(){return this._pwcService.getId()===t._networkIdGoogle},get_isSkype:function(){return this._pwcService.getId()===t._networkIdSkype},get__info:function(){var n=new f.NetworkInfo(this.get_id(),this.get_name(),this._connectionType,this.get__isRemoteNetwork(),this._pwcService.getPhotosUrl(),this._pwcService.getProfileUrl(),this._pwcService.getSendMessageUrl(),this._pwcService.getReportAbuseUrl());return n.rank=this._pwcService.getRank(),n.imEnabled=this._imEnabled,n},get__user:function(){return this._user},set__user:function(n){return this._user=n,n},get__isRemoteNetwork:function(){return this._connectionType!==u.windowsLive},get__rank:function(){return this._pwcService.getRank()},_setStatus:function(n){this._status!==n&&(this._status=n,this._status===f.NetworkInfoStatus.signedOut&&this._markLinkedContactsOffline(),this._onPropertyChanged("Status"))},_onUpdateNetworkCompleted:function(n,t){if(n!==f.MessengerServiceResultCode.success&&n===f.MessengerServiceResultCode.failedToPersist){var u=t&(r.enableIM|r.disableIM),i=!1;switch(u){case r.enableIM:this.get_imEnabled()&&(i=!0,this._imEnabled=!1);break;case r.disableIM:this.get_imEnabled()||(i=!0,this._imEnabled=!0)}i&&this._onPropertyChanged("IMEnabled")}},_setNetworkChanges:function(n){var t=[],u,f,i;for(this._pwcService.getName()!==n.getName()&&t.push("Name"),this._pwcService.getSupportsIm()!==n.getSupportsIm()&&t.push("SupportsIM"),u=n.getSupportsIm()&&!n.getOnHideList(),this._imEnabled!==u&&(this._imEnabled=u,t.push("IMEnabled"),f=this._imEnabled?r.enableIM:r.disableIM,this._user._updateNetwork(this.get_id(),f,!0)),this._pwcService.getTokenState()!==n.getTokenState()&&t.push("TokenState"),this._pwcService=n,i=0;i<t.length;i++)this._onPropertyChanged(t[i])},_markLinkedContactsOffline:function(){this._user.get_contactMap()._markOffline(!0,this.get_id())},_onPropertyChanged:function(t){n(this).triggerHandler("propertyChanged",[this,new i.PropertyChangedEventArgs(t)])}}}(window.originaljQuery||jQuery),function(){var t=window,i=t.ss,n=t.Microsoft.Live.Messenger;n.PresenceProperty=function(t,r){if(i.isNullOrEmpty(t))throw n._exceptionHelper.createArgumentNullOrEmptyException("name",t);if(r==null)throw n._exceptionHelper.createArgumentNullException("value");this._name=t,this._value=r},n.PresenceProperty.prototype={_name:null,_value:null,get_name:function(){return this._name},get_value:function(){return this._value}}}(),function(){var i=window,r=i.ss,t=i.Microsoft.Live.Messenger,u=t.Collection,f=t.PresencePropertyCollection=function(n,t){u.call(this),this._loadServiceData(n,t)},n=f.prototype=new u;n.constructor=f,n._serviceData$1=null,n._serviceEndpointData$1=null,n._onServiceDataChanged=function(n){var t=!1,i=this._findServiceByType$1(n.service);return i!=null&&(t=this._setChangesOnProperties$1(n.updatedProperties,i.get_properties())),t},n._onEndpointServiceDataChanged=function(n,t){var i=!1,u=this._findServiceByType$1(n.service),r;return u!=null&&(i=this._setChangesOnProperties$1(n.updatedProperties,u.get_properties())),r=this._findServiceEndpointByType$1(n.service),r!=null&&(i=(i|this._setChangesOnProperties$1(n.updatedEndpoints[t],r.get_properties()))==1),i},n._loadServiceData=function(n,t){this._serviceData$1=n,this._serviceEndpointData$1=t,this._initializeItems$1()},n._setChangesOnProperties$1=function(n,i){for(var s=!1,h=n.length,u,e,o,f=0;f<h;f++)u=n[f],e=this._indexOf$1(u),r.keyExists(i,u)?(o=i[u],Object.isString(o)&&(e===-1?this._addInternal(new t.PresenceProperty(u,o)):this._setInternal(e,new t.PresenceProperty(u,o)),s=!0)):(this._removeInternal(e),s=!0);return s},n._indexOf$1=function(n){for(var i=this.get_count(),t=0;t<i;t++)if(this.get__items()[t].get_name()===n)return t;return-1},n._findServiceByType$1=function(n){for(var t=0;t<this._serviceData$1.length;t++)if(this._serviceData$1[t].get_service()===n)return this._serviceData$1[t];return null},n._findServiceEndpointByType$1=function(n){for(var t=0;t<this._serviceEndpointData$1.length;t++)if(this._serviceEndpointData$1[t].get_service()===n)return this._serviceEndpointData$1[t];return null},n._initializeItems$1=function(){for(var n=0;n<this._serviceData$1.length;n++)this._initializeProperties$1(this._serviceData$1[n].get_properties());for(n=0;n<this._serviceEndpointData$1.length;n++)this._initializeProperties$1(this._serviceEndpointData$1[n].get_properties())},n._initializeProperties$1=function(n){var f=n,i,r,u;for(i in f)r={key:i,value:f[i]},u=r.value,Object.isString(u)&&this._addInternal(new t.PresenceProperty(r.key,u))},n.get_item=function(n){var u,i;if(n==null)throw t._exceptionHelper.createArgumentNullException("key");if(Object.isString(n)){if(u=n,r.isNullOrEmpty(u))throw t._exceptionHelper.createArgumentNullOrEmptyException("name",u);for(i=0;i<this.get_count();i++)if(this.get__items()[i].get_name()===u)return this.get__items()[i];return null}if(Object.isNumber(n))return this.getItem(n);throw t._exceptionHelper.createArgumentOutOfRangeException("key");}}(),function(n){var s=window,y=s.$WLXIM,u=s.MC,r=s.Microsoft.Live.Messenger,p=r.Network,a=r.Services,h=s.MSH,f=s.ss,t=u.IMAddressInfoType,v=u.IMServiceDataProperties,o=u.RoleLists,c=u.ServiceType,i=r.IMAddressType,e=r.PresenceStatus,l=r.IMAddress=function(n,t){this._user=n,this._addressInfo=t,this._network=this._checkNetwork(),this._messagingAddress=t.messagingAddress,this._updateMessagingAddress()};l._checkAddressType=function(n){return f.isNullOrEmpty(n)?t.none:(n=n.trim(),n.indexOf("@")>0?t.windowsLive:n.startsWith("+")?t.telephone:t.cid)},l._isInviteMessageValid=function(n){return f.isNullOrEmpty(n)||n.length<256},l.prototype={_user:null,_addressInfo:null,_endpoints:null,_capabilities:null,_presence:null,_network:null,_linkedContact:null,_serviceData:null,_isPendingInbound:!1,changeToSkypeAddress:function(){var n=new u.IMAddressInfo(this.get_skypeName(),t.skype,this._addressInfo.roleLists);this._addressInfo=n},get_address:function(){switch(this._addressInfo.type){case t.cid:case t.connect:return"";case t.telephone:return this._addressInfo.address;default:return this._user.get_identity().get__authenticationInfo().authType!==u.AuthenticationType.rpsAuth?"":this._addressInfo.address}},get_type:function(){switch(this._addressInfo.type){case t.windowsLive:case t.cid:return i.windowsLive;case t.connect:return i.connect;case t.officeCommunicator:return i.officeCommunicator;case t.telephone:return i.telephone;case t.smtp:return i.smtp;case t.skype:return i.skype;case t.shortCircuit:return i.shortCircuit;case t.temporaryGroup:return i.temporaryGroup;default:return i.none}},get_id:function(){return h.ContactHelper.computeIMAddressId(this._addressInfo)},get_linkedContact:function(){return this._linkedContact},get_network:function(){return this._network},get_endpoints:function(){return this._endpoints==null&&(this._endpoints=new r.EndpointCollection(this)),this._endpoints},get_capabilities:function(){return this._capabilities==null&&(this._capabilities=new r._imAddressCapabilities(this)),this._capabilities},get_cid:function(){return this.get_type()===i.windowsLive?this.get__info().cid:""},get_skypeName:function(){if(f.isNullOrEmpty(this.get__info().skypeId)){if(this.get_type()===i.skype)return this.get_address();if(this.get_type()===i.windowsLive&&this._serviceData!=null&&this._serviceData.skpServiceData!=null){var n=this._serviceData.skpServiceData.get_item(u.SKPServiceDataProperties.skypeName);return n==null?"":n}return""}return this.get__info().skypeId},get_presence:function(){return this._presence==null&&(this._presence=new r.IMAddressPresence(this)),this._presence},get_isOnline:function(){if(this._presence==null)return!1;switch(this.get_presence().get_status()){case e.appearOffline:case e.offline:return!1}return!0},get_isPendingInbound:function(){return this._isPendingInbound},set_isPendingInbound:function(n){return this._isPendingInbound!==n&&(this._isPendingInbound=n,this._onPropertyChanged("IsPendingInbound")),n},get_supportsAppearOfflineTo:function(){return!this._network.get__isRemoteNetwork()&&this._linkedContact.get__isContact()},get_isFederated:function(){switch(this._addressInfo.type){case t.windowsLive:case t.cid:return!1;default:return!0}},get_canSendInvite:function(){return y.isSkypeInvitesEnabled()&&this.get_type()===i.shortCircuit?!0:!1},get_isIdentityVerified:function(){return this.get__serviceDataSet().peServiceData.get_isIdentityVerified()},get_isContact:function(){return(this._addressInfo.roleLists&o.forward)!=0},get_isAllowed:function(){return(this._addressInfo.roleLists&o.allow)!=0},get_isBlocked:function(){return(this._addressInfo.roleLists&o.block)!=0},get_isAppearOfflineTo:function(){return this.get__user().get_presence().get_status()===e.appearOffline?!0:r.Contact._isAppearOfflineRoleLists(this._addressInfo.roleLists)},get_supportsReportAbuse:function(){return this.get_type()===i.windowsLive||this.get_type()===i.skype||this.get_type()===i.shortCircuit?!0:!1},get_isGroupChatCapable:function(){return this.get_type()===i.skype&&u.GroupChatFeatures.phase!=u.GroupChatPhase.disabled?!0:!1},get_isAudioVideoCapable:function(){return!a.SkyJSHelper.skypeEnabled||!a.SkyJSHelper.skypeAudioVideoEnabled?!1:this.get_type()===i.shortCircuit?!0:this.get_presence().get_status()!==e.offline&&this.get_presence().get_status()!==e.appearOffline&&(this.get_type()===i.skype||this._serviceData!=null&&this._serviceData.skpServiceData!=null&&!f.isNullOrEmpty(this._serviceData.skpServiceData.get_item(u.SKPServiceDataProperties.skypeName)))?!0:!1},get_networkIconUrl:function(){return this.get_network().get_iconUrl()},get_contact:function(){return this._linkedContact==null?null:this._linkedContact.get__contact()},get_rank:function(){var i=this.get_type(),n=100;switch(i){case t.skype:n=1;break;case t.windowsLive:n=2;break;case t.connect:this.get_network().get_isFacebook()?n=3:this.get_network().get_isGoogle()&&(n=4);break;case t.shortCircuit:n=5;break;case t.telephone:n=6;break;case t.officeCommunicator:n=7;break;default:n=100}return this.get_isOnline()||(n+=10),n},get_isUser:function(){return this._user.get_address()===this||this._user.get_skypeAddress()!=null&&this._user.get_skypeAddress().get_address()===this.get_address()||this._user.get_shortCircuitAddress()===this},get__user:function(){return this._user},get__messagingAddress:function(){return this._messagingAddress},get__isMobile:function(){switch(this._addressInfo.type){case t.smtp:case t.telephone:return!0;default:return!1}},get_isFacebookMobileEnabled:function(){return this._addressInfo.isFacebookMobileEnabled},get_isAnonymous:function(){return this._addressInfo.address.endsWith("@anonymous.messenger.live.com")},get__isActive:function(){if(this._presence==null)return!1;switch(this.get_presence().get_status()){case e.online:case e.busy:case e.inACall:return!0}return!1},_isLocalEndpoint:function(n){return this._user.get_localEndpoint()===n},get__info:function(){return this._addressInfo},get__serviceDataSet:function(){return this._serviceData==null&&(this._serviceData=u.ServiceDataSet.create()),this._serviceData},get__addressKey:function(){return h.ContactHelper.getIMAddressInfoKey(this._addressInfo)},get__chatKey:function(){return h.ContactHelper.getIMAddressInfoKey(this.get__info())},equals:function(n){return n==null?!1:h.ContactHelper.areIMAddressesEqual(this._addressInfo,n._addressInfo)},_equalsByAddressAndType:function(n,t){return this._addressInfo.address===n&&this.get_type()===t},_setLinkedContact:function(n){this._linkedContact=n},_onUserAppearOfflineStatusChanged:function(){this._onPropertyChanged("IsAppearOfflineTo")},_setRoleListChanges:function(n,t){if(this._addressInfo.roleLists=n,t!==o.none){(t&o.forward)!=0&&this._onPropertyChanged("IsContact"),(t&o.allow)!=0&&this._onPropertyChanged("IsAllowed"),(t&o.block)!=0&&this._onPropertyChanged("IsBlocked");var i=this._user.get_address()!=null&&this._user.get_presence().get_status()===e.appearOffline,u=r.Contact._isAppearOfflineRoleLists(n^t),f=r.Contact._isAppearOfflineRoleLists(n);i||(u^f)!=1||this._onPropertyChanged("IsAppearOfflineTo")}},_onServiceDataChanged:function(n){for(var i=!1,r=!1,u=!1,o=this.get__serviceDataSet().updateAll(n),e=f.IEnumerator.getEnumerator(o),t;e.moveNext();)if(t=e.get_current(),f.getKeyCount(t.deletedEndpoints)>0||f.getKeyCount(t.newEndpoints)>0||f.getKeyCount(t.updatedEndpoints)>0||t.updatedProperties.length>0){i=(i|this.get_capabilities()._onServiceDataChanged(t))==1,r=(r|this.get_endpoints()._onServiceDataChanged(t))==1,u=(u|this.get_presence()._onServiceDataChanged(t))==1;switch(t.service){case c.IM:this._setChangesIM(t);break;case c.PE:this._setChangesPE(t)}}i&&this._onPropertyChanged("Capabilities"),r&&this._onPropertyChanged("Endpoints"),u&&this._onPropertyChanged("Presence")},_onServiceDataDeleted:function(n){for(var i=!1,r=!1,u=!1,o=this.get__serviceDataSet().deleteAll(n),e=f.IEnumerator.getEnumerator(o),t;e.moveNext();){t=e.get_current(),i=(i|this.get_capabilities()._onServiceDataChanged(t))==1,r=(r|this.get_endpoints()._onServiceDataDeleted(t))==1,u=(u|this.get_presence()._onServiceDataChanged(t))==1;switch(t.service){case c.IM:this._setChangesIM(t);break;case c.PE:this._setChangesPE(t)}}i&&this._onPropertyChanged("Capabilities"),r&&this._onPropertyChanged("Endpoints"),u&&this._onPropertyChanged("Presence")},_onPropertyChanged:function(t){n(this).triggerHandler("propertyChanged",[this,new r.PropertyChangedEventArgs(t)]),this._updateMessagingAddress()},_updateMessagingAddress:function(){this._messagingAddress!=null&&this._messagingAddress._setProperty(this.get_contact()&&this.get_contact().get_currentAddress()==this,this.get_presence().get_status(),this.get_isAudioVideoCapable(),!0,this.get_isGroupChatCapable())},_setChangesIM:function(n){var t=n.updatedProperties;t.contains(v.status)&&this.get_contact()._onIMAddressStatusChanged(),t.contains(v.isOnline)&&(this._onPropertyChanged("IsOnline"),this.get_contact()._onIMAddressIsOnlineChanged())},_setChangesPE:function(n){n.updatedProperties.contains(u.PEServiceDataProperties.isIdentityVerified)&&(this._onPropertyChanged("IsIdentityVerified"),this.get_contact()._onIMAddressIdentityVerifiedChanged())},_checkNetwork:function(){switch(this._addressInfo.type){case t.connect:return this._user.get_networks().get_item(this._addressInfo.network);case t.officeCommunicator:return this._user.get_networks()._addOfficeCommunicator(),r.Network.get__officeCommunicator();case t.telephone:return this._user.get_networks()._addTelephone(),r.Network.get_telephone();case t.skype:case t.shortCircuit:case t.temporaryGroup:return this._user.get_networks()._addSkype(),r.Network.get__skype();default:return r.Network.get__windowsLive()}}}}(window.originaljQuery||jQuery),function(n){var l="comments",h=window,u=h.MC,i=h.Microsoft.Live.Messenger,c=h.MSH,f=h.ss,a=u.IMServiceDataProperties,e=u.PEServiceDataProperties,v=u.SKPServiceDataProperties,o=u.ServiceType,r=u.PresenceInfoStatus,t=i.PresenceStatus,s=i.IMAddressPresence=function(n){this._address=n,this._serviceData=n.get__serviceDataSet(),this._properties=new i.PresencePropertyCollection([this._serviceData.imServiceData,this._serviceData.peServiceData,this._serviceData.cmServiceData,this._serviceData.skpServiceData],new Array(0))};s.isDisplayNameValid=function(n){if(n==null)return!1;var t=129;return n.length>t?!1:n.indexOf("&#")>=0?!1:!0},s.isPersonalMessageValid=function(n){return n==null?!1:n.length<=512},s._getLocalizedStatusText=function(n,r,u,f){switch(n){case t.appearOffline:return i._localization.statusAppearOffline;case t.offline:var e;return e=r===i.IMAddressType.connect&&u&&!f?"On Facebook Mobile":i._localization.statusOffline;case t.away:case t.idle:case t.beRightBack:case t.outToLunch:return i._localization.statusAway;case t.busy:case t.inACall:return i._localization.statusBusy;case t.online:return i._localization.statusOnline;default:return""}},s.prototype={_address:null,_properties:null,_serviceData:null,_displayPictureUrl:null,get_imAddress:function(){return this._address},get_properties:function(){return this._properties},get_displayName:function(){return this._serviceData.peServiceData.get_displayName()},get_displayPictureUrl:function(){return f.isNullOrEmpty(this._displayPictureUrl)&&(this._setDisplayPictureUrl(),f.isNullOrEmpty(this._displayPictureUrl))?null:this._displayPictureUrl},get_personalMessage:function(){return f.isNullOrEmpty(this._serviceData.peServiceData.get_richUserMessage())?this._serviceData.peServiceData.get_personalMessage():this._serviceData.peServiceData.get_richUserMessage()},set_personalMessage:function(n){if(this._ensureCanUpdate(),n==null)throw i._exceptionHelper.createArgumentNullException("value");if(n=n.trim(),!i.IMAddressPresence.isPersonalMessageValid(n))throw i._exceptionHelper.createArgumentException(i._exceptions.personalMessageInvalid,"value");if(this.get_personalMessage()!==n){var r=129,t=u.ServiceData.createEmpty(o.PE);t.set_personalMessage(n.substr(0,r)),t.set_richUserMessage(n),t.set_richLinkType(u.RichPsmLinkType.simpleText),t.set_richUrl(null),t.set_safeUrl(null),this._address.get__user()._updateServiceData(t)}return n},get_status:function(){switch(this._serviceData.imServiceData.get_status()){case r.appearOffline:return t.appearOffline;case r.away:return t.away;case r.beRightBack:return t.beRightBack;case r.busy:return t.busy;case r.idle:return t.idle;case r.inACall:return t.inACall;case r.online:return t.online;case r.outToLunch:return t.outToLunch;case r.none:case r.offline:return t.offline;default:return t.offline}},set_status:function(n){var f,e,s;this._ensureCanUpdateStatus(),f=r.none;switch(n){case t.appearOffline:f=r.appearOffline;break;case t.away:f=r.away;break;case t.beRightBack:f=r.beRightBack;break;case t.busy:f=r.busy;break;case t.idle:f=r.idle;break;case t.inACall:f=r.inACall;break;case t.online:f=r.online;break;case t.outToLunch:f=r.outToLunch;break;case t.offline:f=r.none}if(f===r.none)throw i._exceptionHelper.createArgumentOutOfRangeException("Status");return this._serviceData.imServiceData.get_status()!==f&&(e=u.ServiceData.createEmpty(o.IM),e.set_status(f),s=this._address.get__user(),s._updateServiceData(e)),n},get_statusText:function(){return s._getLocalizedStatusText(this.get_status(),this.get_imAddress().get_type(),this.get_imAddress().get__info().isFacebookMobileEnabled,this.get_imAddress().get_isUser())},get__currentServiceData:function(){return this._serviceData},createPersonalMessageElement:function(){var n=this.get_personalMessage()||"";return n=n.replace(new RegExp("(\\r?\\n)+","g")," "),i.MessengerUtility._createPersonalMessageElement(n,this._serviceData.peServiceData)},_onServiceDataChanged:function(n){var t=!1;switch(n.service){case o.IM:t=this._setChangesIM(n);break;case o.PE:t=this._setChangesPE(n);break;case o.CM:t=this._setChangesCM(n);break;case o.SKP:t=this._setChangesSKP(n)}return this._properties._onServiceDataChanged(n)&&(t=!0,this._onPropertyChanged("Properties")),t&&this._address.get_contact()!=null&&this._address.get_contact()._setPresenceChanges(this._address),t},_onPropertyChanged:function(t){n(this).triggerHandler("propertyChanged",[this,new i.PropertyChangedEventArgs(t)])},_ensureUser:function(){if(!this._address.get_isUser())throw i._exceptionHelper.createInvalidOperationException(i._exceptions.presenceReadOnly);},_ensureCanUpdate:function(){this._ensureUser(),this._ensureServices(),this._address.get__user()._ensureSignedIn()},_ensureCanUpdateStatus:function(){this._ensureUser(),this._ensureServices(),this._address.get__user()._ensureStatusChangeAllowed()},_ensureServices:function(){this._address.get__user()._ensureServicesRichOperation()},_setDisplayPictureUrl:function(){var n=null,t,e,s,h,r,o;if(this._address.get_type()===i.IMAddressType.connect){this._displayPictureUrl=this._address.get_linkedContact().get_displayPictureUrl();return}if(e=this._address.get_isUser(),s=this._address.get_contact().get_isContact(),(s||e)&&(t=this._serviceData.peServiceData,!f.isNullOrEmpty(t.get_userTileLocation())&&t.get_userTileLocation()!=="1"&&(h=f.parseXml(t.get_userTileLocation()),r=h.documentElement,r!=null&&r.nodeName==="msnobj"&&(o=c.XmlHelper.getAttribute(r,"Url1"),i.MessengerUtility._validateUrl(o))))){this._displayPictureUrl=c.UriHelper.updateDisplayPictureUrl(o);return}if(e&&(t=this._serviceData.peServiceData,f.isNullOrEmpty(t.get_displayPictureUrl())||(n=t.get_displayPictureUrl())),n==null){if(f.isNullOrEmpty(this._address.get_cid())||i._globalConfiguration.get__tryGetInstance()==null)return;n=i._globalConfiguration._getDisplayPictureUrl(this._address.get_cid())}if(n!=null){var v=this._address.get__user(),l=v.get_identity().get__authenticationInfo(),a=l.ticket;if(!f.isNullOrEmpty(a))switch(l.authType){case u.AuthenticationType.rpsAuth:n=c.UriHelper.addParameter(n,"t",a)}this._displayPictureUrl=c.UriHelper.updateDisplayPictureUrl(n)}},_setChangesIM:function(n){for(var i=!1,u=n.updatedProperties.length,r,t=0;t<u;t++){r=n.updatedProperties[t];switch(r){case a.status:i=!0,this._onPropertyChanged("Status")}}return i},_setChangesSKP:function(n){for(var i=!1,u=n.updatedProperties.length,r,t=0;t<u;t++){r=n.updatedProperties[t];switch(r){case v.skypeName:i=!0}}return i},_setChangesPE:function(n){for(var t=!1,r=!1,f=n.updatedProperties.length,u,i=0;i<f;i++){u=n.updatedProperties[i];switch(u){case e.displayName:t=!0,this._onPropertyChanged("DisplayName");break;case e.personalMessage:case e.richLinkType:case e.richUrl:case e.richUserMessage:case e.safeUrl:r||(r=!0,t=!0,this._onPropertyChanged("PersonalMessage"));break;case e.displayPictureUrl:case e.userTileLocation:this._displayPictureUrl=null,t=!0,this._onPropertyChanged("DisplayPictureUrl")}}return t},_setChangesCM:function(n){for(var i=!1,u=n.updatedProperties.length,r,t=0;t<u;t++){r=n.updatedProperties[t];switch(r){case l:i=!0}}return i}}}(window.originaljQuery||jQuery),function(){var t=window,n=t.Microsoft.Live.Messenger;n.AddressChangingEventArgs=function(n,t){this._oldAddress$1=n,this._newAddress$1=t},n.AddressChangingEventArgs.prototype={_oldAddress$1:null,_newAddress$1:null,get_oldAddress:function(){return this._oldAddress$1},get_newAddress:function(){return this._newAddress$1}}}(),function(){var t=window,n=t.Microsoft.Live.Messenger;n.EndpointId=function(n){this._id=n},n.EndpointId.prototype={_id:null,equals:function(n){return n!=null&&this._id===n._id},toString:function(){return this._id||""}}}(),function(n){var o="events",u=window,i=u.MC,t=u.Microsoft.Live.Messenger,f=u.ss,r=i.ServiceType,e=t.Endpoint=function(n,i){this._address=n,this._serviceData=i,this._capabilities=new t._endpointCapabilities(this._address,this),this._presence=new t.EndpointPresence(this)};e.isNameValid=function(n){return n==null?!1:n.trim().length<=t._globalConfiguration.get__maxEndpointNameLength()},e.prototype={_address:null,_capabilities:null,_presence:null,_serviceData:null,_id:null,get_id:function(){return this._id==null&&(this._id=new t.EndpointId(this._serviceData.id)),this._id},get_name:function(){return this._serviceData.pdEndpointData.get_name()||""},set_name:function(n){var i,u;if(!this.get__isLocal())throw t._exceptionHelper.createInvalidOperationException(t._exceptions.endpointNotLocal);if(n==null)throw t._exceptionHelper.createArgumentNullException("value");if(i=n.trim(),!e.isNameValid(i))throw t._exceptionHelper.createArgumentException(t._exceptions.endpointNameInvalid,"value");return this._address.get__user()._ensureStatusChangeAllowed(),this._serviceData.pdEndpointData.get_name()!==i&&(u=this._createServiceData(r.PD),u.getEndpointData(this._serviceData.id).set_name(i),this._address.get__user()._updateServiceData(u)),n},get_imAddress:function(){return this._address},get_capabilities:function(){return this._capabilities},get_presence:function(){return this._presence},get_isInstance:function(){if(!this._address.get_isUser())return!1;if(this.get__isLocal())return!0;var n=this._address.get__user().get_localEndpoint();return this._serviceData.imEndpointData==null||n._serviceData.imEndpointData==null?!1:this._serviceData.imEndpointData.get_domain()!==""&&this._serviceData.imEndpointData.get_domain()===n._serviceData.imEndpointData.get_domain()},get__isLocal:function(){return this._address._isLocalEndpoint(this)},get__serviceEndpointDataSet:function(){return this._serviceData},get__isEndpointDataSetEmpty:function(){return f.getKeyCount(this._serviceData.imEndpointData.get_properties())===0&&f.getKeyCount(this._serviceData.pdEndpointData.get_properties())===0},get__isIMEndpoint:function(){return f.getKeyCount(this._serviceData.imEndpointData.get_properties())>0},equals:function(n){return n==null?!1:this._serviceData.id===n._serviceData.id},_onServiceDataChanged:function(n){var t=!1;switch(n.service){case r.IM:t=this._setChangesIM(n);break;case r.PD:t=this._setChangesPD(n);break;case r.CM:t=this._setChangesCM(n)}return this._capabilities._onServiceDataChanged(n)&&(t=!0,this._onPropertyChanged("Capabilities")),this._presence._onServiceDataChanged(n)&&(t=!0,this._onPropertyChanged("Presence")),t},_onEndpointSetChanged:function(n,t){return(this._serviceData=this._address.get__serviceDataSet().getEndpointSet(this.get_id().toString()),n)?(this._presence._reloadServiceData(this._serviceData),this._presence.get_properties()._onEndpointServiceDataChanged(t,this._id.toString())):!1},_createServiceData:function(n){var r=i.ServiceEndpointData.createEmpty(n,this._serviceData.id),t=i.ServiceData.createEmpty(n);return t.addEndpoint(r),t},_onPropertyChanged:function(i){n(this).triggerHandler("propertyChanged",[this,new t.PropertyChangedEventArgs(i)])},_setChangesIM:function(){return!1},_setChangesPD:function(n){var t=n.updatedEndpoints[this._serviceData.id];return t.contains(i.PDServiceEndpointDataProperties.epName)?(this._onPropertyChanged("Name"),!0):!1},_setChangesCM:function(n){var t=n.updatedEndpoints[this._serviceData.id];return t.contains(o)}}}(window.originaljQuery||jQuery),function(n){var f=window,e=f.MC,t=f.Microsoft.Live.Messenger,o=f.MSH,s=f.ss,i=e.CapabilitiesFlags,r=e.IMAddressInfoType,u=t.IMAddressType;t.Capabilities=function(n){this._address=n},t.Capabilities.prototype={_address:null,_version:null,get__sipTunnelVersion2:null,set__sipTunnelVersion2:null,_getVersion:null,get__supportsMultipartyConversationsInternal:null,get__supportsTunneledSip:null,get_version:function(){return this._version==null&&(this._version=this._getVersion()),this._version},get_supportsMultipartyConversations:function(){return this._address.get__info().type===r.cid?!1:this.get__supportsMultipartyConversationsInternal()},get_supportsOfflineMessages:function(){switch(this._address.get__info().type){case r.windowsLive:case r.skype:case r.telephone:case r.smtp:case r.connect:case r.shortCircuit:return!0;default:return!1}},get__supportsTypingIndicators:function(){switch(this._address.get__info().type){case r.telephone:case r.smtp:return!1;default:return!0}},get_address:function(){return this._address},supportsMessageType:function(n){var i=this._address.get_type();switch(i){case u.windowsLive:switch(n){case t.MessageType.textMessage:case t.MessageType.callEventMessage:return!0}break;case u.skype:switch(n){case t.MessageType.textMessage:case t.MessageType.callEventMessage:return!0}break;case u.officeCommunicator:case u.telephone:case u.smtp:case u.connect:switch(n){case t.MessageType.textMessage:return!0}}return!1},_clearVersion:function(){this._version=null},_getVersionFromString:function(n){var r,i,u,f;if(s.isNullOrEmpty(n)||(r=n.split("."),r.length<2||r.length>4))return null;for(i=new Array(r.length),u=0;u<i.length;u++){if(f=o.ConvertHelper.tryParseInt(r[u]),f<0)return null;i[u]=f}switch(i.length){case 2:return new t.Version(i[0],i[1],0,0);case 3:return new t.Version(i[0],i[1],i[2],0)}return new t.Version(i[0],i[1],i[2],i[3])},_getVersionFromFlags:function(n){var u=0,f=0,r;if(n!==i.none){r=28;switch(n>>>r){case i.appVersion60>>>r:u=6;break;case i.appVersion61>>>r:u=6,f=1;break;case i.appVersion62>>>r:u=6,f=2;break;case i.appVersion70>>>r:u=7;break;case i.appVersion75>>>r:u=7,f=5;break;case i.appVersion80>>>r:u=8;break;case i.appVersion81>>>r:u=8,f=1;break;case i.appVersion85>>>r:u=8,f=5;break;case i.appVersion90>>>r:u=9;break;case i.appVersion2009>>>r:u=14}}return new t.Version(u,f,0,0)},_onPropertyChanged:function(i){n(this).triggerHandler("propertyChanged",[this,new t.PropertyChangedEventArgs(i)])}}}(window.originaljQuery||jQuery),function(){var u=window,i=u.MC,f=u.Microsoft.Live.Messenger,o=u.MSH,s=u.ss,t=i.CapabilitiesFlags,e=i.ServiceType,r=i.IMServiceEndpointDataProperties,h=f.Capabilities,c=f._endpointCapabilities=function(n,t){h.call(this,n),this._endpoint$1=t,this._imEndpointData$1=this._endpoint$1.get__serviceEndpointDataSet().imEndpointData,this._peEndpointData$1=this._endpoint$1.get__serviceEndpointDataSet().peEndpointData},n=c.prototype=new h;n.constructor=c,n._endpoint$1=null,n._imEndpointData$1=null,n._peEndpointData$1=null,n._imCapabilitiesToUpdate$1=null,n.get_isOnlineViaMobileDevice=function(){return this._imEndpointData$1.get_isOnlineViaMobileDevice()},n.get_isOnlineViaWeb=function(){return this._imEndpointData$1.get_isOnlineViaWeb()},n.get_videoCallSupports16By9AspectRatio=function(){return this._imEndpointData$1.get_videoCallSupports16By9AspectRatio()},n.set_videoCallSupports16By9AspectRatio=function(n){if(!this._endpoint$1.get__isLocal())throw f._exceptionHelper.createInvalidOperationException(f._exceptions.objectNotBelongToUser);return n?this._addIMCapability$1(1,t.videoCallSupports16By9AspectRatio):this._removeIMCapability$1(1,t.videoCallSupports16By9AspectRatio),n},n.get__supportsMultipartyConversationsInternal=function(){return this._imEndpointData$1.get_supportsMultipartyConversations()},n.get__supportsTunneledSip=function(){return this._imEndpointData$1.get_supportsTunneledSip()},n.set__supportsTunneledSip=function(n){return n?this._addIMCapability$1(0,t.supportsTunneledSip):this._removeIMCapability$1(0,t.supportsTunneledSip),n},n.get__rtcVideoEnabled=function(){return this._imEndpointData$1.get_rtcVideoEnabled()},n.set__rtcVideoEnabled=function(n){return n?this._addIMCapability$1(1,t.rtcVideoEnabled):this._removeIMCapability$1(1,t.rtcVideoEnabled),n},n.get__sipTunnelVersion2=function(){return this._imEndpointData$1.get_sipTunnelVersion2()},n.set__sipTunnelVersion2=function(n){return n?this._addIMCapability$1(1,t.sipTunnelVersion2):this._removeIMCapability$1(1,t.sipTunnelVersion2),n},n.get__fTurnCapable=function(){return this._imEndpointData$1.get_fTurnCapable()},n.set__fTurnCapable=function(n){return n?this._addIMCapability$1(1,t.fTurnCapable):this._removeIMCapability$1(1,t.fTurnCapable),n},n._onServiceDataChanged=function(n){var t=!1;switch(n.service){case e.IM:t=this._setChangesIM$1(n);break;case e.PE:t=this._setChangesPE$1(n)}return t},n._getVersion=function(){var n=this._getVersionFromString(this._peEndpointData$1.get_clientVersion());return n==null&&(n=this._getVersionFromFlags(this._imEndpointData$1.get_version())),n},n._addIMCapability$1=function(n,t){var i=this._imCapabilitiesToUpdate$1||this._imEndpointData$1.get_capabilities();(i[n]&t)!==t&&(i[n]|=t,this._imCapabilitiesToUpdate$1==null&&(this._imCapabilitiesToUpdate$1=i,o.Scheduler.defer(s.Delegate.create(this,this._updateIMCapabilities$1))))},n._removeIMCapability$1=function(n,t){var i=this._imCapabilitiesToUpdate$1||this._imEndpointData$1.get_capabilities();(i[n]&t)!=0&&(i[n]&=~t,this._imCapabilitiesToUpdate$1==null&&(this._imCapabilitiesToUpdate$1=i,o.Scheduler.defer(s.Delegate.create(this,this._updateIMCapabilities$1))))},n._updateIMCapabilities$1=function(){var n=i.ServiceData.createEmpty(e.IM),t=i.ServiceEndpointData.createEmpty(e.IM,this._imEndpointData$1.get_endpointId());n.addEndpoint(t),t.set_capabilities(this._imCapabilitiesToUpdate$1),this._imCapabilitiesToUpdate$1=null,this._endpoint$1.get_imAddress().get__user()._updateServiceData(n)},n._setChangesIM$1=function(n){for(var t=!1,u=n.updatedProperties,e=u.length,f,i=0;i<e;i++){f=u[i];switch(f){case r.isOnlineViaMobileDevice:t=!0,this._onPropertyChanged("IsOnlineViaMobileDevice");break;case r.isOnlineViaWeb:t=!0,this._onPropertyChanged("IsOnlineViaWeb");break;case r.videoCallSupports16By9AspectRatio:t=!0,this._onPropertyChanged("VideoCallSupports16By9AspectRatio");break;case r.supportsMultipartyConversations:t=!0,this._onPropertyChanged("SupportsMultipartyConversations");break;case r.version:t=!0,this._clearVersion(),this._onPropertyChanged("Version")}}return t},n._setChangesPE$1=function(n){for(var r=!1,u=n.updatedProperties,e=u.length,f,t=0;t<e;t++){f=u[t];switch(f){case i.PEServiceEndpointDataProperties.clientVersion:r=!0,this._clearVersion(),this._onPropertyChanged("Version")}}return r}}(),function(){var i=window,r=i.MC,u=i.Microsoft.Live.Messenger,t=r.IMServiceDataProperties,f=u.Capabilities,e=u._imAddressCapabilities=function(n){f.call(this,n),this._serviceData$1=n.get__serviceDataSet().imServiceData},n=e.prototype=new f;n.constructor=e,n._serviceData$1=null,n.get_isOnlineViaMobileDevice=function(){return this._serviceData$1.get_isOnlineViaMobileDevice()},n.get_isOnlineViaWeb=function(){return this._serviceData$1.get_isOnlineViaWeb()},n.get_videoCallSupports16By9AspectRatio=function(){return this._serviceData$1.get_videoCallSupports16By9AspectRatio()},n.get__supportsMultipartyConversationsInternal=function(){return this._serviceData$1.get_supportsMultipartyConversations()},n.get__supportsTunneledSip=function(){return this._serviceData$1.get_supportsTunneledSip()},n.get__sipTunnelVersion2=function(){return this._serviceData$1.get_sipTunnelVersion2()},n.get__fTurnCapable=function(){return this._serviceData$1.get_fTurnCapable()},n._onServiceDataChanged=function(n){var u,e;if(n.service!==r.ServiceType.IM)return!1;var i=!1,f=n.updatedProperties,o=f.length;for(u=0;u<o;u++){e=f[u];switch(e){case t.isOnlineViaMobileDevice:i=!0,this._onPropertyChanged("IsOnlineViaMobileDevice");break;case t.isOnlineViaWeb:i=!0,this._onPropertyChanged("IsOnlineViaWeb");break;case t.videoCallSupports16By9AspectRatio:i=!0,this._onPropertyChanged("VideoCallSupports16By9AspectRatio");break;case t.supportsMultipartyConversations:i=!0,this._onPropertyChanged("SupportsMultipartyConversations");break;case t.version:i=!0,this._clearVersion(),this._onPropertyChanged("Version")}}return i},n._getVersion=function(){return this._getVersionFromFlags(this._serviceData$1.get_version())}}(),function(){var i=window,u=i.MC,t=i.Microsoft.Live.Messenger,f=t.Collection,r=i.ss,e=t.EndpointCollection=function(n){f.call(this),this._address$1=n,this._hiddenEndpoints$1=[],this._allEndpoints$1=[]},n=e.prototype=new f;n.constructor=e,n._address$1=null,n._hiddenEndpoints$1=null,n._allEndpoints$1=null,n.get__allEndpoints=function(){return this._allEndpoints$1},n._onServiceDataChanged=function(n){var i=!1,s=n.updatedEndpoints,f,o;for(f in s){var h={key:f,value:s[f]},e=h.key,u=this._findEndpoint$1(e);u!=null?(o=r.keyExists(n.newEndpoints,e),i=(i|u._onEndpointSetChanged(o,n))==1,o||(i=(i|u._onServiceDataChanged(n))==1),i=(i|this._hideOrUnhideEndpoint$1(u))==1):(u=new t.Endpoint(this._address$1,this._address$1.get__serviceDataSet().getEndpointSet(e)),i=(i|this._addEndpoint$1(u))==1)}return i},n._onServiceDataDeleted=function(n){var t=!1,u=n.deletedEndpoints,r;for(r in u){var f={key:r,value:u[r]},e=f.key,i=this._findEndpoint$1(e);i!=null&&(i._onEndpointSetChanged(!1,n),i.get__isEndpointDataSetEmpty()?t=(t|this._removeEndpoint$1(i))==1:(t=(t|i._onServiceDataChanged(n))==1,t=(t|this._hideOrUnhideEndpoint$1(i))==1))}return t},n._clearAllExceptLocal=function(){for(var f=u.ServiceDataSet.create(),e=r.IEnumerator.getEnumerator(this._allEndpoints$1),t,i,n;e.moveNext();)if(t=e.get_current(),!t.get__isLocal())for(i=t.get__serviceEndpointDataSet().toServiceDataArray(),n=0;n<i.length;n++)f.addEndpoint(i[n]);this._address$1.get__user()._onServiceDataDeleted(this._address$1.get__info(),f.toArray())},n._clearAll=function(){for(var i=u.ServiceDataSet.create(),f=r.IEnumerator.getEnumerator(this._allEndpoints$1),e,t,n;f.moveNext();)for(e=f.get_current(),t=e.get__serviceEndpointDataSet().toServiceDataArray(),n=0;n<t.length;n++)i.addEndpoint(t[n]);this._address$1._onServiceDataDeleted(i.toArray())},n._findEndpoint$1=function(n){for(var i,t=0;t<this._allEndpoints$1.length;t++)if(i=this._allEndpoints$1[t],i.get__serviceEndpointDataSet().id===n)return i;return null},n._endpointShouldBeHidden$1=function(n){return n.get__isIMEndpoint()?this._allEndpoints$1.length===0||this._allEndpoints$1.length===1&&n===this._allEndpoints$1[0]?!1:!n.get__isLocal()&&n.get_isInstance():!0},n._hideOrUnhideEndpoint$1=function(n){var t=this._endpointShouldBeHidden$1(n);if(this._hiddenEndpoints$1.contains(n)){if(!t)return this._hiddenEndpoints$1.remove(n),this._addInternal(n),!0}else if(t)return this._removeInternal(n),this._hiddenEndpoints$1.push(n),!0;return!1},n._addEndpoint$1=function(n){var t;return this._endpointShouldBeHidden$1(n)?(this._hiddenEndpoints$1.push(n),t=!1):(this._addInternal(n),t=!0),this._allEndpoints$1.push(n),t},n._removeEndpoint$1=function(n){return this._allEndpoints$1.remove(n),this._hiddenEndpoints$1.contains(n)?(this._hiddenEndpoints$1.remove(n),!1):(this._removeInternal(n),!0)},n.get_item=function(n){if(n<0||n>=this.get_count())throw t._exceptionHelper.createArgumentOutOfRangeException("index");return this.get__items()[n]}}(),function(n){var i=window,t=i.Microsoft.Live.Messenger;t.EndpointPresence=function(n){this._endpoint=n;var i=this._endpoint.get__serviceEndpointDataSet();this._properties=new t.PresencePropertyCollection(new Array(0),[i.imEndpointData,i.pdEndpointData,i.peEndpointData,i.cmEndpointData,i.skpEndpointData])},t.EndpointPresence.prototype={_endpoint:null,_properties:null,get_properties:function(){return this._properties},_onServiceDataChanged:function(n){var t=!1;return this._properties._onEndpointServiceDataChanged(n,this._endpoint.get_id().toString())&&(t=!0,this._onPropertyChanged("Properties")),t},_reloadServiceData:function(n){this._properties._loadServiceData(new Array(0),[n.imEndpointData,n.pdEndpointData,n.peEndpointData,n.cmEndpointData])},_onPropertyChanged:function(i){n(this).triggerHandler("propertyChanged",[this,new t.PropertyChangedEventArgs(i)])}}}(window.originaljQuery||jQuery),function(){var t=window,i=t.MC,n=t.Microsoft.Live.Messenger,e=t.ss,u=i.MessageInfoType,f=n.InviteMessageType,r=n.Message=function(n){this._messageType=n,this._timestamp=new Date,this._reloaded=!1};r._fromMessageInfo=function(t,i,r,f){var e,o,s;switch(r.type){case u.textMessage:o=r.info,s=new n.TextMessage(o.text,n.TextMessageFormat._fromFormatInfo(o.format)),s.set__safeUrl(o.safeUrl),e=s;break;case u.threadActivityMessage:e=new n.ThreadActivityMessage(t,r.info);break;default:return null}return e._sender=i,e._timestamp=new Date(r.timestamp.utcMilliseconds),e._isOfflineMessage=r.isOfflineMessage,e._isHistoryMessage=r.isHistoryMessage,e._isLastHistoryMessage=r.isLastHistoryMessage,e._id=r.id,e._networkId=f.get_network().get_id(),e._networkName=f.get_network().get_name(),e._conversationId=f.get_id(),e},r._findSenderEndpoint=function(n,t){for(var r=e.IEnumerator.getEnumerator(n.get_endpoints()),i;r.moveNext();)if(i=r.get_current(),i.get_id().toString()===t)return i;return null},r.prototype={_messageType:n.MessageType.textMessage,_sender:null,_timestamp:null,_isOfflineMessage:!1,_isHistoryMessage:!1,_isLastHistoryMessage:!1,_reloaded:!1,_networkName:null,_id:null,_clientId:null,_networkId:null,_conversationId:null,_isInviteMessage:!1,_inviteMessageType:f.historyInvite,get_sender:function(){return this._sender},set_sender:function(n){return this._sender=n,n},get_type:function(){return this._messageType},get_timestamp:function(){return this._timestamp},set_timestamp:function(n){return this._timestamp=n,n},get_reloaded:function(){return this._isHistoryMessage?!0:this._isInviteMessage?this._inviteMessageType===f.historyInvite:this._reloaded},get_isOfflineMessage:function(){return this._isOfflineMessage},get_isHistoryMessage:function(){return this._isHistoryMessage},get_isLastHistoryMessage:function(){return this._isLastHistoryMessage},get_inviteMessage:function(){return this._isInviteMessage},set_inviteMessage:function(n){return this._isInviteMessage=n,n},get_inviteMessageType:function(){return this._inviteMessageType},set_inviteMessageType:function(n){return this._inviteMessageType=n,n},get_networkName:function(){return this._networkName},set_networkName:function(n){return this._networkName=n,n},get_receivedMessageId:function(){return this._id},set_receivedMessageId:function(n){return this._id=n,n},get_clientMessageId:function(){return this._clientId},set_clientMessageId:function(n){return this._clientId=n,n},get_networkId:function(){return this._networkId},set_networkId:function(n){return this._networkId=n,n},get_conversationId:function(){return this._conversationId},set_conversationId:function(n){return this._conversationId=n,n},get__supportsOffline:function(){return!1},_setReloaded:function(n){this._reloaded=n},_buildMessageInfo:function(n){this._sender=n;var r=new i.MessageInfo(this._messageType,null);return r.sender=this._sender.get__info(),r.timestamp=new i.DateInfo(this._timestamp),r.isOfflineMessage=this._isOfflineMessage,r.isHistoryMessage=this._isHistoryMessage,r}}}(),function(){var r=window,i=r.MC,t=r.Microsoft.Live.Messenger,u=t.Message,f=t.CallEventMessage=function(n){if(u.call(this,t.MessageType.callEventMessage),!(n>=0))throw t._exceptionHelper.createArgumentOutOfRangeException("duration");this._duration$1=n},n=f.prototype=new u;n.constructor=f,n._duration$1=0,n.get_duration=function(){return this._duration$1},n.get__supportsOffline=function(){return!1},n._buildMessageInfo=function(n){this.set_sender(n);var r=new i.CallEventMessageInfo(this._duration$1),t=new i.MessageInfo(i.MessageInfoType.callEventMessage,r);return t.sender=n.get__info(),t.isOfflineMessage=this.get_isOfflineMessage(),t}}(),function(){var u=window,t=u.Microsoft.Live.Messenger,i=t.Message,r=t.ThreadActivityMessage=function(n,r){i.call(this,t.MessageType.threadActivityMessage),this._user$1=n,this._info$1=r},n=r.prototype=new i;n.constructor=r,n._user$1=null,n._info$1=null,n.get_activityType=function(){return this._info$1.type},n.get_initiator=function(){return this._user$1._findOrCreateAddress(this._info$1.initiator)},n.get_targets=function(){var t,n;if(this._info$1.targets!=null){for(t=new Array(this._info$1.targets.length),n=0;n<t.length;n++)t[n]=this._user$1._findOrCreateAddress(this._info$1.targets[n]);return t}return null},n.get_otherInfo=function(){return this._info$1.otherInfo}}(),function(){var i=window,n=i.Microsoft.Live.Messenger,t=n.TextMessageColor=function(){};t.fromRgb=function(i,r,u){if(i<0||i>255)throw n._exceptionHelper.createArgumentOutOfRangeException("r");if(r<0||r>255)throw n._exceptionHelper.createArgumentOutOfRangeException("g");if(u<0||u>255)throw n._exceptionHelper.createArgumentOutOfRangeException("b");var f=new t;return f._r=i,f._g=r,f._b=u,f},t.prototype={_r:0,_g:0,_b:0,get_r:function(){return this._r},get_g:function(){return this._g},get_b:function(){return this._b}}}(),function(){var u=window,f=u.ss,e=u.MC,t=u.Microsoft.Live.Messenger,n=t._textMessageStyle=function(){},i,r;n.regular=0,n.bold=1,n.italic=2,n.strikeout=4,n.underline=8,i=t._textMessageDirection=function(){},i.leftToRight=0,i.rightToLeft=1,r=t.TextMessageFormat=function(n,r,u,e){if(n==null)throw t._exceptionHelper.createArgumentNullException("fontColor");if(f.isNullOrEmpty(r))throw t._exceptionHelper.createArgumentNullException("fontFamily");this._fontColor=n,this._fontFamily=r,this._fontStyle=u,this._flowDirection=e||i.leftToRight},r.get_defaultFormat=function(){return t.TextMessageFormat._defaultFormat},r._fromFormatInfo=function(n){return n==null?t.TextMessageFormat.get_defaultFormat():new t.TextMessageFormat(t.TextMessageColor.fromRgb(n.fontColor&255,n.fontColor>>>8&255,n.fontColor>>>16&255),f.isNullOrEmpty(n.fontFamily)?t.TextMessageFormat.get_defaultFormat().get_fontFamily():n.fontFamily,n.fontStyle,n.rightToLeft?i.rightToLeft:i.leftToRight)},r.prototype={_fontColor:null,_fontFamily:null,_fontStyle:n.regular,_flowDirection:i.leftToRight,get_fontColor:function(){return this._fontColor},get_fontFamily:function(){return this._fontFamily},get_fontStyle:function(){return this._fontStyle},get_flowDirection:function(){return this._flowDirection},applyToElement:function(r){if(r==null)throw t._exceptionHelper.createArgumentNullException("element");var u=r.style;this.get_fontStyle()!==n.regular&&((this.get_fontStyle()&n.bold)===n.bold&&(u.fontWeight="bold"),(this.get_fontStyle()&n.italic)===n.italic&&(u.fontStyle="italic"),(this.get_fontStyle()&n.underline)===n.underline&&(u.textDecoration="underline"),(this.get_fontStyle()&n.strikeout)===n.strikeout&&(u.textDecoration+=" line-through")),u.fontFamily="'"+this.get_fontFamily()+"'",u.color="rgb("+this.get_fontColor().get_r()+","+this.get_fontColor().get_g()+","+this.get_fontColor().get_b()+")",u.direction=this.get_flowDirection()===i.rightToLeft?"rtl":"ltr";try{u.whiteSpace="pre-wrap"}catch(f){}},_toInfo:function(){return new e.TextMessageFormatInfo(this._fontColor.get_b()<<16|this._fontColor.get_g()<<8|this._fontColor.get_r(),this._fontFamily,this._fontStyle,this._flowDirection===i.rightToLeft)}},r._defaultFormat=new r(t.TextMessageColor.fromRgb(0,0,0),t._localization.defaultFontFamily,n.regular,i.leftToRight)}(),function(){function h(n,r){var u,f,e;if(n==null)throw t._exceptionHelper.createArgumentNullException("conversation");if(r==null)throw t._exceptionHelper.createArgumentNullException("textMessage");if(u=0,!n.get_closed())if(n.get__isOffline())u=400;else for(f=s.IEnumerator.getEnumerator(n.get_roster());f.moveNext();)if(e=f.get_current(),!e.get_isUser())switch(e.get_type()){case i.windowsLive:case i.skype:case i.shortCircuit:u=2e3;break;case i.officeCommunicator:case i.connect:u=1e3;break;case i.telephone:u=140;break;case i.smtp:u=600}return u-r.length}var o=Math.pow(2,32),r=window,u=r.MC,t=r.Microsoft.Live.Messenger,s=r.ss,i=t.IMAddressType,e=t.Message,f=t.TextMessage=function(n,i){e.call(this,t.MessageType.textMessage),i==null&&(i=t.TextMessageFormat.get_defaultFormat()),this._text$1=n,this._format$1=i},n;f.isValid=function(n,i){if(n==null)throw t._exceptionHelper.createArgumentNullException("conversation");return n.get_closed()?!1:i!=null&&i.length===0?!1:h(n,i)>=0},n=f.prototype=new e,n.constructor=f,n._text$1=null,n._format$1=null,n._safeUrl$1=null,n.get_format=function(){return this._format$1},n.get_text=function(){return this._text$1},n.createTextElement=function(n,i){var r=t.MessengerUtility._replaceEmoticonsAndUrls(this._text$1,this._safeUrl$1,i);return n||this._format$1.applyToElement(r),r},n.createTextElementNoUrls=function(n,i){var r=t.MessengerUtility.replaceEmoticons(this._text$1,i);return n||this._format$1.applyToElement(r),r},n.get__supportsOffline=function(){return!0},n.get__safeUrl=function(){return this._safeUrl$1},n.set__safeUrl=function(n){return this._safeUrl$1=n,n},n._buildMessageInfo=function(n,i){var f,e,r;if(!i.isTextMessageValid(this.get_text()))throw t._exceptionHelper.createArgumentException(t._exceptions.textMessageInvalid,"message");return this.set_sender(n),f=this._getRandom32$1()+""+this._getRandom32$1(),this.set_clientMessageId(f.substr(0,f.length-1)),e=new u.TextMessageInfo(this._text$1,this._format$1._toInfo()),r=new u.MessageInfo(u.MessageInfoType.textMessage,e),r.sender=n.get__info(),r.isOfflineMessage=this.get_isOfflineMessage(),r.clientId=this.get_clientMessageId(),r},n._getRandom32$1=function(){return Math.abs(+new Date^Math.random()*o)}}(),function(n){var f=window,o=f.MC,i=f.Microsoft.Live.Messenger,l=f.MSH,u=f.ss,r=o.RoleLists,s=o.IMAddressInfoType,e=i.IMAddressType,a=i.PresenceStatus,c=i._iimAddressCollectionOwner,h=i.Contact=function(t,r,f,e){var o,h,l,s,a;for(c.call(this),this._isTempContact=e,this._contactMap=t,this._user=r,this._pwcPerson=f,this._linkedContacts=new i.LinkedContactCollection,this._addresses=new i.IMAddressCollection(this),this._isRemoteOnlyContact=!0,o=0;o<f.getContacts().length;o++)h=new i.LinkedContact(this._contactMap,this,f.getContacts()[o]),this._linkedContacts._addInternal(h),h.get_network().get__isRemoteNetwork()||(this._isRemoteOnlyContact=!1);for(o=0;o<this._linkedContacts.get_count();o++)for(l=this._linkedContacts.get_item(o).get__addresses(),s=0;s<l.get_count();s++)a=l.get_item(s),this._roleLists|=a.get__info().roleLists,this._addresses._addInternal(a);this._addresses._sort(),n(this._addresses).bind("collectionChanged",u.Delegate.create(this,this._addressesCollectionChanged)),this._currentAddress=this._findCurrentAddress(),this._cleanRoleLists(!1),this._displayName="",this._isIdentityVerified=!0,this._setIdentityVerifiedChanges(),this._updateCollections(this._roleLists)},t;h._isAppearOfflineRoleLists=function(n){return(n&r.hide)===r.hide||(n&r.hideCompat)===r.hideCompat},t=h.prototype=new c,t.constructor=h,t._user=null,t._contactMap=null,t._pwcPerson=null,t._linkedContacts=null,t._addresses=null,t._displayName=null,t._currentAddress=null,t._presence=null,t._roleLists=0,t._isTempContact=!1,t._isRemoteOnlyContact=!1,t._isIdentityVerified=!1,t.get_id=function(){return this._linkedContacts.get_item(0).get_id()},t.get_cid=function(){return u.isNullOrEmpty(this._pwcPerson.getCid())?null:this._pwcPerson.getCid().toString()},t.get_skypeName=function(){for(var t=u.IEnumerator.getEnumerator(this._addresses),n;t.moveNext();)if(n=t.get_current(),n.get_type()===e.skype||n.get_type()===e.shortCircuit||n.get_network().get_isWindowsLive()&&!u.isNullOrEmpty(n.get_skypeName()))return n.get_skypeName();return null},t.get_profileUrl=function(){return this._pwcPerson.getProfileUrl()},t.get_isEmailOnlyContact=function(){return this._addresses.get_count()===0},t.get_isIdentityVerified=function(){return this._isIdentityVerified},t.get_isOnline=function(){return this.get_currentAddress()==null?!1:this.get_currentAddress().get_isOnline()},t.get_emailAddress=function(){var n,t;if(this._user.get_identity().get__authenticationInfo().authType!==o.AuthenticationType.rpsAuth)return null;for(n=0;n<this._linkedContacts.get_count();n++)if(t=this._linkedContacts.get_item(n),t.get_emailAddress()!=null)return t.get_emailAddress();return null},t.get_displayName=function(){return u.isNullOrEmpty(this._displayName)?this._pwcPerson.getDisplayNameWithFallback():this._displayName},t.get_firstName=function(){return this._pwcPerson.getFirstName()},t.get_lastName=function(){return this._pwcPerson.getLastName()},t.get_fullName=function(){return this._pwcPerson.getFullName()},t.get_linkedContacts=function(){return this._linkedContacts},t.get_addresses=function(){return this._addresses},t.get_presence=function(){return this._presence==null&&(this._presence=new i.ContactPresence(this)),this._presence},t.get_currentAddress=function(){return this._currentAddress},t.set_currentAddress=function(n){if(n!==this._currentAddress){this._onCurrentAddressChanging(this._currentAddress,n);var t=this._currentAddress;this._currentAddress=n,t&&t._updateMessagingAddress(),this._currentAddress&&this._currentAddress._updateMessagingAddress(),this._onPropertyChanged("CurrentAddress"),this._currentAddress!=null&&this.get_presence()._onPresenceChanged(),this._setIdentityVerifiedChanges()}return n},t.get_shortCircuitAddress=function(){for(var n=0;n<this._addresses.get_count();++n)if(this._addresses.get_item(n).get_type()===e.shortCircuit)return this._addresses.get_item(n);return null},t.get_skypeAddress=function(){for(var n=0;n<this._addresses.get_count();++n)if(this._addresses.get_item(n).get_type()===e.skype)return this._addresses.get_item(n);return null},t.get_windowsLiveAddress=function(){for(var n=0;n<this._addresses.get_count();++n)if(this._addresses.get_item(n).get_network().get_isWindowsLive())return this._addresses.get_item(n);return null},t.get_isContact=function(){return(this._roleLists&r.forward)!=0},t.get_isTemporaryContact=function(){return this._isTempContact},t.get_isFavorite=function(){return this._pwcPerson.getIsFavorite()},t.get_isAllowed=function(){return(this._roleLists&r.allow)!=0},t.get_isAppearOfflineTo=function(){return this._user.get_presence().get_status()===a.appearOffline?!0:this.get_isAppearOfflineToExplicit()},t.get_isAudioVideoCapable=function(){var n,t;if(this.get_cid()!=null&&f.self.location.search.indexOf("avcid="+this.get_cid().toString())>-1)return!0;for(n=u.IEnumerator.getEnumerator(this._addresses);n.moveNext();)if(t=n.get_current(),t.get_isAudioVideoCapable())return!0;return!1},t.get_isAppearOfflineToExplicit=function(){return i.Contact._isAppearOfflineRoleLists(this._roleLists)},t.get_pwcPerson=function(){return this._pwcPerson},t.get__user=function(){return this._user},t.get__isCidContact=function(){return this.get_currentAddress()!=null&&this.get_currentAddress().get__info().type===s.cid},t.get__isRemoteOnlyContact=function(){return this._isRemoteOnlyContact},t.get__isWindowsLiveContact=function(){for(var n=u.IEnumerator.getEnumerator(this._addresses),t;n.moveNext();)if(t=n.get_current(),t.get_type()===e.windowsLive)return!0;return!1},t.get__firstLocalNetworkContact=function(){for(var t,n=0;n<this._linkedContacts.get_count();n++)if(t=this._linkedContacts.get_item(n),!t.get_network().get__isRemoteNetwork())return t;return null},t.get__windowsLiveLinkedContact=function(){for(var t=u.IEnumerator.getEnumerator(this._linkedContacts),n;t.moveNext();)if(n=t.get_current(),n.get_network().get_isWindowsLive())return n;return null},t._onIMAddressIsOnlineChanged=function(){this._onPropertyChanged("IsOnline")},t._onIMAddressStatusChanged=function(){this.set_currentAddress(this._findCurrentAddress())},t._onIMAddressIdentityVerifiedChanged=function(){this._setIdentityVerifiedChanges()},t._onUserAppearOfflineStatusChanged=function(){this._onPropertyChanged("IsAppearOfflineTo");for(var n=0;n<this.get_addresses().get_count();n++)this.get_addresses().get_item(n)._onUserAppearOfflineStatusChanged()},t._hasAddressType=function(n){for(var t=u.IEnumerator.getEnumerator(this._addresses),i;t.moveNext();)if(i=t.get_current(),i.get_type()===n)return!0;return!1},t._setPresenceChanges=function(){this.get_presence()._onPresenceChanged()},t._setIdentityVerifiedChanges=function(){var n=!0;this._currentAddress!=null&&(n=this._currentAddress.get_isIdentityVerified()),n!==this._isIdentityVerified&&(this._isIdentityVerified=n,this._onPropertyChanged("IsIdentityVerified"))},t._setDisplayNameChanges=function(n){this._displayName!=n&&(this._displayName=n,this._onPropertyChanged("DisplayName"))},t._setRoleListChanges=function(n,t){var i=this._roleLists,u=(i^n)&n;return(i|=n,u|=i&t,i&=~t,u!==r.none)?(this._roleLists=i,this._updateCollections(u),!0):!1},t._update=function(n){for(var r=u.IEnumerator.getEnumerator(n.getContacts()),t,i;r.moveNext();)t=r.get_current(),i=this._findLinkedContact(t),i!=null&&i._update(t)},t._findLinkedContact=function(n){for(var i=u.IEnumerator.getEnumerator(this._linkedContacts),t;i.moveNext();)if(t=i.get_current(),t.get_id()==n.getId())return t;return null},t._attachAddress=function(n){var t=this._findLinkedContactByAddress(n.get__info());t!=null&&(t.get__addresses()._addInternal(n),this._addresses._addInternal(n),n._setLinkedContact(t))},t._toPersonInfo=function(){for(var t=new Array(this._linkedContacts.get_count()),n=0;n<this._linkedContacts.get_count();++n)t[n]=this._linkedContacts.get_item(n).get__info();return new o.PersonInfo(this.get_id(),t)},t._cleanRoleLists=function(n){var t=this._roleLists,u=r.none,f=r.allow|r.block,e=r.forward|r.pending,i;if((t&f)===f&&(t&=~r.allow,u|=r.allow),(t&e)===e&&(t&=~r.pending,u|=r.pending),this._roleLists!==t)for(this._roleLists=t,i=0;i<this._addresses.get_count();i++)this._addresses.get_item(i).get__info().roleLists=t;n&&this._updateCollections(u)},t._updateCollections=function(n){this._updateUserCollections(n)},t._updateUserCollections=function(n){this._updateContactCollection(this._user.get_contacts(),r.forward,n,"IsContact")},t._updateContactCollection=function(n,t,i,r){(i&t)!=0&&((this._roleLists&t)!=0?n._addInternal(this):n._removeInternal(this),this._onPropertyChanged(r))},t._findLinkedContactByAddress=function(n){for(var i,t=0;t<this._addresses.get_count();t++)if(i=this._addresses.get_item(t),l.ContactHelper.areIMAddressesEqual(i.get__info(),n))return i.get_linkedContact();return null},t._findCurrentAddress=function(){var i,r,n,t;if(this._addresses.get_count()===0)return null;for(i=this._addresses.get_item(0).get_rank(),r=this._addresses.get_item(0),n=1;n<this._addresses.get_count();n++)t=this._addresses.get_item(n),t.get_rank()<i&&(i=t.get_rank(),r=t);return r},t._addressesCollectionChanged=function(){this.set_currentAddress(this._findCurrentAddress())},t._onPropertyChanged=function(t){n(this).triggerHandler("propertyChanged",[this,new i.PropertyChangedEventArgs(t)])},t._onCurrentAddressChanging=function(t,r){n(this).triggerHandler("currentAddressChanging",[this,new i.AddressChangingEventArgs(t,r)])},t.addAddress=function(n,t){if(this._hasAddressType(t.get_type()))throw i._exceptionHelper.createArgumentException(i._exceptions.sameTypeAddressExists,"address");var r=this.get__firstLocalNetworkContact();if(r==null||t.get__info().type===s.connect)throw i._exceptionHelper.createInvalidOperationException(i._exceptions.contactAddressOperationUnsupported);r.get__addresses().add(t),n._addInternal(t),n._sort()},t.removeAddress=function(n,t){var r=this.get__firstLocalNetworkContact();if(r==null||t.get__info().type===s.connect)throw i._exceptionHelper.createInvalidOperationException(i._exceptions.contactAddressOperationUnsupported);r.get__addresses().remove(t),n._removeInternal(t)}}(window.originaljQuery||jQuery),function(n){var i=window,t=i.Microsoft.Live.Messenger,r=i.ss;t.ContactPresence=function(n){var i,r;this._contact=n,i=n.get_currentAddress(),i!=null?(r=n.get_currentAddress().get_presence(),this._status=r.get_status(),this._personalMessage=r.get_personalMessage(),this._displayPictureUrl=r.get_displayPictureUrl(),this._isAudioVideoCapable=i.get_isAudioVideoCapable(),this._type=i.get_type(),this._isFacebookMobileEnabled=i.get__info().isFacebookMobileEnabled):(this._status=t.PresenceStatus.offline,this._isAudioVideoCapable=!1,this._personalMessage="",this._displayPictureUrl=null)},t.ContactPresence.prototype={_contact:null,_status:t.PresenceStatus.offline,_personalMessage:null,_displayPictureUrl:null,_type:0,_isFacebookMobileEnabled:!1,get_contact:function(){return this._contact},get_status:function(){return this._status},get_statusText:function(){return t.IMAddressPresence._getLocalizedStatusText(this._status,this._type,this._isFacebookMobileEnabled,!1)},get_personalMessage:function(){return this._personalMessage},get_displayPictureUrl:function(){return this._displayPictureUrl},createPersonalMessageElement:function(){var i=this.get_contact().get_currentAddress(),n;return i!=null?i.get_presence().createPersonalMessageElement():(n=this._personalMessage||"",n=n.replace(new RegExp("(\\r?\\n)+","g")," "),t.MessengerUtility.emoticonEncode(n))},_onPropertyChanged:function(i){n(this).triggerHandler("propertyChanged",[this,new t.PropertyChangedEventArgs(i)])},_onPresenceChanged:function(){var n=this._contact.get_currentAddress(),r=n.get_presence(),t,i;this.get_status()!==r.get_status()&&(this._status=r.get_status(),this._onPropertyChanged("Status")),t=this._getPersonalMessage(),this.get_personalMessage()!==t&&(this._personalMessage=t,this._onPropertyChanged("PersonalMessage")),i=this._getDisplayPictureUrl(),this._displayPictureUrl!==i&&(this._displayPictureUrl=i,this._onPropertyChanged("DisplayPictureUrl")),this._isAudioVideoCapable!==n.get_isAudioVideoCapable()&&(this._isAudioVideoCapable=n.get_isAudioVideoCapable(),this._onPropertyChanged("AudioVideoCapability")),this._type=n.get_type(),this._isFacebookMobileEnabled=n.get__info().isFacebookMobileEnabled},_getPersonalMessage:function(){for(var t=null,n=0;n<this._contact.get_addresses().get_count();n++)if(t=this._contact.get_addresses().get_item(n).get_presence().get_personalMessage(),!r.isNullOrEmpty(t))break;return t},_getDisplayPictureUrl:function(){for(var t=null,n=0;n<this._contact.get_linkedContacts().get_count();n++)if(t=this._contact.get_linkedContacts().get_item(n).get_displayPictureUrl(),t!=null)break;return t}}}(window.originaljQuery||jQuery),function(){var r=window,i=r.ss,u=r.MC,n=r.Microsoft.Live.Messenger,f=n.Collection,e=n.ContactCollection=function(n,t){f.call(this),this._owner$1=t,this._user$1=n,this._owner$1.setCollection(this)},t=e.prototype=new f;t.constructor=e,t._owner$1=null,t._user$1=null,t.get_capacity=function(){return this._owner$1.get_capacity()},t.add=function(t){if(t==null)throw n._exceptionHelper.createArgumentNullException("contact");if(this._contains(t))throw n._exceptionHelper.createArgumentException(n._exceptions.collectionItemDuplicate,"contact");if(!this._owner$1.canAddContact(t))throw n._exceptionHelper.createInvalidOperationException(n._exceptions.unsupportedContactOperation);this._owner$1.addContact(this,t)},t.remove=function(t){if(t==null)throw n._exceptionHelper.createArgumentNullException("contact");if(!this._contains(t))throw n._exceptionHelper.createArgumentException(n._exceptions.collectionItemNotFound,"contact");if(!this._owner$1.canRemoveContact(t))throw n._exceptionHelper.createInvalidOperationException(n._exceptions.unsupportedContactOperation);this._owner$1.removeContact(this,t)},t.findByAddress=function(t){if(t==null)throw n._exceptionHelper.createArgumentNullException("address");if(t.get__user()!==this._user$1)throw n._exceptionHelper.createArgumentException(n._exceptions.objectNotBelongToUser,"address");return this.get__items().contains(t.get_contact())?t.get_contact():null},t.findByCid=function(t){if(i.isNullOrEmpty(t))throw n._exceptionHelper.createArgumentNullException("cid");var f=new u.IMAddressInfo(t,u.IMAddressInfoType.cid,u.RoleLists.none),r=this._user$1._findAddress(f);return r!=null?this.findByAddress(r):null},t.findByIdWithoutRoleCheck=function(t){if(i.isNullOrEmpty(t))throw n._exceptionHelper.createArgumentNullOrEmptyException("id",t);return this._user$1.findContactById(t)},t.findById=function(t){if(i.isNullOrEmpty(t))throw n._exceptionHelper.createArgumentNullOrEmptyException("id",t);var r=this._user$1.findContactById(t);return r!=null&&this._owner$1.containsContact(r)?r:null},t.find=function(t,r){var u,f,e,o;if(i.isNullOrEmpty(t))throw n._exceptionHelper.createArgumentNullException("address");for(u=0;u<this.get_count();u++)for(f=this.get__items()[u],e=0;e<f.get_addresses().get_count();e++)if(o=f.get_addresses().get_item(e),o._equalsByAddressAndType(t,r))return f;return null},t.get_item=function(n){return this.getItem(n)}}(),function(){function h(n){if(n.startsWith("13:")){var t=n.indexOf(";");return n.substr(0,t)+n.substr(t).toLowerCase()}return n.toLowerCase()}function o(n){return t.isNullOrEmpty(n)||n==="00000000-0000-0000-0000-000000000000"||n==="{00000000-0000-0000-0000-000000000000}"}function s(n){for(var s=new Array(n.length),e=null,u,h,o,c,l,f=0;f<n.length;f++)u=n[f],t.isNullOrEmpty(e)&&(e=u.cid),h=i.ContactHelper.getIMAddressInfoKey(u),o=new Array(1),o[0]=h,c={0:r.Guid.newGuid().toString(),3:[o],4:u.network,5:u.address,7:u.id},s[f]=c;return l={0:r.Guid.newGuid().toString(),1:s,2:n[0].id,6:e},new wLive.People.Person(l,new wLive.People.Names)}var f=window,e=f.MC,r=f.Microsoft.Live.Messenger,i=f.MSH,t=f.ss,u=e.IMAddressInfoType;r._contactDictionary=function(n){this._addressMap={},this._contactMap={},this._allContacts=[],this._user=n},r._contactDictionary.prototype={_contactMap:null,_addressMap:null,_allContacts:null,_user:null,_markOffline:function(n,t){var f=e.ServiceData.createEmpty(e.ServiceType.IM),o,r,u,s,i;f.set_status(e.PresenceInfoStatus.offline),o=[f.get_info()],r=this._addressMap;for(u in r)s={key:u,value:r[u]},i=s.value,!i.get_isOnline()||n&&i.get_isUser()||t!=null&&i.get_network().get_id()!==t||i._onServiceDataChanged(o)},_createAddress:function(n){var t=new r.IMAddress(this._user,n);return this._storeIMAddressMapping(t),t},_storeIMAddressMapping:function(n){if(this._addressMap[n.get_id()]=n,n.get__info().type===u.windowsLive&&!t.isNullOrEmpty(n.get__info().cid)&&!t.isNullOrEmpty(n.get__info().address)){var r=i.ContactHelper.getIMAddressInfoKey(n.get__info());this._addressMap[r]=n}},_findAddress:function(n){var r=null,f=i.ContactHelper.computeIMAddressId(n);return t.keyExists(this._addressMap,f)&&(r=this._addressMap[f]),r!=null&&r.get__info().type===u.cid&&n.type===u.windowsLive&&this._storeIMAddressMapping(r),r},_findOrCreateAddressForContact:function(n,t){var i=this._findAddress(t);return i==null&&(i=this._createAddress(t)),i._setLinkedContact(n),i},_createUserContact:function(n){return this._createContact(s(n),!1)},_findOrCreateAddress:function(n){var t=this._findAddress(n),i,r;return t==null&&(t=this._createAddress(n)),t.get_contact()==null&&(i=s([n]),r=this._findContact(i.getContacts()[0]),r!=null?r._attachAddress(t):this._createContact(i,!0)),t},_findContactById:function(n){var i,r;if(!o(n)){if(i=h(n),t.keyExists(this._contactMap,i))return this._contactMap[i];if(t.keyExists(this._addressMap,i))return r=this._addressMap[i],r.get_contact()}return null},_findContactBySkypeId:function(n,i){var e=this._contactMap,r,f;for(r in e)for(var s={key:r,value:e[r]},u=s.value,o=t.IEnumerator.getEnumerator(u.get_addresses());o.moveNext();)if(f=o.get_current(),f.get_skypeName()===n){if(t.isNullOrEmpty(i)||i===f.get_network().get_id())return u;continue}return null},_findContactByAddress:function(n){var t=null,r=this._findAddress(n);return r!=null&&(t=r.get_contact()),t==null&&n.type===u.connect&&(t=this._contactMap[i.ContactHelper.computeIMAddressId(n)]),t},_findContactByAddresses:function(n){for(var r=t.IEnumerator.getEnumerator(n);r.moveNext();){var f=r.get_current(),e=i.ContactHelper.createAddressInfoFromMessagingAddress(f,null),u=this._findContactByAddress(e);if(u!=null)return u}return null},_findContact:function(n){var t=this._findContactById(n.getId());return t==null&&n.getMessagingAddresses().length>0&&(t=this._findContactByAddresses(n.getMessagingAddresses())),t},_createOrUpdateContact:function(n){var t=this._findContactByPwcPerson(n);return t==null?t=this._createContactAndLinkedContacts(n,!1):t._update(n),t},_deleteContact:function(n){for(var e=t.IEnumerator.getEnumerator(n.getContacts()),o,r,u,s,f,h;e.moveNext();)if(o=e.get_current(),r=this._findContact(o),r!=null){for(this._allContacts.remove(r),u=t.IEnumerator.getEnumerator(r.get_linkedContacts());u.moveNext();)s=u.get_current(),delete this._contactMap[s.get_id()];for(f=t.IEnumerator.getEnumerator(r.get_addresses());f.moveNext();)h=f.get_current(),delete this._addressMap[i.ContactHelper.getIMAddressInfoKey(h.get__info())];this._user.get_contacts()._removeInternal(r)}},_findContactByPwcPerson:function(n){for(var r=t.IEnumerator.getEnumerator(n.getContacts()),u,i;r.moveNext();)if(u=r.get_current(),i=this._findContact(u),i!=null)return i;return null},_createContact:function(n,t){return this._createContactAndLinkedContacts(n,t)},_createContactAndLinkedContacts:function(n,f){var e=new r.Contact(this,this._user,n,f),s,h,c;for(this._allContacts.push(e),s=0;s<e.get_linkedContacts().get_count();s++)if(linkedContact=e.get_linkedContacts().get_item(s),o(linkedContact.get_id())||(this._contactMap[linkedContact.get_id()]=e),linkedContact.get__addresses()!=null)for(h=t.IEnumerator.getEnumerator(linkedContact.get__addresses());h.moveNext();)c=h.get_current().get__info(),c.type===u.connect&&(this._contactMap[i.ContactHelper.computeIMAddressId(c)]=e);return e}}}(window.originaljQuery||jQuery),function(){var i=window,t=i.Microsoft.Live.Messenger,f=i.MSH,r=t.Collection,u=t.MessageCollection=function(){r.call(this),this._lastReceived$1=f.DateTimeHelper.minValue},n=u.prototype=new r;n.constructor=u,n._lastReceived$1=null,n._addOutbound=function(n){var t=new Date;n.set_timestamp(t),this._add(n)},n._add=function(n){if(this._addInternal(n),!n.get_sender().get_isUser()){this._lastReceived$1=n.get_timestamp();this.onPropertyChanged(new t.PropertyChangedEventArgs("LastReceived"))}},n._remove=function(n){this._removeInternal(n)},n._insert=function(n,t){this._insertInternal(n,t,!0)},n._insertRange=function(n,t){this._insertRangeInternal(n,t)},n.get_lastReceived=function(){return this._lastReceived$1},n.get_item=function(n){return this.getItem(n)}}(),function(){var t=window,n=t.Microsoft.Live.Messenger;n.MessageReceivedEventArgs=function(n){this._message$1=n},n.MessageReceivedEventArgs.prototype={get_message:function(){return this._message$1}}}(),function(){var t=window,n=t.Microsoft.Live.Messenger;n.SendMessageFailedEventArgs=function(n,t,i){this._resultCode$1=n,this._message$1=t,this._userState$1=i},n.SendMessageFailedEventArgs.prototype={_resultCode$1:n.SendMessageResultCode.success,_message$1:null,_userState$1:null,get_resultCode:function(){return this._resultCode$1},get_message:function(){return this._message$1},get_userState:function(){return this._userState$1}}}(),function(){var t=window,n=t.Microsoft.Live.Messenger;n.SignedOutEventArgs=function(n){this._reason$1=n},n.SignedOutEventArgs.prototype={get_reason:function(){return this._reason$1}}}(),function(){var n=window,t=n.Microsoft.Live.Messenger;t.SignedOutRemotelyEventArgs=function(){}}(),function(){var t=window,n=t.Microsoft.Live.Messenger;n.SignInCompletedEventArgs=function(n,t,i){this._resultCode$1=n,this._error$1=t,this._userState$1=i},n.SignInCompletedEventArgs.prototype={_resultCode$1:n.SignInResultCode.success,_userState$1:null,_error$1:null,_serverName$1:null,get_resultCode:function(){return this._resultCode$1},get_error:function(){return this._error$1},get_userState:function(){return this._userState$1},get_serverName:function(){return this._serverName$1},set_serverName:function(n){return this._serverName$1=n,n}}}(),function(){var t=window,n=t.Microsoft.Live.Messenger;n.SignOutCompletedEventArgs=function(n,t,i,r){this._resultCode$1=n,this._locations$1=t,this._signoutEndpoint$1=i,this._userState$1=r},n.SignOutCompletedEventArgs.prototype={_locations$1:n.SignOutLocations.local,_resultCode$1:n.SignOutResultCode.success,_signoutEndpoint$1:null,_userState$1:null,get_endpoint:function(){return this._signoutEndpoint$1},get_locations:function(){return this._locations$1},get_resultCode:function(){return this._resultCode$1},get_userState:function(){return this._userState$1}}}(),function(n){function l(n,t,i){return t.getTime()-n.getTime()>i}var o=1e4,u=window,f=u.MC,i=u.Microsoft.Live.Messenger,s=u.MSH,r=u.ss,c=i.MessageType,h=i._iimAddressCollectionOwner,e=i.Conversation=function(t,u,f){var e,c;if(h.call(this),t){if(e=null,u instanceof i.IMAddress)e=u;else if(u instanceof i.Contact)c=u,e=c.get_currentAddress();else throw i._exceptionHelper.createArgumentOutOfRangeException("entity");if(e.get__user()!==t)throw i._exceptionHelper.createArgumentException(i._exceptions.objectNotBelongToUser,"address");if(e.get_isUser()&&!f)throw i._exceptionHelper.createArgumentException(i._exceptions.cantConvSelf,"address");e.get_type()===i.IMAddressType.shortCircuit&&(this._hasMoreHistoryOnServer=!1),r.isNullOrEmpty(t.get_conversations().get__currentConversationId())?this._id=e.get__chatKey():(this._id=t.get_conversations().get__currentConversationId(),t.get_conversations().set__currentConversationId("")),this._user=t,this._network=e.get_network(),t.get_conversations().get__currentConversationCreator()!=null?(this._creator=t.get_conversations().get__currentConversationCreator(),t.get_conversations().set__currentConversationCreator(null)):this._creator=t.get_address(),this._messageIdMap={},this._history=new i.MessageCollection,n(this._history).bind("collectionChanged",r.Delegate.create(this,this._onHistoryCollectionChanged)),this._invitedContacts={},this._roster=new i.IMAddressCollection(this),n(this._roster).bind("collectionChanged",r.Delegate.create(this,this._onRosterCollectionChanged)),f||(this._roster._addInternal(e),this._roster._addInternal(t.get_address())),this._typingaddresses=new i.TypingIMAddressCollection(o),this._lastTypedTime=s.DateTimeHelper.minValue,this._reloaded=t.get_conversations().get__currentConversationReloaded(),t.get_conversations()._addInternal(this),f||this._createInternally()}},t;e._createFromIncoming=function(n,t,i,u){for(var s=r.IEnumerator.getEnumerator(n.get_conversations()),o,f,e;s.moveNext();)if(o=s.get_current(),o._id===t)return o;if(i==null)f=n._createConversationFromIncoming(u[0],t);else if(n.get_skypeAddress())f=n._createGroupConversation(i);else return null;if(u!=null)for(e=1;e<u.length;e++)f._roster._addInternal(u[e]);return f},t=e.prototype=new h,t.constructor=e,t._user=null,t._creator=null,t._id=null,t._consumptionHorizon=null,t._buddyAddress=null,t._roster=null,t._typingaddresses=null,t._history=null,t._messageIdMap=null,t._closed=!1,t._invitedContacts=null,t._lastTypedTime=null,t._reloaded=!1,t._recentMessage=null,t._hasMoreHistoryOnServer=!0,t._network=null,t._onAddMembersCompleted=null,t._onRemoveMembersCompleted=null,t._onConversationUpdated=null,t.get_user=function(){return this._user},t.get_network=function(){return this._network},t.get_roster=function(){return this._roster},t.get_buddyAddress=function(){var n,t;if(this._buddyAddress==null)for(n=r.IEnumerator.getEnumerator(this.get_roster());n.moveNext();)t=n.get_current(),t!==this.get_user().get_address()&&(this._buddyAddress=t);return this._buddyAddress},t.get_buddyContact=function(){return this.get_buddyAddress()==null?null:this.get_buddyAddress().get_contact()},t.get_creator=function(){return this._creator},t.get_typingAddresses=function(){return this._typingaddresses},t.get_history=function(){return this._history},t.get_mostRecentMessage=function(){var n,t;if(this._history.get_count()>0)for(n=this._history.get_count()-1;n>=0;n--)if(t=this._history.get_item(n),t instanceof i.TextMessage||t instanceof i.ThreadActivityMessage)return t;return this._recentMessage},t.get_lastHistoryMessage=function(){return this._history.get_count()>0&&this._history.get_item(0).get_isHistoryMessage()?this._history.get_item(0):this.get_mostRecentMessage()},t.get_closed=function(){return this._closed},t.get_reloaded=function(){return this._reloaded},t._setReloaded=function(n){this._reloaded=n},t.get__isOffline=function(){var t,n;if(this._closed||this._roster.get_count()!==2)return!1;for(t=r.IEnumerator.getEnumerator(this._roster);t.moveNext();)if(n=t.get_current(),!n.get_isUser()){if(s.ContactHelper.getIMAddressInfoKey(n.get__info())!==this._id)return!1;if(!n.get_isOnline()&&!n.get__isMobile()&&n.get_type()!==i.IMAddressType.shortCircuit&&n.get_isContact())return!0}return!1},t.get__supportsTypingIndicators=function(){for(var n=r.IEnumerator.getEnumerator(this._roster),t;n.moveNext();)if(t=n.get_current(),!t.get_capabilities().get__supportsTypingIndicators())return!1;return!0},t.get_id=function(){return this._id},t.get_supportsMultiparty=function(){var n,t;if(this._closed)return!1;for(n=r.IEnumerator.getEnumerator(this._roster);n.moveNext();)if(t=n.get_current(),!t.get_capabilities().get_supportsMultipartyConversations())return!1;return!0},t.get_supportsOfflineMessages=function(){var t,n;if(this._closed||this._roster.get_count()!==2)return!1;for(t=r.IEnumerator.getEnumerator(this._roster);t.moveNext();)if((n=t.get_current(),!n.get_isUser())&&(!n.get_capabilities().get_supportsOfflineMessages()||n.get__info().type===f.IMAddressInfoType.cid))return!1;return!0},t.get_hasUnreadMessages=function(){var n=this.get_mostRecentMessage(),t,i;return n&&!n.get_sender().get_isUser()&&(!this._consumptionHorizon||(t=this._consumptionHorizon.lastReadMessageTimestamp,this._consumptionHorizon.lastReadMessageId&&(i=this._messageIdMap[this._consumptionHorizon.lastReadMessageId],i&&(t=i.get_timestamp())),n.get_timestamp()>t))?!0:!1},t.get_consumptionHorizon=function(){return this._consumptionHorizon},t.get_hasMoreHistoryOnServer=function(){return this._hasMoreHistoryOnServer},t.set_hasMoreHistoryOnServer=function(n){if(this._hasMoreHistoryOnServer!==n){this._hasMoreHistoryOnServer=n;this.onPropertyChanged(new i.PropertyChangedEventArgs("HasMoreHistory"))}return n},t.notifyUserTyped=function(){var n,t;(this._assertNotDisposed(),this.get__supportsTypingIndicators()&&!this.get__isOffline())&&(n=new Date,l(this._lastTypedTime,n,o)&&(this._lastTypedTime=n,t=new f.MessageInfo(f.MessageInfoType.typingUserMessage,null),t.sender=this._user.get_address().get__info(),this._user._conversationSendMessage(this._id,t,null)))},t.getHistory=function(){this._hasMoreHistoryOnServer&&this._user._conversationGetHistory(this._id)},t.removeInviteRequest=function(){for(var t=r.IEnumerator.getEnumerator(this._history.get__items()),n;t.moveNext();)n=t.get_current(),n.get_inviteMessage()&&this._history._remove(n)},t.sendMessage=function(n,t){this.sendMessageToEndpoint(n,null,t)},t.sendMessageToEndpoint=function(n,t,u){var f,e,o;if(this._assertNotDisposed(),n==null)throw i._exceptionHelper.createArgumentNullException("message");if(t!=null&&this._roster.get_count()!==2)throw i._exceptionHelper.createInvalidOperationException(i._exceptions.targetEndpointRosterCountInvalid);if(!this.get__isOffline()||!this.get_supportsOfflineMessages()||n.get__supportsOffline()){if(n.set_networkId(this.get_network().get_id()),n.set_networkName(this.get_network().get_name()),n.set_conversationId(this._id),f=n._buildMessageInfo(this._user.get_address(),this),t!=null){for(e=r.IEnumerator.getEnumerator(this._roster);e.moveNext();)if((o=e.get_current(),!o.get_isUser())&&!o.get_endpoints()._contains(t))throw i._exceptionHelper.createArgumentOutOfRangeException("targetEndpoint");f.targetEndpointId=t.get_id().toString()}this.get__isOffline()&&this.get_supportsOfflineMessages()&&(f.isOfflineMessage=!0),this._user._conversationSendMessage(this._id,f,u),this._history._addOutbound(n)}},t.close=function(){this._closed||(this._user._conversationClose(this._id),this._markConversationAsClosed())},t.supportsMessageType=function(n){var t,i;if(this._closed||n===c.callEventMessage&&this._roster.get_count()!==2)return!1;for(t=r.IEnumerator.getEnumerator(this._roster);t.moveNext();)if(i=t.get_current(),!i.get_capabilities().supportsMessageType(n))return!1;return!0},t.isTextMessageValid=function(n){return i.TextMessage.isValid(this,n)},t.rosterContainsAddress=function(n){for(var t=r.IEnumerator.getEnumerator(this._roster),i;t.moveNext();)if(i=t.get_current(),i.equals(n))return!0;return!1},t.markAsRead=function(){var n=this.get_mostRecentMessage(),i,t;n&&(!this.get_consumptionHorizon()||n.get_timestamp()>this.get_consumptionHorizon().lastReadMessageTimestamp)&&(i=n.get_clientMessageId()!=null?n.get_clientMessageId():n.get_receivedMessageId(),t=new f.ConsumptionHorizonInfo(i,n.get_timestamp()),this._setConsumptionHorizon(t),this._user._conversationUpdateConsumptionHorizon(this._id,t))},t.onMessageReceived=function(t){n(this).triggerHandler("messageReceived",[this,t]),this._history._add(t.get_message());var i=t.get_message().get_receivedMessageId();i&&(this._messageIdMap[i]=t.get_message())},t.onHistoryMessagesReceived=function(n,t){var i,e,u,f;if(this.set_hasMoreHistoryOnServer(t),n!=null){for(i=[],e=r.IEnumerator.getEnumerator(n);e.moveNext();)u=e.get_current(),f=u.get_receivedMessageId(),f&&!this._messageIdMap[f]&&(i.push(u),this._messageIdMap[f]=u);i.length>1?this._history._insertRange(0,i):i.length===1?this._history._insert(0,i[0]):t&&this.getHistory()}},t.onRecentMessageReceived=function(t){this._recentMessage=t.get_message(),n(this).triggerHandler("recentMessageReceived",[this,t])},t.onSendMessageFailed=function(t){n(this).triggerHandler("sendMessageFailed",[this,t])},t.onPropertyChanged=function(t){n(this).triggerHandler("propertyChanged",[this,t])},t.dispose=function(){this.close()},t.addAddress=function(n,t){if(this instanceof i.GroupConversation)n._addInternal(t);else throw new Error(i._exceptions.collectionReadOnly);},t.removeAddress=function(n,t){if(this instanceof i.GroupConversation)n._removeInternal(t);else throw new Error(i._exceptions.collectionReadOnly);},t._createInternally=function(){var n=this._roster.get_item(0);n.get_isUser()&&(n=this._roster.get_item(1)),this._user._conversationCreate(this._id,n)},t._onHistoryCollectionChanged=function(){this.onPropertyChanged(new i.PropertyChangedEventArgs("History"))},t._onRosterCollectionChanged=function(){this.onPropertyChanged(new i.PropertyChangedEventArgs("Roster"))},t._onClosed=function(){this._closed||this._markConversationAsClosed()},t._setConsumptionHorizon=function(n){if(!this._consumptionHorizon||this._consumptionHorizon.lastReadMessageId!==n.lastReadMessageId||this._consumptionHorizon.lastReadMessageTimestamp!==n.lastReadMessageTimestamp){this._consumptionHorizon=n;this.onPropertyChanged(new i.PropertyChangedEventArgs("ConsumptionHorizon"))}},t._setConversationId=function(n){if(this._id!==n){this._id=n;this.onPropertyChanged(new i.PropertyChangedEventArgs("Id"))}},t._markConversationAsClosed=function(){this._closed=!0;this.onPropertyChanged(new i.PropertyChangedEventArgs("Closed"));this._user.get_conversations()._removeInternal(this)},t._assertNotDisposed=function(){if(this._closed)throw i._exceptionHelper.createObjectDisposedException("Conversation");}}(window.originaljQuery||jQuery),function(n){var f=window,u=f.MC,i=f.Microsoft.Live.Messenger,r=f.ss,o=u.GroupConversationOperationResult,s=i.Conversation,e=i.GroupConversation=function(n,t,i){s.call(this,n,t,!0),this._onConversationUpdated(i)},t;e._getThreadMemberInfo=function(n){for(var e=new Array(n.length),s=0,o=r.IEnumerator.getEnumerator(n),t,f;o.moveNext();)t=o.get_current(),f=t.get_type()===i.IMAddressType.skype?t.get_contact().get_windowsLiveAddress():t.get_contact().get_skypeAddress(),e[s++]=new u.GroupConversationMemberInfo(t.get__info(),f==null?null:f.get__info());return e},t=e.prototype=new s,t.constructor=e,t._threadInfo$1=null,t._groupContact$1=null,t._userInitiated$1=!1,t.get_title=function(){return!r.isNullOrUndefined(this._threadInfo$1)&&r.isNullOrEmpty(this._threadInfo$1.title)?this._threadInfo$1.title:""},t.get_version=function(){return this._threadInfo$1.version},t.get_userInitiated=function(){return this._userInitiated$1},t.set_userInitiated=function(n){return this._userInitiated$1=n,n},t.get_buddyAddress=function(){return this.get_buddyContact().get_addresses().get_item(0)},t.get_buddyContact=function(){if(this._groupContact$1==null){var n=new u.IMAddressInfo(this.get_id().split(":")[1],u.IMAddressInfoType.temporaryGroup,u.RoleLists.none);this._groupContact$1=this.get_user()._findOrCreateAddress(n).get_contact()}return this._groupContact$1},t.addMembers=function(n){this.get_user()._conversationAddMembers(this.get_id(),i.GroupConversation._getThreadMemberInfo(n),null)},t.removeMembers=function(n){this.get_user()._conversationRemoveMembers(this.get_id(),i.GroupConversation._getThreadMemberInfo(n),null)},t.leaveGroup=function(){var n,t=this.get_user().get_contact();this.rosterContainsAddress(t.get_windowsLiveAddress())?n=[t.get_windowsLiveAddress()]:this.rosterContainsAddress(t.get_skypeAddress())&&(n=[t.get_skypeAddress()]),n&&this.removeMembers(n)},t._onAddMembersCompleted=function(t,r){var e,f;if(t!==o.success){for(e=new Array(r.length),f=0;f<r.length;f++)e[f]=this.get_user()._findOrCreateAddress(r[f].address);n(this).triggerHandler("operationFailed",[i.GroupConversationOperationType.addMembers,e])}},t._onRemoveMembersCompleted=function(t,r){var e,f;if(t!==o.success){for(e=new Array(r.length),f=0;f<r.length;f++)e[f]=this.get_user()._findOrCreateAddress(r[f].address);n(this).triggerHandler("operationFailed",[i.GroupConversationOperationType.removeMembers,e])}},t._onConversationUpdated=function(t){var o,u,f,e;if(this._threadInfo$1=t,this._threadInfo$1.userInitiated&&(this._userInitiated$1=!0,this.get_user().get_presence().get_status()===i.PresenceStatus.appearOffline&&this.getHistory()),this.get_roster()._beginReset(),this.get_roster().get__items().length=0,t.members!=null)for(o=r.IEnumerator.getEnumerator(t.members);o.moveNext();)f=o.get_current(),f.linkedAddress==null?(u=this.get_user()._findOrCreateAddress(f.address),this.get_roster().add(u)):(u=this.get_user()._findAddress(f.address),e=this.get_user()._findAddress(f.linkedAddress),u!=null?(this.get_roster().add(u),e==null&&(e=this.get_user()._findOrCreateAddress(f.linkedAddress),e.get_contact()._setDisplayNameChanges(u.get_contact().get_displayName()))):e!=null?(this.get_roster().add(e),u=this.get_user()._findOrCreateAddress(f.address),u.get_contact()._setDisplayNameChanges(e.get_contact().get_displayName())):(u=this.get_user()._findOrCreateAddress(f.address),e=this.get_user()._findOrCreateAddress(f.linkedAddress),this.get_roster().add(u)));this.get_roster().get__items().sort(function(n,t){return r.compare(n.get_contact().get_displayName(),t.get_contact().get_displayName(),!0)}),this.get_roster()._endReset(),this._updateDisplayName$1(),n(this).triggerHandler("infoUpdated")},t._updateDisplayName$1=function(){var n="",t,i;if(r.isNullOrEmpty(this._threadInfo$1.title)){for(t=r.IEnumerator.getEnumerator(this.get_roster());t.moveNext();)i=t.get_current(),i.get_isUser()||(n+=i.get_contact().get_displayName()+", ");r.isNullOrEmpty(n)||(n=n.substr(0,n.length-2))}else n=this._threadInfo$1.title;n!==this.get_buddyContact().get_displayName()&&this.get_buddyContact()._setDisplayNameChanges(n)}}(window.originaljQuery||jQuery),function(n){var u=window,i=u.Microsoft.Live.Messenger,r=u.ss,f=i.Collection,e=i.ConversationCollection=function(n){f.call(this),this._user$1=n,this._currentConversationCreator$1=null,this._currentConversationId$1="",this._currentConversationReloaded$1=!1},t=e.prototype=new f;t.constructor=e,t._user$1=null,t._currentConversationId$1=null,t._currentConversationReloaded$1=!1,t._hasMoreConversationsOnServer$1=!0,t.get__currentConversationCreator=function(){return this._currentConversationCreator$1},t.set__currentConversationCreator=function(n){return this._currentConversationCreator$1=n,n},t.get__currentConversationId=function(){return this._currentConversationId$1},t.set__currentConversationId=function(n){return this._currentConversationId$1=n,n},t.get__currentConversationReloaded=function(){return this._currentConversationReloaded$1},t.create=function(n){var t,u,r;if(n==null)throw i._exceptionHelper.createArgumentNullException("address");if(this._user$1._ensureServicesRichOperation(),n instanceof i.IMAddress)t=n;else if(n instanceof i.Contact){if(u=n,u.get_isEmailOnlyContact())throw i._exceptionHelper.createInvalidOperationException(i._exceptions.conversationEmailOnly);t=u.get_currentAddress()}else throw i._exceptionHelper.createArgumentOutOfRangeException("entity");if(t.get_isUser())throw i._exceptionHelper.createInvalidOperationException(i._exceptions.cantConvSelf);return r=this._getConversationByAddress$1(t),r==null&&(r=this._user$1._createConversation(t)),r},t.createByCid=function(n){if(r.isNullOrEmpty(n))throw i._exceptionHelper.createArgumentNullOrEmptyException("cid",n);var t=this._user$1.get_contacts().findByCid(n);return t!=null?this.create(t):null},t.createGroup=function(n){var t=i.GroupConversation._getThreadMemberInfo(n);this._user$1._conversationCreateGroup(t)},t.getMoreRecentConversations=function(){this._user$1._conversationGetRecentList()},t.get_hasMoreConversationsOnServer=function(){return this._hasMoreConversationsOnServer$1},t._clear=function(){for(this._beginReset();this.get_count()>0;)this.get_item(0)._onClosed();this._endReset()},t.removeConversation=function(n){this._removeInternal(n)},t._onAddMembersCompleted=function(n,t,r,u){var f=this._getConversationById$1(n);f!=null&&f instanceof i.GroupConversation&&f._onAddMembersCompleted(t,r,u)},t._onRemoveMembersCompleted=function(n,t,r,u){var f=this._getConversationById$1(n);f!=null&&f instanceof i.GroupConversation&&f._onRemoveMembersCompleted(t,r,u)},t.onConversationClearedAtUpdated=function(t,i){var r=this._getConversationById$1(t),u,f;r!=null&&(u=r.get_mostRecentMessage(),u!=null&&u.get_timestamp()<new Date(parseInt(i))&&(f=this,f._user$1.remove_conversation(r,i,function(){n(f).triggerHandler("conversationDeleted",r)})))},t._onAddressJoined=function(n,t){var i=this._getConversationById$1(n),r;i!=null&&(r=this._user$1._findOrCreateAddress(t),i.get_roster()._addInternal(r))},t._onAddressLeft=function(n,t){var i=this._getConversationById$1(n),r;i!=null&&i.get_roster().get_count()>=3&&(r=this._user$1._findOrCreateAddress(t),i.get_roster()._removeInternal(r))},t._onConversationClosed=function(n){var t=this._getConversationById$1(n);t!=null&&t._onClosed()},t._onConsumptionHorizonUpdated=function(n,t){var i=this._getConversationById$1(n);i!=null&&i._setConsumptionHorizon(t)},t._onGetRecentConversationsCompleted=function(t,i){this._hasMoreConversationsOnServer$1=t,n(this).triggerHandler("getRecentConversationsCompleted",{callFailed:i})},t._onMessageReceived=function(n,t){var e=this._getConversationById$1(n),u,f;if(e!=null&&(u=this._user$1._findOrCreateAddress(t.sender),r.isNullOrEmpty(t.displayNameOverride)||(u.get_isAnonymous()||!u.get_contact().get_isContact())&&u.get_contact()._setDisplayNameChanges(t.displayNameOverride),f=i.Message._fromMessageInfo(this._user$1,u,t,e),f!=null))if(t.isRecentMessage)e.onRecentMessageReceived(new i.MessageReceivedEventArgs(f));else{this._currentConversationReloaded$1&&f._setReloaded(!0);e.onMessageReceived(new i.MessageReceivedEventArgs(f));u!=null&&f.get_type()===i.MessageType.textMessage&&e.get_typingAddresses()._remove(u)}},t._onConversationHistoryMessagesReceived=function(n,t,r){var f=this._getConversationById$1(n),e,u,o;if(t!=null){for(e=new Array(t.length),u=0;u<t.length;u++)o=t[u],e[u]=i.Message._fromMessageInfo(this._user$1,this._user$1._findOrCreateAddress(o.sender),o,f);f.onHistoryMessagesReceived(e,r)}else f.onHistoryMessagesReceived(null,r)},t._onBuddyTypedNotification=function(n,t){var i=this._getConversationById$1(n),r;i!=null&&(r=this._user$1._findOrCreateAddress(t),r!==i.get_user().get_address()&&r!==i.get_user().get_skypeAddress())&&i.get_typingAddresses()._add(r)},t._onSendMessageFailed=function(n,t,r,u){var f=this._getConversationById$1(n),e;if(f!=null&&(e=i.Message._fromMessageInfo(this._user$1,this._user$1.get_address(),r,f),e!=null))f.onSendMessageFailed(new i.SendMessageFailedEventArgs(t,e,u))},t._onConversationUpdated=function(n,t){var i=this._getConversationById$1(n);i!=null&&i._onConversationUpdated(t)},t._onUpdatedId=function(n,t){var i=this._getConversationById$1(n);i._setConversationId(t)},t._getConversationByAddress$1=function(n){return this._getConversationById$1(n.get__chatKey())},t._getConversationById$1=function(n){for(var i=r.IEnumerator.getEnumerator(this),t;i.moveNext();)if(t=i.get_current(),t.get_id()===n)return t;return null},t.get_item=function(n){if(n<0||n>=this.get_count())throw i._exceptionHelper.createArgumentOutOfRangeException("index");return this.get__items()[n]}}(window.originaljQuery||jQuery),function(){var t=window,n=t.Microsoft.Live.Messenger;n._searchResult=function(){},n._searchResult.prototype={found:!1,index:0}}(),function(){var f=600,r=window,t=r.Microsoft.Live.Messenger,e=r.ss,i=t.Collection,u=t.SortedCollection=function(n,t){i.call(this),this._compareItems$1=n,this._sortCallback$1=t,this._sortCallback$1||(this._sortCallback$1=e.Delegate.create(this,this._defaultSort$1))},n=u.prototype=new i;n.constructor=u,n._compareItems$1=null,n._sortCallback$1=null,n._endReset=function(){this._sortCallback$1.invoke(this.get__items()),i.prototype._endReset.call(this)},n._loadItems=function(n){this._beginReset(),this.get__items().length=0,n!=null&&this._insertRangeInternal(0,n),this._endReset()},n._addItem=function(n){var r,i;this.get__isResetting()?r=this.get_count():(i=new t._searchResult,this._binarySearch$1(n,i),i.found&&!this.onInsertEqual(this.get__items()[i.index],n),r=i.index),this._insertInternal(r,n,!0)},n._removeItem=function(n){var t=this._findItem(n);t>=0&&this._removeAtInternal(t,!0)},n._updateItem=function(n){var i=this.get__items().indexOf(n),r;i!==-1&&(r=new t._searchResult,this.get__items().splice(i,1),this._binarySearch$1(n,r),this.get__items().insert(i,n),i!==r.index&&this._moveInternal(r.index,i))},n._findItem=function(n){var i=new t._searchResult;return this.get_count()>f&&!this.get__isResetting()?(this._binarySearch$1(n,i),i.found)?i.index:-1:this.get__items().indexOf(n)},n.onInsertEqual=function(){return!0},n._defaultSort$1=function(n){n.sort(this._compareItems$1)},n._binarySearch$1=function(n,t){if(t.index=0,t.found=!1,this.get_count()!==0){for(var f=this.get_count()-1,r=0,i,u;r<=f;)if(i=Math.floor((f+r)/2),u=this._compareItems$1.invoke(this.get__items()[i],n),u<0)r=i+1;else if(u>0)f=i-1;else if(u===0){while(i>0&&this._compareItems$1.invoke(this.get__items()[i-1],n)===0)i--;while(i<this.get_count()-1&&this.get__items()[i]!==n&&this._compareItems$1.invoke(this.get__items()[i+1],n)===0)i++;t.index=i,t.found=this.get__items()[i]===n;return}t.index=r;return}}}(),function(n){var r=window,i=r.Microsoft.Live.Messenger,u=r.MSH,t=r.ss;i.AggregatedConversation=function(n){this._getHistoryPending="",this._user=n,this._conversations=[],this._history=new i.MessageCollection,this._pendingHistoryMessages=[],this._stagingHistoryMessages=[]},i.AggregatedConversation.prototype={_conversations:null,_currentConversation:null,_user:null,_buddyContact:null,_history:null,_hasMoreHistoryOnServer:!0,_markedReadTimestamp:null,_firstHistoryRequest:!0,_pageSize:20,_pendingHistoryMessages:null,_stagingHistoryMessages:null,get_user:function(){return this._user},get_buddyContact:function(){if(this._buddyContact==null&&this._conversations!=null&&this._conversations.length>0){var n=this._conversations[0];this._buddyContact=n.get_buddyContact()}return this._buddyContact},get_conversations:function(){return this._conversations},get_currentConversation:function(){var n,i,r;if(this._currentConversation==null){if(n=this.getMostRecentMessage(),n!=null)for(i=t.IEnumerator.getEnumerator(this._conversations);i.moveNext();)if(r=i.get_current(),n.get_conversationId()===r.get_id())return r;if(this._conversations.length>0)return this._conversations[0]}return this._currentConversation},set_currentConversation:function(t){this._currentConversation=t,this.get_buddyContact().set_currentAddress(this._currentConversation.get_buddyAddress());var i={};return i.conversation=this._currentConversation,n(this).triggerHandler("currentConversationChanged",[this,i]),t},get_history:function(){return this._history},get_hasMoreHistoryOnServer:function(){return this._hasMoreHistoryOnServer},get_hasUnreadMessages:function(){for(var n=0;n<this._conversations.length;n++)if(this._conversations[n].get_hasUnreadMessages())return!0;return!1},get_consumptionHorizon:function(){for(var n=null,t,i,r=0;r<this._conversations.length;r++)this._conversations[r].get_hasUnreadMessages()&&(t=this._conversations[r],i=null,t.get_consumptionHorizon()&&(i=t.get_consumptionHorizon().lastReadMessageTimestamp),i||(i=t.get_history().get_count()>0?t.get_history().getItem(0).get_timestamp()-1:t.get_mostRecentMessage().get_timestamp()-1),(!n||i<n)&&(n=i));return n||(n=this.getMostRecentMessage()&&this.getMostRecentMessage().get_timestamp()||new Date),n},add:function(i){for(var r=t.IEnumerator.getEnumerator(this._conversations),u;r.moveNext();)if(u=r.get_current(),u.get_id()===i.get_id())return;this._conversations.push(i),n(i.get_history()).bind("collectionChanged",t.Delegate.create(this,this._onConversationHistoryChanged)),n(i).bind("recentMessageReceived",t.Delegate.create(this,this._onConversationRecentMessageReceived)),n(i).bind("propertyChanged",t.Delegate.create(this,this._onConversationPropertyChanged)),n(i).bind("sendMessageFailed",t.Delegate.create(this,this._onConversationSendMessageFailed)),this._updateHasMoreHistory()},remove:function(i){for(var e=new Array(this._history.get_count()),u=t.IEnumerator.getEnumerator(this._history),o,f,r;u.moveNext();)o=u.get_current(),o.get_conversationId()==i.get_id()&&e.push(o);for(f=0;f<e.length;f++)e[f]!=null&&this._history._remove(e[f]);for(u=t.IEnumerator.getEnumerator(this._conversations);u.moveNext();)if(r=u.get_current(),r.get_id()===i.get_id()){this._conversations.remove(r),n(r.get_history()).unbind("collectionChanged"),n(r).unbind("recentMessageReceived"),n(r).unbind("propertyChanged"),n(r).unbind("sendMessageFailed");break}},getMoreHistory:function(){var n,i;if(this._firstHistoryRequest)for(this._firstHistoryRequest=!1,n=t.IEnumerator.getEnumerator(this.get_buddyContact().get_addresses());n.moveNext();)i=n.get_current(),this._user.get_conversations().create(i);this._processPendingHistoryMessages()},getMostRecentMessage:function(){for(var r=null,u=new Date(0),f=t.IEnumerator.getEnumerator(this._conversations),e,n;f.moveNext();)e=f.get_current(),n=e.get_mostRecentMessage(),n!=null&&(n instanceof i.TextMessage||n instanceof i.ThreadActivityMessage)&&n.get_timestamp()>u&&(r=n,u=n.get_timestamp());return r},markAllConversationsAsRead:function(){for(var n=t.IEnumerator.getEnumerator(this._conversations),i;n.moveNext();)i=n.get_current(),i.markAsRead()},getConversationByNetworkName:function(n){for(var r=t.IEnumerator.getEnumerator(this._conversations),i;r.moveNext();)if(i=r.get_current(),i.get_network().get_name()===n)return i;return null},_getConversationByLastHistoryMessage:function(){for(var r=null,f=u.DateTimeHelper.minValue,e=t.IEnumerator.getEnumerator(this.get_conversations()),n,i;e.moveNext();)n=e.get_current(),n.get_hasMoreHistoryOnServer()&&(i=n.get_lastHistoryMessage(),i!=null&&i.get_timestamp()>f&&(f=i.get_timestamp(),r=n));return r},_onConversationRecentMessageReceived:function(t,i,r){this._processPendingHistoryMessages(),n(this).triggerHandler("recentMessageReceived",[this,r])},_onConversationHistoryChanged:function(n,t,r){var u;r.get_action()===i.NotifyCollectionChangedAction.add?(u=r.get_newItems()[0],u.get_isHistoryMessage()?(this._getHistoryPending="",this._pendingHistoryMessages.addRange(r.get_newItems()),this._processPendingHistoryMessages()):(u.get_networkName()!==this.get_currentConversation().get_network().get_name()&&this.set_currentConversation(this.getConversationByNetworkName(u.get_networkName())),this._history._add(u))):r.get_action()===i.NotifyCollectionChangedAction.remove&&(u=r.get_oldItems()[0],this._history._remove(u))},_processPendingHistoryMessages:function(){var i,n,e,r,u,o,f;if(!this._firstHistoryRequest){if(i=this._getConversationByLastHistoryMessage(),n=this._pendingHistoryMessages,n.length>0)if(n.sort(t.Delegate.create(this,this._compareMessagesCallback)),i!=null)for(e=i.get_lastHistoryMessage().get_timestamp(),r=n.length-1;r>=0;r--)if(n[r].get_timestamp()>=e)this._stagingHistoryMessages.insert(0,n[r]),n.splice(r,1);else break;else{if(this._history.get_count()>0&&this._history.get_item(0).get_timestamp()<this._pendingHistoryMessages[this._pendingHistoryMessages.length-1].get_timestamp()){for(this._history._beginReset(),this._history._items=[],this._history._endReset(),this._stagingHistoryMessages=[],n=[],u=t.IEnumerator.getEnumerator(this.get_conversations());u.moveNext();)o=u.get_current(),n=n.concat(o.get_history().get__items());n.sort(t.Delegate.create(this,this._compareMessagesCallback))}this._stagingHistoryMessages=n.concat(this._stagingHistoryMessages),this._pendingHistoryMessages=[]}f=this._stagingHistoryMessages.length,f>=this._pageSize||!this._hasMoreHistoryOnServer&&f>0?this._addToHistory():this._getHistoryPending===""&&i!=null&&(this._getHistoryPending=i.get_id(),i.getHistory())}},_addToHistory:function(){var t=this._stagingHistoryMessages.length-this._pageSize>0?this._stagingHistoryMessages.length-this._pageSize:0,n=this._stagingHistoryMessages.splice(t,this._pageSize);n.length>1?this._history._insertRange(0,n):this._history._insert(0,n[0])},_onConversationPropertyChanged:function(t,r,u){switch(u.get_propertyNamePascal()){case"HasMoreHistory":this._getHistoryPending!==""&&this._getHistoryPending===r.get_id()&&(this._getHistoryPending=""),this._updateHasMoreHistory();break;case"ConsumptionHorizon":n(this).triggerHandler("propertyChanged",[this,new i.PropertyChangedEventArgs("ConsumptionHorizon")])}},_updateHasMoreHistory:function(){for(var r=!1,u=t.IEnumerator.getEnumerator(this._conversations),f;u.moveNext();)f=u.get_current(),f.get_hasMoreHistoryOnServer()&&(r=!0);this._hasMoreHistoryOnServer!==r&&(this._hasMoreHistoryOnServer=r,this._processPendingHistoryMessages(),n(this).triggerHandler("propertyChanged",[this,new i.PropertyChangedEventArgs("HasMoreHistory")]))},_onConversationSendMessageFailed:function(t,i,r){n(this).triggerHandler("sendMessageFailed",[this,r])},_compareMessagesCallback:function(n,t){return n.get_timestamp()-t.get_timestamp()}}}(window.originaljQuery||jQuery),function(n){function o(n,t){var i=n.getMostRecentMessage(),r=t.getMostRecentMessage(),u=i?i.get_timestamp():0,f=r?r.get_timestamp():0;return f-u}function s(n){var t=[],i;n.forEach(function(n){i=n.get_mostRecentMessage(),t.push([i?i.get_timestamp():0,n])}),t.sort(function(n,t){return t[0]-n[0]}),n.length=0,t.forEach(function(t){n.push(t[1])})}var u=window,i=u.Microsoft.Live.Messenger,f=i.SortedCollection,r=u.ss,e=i.AggregatedConversationCollection=function(t){f.call(this,o,s),this._user=t,n(this._user.get_conversations()).bind("collectionChanged",r.Delegate.create(this,this._onConversationsCollectionChanged)),n(this._user.get_conversations()).bind("getRecentConversationsCompleted",r.Delegate.create(this,this._onGetRecentConversationsCompleted))},t=e.prototype=new f;t.constructor=e,t._user=null,t._hasMoreConversationsOnServer=!0,t._aggregatedConversationContactMap={},t._aggregatedConversationIdMap={},t.getMoreConversationsFromServer=function(){this._user._conversationGetRecentList()},t.get_hasMoreConversationsOnServer=function(){return this._hasMoreConversationsOnServer},t.get_items=function(){return this._items},t.getAggregatedConversationByContact=function(n){return n.get_id()?this._aggregatedConversationContactMap[n.get_id()]:null},t._onGetRecentConversationsCompleted=function(t,i){this._hasMoreConversationsOnServer=this._user.get_conversations().get_hasMoreConversationsOnServer(),n(this).triggerHandler("getMoreConversationsCompleted",{callFailed:i.callFailed})},t._onConversationsCollectionChanged=function(t,u,f){var c,o,s,h,e,l;switch(f.get_action()){case i.NotifyCollectionChangedAction.add:for(c=r.IEnumerator.getEnumerator(f.get_newItems());c.moveNext();)o=c.get_current(),s=o.get_buddyContact(),s!=null&&s.get_id()!=null&&(h=s.get_id(),this._aggregatedConversationContactMap[h]==null?(e=new i.AggregatedConversation(this._user),e.add(o),this._aggregatedConversationContactMap[h]=e,this._aggregatedConversationIdMap[o.get_id()]=e,n(e).bind("recentMessageReceived",r.Delegate.create(this,this._onAggregatedConversationRecentMessageReceived)),n(e.get_history()).bind("collectionChanged",r.Delegate.create(this,this._onAggregatedConversationCollectionChanged)),this._addItem(e)):(e=this._aggregatedConversationContactMap[h],e.add(o),this._aggregatedConversationIdMap[o.get_id()]=e));break;case i.NotifyCollectionChangedAction.remove:for(l=r.IEnumerator.getEnumerator(f.get_oldItems());l.moveNext();)o=l.get_current(),s=o.get_buddyContact(),s!=null&&s.get_id()!=null&&(e=this._aggregatedConversationContactMap[s.get_id()],e!=null&&(e.remove(o),this.removeAggregatedConversationIfEmpty(e,o.get_id())))}},t._onAggregatedConversationRecentMessageReceived=function(n,t){this._sortConversation(t)},t._onAggregatedConversationCollectionChanged=function(n,t,r){var u,f;r.get_action()==i.NotifyCollectionChangedAction.add&&r.get_newItems()?(u=r.get_newItems()[0],this._sortConversation(this.getAggregatedConversationByContact(this._user.get_conversations()._getConversationById$1(u.get_conversationId()).get_buddyContact()))):r.get_action()==i.NotifyCollectionChangedAction.remove&&r.get_oldItems()&&(u=r.get_oldItems()[0],f=this._aggregatedConversationIdMap[u.get_conversationId()],this.removeAggregatedConversationIfEmpty(f,u.get_conversationId()))},t._sortConversation=function(n){this._updateItem(n)},t.removeAggregatedConversationIfEmpty=function(n,t){n!=null&&n.get_history().get_count()==0&&(this._removeItem(n),this._aggregatedConversationIdMap[t]=null,this._aggregatedConversationContactMap[n.get_buddyContact().get_id()]=null)}}(window.originaljQuery||jQuery),function(){var i=window,n=i.Microsoft.Live.Messenger,f=i.ss,r=n.Collection,u=n.IMAddressCollection=function(n){r.call(this),this._owner$1=n},t=u.prototype=new r;t.constructor=u,t._owner$1=null,t.add=function(t){if(t==null)throw n._exceptionHelper.createArgumentNullException("address");if(this._contains(t))throw n._exceptionHelper.createArgumentException(n._exceptions.collectionItemDuplicate,"address");this._owner$1.addAddress(this,t)},t.remove=function(t){if(t==null)throw n._exceptionHelper.createArgumentNullException("address");if(!this._contains(t))throw n._exceptionHelper.createArgumentException(n._exceptions.collectionItemNotFound,"address");this._owner$1.removeAddress(this,t)},t._toArray=function(){for(var t=this.get__items(),i=new Array(t.length),n=0;n<t.length;n++)i[n]=t[n];return i},t._sort=function(){this.get__items().sort(f.Delegate.create(this,this._compareByRank$1))},t._compareByRank$1=function(n,t){return n.get_network().get__rank()-t.get_network().get__rank()},t.get_item=function(t){if(t<0||t>=this.get_count())throw n._exceptionHelper.createArgumentOutOfRangeException("index");return this.get__items()[t]}}(),function(n){function v(n){var t=f.BigInt.parseDecInt(f.BigInt.hexRadix,n);return t==null?null:t.toString()}var e=window,a=e.$WLXIM,o=e.MC,u=e.Microsoft.Live.Messenger,s=u.Services,f=e.MSH,r=e.ss,i=o.RoleLists,h=o.IMAddressInfoType,c=u._iimAddressCollectionOwner,l=u.LinkedContact=function(n,t,r){var l,o,e,v;for(c.call(this),this._roleLists=i.none,this._contactMap=n,this._contact=t,this._pwcContact=r,this._addresses=new u.IMAddressCollection(this),l=f.ContactHelper.createAddressInfos(r),o=0;o<l.length;o++)(e=l[o],e.type!==h.skype||s.SkyJSHelper.skypeEnabled)&&(e.type!==h.shortCircuit||a.isSkypeInvitesEnabled())&&(e.type!==h.connect||(v=this._contact.get__user().get_networks().get_item(e.network),v!=null&&v.get_supportsIM()))&&(address=this._contactMap._findOrCreateAddressForContact(this,e),this._roleLists|=e.roleLists,this._addresses._addInternal(address));this._network=this._addresses.get_count()>0?this._addresses.get_item(0).get_network():u.Network.get__windowsLive(),this._network.get_isSkype()?this._isBlocked=this._pwcContact.getIsBlocked()?!0:!1:this._network.get_isWindowsLive()&&(this._isBlocked=(this._roleLists&i.hide)!=0)},t=l.prototype=new c;t.constructor=l,t._contactMap=null,t._contact=null,t._addresses=null,t._network=null,t._skypeInviteSent=!1,t._isBlocked=!1,t.get_displayPictureUrl=function(){return this._pwcContact.getUserTile()||""},t.get_emailAddress=function(){return this._pwcContact.getPrimaryEmail()},t.get_firstName=function(){return this._pwcContact.getFirstName()},t.get_lastName=function(){return this._pwcContact.getLastName()},t.get_fullName=function(){return this._pwcContact.getFullName()},t.get_id=function(){return this._pwcContact.getId()!=null?this._pwcContact.getId().toLowerCase():null},t.get_isAllowed=function(){return(this._roleLists&i.allow)!=0},t.get_isBlocked=function(){return this._isBlocked},t.set_isBlocked=function(n){this.get_isBlockable()&&(this._isBlocked=n,this._onPropertyChanged("Block"))},t.get_isBlockable=function(){return this._addresses.get_count()==0?!1:this._addresses.get_item(0).get_type()===u.IMAddressType.shortCircuit?!1:this._network.get_isWindowsLive()?!0:this._network.get_isSkype()&&s.SkyJSHelper.initCompleted&&s.SkyJSHelper.getInstance().Outlook.isUserLinkStatusActive()?!0:!1},t.get_network=function(){return this._network},t.get_profileUrl=function(){var n=this._getUrlId(!1),t=this._network.get_pwcService().getProfileUrl();return!r.isNullOrEmpty(n)&&!r.isNullOrEmpty(t)?f.UriHelper.updateUrlProtocol(r.format(t,encodeURIComponent(n))):null},t.get_sendMessageUrl=function(){var n=this._getUrlId(!0),t=this._network.get_pwcService().getSendMessageUrl();return!r.isNullOrEmpty(n)&&!r.isNullOrEmpty(t)?f.UriHelper.updateUrlProtocol(r.format(t,encodeURIComponent(n))):null},t.get_skypePendingOutbound=function(){return this._pwcContact.getSkypePendingOutbound()?!0:!1},t.get_skypeInviteSent=function(){return this._skypeInviteSent},t.set_skypeInviteSent=function(n){return this._skypeInviteSent=n,n},t.get_pwcContact=function(){return this._pwcContact},t.get__info=function(){var n=new o.ContactInfo(this._pwcContact.getId(),this._pwcContact.getFullName(),new Array(0)),t,i;for(n.cid=this._pwcContact.getPerson().getCid()||"",n.firstName=this._pwcContact.getFirstName(),n.lastName=this._pwcContact.getLastName(),n.fullName=this._pwcContact.getFullName(),n.pictureUrl=this._pwcContact.getUserTile(),n.favoritesOrder=this._pwcContact.getFavoriteOrder()||"",n.isBlocked=this._pwcContact.getIsBlocked()?!0:!1,n.skypePendingOutbound=this._pwcContact.getSkypePendingOutbound()?!0:!1,t=f.ContactHelper.createAddressInfos(this._pwcContact),i=0;i<t.length;i++)t[i].messagingAddress=null;return n.addresses=t,n},t.get__isContact=function(){return(this._roleLists&i.forward)!=0},t.get__contact=function(){return this._contact},t.get__addresses=function(){return this._addresses},t._update=function(n){var h,c,e,u,f,t,o,s;if(!this._network.get__isRemoteNetwork()){for(h=this._isBlocked,c=this._pwcContact.getSkypePendingOutbound(),this._pwcContact=n,e=r.IEnumerator.getEnumerator(n.getMessagingAddresses());e.moveNext();)if(u=e.get_current(),u)for(f=0;f<this._addresses.get_count();f++)if(t=this._addresses.get_item(f),t._messagingAddress!=null&&t._messagingAddress._getMri()==u._getMri()){t._messagingAddress=u,t._updateMessagingAddress();break}o=i.allow|i.forward,s=n.getPerson(),(s.getOnHideList()||s.getTrustLevel()===3)&&(o|=i.hide),this._roleLists=o,this._network.get_isSkype()?this._isBlocked=this._pwcContact.getIsBlocked()?!0:!1:this._network.get_isWindowsLive()&&(this._isBlocked=(this._roleLists&i.hide)!=0),this._isBlocked!==h&&this._onPropertyChanged("Block"),this._pwcContact.getSkypePendingOutbound()!==c&&this._onPropertyChanged("SkypePendingOutbound")}},t._setRoleListChanges=function(n,t){var u=this._roleLists,f=(u^n)&n,r;if(u|=n,f|=u&t,u&=~t,f!==i.none){for(this._roleLists=u,r=0;r<this._addresses.get_count();r++)this._addresses.get_item(r).get__info().roleLists=u;for(this._contact._setRoleListChanges(n,t),r=0;r<this._addresses.get_count();r++)this._addresses.get_item(r)._setRoleListChanges(u,f);return!0}return!1},t._getUrlId=function(n){var t;return this._network.get__isRemoteNetwork()?t=this._pwcContact.getObjectId():n?t=this.get_emailAddress():(t=v(this._pwcContact.getPerson().getCid()),r.isNullOrEmpty(t)||(t=r.padLeft(t,16,"0"))),t},t._onPropertyChanged=function(t){n(this).triggerHandler("propertyChanged",[this,new u.PropertyChangedEventArgs(t)])},t.addAddress=function(n,t){var i=t.get_contact();i!=null&&i.get_addresses().remove(t),t._setRoleListChanges(this._roleLists,this._roleLists^t.get__info().roleLists),t._setLinkedContact(this),n._addInternal(t)},t.removeAddress=function(n,t){this._addresses.get_count()===1&&this._contact.get__user()._updateContactRoles(this,i.none,this._roleLists),n._removeInternal(t)}}(window.originaljQuery||jQuery),function(){var u=window,n=u.Microsoft.Live.Messenger,t=n.Collection,i=n.LinkedContactCollection=function(){t.call(this)},r=i.prototype=new t;r.constructor=i,r.get_item=function(n){return this.getItem(n)}}(),function(n){var h=["SKYPE","WL"],u=window,e=u.MC,i=u.Microsoft.Live.Messenger,r=u.ss,f=i.NotifyCollectionChangedAction,o=i.Collection,s=i.NetworkCollection=function(t){o.call(this),this._user$1=t,this._networks$1={},n(this).bind("collectionChanged",r.Delegate.create(this,this._onCollectionChanged$1)),i.Services.SkyJSHelper.skypeEnabled&&this._addSkype(),this._addInternal(i.Network.get__windowsLive())},t=s.prototype=new o;t.constructor=s,t._networks$1=null,t._hasOfficeCommunicator$1=!1,t._hasSkype$1=!1,t._hasTelephone=!1,t._user$1=null,t._updateNetworks=function(n,t,i){var u,e,o,s,h,f;if(this._beginReset(),n!=null)for(e=r.IEnumerator.getEnumerator(n);e.moveNext();)u=e.get_current(),this._updateNetwork$1(u);if(t!=null)for(o=r.IEnumerator.getEnumerator(t);o.moveNext();)u=o.get_current(),this._updateNetwork$1(u);if(i!=null)for(s=r.IEnumerator.getEnumerator(i);s.moveNext();)h=s.get_current(),f=this.get_item(h.getId()),f!=null&&f.get__isRemoteNetwork()&&this._removeInternal(f);this._sort$1(),this._endReset()},t._addSkype=function(){this._hasSkype$1||(this._addInternal(i.Network.get__skype()),this._hasSkype$1=!0,this._sort$1())},t._addOfficeCommunicator=function(){this._hasOfficeCommunicator$1||(this._addInternal(i.Network.get__officeCommunicator()),this._hasOfficeCommunicator$1=!0,this._sort$1())},t._addTelephone=function(){this._hasTelephone||(this._addInternal(i.Network.get_telephone()),this._hasTelephone=!0,this._sort$1())},t._markNetworksOffline=function(){for(var t=r.IEnumerator.getEnumerator(this),n;t.moveNext();)n=t.get_current(),n.get__isRemoteNetwork()&&n._setStatus(e.NetworkInfoStatus.signedOut)},t._updateNetwork$1=function(n){if(!h.contains(n.getId().toUpperCase())&&n.getSupportsIm()){var t=this.get_item(n.getId());t==null?(t=new i.Network(n,e.NetworkConnectionType.connect),t.set__user(this._user$1),this._addInternal(t)):t._setNetworkChanges(n)}},t._onCollectionChanged$1=function(n,t,i){var u,e;switch(i.get_action()){case f.add:for(u=0;u<i.get_newItems().length;u++)e=i.get_newItems()[u],e.set__user(this._user$1),this._networks$1[e.get_id()]=e;break;case f.remove:for(u=0;u<i.get_oldItems().length;u++)e=i.get_oldItems()[u],delete this._networks$1[e.get_id()];break;case f.reset:for(r.clearKeys(this._networks$1),u=0;u<this.get__items().length;u++)e=this.get__items()[u],e.set__user(this._user$1),this._networks$1[e.get_id()]=e}},t._sort$1=function(){this.get__items().sort(r.Delegate.create(this,this._compareNetworkByRank$1))},t._compareNetworkByRank$1=function(n,t){return n.get__rank()-t.get__rank()},t.get_item=function(n){if(n==null)throw i._exceptionHelper.createArgumentNullException("key");if(Object.isString(n)){var t=n;if(r.isNullOrEmpty(t))throw i._exceptionHelper.createArgumentNullOrEmptyException("id",t);return this._networks$1[t.toUpperCase()]}if(Object.isNumber(n))return this.getItem(n);throw i._exceptionHelper.createArgumentOutOfRangeException("key");}}(window.originaljQuery||jQuery),function(){var t=window,n=t.Microsoft.Live.Messenger;n.SignedInEventArgs=function(n){this._serverName$1=n},n.SignedInEventArgs.prototype={_serverName$1:null,get_serverName:function(){return this._serverName$1}}}(),function(){var t=window,n=t.Microsoft.Live.Messenger;n._signInState=function(n,t){this.userState=n,this.raiseSignInCompleted=t},n._signInState.prototype={userState:null,raiseSignInCompleted:!1}}(),function(){var t=window,n=t.Microsoft.Live.Messenger;n._signOutState=function(n,t,i){this.signedOutEndpoint=n,this.locations=t,this.userState=i},n._signOutState.prototype={signedOutEndpoint:null,locations:0,userState:null}}(),function(){var t=window,n=t.Microsoft.Live.Messenger;n._typingIMAddress=function(n){this._address=n,this._addTime=new Date},n._typingIMAddress.prototype={_address:null,_addTime:null,get_address:function(){return this._address},get_addTime:function(){return this._addTime},set_addTime:function(n){return this._addTime=n,n}}}(),function(){var t=window,i=t.Microsoft.Live.Messenger,r=t.MSH,u=t.ss,f=i.Collection,e=i.TypingIMAddressCollection=function(n){f.call(this),this._timeout$1=n,this._timeoutItems$1=[]},n=e.prototype=new f;n.constructor=e,n._timeout$1=0,n._timeoutItems$1=null,n._timer$1=null,n._add=function(n){this._contains(n)||this._addInternal(n),this._updateTimeoutItem$1(n),this._timer$1==null&&this._startTimer$1(this._timeout$1)},n._remove=function(n){this._removeInternal(n)},n._timerExpired$1=function(){for(var u=!1,t,i;this._timeoutItems$1.length>0;)if(t=this._getOldestExpirationItem$1(),i=this._timeout$1-r.DateTimeHelper.subtract(new Date,t.get_addTime()),i<=100)this._expireItem$1(t);else{this._startTimer$1(i),u=!0;break}u||(this._timer$1=null)},n._updateTimeoutItem$1=function(n){for(var r=!1,f=u.IEnumerator.getEnumerator(this._timeoutItems$1),t;f.moveNext();)if(t=f.get_current(),t.get_address().equals(n)){t.set_addTime(new Date),r=!0;break}r||this._timeoutItems$1.push(new i._typingIMAddress(n))},n._expireItem$1=function(n){this._removeInternal(n.get_address()),this._timeoutItems$1.remove(n)},n._getOldestExpirationItem$1=function(){for(var n=this._timeoutItems$1[0],i=u.IEnumerator.getEnumerator(this._timeoutItems$1),t;i.moveNext();)t=i.get_current(),t.get_addTime()<n.get_addTime()&&(n=t);return n},n._startTimer$1=function(n){this._timer$1=new r.Timer(u.Delegate.create(this,this._timerExpired$1),null,n,r.Timeout.infinite)},n.get_item=function(n){return this.getItem(n)}}(),function(){var f=window,s=f.MC,r=f.Microsoft.Live.Messenger,u=f.MSCo,n=s.RoleLists,i=r.SessionServices,e=r._iContactCollectionOwner,o=r._roleListOwner=function(t,i){e.call(this),this._user=t,this._addedLists=i,i===n.allow&&(this._removedLists=n.block),i===n.block&&(this._removedLists=n.allow)},t=o.prototype=new e;t.constructor=o,t._user=null,t._addedLists=0,t._removedLists=0,t._collection=null,t.canAddContact=function(t){var r=this._user.get_services();switch(this._addedLists){case n.allow:case n.block:case n.hide:if(t.get__isCidContact()||r===i.contactPresence||r===i.notifications)return!1;break;case n.forward:if(r===i.notifications)return!1}return!0},t.canRemoveContact=function(){var r=this._user.get_services();switch(this._removedLists){case n.allow:case n.block:case n.hide:if(r===i.contactPresence||r===i.notifications)return!1;break;case n.forward:if(r===i.notifications)return!1}return!0},t.addContact=function(n,t){var i,r;if(!t.get_isEmailOnlyContact()&&!t.get__isRemoteOnlyContact()&&!t.get__isCidContact())for(i=0;i<t.get_linkedContacts().get_count();i++)r=t.get_linkedContacts().get_item(i),r.get_network().get__isRemoteNetwork()||this._user._updateContactRoles(r,this._addedLists,this._removedLists)},t.removeContact=function(n,t){var i,u;if(t.get__isCidContact())throw r._exceptionHelper.createInvalidOperationException(r._exceptions.contactMustMemberUserContact);for(i=0;i<t.get_linkedContacts().get_count();i++)u=t.get_linkedContacts().get_item(i),u.get_network().get__isRemoteNetwork()||this._user._updateContactRoles(u,this._removedLists,this._addedLists)},t.containsContact=function(t){switch(this._addedLists){case n.forward:return t.get_isContact();case n.allow:return t.get_isAllowed();case n.hide:return t.get_isAppearOfflineTo();default:return this._collection._contains(t)}},t.setCollection=function(n){this._collection=n},t.get_capacity=function(){switch(this._addedLists){case n.allow:return u.Configuration.maximumAllowedContactCount;case n.block:return u.Configuration.maximumBlockedContactCount;case n.forward:return u.Configuration.maximumContactCount;case n.hide:return u.Configuration.maximumContactCount;default:return 0}}}(),function(){var t=window,n=t.Microsoft.Live.Messenger;n.EmailReceivedEventArgs=function(n,t,i,r,u){this._subject$1=n,this._sender$1=t,this._senderAddress$1=i,this._messageUrl$1=r,this._folder$1=u},n.EmailReceivedEventArgs.prototype={_subject$1:null,_sender$1:null,_senderAddress$1:null,_messageUrl$1:null,_folder$1:0,get_subject:function(){return this._subject$1},get_sender:function(){return this._sender$1},get_senderAddress:function(){return this._senderAddress$1},get_messageUrl:function(){return this._messageUrl$1},get_folder:function(){return this._folder$1}}}(),function(n){var r=window,f=r.MC,i=r.Microsoft.Live.Messenger,e=r.MSCo,o=r.ss,u=f.MailNotificationInfoType,t=f.MailNotificationFolderType;i.Mailbox=function(n){if(n==null)throw i._exceptionHelper.createArgumentNullException("user");this._user=n},i.Mailbox.prototype={_user:null,_inboxInitialCount:0,_inboxUnreadCount:0,_otherInitialCount:0,_otherUnreadCount:0,get_inboxInitialCount:function(){return this._inboxInitialCount},set_inboxInitialCount:function(n){return n!==this._inboxInitialCount&&(this._inboxInitialCount=n,this._onPropertyChangedEvent("InboxInitialCount")),n},get_inboxUnreadCount:function(){return this._inboxUnreadCount},set_inboxUnreadCount:function(n){return n!==this._inboxUnreadCount&&(this._inboxUnreadCount=n,this._onPropertyChangedEvent("InboxUnreadCount")),n},get_otherInitialCount:function(){return this._otherInitialCount},set_otherInitialCount:function(n){return n!==this._otherInitialCount&&(this._otherInitialCount=n,this._onPropertyChangedEvent("OtherInitialCount")),n},get_otherUnreadCount:function(){return this._otherUnreadCount},set_otherUnreadCount:function(n){return n<0&&(n=0),n!==this._otherUnreadCount&&(this._otherUnreadCount=n,this._onPropertyChangedEvent("OtherUnreadCount")),n},get__user:function(){return this._user},_onMailNotification:function(n){var s,f,r;switch(n.type){case u.initial:s=n.notification,this.set_inboxInitialCount(s.inboxTotal),this.set_inboxUnreadCount(s.inboxUnread),this.set_otherInitialCount(s.foldersTotal),this.set_otherUnreadCount(s.foldersUnread);break;case u.incoming:if(f=n.notification,f.folder!==t.hidden)this.onEmailReceived(new i.EmailReceivedEventArgs(f.subject,f.from,f.fromAddress,o.format(e.Configuration.get_messageUrlFormat(),f.messageUrl),f.folder));break;case u.activity:r=n.notification,r.source===t.inbox?(this.set_inboxUnreadCount(this.get_inboxUnreadCount()-r.delta),r.destination!==t.inbox&&r.destination!==t.hidden&&this.set_otherUnreadCount(this.get_otherUnreadCount()+r.delta)):r.source!==t.hidden?(this.set_otherUnreadCount(this.get_otherUnreadCount()-r.delta),r.destination===t.inbox&&this.set_inboxUnreadCount(this.get_inboxUnreadCount()+r.delta)):r.destination===t.inbox?this.set_inboxUnreadCount(this.get_inboxUnreadCount()+r.delta):r.destination!==t.hidden&&this.set_otherUnreadCount(this.get_otherUnreadCount()+r.delta)}},onEmailReceived:function(t){n(this).triggerHandler("emailReceived",[this,t])},onPropertyChanged:function(t){n(this).triggerHandler("propertyChanged",[this,t])},_onPropertyChangedEvent:function(n){this.onPropertyChanged(new i.PropertyChangedEventArgs(n))}}}(window.originaljQuery||jQuery),function(){var r=120,u=30,i=window,f=i.MC,n=i.Microsoft.Live.Messenger,t=i.MSH,e=i.ss;n._userAutoReconnect=function(n){this._waitTime=-1,this._user=n},n._userAutoReconnect.prototype={_waitTime:0,_autoReconnectWaitTimer:null,_targetReconnectTime:null,_reconnectStatus:f.PresenceInfoStatus.none,get_reconnectStatus:function(){return this._reconnectStatus},dispose:function(){this._clearAutoReconnectTimers()},onSignIn:function(){this._clearAutoReconnectTimers()},onSignedIn:function(){this._clearAutoReconnectTimers(),this._waitTime=-1},onSignOut:function(){this._clearAutoReconnectTimers(),this._waitTime=-1,this._user.set__state(n._userState.signedOut);this._user.onSignedOut(new n.SignedOutEventArgs(n.SignedOutReason.signedOutByLocalEndpoint))},trigger:function(t){this._user.get__state()===n._userState.signedIn&&(this._reconnectStatus=this._user.get_address().get__serviceDataSet().imServiceData.get_status()),this._startAutoReconnectWaitTimer(t),this._user.set__state(n._userState.autoReconnectWaiting)},_clearAutoReconnectTimers:function(){this._updateAutoReconnectWaitTime(-1),this._autoReconnectWaitTimer!=null&&(this._autoReconnectWaitTimer.dispose(),this._autoReconnectWaitTimer=null)},_updateAutoReconnectWaitTime:function(n){this._user._setAutoReconnectWaitTime(n)},_startAutoReconnectWaitTimer:function(i){if(this._autoReconnectWaitTimer==null&&(this._autoReconnectWaitTimer=new t.Timer(e.Delegate.create(this,this._onAutoReconnectWaitTimerElapsed),null,t.Timeout.infinite,t.Timeout.infinite)),i>=0)this._waitTime=i;else if(this._waitTime===-1){var f=2,o=60;this._waitTime=Math.floor(f+Math.random()*(o-f))}else this._waitTime=Math.min(this._waitTime+u,r);this._targetReconnectTime=t.DateTimeHelper.addMilliseconds(new Date,1e3*this._waitTime),this._updateAutoReconnectWaitTime(this._waitTime),this._user.set__state(n._userState.autoReconnectWaiting),this._autoReconnectWaitTimer.change(1e3,1e3)},_onAutoReconnectWaitTimerElapsed:function(){var i=Math.round(t.DateTimeHelper.subtract(this._targetReconnectTime,new Date)/1e3);i>0?this._updateAutoReconnectWaitTime(i):(this._autoReconnectWaitTimer.change(t.Timeout.infinite,t.Timeout.infinite),this._updateAutoReconnectWaitTime(-1),this._user._signInInternal(null,!1))}}}(),function(n){var o=window,d=o.$Config,b=o.$WLXIM,t=o.MC,i=o.Microsoft.Live.Messenger,p=i.Services,g=o.MSCo,k=o.MSH,r=o.ss,l=t.CapabilitiesFlags,y=t.IMAddressInfoType,s=t.MessengerServiceResultCode,a=t.PresenceInfoStatus,v=t.RoleLists,f=t.SessionServiceOptions,e=t.SignOutLocationFlags,nt=t.UpdateIMAvailabilityOperationCode,w=i.PresenceStatus,c=i.SessionServices,h=i.SignOutLocations,u=i._userState;i.User=function(u,f){var h,e,o,s;if(this._lastDisplayNameValue="",this._autoReconnectWaitTime=-1,this._pendingServiceDataChanges=[],this._inboundInvites={},this._pendingStartGroupChatThreadId=null,u==null)throw i._exceptionHelper.createArgumentNullException("identity");if(!u.get_isAuthenticated())throw i._exceptionHelper.createInvalidOperationException(i._exceptions.identityNotAuthenticated);if(r.isNullOrUndefined(f))throw i._exceptionHelper.createArgumentException(i._exceptions.argumentNull,"contactsReader");this._identity=u,this._identity.set__user(this),this._service=this._identity.get__userService(),this._events=this._identity.get__userEvents(),this._events.set__user(this),this._settings=new t.Settings,this._sessionServices=this._identity.get__initialServices(),this._contactMap=new i._contactDictionary(this),this._contacts=new i.ContactCollection(this,new i._roleListOwner(this,v.forward)),this._conversations=new i.ConversationCollection(this),this._aggregatedConversations=new i.AggregatedConversationCollection(this),this._addContactEvents=[],this._networks=new i.NetworkCollection(this),h=this._initializeServiceData(),e=new t.IMAddressInfo(u.get_liveId().toLowerCase(),y.windowsLive,v.none),e.cid=u.get_cid(),o=new t.IMAddressInfo(u.get_cid(),y.shortCircuit,v.none),s=[e,o],p.SkyJSHelper.skypeEnabled&&(s=[e,o,new t.IMAddressInfo(null,y.skype,v.none)]),this._contact=this._contactMap._createUserContact(s),this._shortCircuitAddress=this._contact.get_shortCircuitAddress(),this._address=this._contact.get_windowsLiveAddress(),this._address._onServiceDataChanged(h.toArray()),n(this._address.get_presence()).bind("propertyChanged",r.Delegate.create(this,this._onUserPresencePropertyChanged)),n(this._contact).bind("propertyChanged",r.Delegate.create(this,this._onUserContactPropertyChanged)),this._localEndpoint=this._address.get_endpoints().get_item(0),this._createMailbox(),this._userAutoReconnect=new i._userAutoReconnect(this),this._contactsReader=f,this._contactsReader.initialize(r.Delegate.create(this,this._onContactsReaderInitialized)),t.WebmainHelper.qoSResetTime(t.WebmainHelper.qoSScenarioSignin),n(this._contactsReader).bind("networksChanged",r.Delegate.create(this,this._onNetworksChanged)),n(this.get_networks()).bind("collectionChanged",r.Delegate.create(this,this._networkCollectionChanged))},i.User.prototype={_settings:null,_events:null,_identity:null,_address:null,_shortCircuitAddress:null,_contact:null,_localEndpoint:null,_contacts:null,_contactMap:null,_conversations:null,_aggregatedConversations:null,_networks:null,_service:null,_skypeAddress:null,_mailbox:null,_state:u.initialized,_addContactEvents:null,_signInStartTime:null,_sessionServices:f.normal,_userAutoReconnect:null,_hasSignedIn:!1,_invitationsRequireNotification:!1,_pendingIMAvailabilityState:null,_contactsReader:null,_peopleDataPopulated:!1,_peopleDataReadyCallback:null,_pendingInviteCount:0,_getInvitationsQoSScenario:null,_onNetworksChanged:function(n,t,i){this._networks._updateNetworks(i.added,i.changed,i.removed)},_networkCollectionChanged:function(n,u,f){var o,s,e;if(f.get_action()===i.NotifyCollectionChangedAction.remove){if(o=f.get_oldItems(),o==null)return;for(s=r.IEnumerator.getEnumerator(o);s.moveNext();){e=s.get_current(),e.get_isFacebook()&&e.get_imEnabled()&&this._updateNetwork(e.get_id(),t.NetworkOperationType.disableIM,!1);break}}},_initializeServiceData:function(){var e=l.appVersion2009,h=l.supportsOfflineIM,o=l.supportsMissedConversations,c=l.none,v=l.none,r,f,u,s,n;return e|=l.onlineViaWebIM,p.SkyJSHelper.skypeEnabled&&(o|=l.supportsShortCircuit),r=t.ServiceEndpointData.createEmpty(t.ServiceType.PD,this._identity.get__endpointId()),r.set_name(i._globalConfiguration.get__domainName()),r.set_clientType(t.ClientType.website),f=t.ServiceEndpointData.createEmpty(t.ServiceType.IM,this._identity.get__endpointId()),f.set_capabilities([e,h,o]),u=t.ServiceEndpointData.createEmpty(t.ServiceType.PE,this._identity.get__endpointId()),u.set_capabilities([c,v]),s=t.ServiceEndpointData.createEmpty(t.ServiceType.SKP,this._identity.get__endpointId()),u.set_clientType(t.ClientType.website),n=t.ServiceDataSet.create(),n.imServiceData.set_status(a.offline),n.imServiceData.addEndpoint(f),n.pdServiceData.addEndpoint(r),n.peServiceData.addEndpoint(u),n.skpServiceData.addEndpoint(s),n},get_contactMap:function(){return this._contactMap},get__userServiceEvents:function(){return this._events},get__contactsReader:function(){return this._contactsReader},get_settings:function(){return this._settings},get_autoReconnectWaitTime:function(){return this._autoReconnectWaitTime},get_identity:function(){return this._identity},get_displayName:function(){var n=this.get_contact();return r.isNullOrEmpty(this.get_presence().get_displayName())?this.get_identity().get_liveId():this.get_presence().get_displayName()},get_address:function(){return this._address},get_skypeAddress:function(){return this._skypeAddress},get_shortCircuitAddress:function(){return this._shortCircuitAddress},get_contact:function(){return this._contact},get_presence:function(){return this._address.get_presence()},get_endpoints:function(){return this._address.get_endpoints()},get_localEndpoint:function(){return this._localEndpoint},get_conversations:function(){return this._conversations},get_aggregatedConversations:function(){return this._aggregatedConversations},get_contacts:function(){return this._contacts},get_services:function(){switch(this._sessionServices){case f.contactPresence:return c.contactPresence;case f.normal:return c.normal;case f.full:return c.full;case f.notifications:return c.notifications;default:return c.normal}},set_services:function(n){if(this._ensureStatusChangeAllowed(),n!==this.get_services()){switch(n){case c.contactPresence:this._onServicesChanged(f.contactPresence);break;case c.full:this._onServicesChanged(f.full);break;case c.normal:this._onServicesChanged(f.normal);break;case c.notifications:this._onServicesChanged(f.notifications);break;default:throw i._exceptionHelper.createArgumentOutOfRangeException("Services");}this._state===u.signedIn&&this._updateServices(this._sessionServices)}return n},get_status:function(){switch(this.get__state()){case u.signedIn:return i.UserStatus.signedIn;case u.disposed:case u.initialized:case u.signedOut:return i.UserStatus.signedOut;case u.signingIn:return i.UserStatus.signingIn;case u.signingOut:return i.UserStatus.signingOut;case u.autoReconnectWaiting:return i.UserStatus.autoReconnectWaiting;default:return i.UserStatus.signedOut}},get_mailbox:function(){return this._mailbox},get_networks:function(){return this._networks},get__disposed:function(){return this.get__state()===u.disposed},get__state:function(){return this._state},set__state:function(n){var r,i;if(n!==this._state){if(t.Logger.logDetails("UserState",{userState:t.enumToString(u,n)}),r=this.get_status(),this._state=n,r!==this.get_status())this.onPropertyChanged("Status");this._state===u.signedIn?this._events.processPendingConversations():this._state===u.signedOut&&(i=t.ServiceData.createEmpty(t.ServiceType.IM),i.set_status(a.offline),this._address._onServiceDataChanged([i.get_info()]))}return n},add_signedOut:function(t){n(this).bind("signedOut",r.Delegate.create(this,t))},remove_signedOut:function(t){n(this).unbind("signedOut",r.Delegate.create(this,t))},remove_conversation:function(n,i,r){var f=this,u=b.getTestFlags();if((u&t.TestFlags.DeleteConversationPartialFailure)==t.TestFlags.DeleteConversationPartialFailure){b.setTestFlags(u&~t.TestFlags.DeleteConversationPartialFailure),r.invoke(!1);return}if((u&t.TestFlags.DeleteConversationFailure)==t.TestFlags.DeleteConversationFailure){r.invoke(!1);return}f._service.conversationDelete(n.get_id(),i,function(i){i==t.ConnectionServiceResultCode.success?f.get_conversations().removeConversation(n):t.Logger.logResult("RemoveConversationFailed",i),r.invoke(i==t.ConnectionServiceResultCode.success)})},findContactById:function(n){if(r.isNullOrEmpty(n))throw i._exceptionHelper.createArgumentNullOrEmptyException("id",n);return this._contactMap._findContactById(n)},findContactBySkypeId:function(n,t){if(r.isNullOrEmpty(n))throw i._exceptionHelper.createArgumentNullOrEmptyException("skypeId",n);return this._contactMap._findContactBySkypeId(n,t)},findContactByThreadId:function(n){if(r.isNullOrEmpty(n))throw i._exceptionHelper.createArgumentNullOrEmptyException("threadId",n);var u=r.format("{0}:{1}",t.IMAddressInfoType.temporaryGroup,n);return this.get_contactMap()._addressMap[u]},addToStartGroupChatPendingList:function(n){if(r.isNullOrEmpty(n))throw i._exceptionHelper.createArgumentNullOrEmptyException("threadId",n);this._pendingStartGroupChatThreadId=r.format("{0}:{1}",t.IMAddressInfoType.temporaryGroup,n)},reportAbuse:function(n,u){var f;if(n!=null){if(!n.get_supportsReportAbuse())throw i._exceptionHelper.createInvalidOperationException(r.format("Report Abuse not supported for {0} imaddress type",t.enumToString(i.IMAddressType,n.get_type())));f=n.get__info()}else if(r.isNullOrEmpty(u))throw i._exceptionHelper.createArgumentNullException("Either imaddress or skypeid needs to be non-null");else f=new t.IMAddressInfo(u,t.IMAddressInfoType.skype,t.RoleLists.none);this._service.reportAbuse(f,r.Delegate.create(this,this._onReportAbuseCompleted))},signIn:function(n){t.WebmainHelper.qoSResetTime(t.WebmainHelper.qoSScenarioSignin),this._signInInternal(n,!0)},_signInInternal:function(n,r){this._ensureNotDisposed();var e=this,o=function(){var s,o,h,c;if(e._signInStartTime=new Date,e.get__state()!==u.autoReconnectWaiting&&e.get__state()!==u.initialized)throw i._exceptionHelper.createInvalidOperationException(i._exceptions.userAlreadySignedIn);if(s=new i._signInState(n,r),e.get__state()===u.autoReconnectWaiting&&(e._userAutoReconnect.onSignIn(),e._hasSignedIn)){e._reconnect(s);return}e._address.get_presence().get_status()===w.offline&&e._sessionServices!==f.notifications&&e._sessionServices!==f.contactPresence&&(o=t.ServiceData.createEmpty(t.ServiceType.IM),(o.get_status()===a.none||o.get_status()===a.offline)&&(h=e.get_settings().get_userPresencePreference(),h!=null&&h==w.appearOffline?o.set_status(a.appearOffline):o.set_status(a.online)),e._address._onServiceDataChanged([o.get_info()])),e.set__state(u.signingIn),t.Logger.logAction("UserSignIn"),c=p.SkyJSHelper.skypeEnabled,e._service.signIn(e._identity._getIdentityInfo(),e._address.get__serviceDataSet().toArray(),e._sessionServices,null,s,c)};this._peopleDataPopulated?o.invoke(null,{}):this._peopleDataReadyCallback=o},triggerFakeAutoReconnect:function(){},signOut:function(n,t){var f,o,c,s;if(arguments.length===0&&(n=h.sameDomain),this.get__state()===u.autoReconnectWaiting&&(n===h.all||n===h.local)){this._userAutoReconnect.onSignOut();return}this._ensureSignedIn(),o=null;switch(n){case h.all:f=e.allEndpoints;break;case h.remote:f=e.remoteEndpoints;break;case h.local:f=e.localEndpoint;break;case h.sameDomain:for(o=[],c=r.IEnumerator.getEnumerator(this.get_endpoints().get__allEndpoints());c.moveNext();)s=c.get_current(),s!==this._localEndpoint&&s.get_isInstance()&&s.get__isIMEndpoint()&&o.push(s.get_id().toString());o.length===0?(o=null,f=e.localEndpoint):f=e.specificEndpoints|e.localEndpoint;break;default:throw i._exceptionHelper.createArgumentOutOfRangeException("locations");}(f&e.localEndpoint)===e.localEndpoint&&this.set__state(u.signingOut),this._service.signOut(f,o,!0,new i._signOutState(null,n,t))},signOutEndpoint:function(n,t){if(n==null)throw i._exceptionHelper.createArgumentNullException("endpoint");if(!this._address.get_endpoints()._contains(n))throw i._exceptionHelper.createArgumentException(i._exceptions.objectNotBelongToUser,"endpoint");if(this.get__state()===u.autoReconnectWaiting&&this._localEndpoint===n){this._userAutoReconnect.onSignOut();return}this._ensureSignedIn();var r,f,o;this._localEndpoint===n?(o=null,r=e.localEndpoint,f=h.local,this.set__state(u.signingOut)):(o=[n.get_id().toString()],r=e.specificEndpoints,f=h.remote),this._service.signOut(r,o,!0,new i._signOutState(n,f,t))},createSkypeInitializationInfo:function(n){var f,r;if(this._identity.get__authenticationInfo().authType!==t.AuthenticationType.rpsAuth)throw i._exceptionHelper.createInvalidOperationException("User must be using RPS auth.");else if(this.get__state()!==u.signedIn)throw i._exceptionHelper.createInvalidOperationException("User must be signed in.");else{for(f=new Array(this.get_networks().get_count()),r=0;r<this._networks.get_count();++r)f[r]=this._networks.get_item(r).get__info();return t.JSON.serialize(new t.SkypeInitializationInfo(this._identity.get_liveId(),this._identity.get_cid(),n._toPersonInfo(),f))}},findOrCreateShortCircuitContact:function(n,i){var u=new t.IMAddressInfo(n,y.shortCircuit,v.none),r=this._findOrCreateAddress(u).get_contact();return r._setDisplayNameChanges(i),r},_onReportAbuseCompleted:function(){},_reconnect:function(n){this._identity.set_reconnectScenarioQoSObject(t.WebmainHelper.startQoS(t.WebmainHelper.qoSScenarioReconnect)),t.WebmainHelper.qoSResetTime(t.WebmainHelper.qoSScenarioReconnect),this.set__state(u.signingIn);var i=this._address.get__serviceDataSet();(this._sessionServices===f.full||this._sessionServices===f.normal)&&this._userAutoReconnect.get_reconnectStatus()!==i.imServiceData.get_status()&&(i=i.clone(),i.imServiceData.set_status(this._userAutoReconnect.get_reconnectStatus())),this._service.reconnect(i.toArray(),this._sessionServices,this._getEnabledConnectNetworks(),n)},_onUserPresencePropertyChanged:function(n,t,i){if(i.get_propertyNamePascal()==="DisplayName")this.onPropertyChanged(i.get_propertyNamePascal())},_onUserContactPropertyChanged:function(n,t,i){if(i.get_propertyNamePascal()==="DisplayName")this.onPropertyChanged(i.get_propertyNamePascal())},_onContactsChanged:function(n,t,i){var u,f,e;if(i.changed!=null&&i.changed.length>0)for(f=r.IEnumerator.getEnumerator(i.changed);f.moveNext();)u=f.get_current(),u.isMe()?this._updateUserMessagingAddress(u):this._contactMap._createOrUpdateContact(u);if(i.added!=null&&i.added.length>0)for(e=r.IEnumerator.getEnumerator(i.added);e.moveNext();)u=e.get_current(),this._contactMap._createOrUpdateContact(u)},_onServicesChanged:function(n){if(this._sessionServices!==n){(n===f.notifications||n===f.contactPresence)&&(this._conversations._clear(),this.get_presence().get_status()!==w.offline&&this._markUserAsOffline()),this._sessionServices=n;this.onPropertyChanged("Services")}},_onServiceDataChanged:function(n,t){var i=this._findAddress(n);i!=null?i._onServiceDataChanged(t):this.get__state()===u.signingIn&&this._pendingServiceDataChanges.push([n,t])},_onServiceDataDeleted:function(n,t){var i=this._findAddress(n);i!=null&&i._onServiceDataDeleted(t)},_onConversationCreated:function(n,t,r){return i.Conversation._createFromIncoming(this,n,t,r)},_findAddress:function(n){return this._contactMap._findAddress(n)},_findOrCreateAddress:function(n){return this._contactMap._findOrCreateAddress(n)},_beginPopulate:function(){this._beginResetCollections(),this._populateBatch(r.IEnumerator.getEnumerator(this._contactsReader.get_persons()),i._globalConfiguration.get__userPopulationBatchSize())},_populateBatch:function(n,t){for(var u=t,f=!1,r,e,o;(t===i._globalConfiguration._disablePopulateBatching||u>0)&&(f=n.moveNext());)r=n.get_current(),this._populateContact(r),u-=r.getContacts().length;f?(e=this,o=new k.Timer(function(){e._populateBatch(n,t)},null,1,k.Timeout.infinite)):this._endPopulate()},_endPopulate:function(){this._endResetCollections(),n(this._contactsReader).bind("personsChanged",r.Delegate.create(this,this._onContactsChanged)),this._peopleDataPopulated=!0,this._peopleDataReadyCallback!=null&&this._peopleDataReadyCallback.invoke(this,{})},_populateContact:function(n){n.isMe()?this._updateUserMessagingAddress(n):this._contactMap._createContactAndLinkedContacts(n,!1)},_updateUserMessagingAddress:function(n){for(var i=n.getMessagingAddresses()[0],u=r.IEnumerator.getEnumerator(this.get_contact().get_addresses()),t;u.moveNext();)t=u.get_current(),i._setProperty(t._messagingAddress.isActiveAddress(),t._messagingAddress.getPresence(),t._messagingAddress.canCall(),t._messagingAddress.canChat(),t._messagingAddress.canGroupChat()),t._messagingAddress=i},_beginResetCollections:function(){this._contacts._beginReset()},_endResetCollections:function(){this._contacts._endReset()},_onIMAvailabilityUpdated:function(n){n!=null&&(n===this._pendingIMAvailabilityState&&this.get_presence().get_status()===w.appearOffline&&this.get_presence().set_status(w.online),this._pendingIMAvailabilityState=null)},onSignInCompleted:function(t){n(this).triggerHandler("signInCompleted",[this,t])},onSignOutCompleted:function(t){n(this).triggerHandler("signOutCompleted",[this,t])},onSignOutEndpointCompleted:function(t){n(this).triggerHandler("signOutEndpointCompleted",[this,t])},onSignedOutRemotely:function(t){n(this).triggerHandler("signedOutRemotely",[this,t])},onSignedOut:function(t){n(this).triggerHandler("signedOut",[this,t])},onSignedIn:function(t){n(this).triggerHandler("signedIn",[this,t])},onPropertyChanged:function(t){if(t==="DisplayName"){if(this._lastDisplayNameValue===this.get_displayName())return;this._lastDisplayNameValue=this.get_displayName()}n(this).triggerHandler("propertyChanged",[this,new i.PropertyChangedEventArgs(t)])},_updateServices:function(n){this._ensureSignedIn(),this._service.updateServices(n,!0,this._getEnabledConnectNetworks())},_updateNetwork:function(n,t,i){this._ensureSignedIn(),this._service.updateNetwork(n,t,i)},_updateServiceData:function(n){var i=this.get_presence().get__currentServiceData().imServiceData.get_status(),t=[n.get_info()];this.get__state()===u.signedIn&&this._service.updateServiceData(t,null),this._address._onServiceDataChanged(t)},_updateContactRoles:function(n,t,i){this._ensureSignedIn(),n._setRoleListChanges(t,i)},onCreateMailbox:function(){return new i.Mailbox(this)},onCreateConversation:function(n){return new i.Conversation(this,n)},_createMailbox:function(){var n=this.onCreateMailbox();if(n==null||n.get__user()!==this)throw i._exceptionHelper.createArgumentException(i._exceptions.objRetOnCreateMailboxInvalid,"mailbox");this._mailbox=n},_createConversation:function(n){var t=this.onCreateConversation(n);if(t==null||t.get_user()!==this)throw i._exceptionHelper.createInvalidOperationException(i._exceptions.onCreateConvRetInvalidConv);return t},_createConversationFromIncoming:function(n,t){this.get_conversations().set__currentConversationCreator(n),this.get_conversations().set__currentConversationId(t);try{return this._createConversation(n)}catch(i){throw i;}finally{this.get_conversations().set__currentConversationCreator(null)}},_createGroupConversation:function(n){var r=n.creator?this._findOrCreateAddress(n.creator):this.get_address(),t;return this.get_conversations().set__currentConversationCreator(r),this.get_conversations().set__currentConversationId(n.id),this._pendingStartGroupChatThreadId!=null&&this._pendingStartGroupChatThreadId==n.id.toLowerCase()&&(n.userInitiated=!0,this._pendingStartGroupChatThreadId=null),t=new i.GroupConversation(this,r,n),t.get_user()!==this&&this.get_conversations().set__currentConversationCreator(null),t},_ensureNotDisposed:function(){if(this.get__state()===u.disposed)throw i._exceptionHelper.createObjectDisposedException("User");},_ensureSignedIn:function(){if(this._ensureNotDisposed(),this.get__state()!==u.signedIn)throw i._exceptionHelper.createInvalidOperationException(i._exceptions.userMustBeSignedInForOperation);},_ensureServicesRichOperation:function(){if(this._sessionServices!==f.full&&this._sessionServices!==f.normal)throw i._exceptionHelper.createInvalidOperationException(i._exceptions.userInvalidServices);},_ensureServicesModifyContactList:function(){if(this._sessionServices!==f.contactPresence&&this._sessionServices!==f.normal&&this._sessionServices!==f.full)throw i._exceptionHelper.createInvalidOperationException(i._exceptions.userInvalidServices);},_ensureAuthenticationType:function(n){if(this._identity.get__authenticationInfo().authType!==n)throw i._exceptionHelper.createInvalidOperationException(i._exceptions.invalidOperationForCurrentAuthMode);},_ensureStatusChangeAllowed:function(){if(this._ensureNotDisposed(),this.get__state()!==u.initialized&&this.get__state()!==u.signedIn)throw i._exceptionHelper.createInvalidOperationException(i._exceptions.userMustBeSignedInForOperation);},dispose:function(){var n,t;this.get__state()!==u.disposed&&(n=this.get__state(),this.set__state(u.disposed),(n===u.signingIn||n===u.signedIn)&&(t=e.localEndpoint,this._service.signOut(t,null,!0,new i._signOutState(null,h.local,null))),this._userAutoReconnect.dispose())},_conversationCreate:function(n,t){this._service.conversationCreate(n,t.get__info())},_conversationCreateGroup:function(n){var i=this._contact.get_skypeAddress(),r=new t.GroupConversationMemberInfo(this._contact.get_windowsLiveAddress().get__info(),i?i.get__info():null);r.isAdmin=!0,n[n.length]=n[0],n[0]=r,this._service.conversationCreateGroup(n)},_conversationAddMembers:function(n,t,i){this._service.conversationAddMembers(n,t,i)},_conversationRemoveMembers:function(n,t,i){this._service.conversationRemoveMembers(n,t,i)},_conversationSendMessage:function(n,t,i){this._service.conversationSendMessage(n,t,i)},_conversationGetRecentList:function(){this._service.conversationGetRecentList()},_conversationGetHistory:function(n){this._service.conversationGetHistory(n)},_conversationUpdateConsumptionHorizon:function(n,t){this._service.conversationUpdateConsumptionHorizon(n,t)},_conversationClose:function(n){this._service.conversationClose(n)},_completeSignIn:function(f,e,o,h,c,l){var v,p,w,y,k,d,rt,g,a,nt,ut,tt,it;if(!this.get__disposed()){if(l==null&&(l=new i._signInState(null,!0)),v=i.SignInResultCode.success,f!==s.success){if(v=i.SignInResultCode.failure,f!==s.unauthenticated?this._userAutoReconnect.trigger(-1):this.set__state(u.signedOut),l.raiseSignInCompleted){f===s.unauthenticated&&(v=i.SignInResultCode.authenticationFailure),p=new i.SignInCompletedEventArgs(v,e,l.userState),p.set_serverName(h);this.onSignInCompleted(p)}}else{if(this._userAutoReconnect.onSignedIn(),this._service.onSignInPopulateCompleted(),!r.isNullOrEmpty(c))for(this._identity._setSkypeId(c),w=r.IEnumerator.getEnumerator(this._contact.get_addresses());w.moveNext();)if(y=w.get_current(),y.get_type()===i.IMAddressType.skype){y.get__info().address=c,y.get__info().id=c,this._skypeAddress=y;break}this.set__state(u.signedIn),this._hasSignedIn=!0;this.onSignedIn(new i.SignedInEventArgs(h));if(l.raiseSignInCompleted){k=new i.SignInCompletedEventArgs(v,e,l.userState),k.set_serverName(h);this.onSignInCompleted(k)}while(this._pendingServiceDataChanges.length>0)d=this._pendingServiceDataChanges.shift(),this._onServiceDataChanged(d[0],d[1]);for(rt=this._getEnabledConnectNetworks(),g=r.IEnumerator.getEnumerator(this.get_networks());g.moveNext();)if(a=g.get_current(),a.get_imEnabled()&&!a.get_isWindowsLive()&&a.get__isRemoteNetwork())for(nt=r.IEnumerator.getEnumerator(rt);nt.moveNext();)if(ut=nt.get_current(),a.get_id()===ut){this._updateNetwork(a.get_id(),t.NetworkOperationType.enableIM,!1);break}b.isSkypeInvitesEnabled()&&(this._retrieveInboundInvitations(),n(this._contactsReader).bind("settingsChanged",r.Delegate.create(this,this._onContactsSettingsChanged)))}this._identity.get_signinScenarioQoSObject()!=null?(f===s.success?(t.WebmainHelper.addQoSStats(t.WebmainHelper.qoSApiConnectMessenger,null,t.WebmainHelper.qoSSigninApiStartTime,this._identity.get_signinScenarioQoSObject(),!1),t.WebmainHelper.stopQoS(this._identity.get_signinScenarioQoSObject(),!0,null)):(tt=f===s.unauthenticated||f===s.transferred,t.WebmainHelper.addQoSStats(t.WebmainHelper.qoSApiConnectMessenger,e,t.WebmainHelper.qoSSigninApiStartTime,this._identity.get_signinScenarioQoSObject(),tt),t.WebmainHelper.stopQoS(this._identity.get_signinScenarioQoSObject(),!1,e,tt)),this._identity.set_signinScenarioQoSObject(null)):this._identity.get_reconnectScenarioQoSObject()!=null&&(f===s.success?(t.WebmainHelper.addQoSStats(t.WebmainHelper.qoSApiReconnect,null,t.WebmainHelper.qoSReconnectApiStartTime,this._identity.get_reconnectScenarioQoSObject(),!1),t.WebmainHelper.stopQoS(this._identity.get_reconnectScenarioQoSObject(),!0,null)):(it=f===s.unauthenticated||f===s.transferred,t.WebmainHelper.addQoSStats(t.WebmainHelper.qoSApiReconnect,e,t.WebmainHelper.qoSReconnectApiStartTime,this._identity.get_reconnectScenarioQoSObject(),it),t.WebmainHelper.stopQoS(this._identity.get_reconnectScenarioQoSObject(),!1,e,it)),this._identity.set_reconnectScenarioQoSObject(null))}},_onContactsSettingsChanged:function(){this._invitationsRequireNotification=!0,this._retrieveInboundInvitations()},_retrieveInboundInvitations:function(){var i,n,u;p.SkyJSHelper.skypeEnabled&&(i=this._contactsReader.get_settings().getSkypePendingInboundCount(),i>this._pendingInviteCount&&(this._pendingInviteCount=i,this._getInvitationsQoSScenario=t.WebmainHelper.startQoS(t.WebmainHelper.qoSScenarioGetInvitations),t.WebmainHelper.qoSResetTime(t.WebmainHelper.qoSScenarioGetInvitations),n={},u={},u.userId=this.get_skypeAddress().get_address(),n.data=u,n.success=r.Delegate.create(this,this._onSkyJSInviteSuccessCallback),n.error=r.Delegate.create(this,this._onSkyJSInviteErrorCallback),p.SkyJSHelper.getInstance().Outlook.getList(n)))},_onSkyJSInviteSuccessCallback:function(n){function a(){var n=new o.XMLHttpRequest,i;n.open("POST",r.format("{0}//{1}/Handlers/PeopleApi/ResetSkypePendingInboundCount.mvc",o.location.protocol,o.location.host),!0),n.setRequestHeader("X-Requested-With","XMLHttpRequest"),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),i=t.WebmainHelper.startQoS(t.WebmainHelper.qoSScenarioResetSkypePendingInboundCount),t.WebmainHelper.qoSResetTime(t.WebmainHelper.qoSScenarioResetSkypePendingInboundCount),n.send(r.format("canary={0}",encodeURIComponent(d.ContactCache.canary))),n.onreadystatechange=function(){if(n.readyState===4)if(n.status===200)t.WebmainHelper.addQoSStats(t.WebmainHelper.qoSApiResetSkypePendingInboundCount,null,t.WebmainHelper.qoSResetSkypePendingInboundCountApiStartTime,i,!1),t.WebmainHelper.stopQoS(i,!0,null);else{var u;u=n.status!==500||r.isNullOrEmpty(n.statusText)?n.status.toString():r.format("500, {0}",n.statusText),t.WebmainHelper.addQoSStats(t.WebmainHelper.qoSApiResetSkypePendingInboundCount,u,t.WebmainHelper.qoSResetSkypePendingInboundCountApiStartTime,i,!1),t.WebmainHelper.stopQoS(i,!1,u)}}}var f=n,e,u;if(f!=null&&f.length>0)for(e=r.IEnumerator.getEnumerator(f);e.moveNext();){var s=e.get_current(),i=s.sender,c=s.greeting,l=s.event_time,h=null;r.isNullOrEmpty(l)||(u=l.split(" "),u.length===2&&(h=k.DateTimeHelper.parseTimeStamp(r.format("{0}T{1}Z",u[0],u[1])))),r.isNullOrEmpty(i)||r.isNullOrEmpty(c)||h==null||r.keyExists(this._inboundInvites,i)||(this._createInviteMessage(i,c,h,this._invitationsRequireNotification),this._inboundInvites[i]=!0)}else a();t.WebmainHelper.addQoSStats(t.WebmainHelper.qoSApiGetInvitations,null,t.WebmainHelper.qoSGetInvitationsApiStartTime,this._getInvitationsQoSScenario,!1),t.WebmainHelper.stopQoS(this._getInvitationsQoSScenario,!0,null)},_onSkyJSInviteErrorCallback:function(n){var u=n,i="";i=u!=null?r.format("{0}:{1}",u.code,u.text):"Unknown",t.WebmainHelper.addQoSStats(t.WebmainHelper.qoSApiGetInvitations,i,t.WebmainHelper.qoSGetInvitationsApiStartTime,this._getInvitationsQoSScenario,!1),t.WebmainHelper.stopQoS(this._getInvitationsQoSScenario,!1,i)},_createInviteMessage:function(n,u,f,e){var o=null,a=this.findContactBySkypeId(n,null),c,h,l;if(a!=null){for(c=r.IEnumerator.getEnumerator(a.get_addresses());c.moveNext();)if(h=c.get_current(),h.get_skypeName()===n)if(h.get_type()===i.IMAddressType.shortCircuit){o=h;break}else return}else l=new t.IMAddressInfo(n,y.shortCircuit,v.none),l.skypeId=n,o=this._findOrCreateAddress(l),o.get_contact()._setDisplayNameChanges(n),o.set_isPendingInbound(!0);var p=this._conversations.create(o),w=new t.MessageInfo(t.MessageInfoType.textMessage,new t.TextMessageInfo(u,null)),s=i.Message._fromMessageInfo(this,o,w,p);s.set_timestamp(f),s.set_inviteMessage(!0),s.set_clientMessageId("0"),s.set_inviteMessageType(e?i.InviteMessageType.newInvite:i.InviteMessageType.historyInvite);p.onMessageReceived(new i.MessageReceivedEventArgs(s))},_markUserAsSignedOut:function(n,t){n?this._userAutoReconnect.trigger(t):this.get__state()!==u.disposed&&this.set__state(u.signedOut),this._markUserAsOffline(),this._address.get_endpoints()._clearAllExceptLocal()},_markUserAsOffline:function(){var n=t.ServiceData.createEmpty(t.ServiceType.IM);n.set_status(a.offline),this._address._onServiceDataChanged([n.get_info()])},_markContactsAsOffline:function(){this._contactMap._markOffline(!1,null)},_setAutoReconnectWaitTime:function(n){if(n!==this._autoReconnectWaitTime){this._autoReconnectWaitTime=n;this.onPropertyChanged("AutoReconnectWaitTime")}},_isExistingOfficeCommunicatorContact:function(n){var i=new t.IMAddressInfo(n,y.officeCommunicator,v.forward),r=this._findAddress(i);return r!=null},_getEnabledConnectNetworks:function(){for(var i=[],n,t=0;t<this.get_networks().get_count();t++)n=this.get_networks().get_item(t),n.get_imEnabled()&&!n.get_isWindowsLive()&&n.get__isRemoteNetwork()&&i.push(n.get_id());return i.length>0?i:null},_onContactsReaderInitialized:function(n){if(n===s.success)t.WebmainHelper.addQoSStats(t.WebmainHelper.qoSApiContactsReady,null,t.WebmainHelper.qoSSigninApiStartTime,this._identity.get_signinScenarioQoSObject(),!1),i._globalConfiguration._initialize(),this.get_networks()._updateNetworks(this._contactsReader.get_networks(),null,null),this._beginPopulate();else{var r="PwcFailed";t.WebmainHelper.addQoSStats(t.WebmainHelper.qoSApiContactsReady,r,t.WebmainHelper.qoSSigninApiStartTime,this._identity.get_signinScenarioQoSObject(),!1),t.WebmainHelper.stopQoS(this._identity.get_signinScenarioQoSObject(),!1,r,!1)}}}}(window.originaljQuery||jQuery),function(){var r=window,a=r.$Config,v=r.$pwc,t=r.MC,i=r.Microsoft.Live.Messenger,s=r.ss,h=t.IUserServiceEvents,e=t.MessengerServiceResultCode,o=t.SignOutLocationFlags,u=t.SignOutReasonCode,f=i.SignedOutReason,c=i.SignOutResultCode,l=i._userEvents=function(n){h.call(this),this._identity=n},n=l.prototype=new h;n.constructor=l,n._queuedConversations=null,n._queuedConversationMessages=null,n._user=null,n.get__user=function(){return this._user},n.set__user=function(n){return this._user=n,n},n.onServicesChanged=function(n){this._user._onServicesChanged(n)},n.onABChangeNotificationReceived=function(n){this._user.get__contactsReader().notifyAddressBookChange(n)},n.onUpdateNetworkCompleted=function(n,i,u,f){var l=this._user.get_networks().get_item(i),c,o,h;l!=null&&l._onUpdateNetworkCompleted(n,u),f&&n===e.success&&(c=u===t.NetworkOperationType.disableIM?"HideNetwork.mvc":"UnHideNetwork.mvc",o=new r.XMLHttpRequest,o.open("POST",s.format("{0}//{1}/Handlers/PeopleApi/{2}",window.location.protocol,window.location.host,c),!0),o.setRequestHeader("X-Requested-With","XMLHttpRequest"),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),h=t.WebmainHelper.startQoS(t.WebmainHelper.qoSScenarioOnOffThirdPartyChat),t.WebmainHelper.qoSResetTime(t.WebmainHelper.qoSScenarioOnOffThirdPartyChat),o.onreadystatechange=function(){if(o.readyState===4)if(o.status===200)v.client.deltaSync(),t.WebmainHelper.addQoSStats(u===t.NetworkOperationType.disableIM?t.WebmainHelper.qoSApiOffThirdPartyChat:t.WebmainHelper.qoSApiOnThirdPartyChat,null,t.WebmainHelper.qoSOnOffThirdPartyChatApiStartTime,h,!1),t.WebmainHelper.stopQoS(h,!0,null);else{var n=s.format("{0}:{1}",o.status.toString(),o.statusText);t.WebmainHelper.addQoSStats(u===t.NetworkOperationType.disableIM?t.WebmainHelper.qoSApiOffThirdPartyChat:t.WebmainHelper.qoSApiOnThirdPartyChat,n,t.WebmainHelper.qoSOnOffThirdPartyChatApiStartTime,h,!1),t.WebmainHelper.stopQoS(h,!1,n)}},o.send(s.format("canary={0}&sourceId={1}",encodeURIComponent(a.ContactCache.canary),i)))},n.onNetworkStatusChanged=function(n,t){var i=this._user.get_networks().get_item(n);i!=null&&i._setStatus(t)},n.onSignedIn=function(n,t,i,r,u,f){this._user._completeSignIn(n,t,i,r,u,f)},n.processPendingConversations=function(){this._createReloadedQueuedConversations(),this._processReloadedQueuedConversationMessages()},n.onSignedOut=function(n,t,r){var h=c.success,s;n!==e.success&&(h=c.failure);var u=r,a=u.locations,l=u.signedOutEndpoint;if((t&o.localEndpoint)===o.localEndpoint&&this._user._markUserAsSignedOut(!1,0),s=new i.SignOutCompletedEventArgs(h,a,l,u.userState),!this._user.get__disposed()){if(l!=null)this._user.onSignOutEndpointCompleted(s);else this._user.onSignOutCompleted(s);if((t&o.localEndpoint)===o.localEndpoint){if(this._user.get__state()!==i._userState.autoReconnectWaiting)this._user.onSignedOut(new i.SignedOutEventArgs(f.signedOutByLocalEndpoint));this._user._markContactsAsOffline(),this._user.get_networks()._markNetworksOffline()}}},n.onUserServicesUpdated=function(){},n.onUserServiceDataUpdated=function(){},n.onMailNotification=function(n){this._user.get_mailbox()._onMailNotification(n)},n.onServiceDataChanged=function(n,t){this._user._onServiceDataChanged(n,t)},n.onServiceDataDeleted=function(n,t){this._user._onServiceDataDeleted(n,t)},n.onSignedOutRemotely=function(n,t){var e=!1,r;switch(n){case u.connectionLost:r=f.connectionLost,e=!0;break;case u.serverError:r=f.serverError,e=!0;break;case u.endpointLimitExceeded:r=f.endpointLimitExceeded;break;case u.signedOutByRemoteEndpoint:r=f.signedOutByRemoteEndpoint;break;case u.userTransferred:case u.signedOutForReconnect:e=!0,r=f.signedOutByServer;break;default:return}this._user._markUserAsSignedOut(e,t);this._user.onSignedOutRemotely(new i.SignedOutRemotelyEventArgs);this._user.onSignedOut(new i.SignedOutEventArgs(r));this._user._markContactsAsOffline()},n.onNotifyWebSignInPendingEventsCompleted=function(){this.processPendingConversations()},n._onConversationCreatedHandler=function(n,t,r,u,f,e){var s=null,c,h,o;if(r!=null)for(s=new Array(r.length-1),c=0,h=0;h<r.length;h++){if(o=n._findOrCreateAddress(r[h]),o.get_isUser())continue;else if(o.get_contact()==null||o.get_contact()!=null&&o.get_contact().get_isTemporaryContact()&&o.get_type()==i.IMAddressType.connect)return;s[c++]=o}e?this._queueReloadedConversation(n,t,u,f,s):this._createConversation(n,t,u,f,s)},n.onConversationCreated=function(n,t,r){var u=this._user.get__state()!==i._userState.signedIn;this._onConversationCreatedHandler(this._user,n,t,null,r,u)},n.onConversationGroupCreated=function(n,t){var r=this._user.get__state()!==i._userState.signedIn;this._onConversationCreatedHandler(this._user,n.id,null,n,t,r)},n.onConversationGroupUpdated=function(n){this._user.get_conversations()._onConversationUpdated(n.id,n)},n.onConversationAddMembersCompleted=function(n,t,i,r){this._user.get_conversations()._onAddMembersCompleted(n,t,i,r)},n.onConversationRemoveMembersCompleted=function(n,t,i,r){this._user.get_conversations()._onRemoveMembersCompleted(n,t,i,r)},n.onConversationAddressJoined=function(n,t){this._user.get_conversations()._onAddressJoined(n,t)},n.onConversationAddressLeft=function(n,t){this._user.get_conversations()._onAddressLeft(n,t)},n.onConversationGetRecentListCompleted=function(n,t){this._user.get_conversations()._onGetRecentConversationsCompleted(n,t)},n.onConversationMessageReceived=function(n,t){var r=this._user.get__state()!==i._userState.signedIn;this._onConversationMessageReceivedHandler(n,t,r)},n.onConversationHistoryMessagesReceived=function(n,t,i){this._user.get_conversations()._onConversationHistoryMessagesReceived(n,t,i)},n.onConversationConsumptionHorizonUpdated=function(n,t){this._user.get_conversations()._onConsumptionHorizonUpdated(n,t)},n.onConversationClearedAtUpdated=function(n,t){this._user.get_conversations().onConversationClearedAtUpdated(n,t)},n.onConversationClosed=function(n){this._user.get_conversations()._onConversationClosed(n)},n._onConversationMessageReceivedHandler=function(n,i,r){if(r){var u={};u.id=n,u.messageInfo=i,this._queuedConversationMessages==null&&(this._queuedConversationMessages=[]),this._queuedConversationMessages.push(u);return}i.type===t.MessageInfoType.typingUserMessage?this._user.get_conversations()._onBuddyTypedNotification(n,i.sender):this._user.get_conversations()._onMessageReceived(n,i)},n.onConversationSendMessageFailed=function(n,t,r,u){var f=i.SendMessageResultCode.failure;switch(t){case e.messageTooLong:f=i.SendMessageResultCode.messageTooLong;break;case e.messageRecipientDisabled:f=i.SendMessageResultCode.recipientDisabled;break;case e.messageRecipientInvalid:f=i.SendMessageResultCode.recipientInvalid}this._user.get_conversations()._onSendMessageFailed(n,f,r,u)},n.onConversationUpdatedId=function(n,t){this._user.get_conversations()._onUpdatedId(n,t)},n._createConversation=function(n,t,i,r,u){var f=n._onConversationCreated(t,i,u);f&&f._setConsumptionHorizon(r)},n._createReloadedQueuedConversations=function(){if(this._queuedConversations!=null)while(this._queuedConversations.length>0){var n=this._queuedConversations.shift();this._createConversation(this._user,n.id.toString(),n.threadInfo,n.consumptionHorizon,n.addresses)}},n._processReloadedQueuedConversationMessages=function(){if(this._queuedConversationMessages!=null)while(this._queuedConversationMessages.length>0){var n=this._queuedConversationMessages.shift();this._onConversationMessageReceivedHandler(n.id.toString(),n.messageInfo,!1)}},n._queueReloadedConversation=function(n,t,i,r,u){this._queuedConversations==null&&(this._queuedConversations=[]);var f={};f.id=t,f.threadInfo=i,f.addresses=u,f.consumptionHorizon=r,this._queuedConversations.push(f)}}(),function(){var t=window,n=t.Microsoft.Live.Messenger;n._identityInitializer=function(){},n._identityInitializer.prototype={_identity:null,initialize:function(t){this._identity=t,this._identity._setUserService(n.Services.UserServiceFactory.create(this._identity,this._identity.get__userEvents())),this._identity.get__userService().updateTicket(this._identity._getIdentityInfo()),this._identity._onInitialized()},dispose:function(){}}}(),function(){var i=window,f=i.$Config,n=i.MC,r=i.Microsoft.Live.Messenger,e=r.Services,c=i.MSH,o=i.ss,u=r.Identity,s=u.prototype,h=r.RpsAuthIdentity=function(t,i){var s=this,h;u.call(this),s._setIsAuthenticated(s),s._setLiveId(t),s._setCid(i),s.set__authenticationInfo(new n.AuthenticationInfo(n.AuthenticationType.rpsAuth,"")),s._initializer$1=new r._identityInitializer,c.Scheduler.defer(o.Delegate.create(s,function(){s._initializer$1.initialize(s)})),n.WebmainHelper.isQoS()&&(s.set_signinScenarioQoSObject(n.WebmainHelper.startQoS(n.WebmainHelper.qoSScenarioSignin)),n.WebmainHelper.qoSResetTime(n.WebmainHelper.qoSScenarioSignin)),n.WebmainHelper.isConfig()&&f.WebIM.si!==1?s._onGetMappingContainerCompleted():(h=n.WebmainHelper.getQueryParameterByName("uicTicket"),f.WebIM.eso&&!o.isNullOrEmpty(h)?this._setUicTicket(h):e.SkyJSHelper.getInstance()!=null&&e.SkyJSHelper.getInstance().Outlook!=null?s._initializeSkyJS():s._onGetMappingContainerCompleted())},t=h.prototype=new u;t.constructor=h,t._experienceId$1=null,t.get_experienceId=function(){return this._experienceId$1},t.set_experienceId=function(n){if(this._experienceId$1!==n){this._experienceId$1=n;this.onPropertyChanged(new r.PropertyChangedEventArgs("ExperienceId"))}return n},t.get_uicTicket=function(){return this.get__authenticationInfo().uicTicket},t.set_uicTicket=function(n){return this._setUicTicket(n),n},t._getIdentityInfo=function(){var n=s._getIdentityInfo.call(this);return n.experienceId=this._experienceId$1,n},t.dispose=function(){this.get__isDisposed()||(this._initializer$1.dispose(),s.dispose.call(this))}}(),function(n){var i=window,f=i.MC,t=i.Microsoft.Live.Messenger,r=i.ss,u=t.SkypeInitializer=function(){};u.initialize=function(i,e,o){var s=f.JSON.deserialize(i),h;if(s==null)throw t._exceptionHelper.createArgumentNullException("json");else if(r.isNullOrEmpty(s.liveId)||r.isNullOrEmpty(s.cid)||r.isNullOrUndefined(s.buddy))throw t._exceptionHelper.createArgumentException("Invalid JSON; Missing fields.","json");else if(o==null)throw t._exceptionHelper.createArgumentNullException("callback");h=new t.RpsAuthIdentity(s.liveId,s.cid),h._setUicTicket(e),n(h).bind("authenticationCompleted",function(n,t,i){u._onAuthenticationCompleted(h,i,s,o)})},u._onAuthenticationCompleted=function(i,r,u,f){if(r.get_resultCode()===t.AuthenticationResultCode.success){var e=new t.User(i,new t.Services._personInfoReader([u.buddy],u.networks));n(e).bind("signInCompleted",function(n,t,i){f.invoke(i.get_resultCode(),e)}),e.signIn()}else f.invoke(t.SignInResultCode.failure,null)}}(window.originaljQuery||jQuery),function(){function f(n){return e(u,n)}function e(t,i){var r="";return n.GetString&&(r=n.GetString(t+i)),r}function o(n){var t=n?n.get_name():"";return t=="SMS"&&(t=f(r)),t}function s(t,i){var e=n.$Config||{},s=e.WebIM||{},r=t.get_displayName(),u,f;return r||(u=i&&i.get_network()||t.get_linkedContacts().get_item(0).get_network(),f=s.so3||"",r=f.format(o(u))),r}function i(n){return n<10&&(n="0"+n),n}var n=window,t=n.$WLXIM,r="Sms",u="live.shared.strings.webim.client.";t.getDisplayName=s,t.getReconnectingTime=function(){var n=t.user.get_autoReconnectWaitTime(),r=i(Math.floor(n/60));return n=i(n%60),{min:r,sec:n}}}(),function(n){function f(n,i,r){for(var o=n.get_addresses(),f,e,u=0,s=o.get_count();u<s;u++)if(f=o.get_item(u),e=f.get_type(),e==i&&(e!=t.MLM.IMAddressType.connect||!r||r==f.get_network()))return f;return null}function e(n,i,r){var u=null,o,e,h,s;if(i&&(u=f(n,i,r)),!u&&(u=n.get_currentAddress(),u.get_type()==t.MLM.IMAddressType.telephone))for(o=n.get_addresses(),e=0,h=o.get_count();e<h;e++)if(s=o.get_item(e),s.get_capabilities().get_supportsOfflineMessages()){u=s;break}return u}var i=window,t=i.$WLXIM,r=i.$Do,u=i.$BSI;r.register("$WLXIM.ConversationStarted"),t.startConversation=function(i,f,e,o,s){e=e||"Other",u.reportEvent("ClickedSelected.Messaging.IMConversation",{StartLocation:e}),r.when("wlxim_startconversation",0,i,f,o,s,e),n(t).trigger("ConversationStarted",!1)},t.getConversationAddress=e}(window.originaljQuery||jQuery),function(n){function oi(){n(t).bind("stateChange",d),d(),wt=!0,n(r).bind(gt,o.dispose)}function wi(){r.$Utility.isHighContrast()&&(it(nt),it(h),it(lt),it(at))}function it(t){var i=n(t);n("span.is_hc",i).replaceWith($menu.createChevron($menu.chevronTypes.LargeDotLight,!0))}function bt(n){var i=null,t;return n!=null&&(t=n.parentNode,i=t!=null&&l.has(t,"c_ld")?t.nextSibling:n.nextSibling),i}function u(n,t){n!=null&&(n=n.parentNode,l.has(n,"c_ld")&&(n=n.parentNode),n.style.display=t,l.has(n,"c_sml")&&(n=n.parentNode,n.style.display=t))}function rt(n){u(n,"block")}function k(n){u(n,"none")}function bi(){for(var n=0;n<s.length;n++)k(s[n])}function ki(t,i){var r=t.get_id(),h=ct.parentNode.cloneNode(!0),p=lt.parentNode.cloneNode(!0),c=at.parentNode.cloneNode(!0),u=h.getElementsByTagName("span")[0],k=ai.rtl?"rtl":"ltr",d=li.createTextNode(t.get_name()),f,e,o,s,a,w,y;u.id="c_wimnet_"+r,u.setAttribute("dir",k),u.replaceChild(d,u.childNodes[0]),v(u,"$Sutra.Shared.ThirdPartyNetwork"),f=p.getElementsByTagName("a")[0],e=c.getElementsByTagName("a")[0],f.id="c_wimneton_"+r,e.id="c_wimnetoff_"+r,o=n(f),s=n(e),o.click(function(n){$HeaderWebIM.toggle(n,r,!0)}),s.click(function(n){$HeaderWebIM.toggle(n,r,!1)}),a="<span style='display: none; visibility: hidden;'>&nbsp;{0}&nbsp;<\/span>".format(t.get_name()),o.find(".is_c").after(a),s.find(".is_c").after(a),window.$header&&(window.$header.reportBSIMenu(o,f.id),window.$header.reportBSIMenu(s,e.id)),h.style.display="block",i&&(w=l.getCN("c_ms","span",c),y=w[0],y.parentNode.removeChild(y)),n(t).bind("propertyChanged",ut),b&&b.push(t),di(h,p,c),ut(null,t)}function di(n,t,i){var r=ct.parentNode,u=r.parentNode;u.insertBefore(n,r),u.insertBefore(t,r),u.insertBefore(i,r)}function ut(n,r){var o,l;if(!r.get_supportsIM()){kt(),a();return}if(o=r.get_id(),l=i("c_wimnet_"+o),l){var f=i("c_wimneton_"+o),e=i("c_wimnetoff_"+o),s=l.childNodes[0],y=" "+st("MeMenu.Chat"),v=r.get_name(),h=r.get_status(),c=t.MLM.NetworkStatus;h==c.signedOut?(ft(f,0),ft(e,1),u(f,"block"),u(e,"block"),s.nodeValue=r.get_name()+y):h==c.signedIn?(ft(f,1),ft(e,0),u(f,"block"),u(e,"block"),s.nodeValue=v+y):h==c.signingIn||h==c.autoReconnectWaiting?(u(f,"none"),u(e,"none"),s.nodeValue=v+" "+st("MeMenu.Enabling")):(u(f,"none"),u(e,"none"),s.nodeValue=v+" "+st("MeMenu.CannotConnect")),tt&&tt.binding&&tt.binding.update()}}function ft(t,i){var u=n(t).children("span"),r=n(u[0]);i?r.css("visibility","inherit"):r.css("visibility","hidden")}function a(){var n=i("c_melink").menu;n&&n.isOpen()&&!w?(w=1,n.addStateListener(et)):et()}function et(){var o,u,f,s;if(w&&(i("c_melink").menu.removeStateListener(et),w=0),o=e.get_networks().get_count(),o){for(var l=[],v=[],r=0,t=0;t<o;t++)u=e.get_networks().get_item(t),f=u.get_id(),f!="WL"&&u.get_supportsIM()&&u.get_supportsRemoteSignIn()&&!i("c_wimnet_"+f)&&v.indexOf(f)==-1&&(v.push(f),l[r]=u,r++);for(t=0;t<r;t++)ki(l[t],t==r-1);r>0&&(rt(c),s=bt(h),s&&(s.style.display="none"))}p||(n(e.get_networks()).bind("collectionChanged",a),p=1),y.binding&&y.binding.update()}function kt(){var f,t,r,u,o,s;for(p&&(n(e.get_networks()).unbind("collectionChanged",a),p=0),f=i("c_memenu"),t=l.getCN("c_wimnw","a",f),t=t.concat(l.getCN("c_wimnw","span",f)),r=0;r<t.length;r++)u=t[r].id,u!="c_wimnet"&&u!="c_wimneton"&&u!="c_wimnetoff"&&(o=t[r].parentNode,o.parentNode.removeChild(o));k(c),s=bt(h),s&&(s.style.display="block")}function d(){var p=t.hasPresence(),v=t.hasNotify(),ut=!1,w=!1,b=!1,nt=!1,h,c,tt,l,ft,it;if(!yt&&(v||p)&&(e=t.user,n(t).bind("contactsCountChanged",dt),n(t.user.get_mailbox()).bind("propertyChanged",ot),n(t.user.get_address()).bind("propertyChanged",si),dt(!0),ot(0,!0),yt=1),p?(ut=!0,w=!0):(v&&(w=!0),ut&&(nt=1)),!v&&w&&(b=!0),(t.isError()||t.isWaitingToReconnect()||t.isOff())&&(v||(b=!0),nt=!0),f&&b&&(f[ii][ni]=ti),vt&&nt&&(vt[ii][ni]=ti),ei){if(p){for(a(),h=0;h<s.length;h++)c=s[h],c.style.display=="none"&&g.e(c.parentNode,"block"),u(c,"block");e&&(tt=e.get_presence().get_status(),tt&&o.setPresenceRadioButton(tt))}else if(kt(),t.isLoading())for(o.setPresenceRadioButton(0),h=0;h<s.length;h++)c=s[h],g.d(c),u(c,"block");else bi();t.isError()?rt(i("c_wims")):k(i("c_wims")),l=i("c_wimr"),t.isWaitingToReconnect()?l&&(ft=st("InfoBar.Reconnecting"),it=t.getReconnectingTime(),l[ci]=ft.format(it.min,it.sec),rt(l),pt=r.setTimeout(d,1e3)):l&&k(l),t.isOff()?rt(i("c_wimn")):k(i("c_wimn")),y.binding&&y.binding.update()}}function dt(n){window.$HeaderCookie&&t.hasPresence()&&(!n||t.count!=0)&&r.$HeaderCookie.updateContactsCount(t.onlineCount)}function si(){t._inform()}function ot(n,i){var u=0;t!=null&&t.user!=null&&(u=Math.max(0,parseInt(t.user.get_mailbox().get_inboxUnreadCount()))),i&&u==0||(window.$HeaderCookie?r.$HeaderCookie.updateUnreadCount(u,f):f&&(f.style.display="inline",u>999&&(u="99+"),f.innerHTML="&nbsp;"+u))}function st(n){return gi(hi,n)}function gi(n,t){var i="";return r.GetString&&(i=r.GetString(n+t)),i}var hi="live.shared.strings.webim.client.",gt="unload",ci="innerHTML",ni="display",ti="none",ii="style",r=window,li=r.document,t=r.$WLXIM,ai=r.$B,ht=r.$Do,l=r.$css,g=r.$edh,e,v=r.sutra,i=r._ge,vi=r.Microsoft.Live.Messenger,o=r.$HeaderWebIM={},yi=0,ri="c_himla",ui="c_himld",nt,h,c,tt,s,y,ct,lt,at,vt,f,yt=0,p=0,w=0,pt,b=[],wt,fi,ei;ht.when("wlximuiouter",0,oi),o.init=function(){var n=i("c_memenu");n&&(nt=i(ri),h=i(ui),c=i("c_wimnetsub"),tt=i("c_wimnetsub_m"),s=[nt,h],y=i("c_memenu"),ct=i("c_wimnet"),lt=i("c_wimneton"),at=i("c_wimnetoff"),vt=i("c_mocc"),f=i("c_murc"),wi(),ei=!0,wt&&d(),v(nt,"$Sutra.Shared.Available"),v(h,"$Sutra.Shared.Invisible"),v(c,"$Sutra.Shared.AvailabilityDetails"),v(i("c_wimnetsub_m"),"$Sutra.Shared.ThirdPartyNetworks"))},ht.register("$HeaderWebIM.Initialize",o.init),o.dispose=function pi(){var o,s,u,h,f;if(!fi){for(ht.remove("wlximuiinner",0,oi),wt&&n(t).unbind("stateChange",d),yt&&(n(t.user.get_mailbox()).unbind("propertyChanged",ot),n(t).unbind("contactsCountChanged",dt),n(t.user.get_address()).unbind("propertyChanged",si)),w&&i("c_melink").menu.removeStateListener(et),pt&&r.clearTimeout(pt),p&&(o=e.get_networks(),n(o).unbind("collectionChanged",a)),s=b.length,u=0;u<s;u++)h=b[u],n(h).unbind("propertyChanged",ut);b=null,window.$WLXIMCL&&(f=window.$WLXIMCL.getListById(yi),f&&f.dispose()),n(r).unbind(gt,pi),fi=!0}},o.SP=function(n){r.$menu.closeCurrent(),t.switchPresence(n),$HeaderWebIM.setPresenceRadioButton(n)},o.setUnreadCountEl=function(t){t!=f&&(f&&n(f).hide(),f=t,ot(0,!0))},o.setPresenceRadioButton=function(n){var u="",i,t,r,f;switch(n){case 0:break;case 2:u=ui;break;default:u=ri}for(i=0;i<s.length;i++)t=s[i],t&&(r=t.firstChild,r&&(t.id==u?(r.style.visibility="inherit",t.setAttribute("aria-checked","true")):(r.style.visibility="hidden",t.setAttribute("aria-checked","false"))));f=bt(h),f&&f.style.display=="none"&&(n==vi.PresenceStatus.appearOffline?g.d(c):c.style.display=="none"&&g.e(c.parentNode,"block"))},o.toggle=function(n,t,i){var o,f,u;for(n.preventDefault(),r.$menu.closeAll(),o=e.get_networks().get_count(),f=0;f<o;f++)if(u=e.get_networks().get_item(f),u.get_id()==t)if(u.get_supportsIM())u.set_imEnabled(i),ut(null,u);else{kt(),a();break}}}(window.originaljQuery||jQuery),function(){var i=window,r,n,t;i.MsgrUI=i.MsgrUI||{},r=i.MsgrUI,n=r.EventType=function(){},n.blur=0,n.click=1,n.focus=2,n.keyPress=3,n.keyDown=4,n.mouseDown=5,n.mouseUp=6,n.mouseOut=7,n.scroll=8,t=r.PeopleFilter=function(){},t.all=0,t.available=1,t.skype=2,t.facebook=3,t.google=4}(),function(){var i=window,r=i.Microsoft.Live.Messenger,u=i.$B,f=i.$Utility,e=i.MsgrUI,n=e._templates=function(){},t;n.anchorFormat='<a resourceid="anchor" sutra= "infobarlink" href="#" onclick="return false;">{0}<\/a>',n._recentConversationsControl='\r\n<div resourceid="RecentConversationsControl" class="RecentConversationsControl"><div resourceid="Container" class="RecentConversationsControl_Container"><div resourceid="Items" class="RecentConversationsControl_Items" sutra="recentconversations"><h1 resourceid="Title" class="Title" sutra="recentconversationstitle"><\/h1><ul resourceid="ItemsContainer" class="RecentConversationsContainer" sutra="recentconversationscontainer"><\/ul>\r\n<a resourceid="ShowMore" class="ShowMore" sutra="showmore"><\/a><div resourceid="ErrorMessage" class="ErrorMessage" sutra="recenterror"><\/div><img resourceid="Spinner" class="Spinner" sutra="recentconversationsloading"><\/img>\r\n        <\/div><div resourceid="Favorites"><\/div><div resourceid="People" id="WebIMPeople" sutra="peoplecontrol"><\/div><\/div><div resourceid="Upsell" class="RecentConversationsControl_Upsell" sutra="webimupsellbody">\r\n            <div class="WhiteLineBreak"><\/div>\r\n            <div resourceid="UpsellHeader" class="Header"><\/div>\r\n            <div class="Container">\r\n                <ul resourceid="UpsellContainer"><\/ul>\r\n            <\/div>\r\n            <a href="#" onclick="return false;" resourceid="UpsellClose" class="Close" sutra="nothanks"><\/a>\r\n        <\/div>\r\n<div class="BelowRecentItems"><div resourceid="ConnectedTo" class="RecentConversationsControl_ConnectedTo" sutra="connectedtowidget"><\/div>\r\n    <\/div>\r\n<\/div>',n._recentConversationsItem='<li><a href="#" onclick="return false;" resourceid="RecentConversationsItem" class="RecentConversationsControl_Item" sutra="recentconversation"><div resourceid="UserTile" class="RecentConversationsControl_UserTile" sutra="recentconversationusertile"><\/div><div class="RecentConversationsControl_RightGroup"><div resourceid="DisplayName" class="RecentConversationsControl_ContactDisplayName" sutra="recentconversationsendername"><\/div><div resourceid="LastMessage" class="RecentConversationsControl_LastMessage"><div resourceid="MessageText" class="RecentConversationsControl_MessageText" sutra="recentconversationlastmessage"><\/div><div resourceid="Timestamp" class="RecentConversationsControl_Time" sutra="recentconversationlastmessagetimestamp"><\/div><\/div><\/div><\/a><\/li>',n._modernConversationControl="<div resourceid='ModernConversationControl' class='ModernConversationControl'><div resourceid='Header' class='ModernConversationControl_Header' sutra='chatviewheader'><div resourceid='CommandBar' class='CommandBar' sutra='chatviewcommandbar'><a href='#' onclick='return false;' resourceid='BackButton' class='BackButton' sutra='chatviewbackbutton' role='button'><img src='{0}'/><\/a><div class='RightGroup'><div resourceid='CallButtons' class='ModernConversationControl_CallButtons'><img resourceid='SpinningWheel' class='ModernConversationControl_SpinningWheel' sutra='spinningwheel'><\/img><a href='#' onclick='return false;' resourceid='VideoCallButton' class='ModernConversationControl_VideoCallButton' sutra='videocallbutton' role='button'><img src='{0}'/><\/a><a href='#' onclick='return false;' resourceid='AudioCallButton' class='ModernConversationControl_AudioCallButton' sutra='audiocallbutton' role='button'><img src='{0}'/><\/a><a resourceid='DisableVideoCallButton' class='ModernConversationControl_DisableVideoCallButton' sutra='disablevideocallbutton'><img src='{0}'/><\/a><a resourceid='DisableAudioCallButton' class='ModernConversationControl_DisableAudioCallButton' sutra='disableaudiocallbutton'><img src='{0}'/><\/a><\/div><a href='#' onclick='return false;' resourceid='AddMembersButton' class='AddMembersButton' sutra='addmembersbutton' style='display:none;' role='button'><img src='{0}'/><\/a><a href='#' onclick='return false;' resourceid='CommandMenu' class='CommandMenu' sutra='chatviewcommandmenu' role='menu'><img src='{0}'/><\/a><div resourceid='ContextMenuContainer' class='ContextMenuContainer'><\/div><div resourceid='ConfirmationDialogContainer' class='ConfirmationDialogContainer' sutra='chatviewconfirmationdialog'><\/div><\/div><\/div><div class='ModernConversationControl_ContactDetails' sutra='chatviewcontactdetails'><div resourceid='UserTile' class='UserTile' sutra='chatviewusertile'><\/div><div resourceid='TitleAndNetwork' class='TitleAndNetwork'><h1 class='Title'><a href='#' onclick='return false;' resourceid='Title' sutra='chatviewdisplayname'><\/a><\/h1><div resourceid='Status' sutra='chatviewstatus'><div resourceid='Presence' class='Presence' sutra='chatviewbuddypresence'><\/div><a class='NetworkSwitcher' resourceid='NetworkSwitcher' href='#' onclick='return false;'><div resourceid='Network' class='Network' sutra='chatviewcurrentnetwork'><\/div><div resourceid='NetworkChevron' class='NetworkChevron'><img src='{0}' /><\/div><\/a><\/div><div resourceid='NetworkMenuContainer' class='NetworkMenuContainer'><\/div><div resourceid='Roster' class='ModernConversationRosterControl' sutra='chatviewroster' style='display:none;'><a href='#' onclick='return false;' resourceid='RosterCount' class='RosterCount' sutra='chatviewrostercount' role='menu'><span resourceid='Count'><\/span><span class='RosterChevron'><img src='{0}'/><\/span><\/a><ul resourceid='RosterContainer' class='RosterContainer' style='display:none;' sutra='chatviewrostercontainer'><\/ul><\/div><\/div><div resourceid='InviteRequest' sutra='inviterequest' class='InviteRequest'><ul resourceid='InviteGreeting' class='InviteGreeting' sutra='invitegreeting'><\/ul><button resourceid='InviteAccept' sutra='inviteaccept' class='default InviteAccept' type='button'><\/button><button resourceid='InviteDecline' class='InviteDecline' type='button' sutra='invitedecline'><\/button><\/div><\/div><\/div><div resourceid='Container' class='ModernConversationControl_Container'><div sutra='messagehistorylist'><div resourceid='History' class='ModernConversationHistoryControl' sutra='messages'><img resourceid='Spinner' class='Spinner' sutra='messagesloading' style='display: none;'><\/img><ul resourceid='ItemsContainer' sutra='messagescontainer'><\/ul><\/div><\/div><div resourceid='HistoryBottom' class='ModernConversationControlBottom'><div><div resourceid='InfoBar' sutra='infobar' class='InfoBar'><\/div><div resourceid='Typing' class='ModernConversationTypingControl'><div resourceid='TypingText' class='TypingText'><\/div><\/div><a href='#' onclick='return false;' resourceid='EmoticonLaunch' class='EmoticonLaunchImage' sutra='emoticonlaunch'><\/a><div resourceid='EmoticonPanel' class='ModernConversationControl_EmoticonPanel' style='display: none; visibility: hidden;' sutra='emoticonpanel'><ul resourceid='MessengerEmoticons' style='border-style:none'><\/ul><ul resourceid='FacebookEmoticons' style='border-style:none'><\/ul><ul resourceid='GoogleEmoticons' style='border-style:none'><\/ul><\/div><\/div><div resourceid='Input' class='ModernConversationInputControl'><textarea resourceid='TextBox' class='ModernConversationInputControl_TextBox' sutra='sendmessagebox' tabindex='0'><\/textarea><\/div><div resourceid='SkypeUpsell' class='SkypeUpsell' sutra='skypeconvupsell'><span resourceid='Text'><\/span><a resourceid='Link'><img /><span resourceid='LinkText'><\/span><\/a><\/div><\/div><\/div><\/div>",n._modernConversationHistoryItem='\r\n<li>    \r\n    <div resourceid="ModernConversationHistoryItem" class="ModernConversationHistoryItem" sutra="message">\r\n        <div resourceid="Sender" class="ModernConversationHistoryItemNode_Sender" sutra="chatviewsendername" style="display: none;"><\/div>\r\n        <div resourceid="Text" class="ModernConversationHistoryItemNode_Text" sutra="chatviewmessagetext"><\/div>\r\n        <div resourceid="Timestamp" class="ModernConversationHistoryItemNode_Timestamp" sutra="chatviewMessagetimestamp"><\/div>\r\n        <div resourceid="Pointer"><\/div>\r\n    <\/div>\r\n    <label resourceid="Label" style="display:none"><\/label>\r\n<\/li>\r\n',n._modernConversationNetworkMenuItem='\r\n<div resourceid="NetworkAttributeMenuItem" class="NetworkAttributeMenuItem" sutra="network">\r\n    <span resourceid="SelectedIndicator" class="NetworkAttributeMenuItem_SelectedIndicator" style="visibility:hidden;"><\/span>\r\n    <span resourceid="NetworkAttributeName" class="NetworkAttributeMenuItem_Name"><\/span>\r\n<\/div>\r\n',n._modernConversationRosterItem='\r\n<li class="RosterItem" sutra="chatviewrosteritem">\r\n    <div resourceid="StatusBarContainer" class="StatusBarContainer">\r\n        <div resourceid="StatusBar" class="StatusBar" sutra="rosterstatusbar">\r\n            <span resourceid="Label"><\/span>\r\n        <\/div>\r\n    <\/div>\r\n    <div resourceid="DisplayName" class="ContactDisplayName" sutra="rosterdisplayname"><\/div>\r\n<\/li>\r\n',n._contactPickerControl='\r\n<div resourceid="ContactPickerControl" class="ContactPickerControl" sutra="webimcontactpicker">\r\n    <h1 resourceid="Title" class="Title"><\/h1>\r\n    <div resourceid="Container" class="Container">\r\n        <textarea class="cp_textarea"><\/textarea>\r\n    <\/div>    \r\n    <div class="BottomGroup">\r\n        <div resourceid="Infobar" class="Infobar"><\/div>\r\n        <button resourceid="AddButton" class="AddButton default" sutra="cpacceptbutton"><\/button>\r\n        <button resourceid="CancelButton" class="CancelButton" sutra="cpcancelbutton"><\/button>\r\n    <\/div>\r\n<\/div>',n._confirmationDialog='\r\n<div class="ConfirmationDialog" sutra="confirmationdialog" style="display: none;" role="dialog">\r\n    <span resourceid="DialogText" sutra="dialogtext" class="DialogText"><\/span>\r\n    <button resourceid="AcceptButton" sutra="dialogacceptbutton" class="AcceptButton default"><\/button>\r\n<\/div>\r\n',n._contextMenu='\r\n<div class="ContextMenu" style="display:none;">\r\n    <ul resourceid="MenuItemList"><\/ul>\r\n<\/div>',t="MessagingImageStrip",u.ltr||(t+="RTL"),f.isHighContrast()&&(t+="White"),t+="4.png",n.messagingImageStrip=r.MessengerUtility.getImagePath()+t}(),function(){var n=window,t=n.MsgrUI;t._getLocString=function(t){var i="";return n.GetString&&(i=n.GetString("live.webim.strings."+t)),i},t._getLocStringNS=function(t){var i="";return n.GetString&&(i=n.GetString(t)),i}}(),function(){var f=window,e=f.document,h=f.MC,u=h.ThreadActivityMessageType,i=f.ss,n=f.MsgrUI,o=f.Microsoft.Live.Messenger,r=o.PresenceStatus,s=null,t=n.Utility=function(){};t.backgroundThemeClassName="t_cbr",t.backgroundLightThemeClassName="t_cbs",t.fontColorThemeClassName="t_rc",t.borderTopThemeClassName="t_cbpr",t.borderTopLightThemeClassName="t_cbps",t.isElementPositionStatic=function(n){var i=t.getCurrentStyleProperty(n,"position");return i===""||i==="static"},t.getCurrentStyleProperty=function(n,t){var i=n.currentStyle,r;return i==null?(r=e.defaultView.getComputedStyle(n,null),r.getPropertyValue(t)):i[t]},t.getLocalizedStatusText=function(t){var u=t.get_presence().get_status(),i;switch(u){case r.appearOffline:return n._getLocString("statusAppearOffline");case r.offline:return i=t.get_type()===o.IMAddressType.connect&&t.get_isFacebookMobileEnabled()&&!t.get_isUser()?n._getLocString("facebookMobile"):n._getLocString("statusOffline");case r.away:case r.idle:case r.beRightBack:case r.outToLunch:return n._getLocString("statusAway");case r.busy:case r.inACall:return n._getLocString("statusBusy");case r.online:return n._getLocString("statusOnline");default:return""}},t.getNetworkIconsPath=function(){return o.MessengerUtility.getImagePath()+"NetworkIcons/"},t.getNetworkLabel=function(t){return t.get_isWindowsLive()?n._getLocString("networkMessenger"):t.get_name()},t.getActivityMessageElement=function(n){var i=e.createElement("span");return i.innerText=t.getActivityMessageString(n),i},t.getActivityMessageString=function(r){var f="",o=r.get_initiator().get_isUser()?n._getLocString("you"):r.get_initiator().get_contact().get_displayName(),e="";switch(r.get_activityType()){case u.addMember:e=t._getTargetNames(r.get_targets(),r.get_initiator()),e?f=i.format(n._getLocString("activityMessageAddMembers"),o,e):r.get_targets()!=null&&r.get_targets().length>0&&!r.get_initiator().get_isUser()&&(f=i.format(n._getLocString("activityMessageSelfAddMembers"),o));break;case u.deleteMember:r.get_targets().length===1&&r.get_initiator().equals(r.get_targets()[0])?f=r.get_initiator().get_isUser()?n._getLocString("activityMessageUserLeftGroup"):i.format(n._getLocString("activityMessageMemberLeftGroup"),r.get_initiator().get_contact().get_displayName()):(e=t._getTargetNames(r.get_targets(),r.get_initiator()),e&&(f=i.format(n._getLocString("activityMessageRemoveMembers"),o,e)));break;case u.topicUpdate:f=i.format(n._getLocString("activityMessageTopicUpdate"),o,r.get_otherInfo());break;case u.pictureUpdate:f=i.format(n._getLocString("activityMessagePictureUpdate"),o);break;case u.fileShared:f=r.get_initiator().get_isUser()?n._getLocString("activityMessageUserSharedFile"):i.format(n._getLocString("activityMessageMemberSharedFile"),r.get_initiator().get_contact().get_displayName());break;case u.contactShared:f=r.get_initiator().get_isUser()?n._getLocString("activityMessageUserSharedContact"):i.format(n._getLocString("activityMessageMemberSharedContact"),r.get_initiator().get_contact().get_displayName())}return f},t.isChatViewVisible=function(){return s==null&&(s=e.getElementById("chat_view")),s.style.display!=="none"},t._getTargetNames=function(n,t){var f=[],r,u;if(n!=null&&n.length>0)for(r=i.IEnumerator.getEnumerator(n);r.moveNext();)u=r.get_current(),u!==t&&f.push(u.get_contact().get_displayName());return f.join(", ")},t._getTimeFormat=function(t){var u=n._getLocStringNS("live.shared.marketinfo.webim.client.TimeReceivedFormat"),i=t.getHours(),r=t.getMinutes();return u.format("","","",i>12?i-12:i,i,r<10?"0"+r:r,i<12?n._getLocStringNS("live.shared.strings.webim.client.Am"):n._getLocStringNS("live.shared.strings.webim.client.Pm"))}}(),function(n){function h(n){var i=n._template,t=c.createElement("div");return r.isNullOrEmpty(i)?t:(t.innerHTML=i,t.children[0])}var u=window,c=u.document,i=u.MC,l=u.Microsoft.Live.Messenger,f=u.MsgrUI,t=f.EventType,r=u.ss,a="attachEvent",v="detachEvent",e="addEventListener",o="removeEventListener",s=f.UIElement=function(n){var r=this;r._element=n,r._internetExplorerEventNames={},r._otherEventNames={},r._internetExplorerEventNames[i.enumToString(t,t.blur)]="onblur",r._internetExplorerEventNames[i.enumToString(t,t.click)]="onclick",r._internetExplorerEventNames[i.enumToString(t,t.focus)]="onfocus",r._internetExplorerEventNames[i.enumToString(t,t.keyPress)]="onkeypress",r._internetExplorerEventNames[i.enumToString(t,t.keyDown)]="onkeydown",r._internetExplorerEventNames[i.enumToString(t,t.mouseDown)]="onmousedown",r._internetExplorerEventNames[i.enumToString(t,t.mouseUp)]="onmouseup",r._internetExplorerEventNames[i.enumToString(t,t.mouseOut)]="onmouseout",r._internetExplorerEventNames[i.enumToString(t,t.scroll)]="onscroll",r._otherEventNames[i.enumToString(t,t.blur)]="blur",r._otherEventNames[i.enumToString(t,t.click)]="click",r._otherEventNames[i.enumToString(t,t.focus)]="focus",r._otherEventNames[i.enumToString(t,t.keyPress)]="keypress",r._otherEventNames[i.enumToString(t,t.keyDown)]="keydown",r._otherEventNames[i.enumToString(t,t.mouseDown)]="mousedown",r._otherEventNames[i.enumToString(t,t.mouseUp)]="mouseup",r._otherEventNames[i.enumToString(t,t.mouseOut)]="mouseout",r._otherEventNames[i.enumToString(t,t.scroll)]="scroll"};s.prototype={_template:null,get_element:function(){return this._element},set_element:function(n){return n!=null&&(this._element=n),n},get_isVisible:function(){return this._element.style.visibility!=="hidden"&&this._element.style.display!=="none"},set_isVisible:function(t){var i=this._element.style;return(i.visibility!=="hidden"&&i.display!=="none")!==t&&(i.visibility=t?"":"hidden",i.display=t?"":"none"),n(this).triggerHandler("propertyChanged",[this,new l.PropertyChangedEventArgs("IsVisible")]),t},get_text:function(){return this._element.innerText},set_text:function(n){return n==null&&(n=""),this._element.innerText=n,n},get_innerHtml:function(){return this._element.innerHTML},set_innerHtml:function(n){return this._element.innerHTML=n,n},onVisualInitialized:function(){},attachEvent:function(n,r){this.get_element()[e]!=null?this.get_element()[e](this._otherEventNames[i.enumToString(t,n)],r,!1):this.get_element()[a](this._internetExplorerEventNames[i.enumToString(t,n)],r)},detachEvent:function(n,r){var u=this;u.get_element()[o]!=null?u.get_element()[o](u._otherEventNames[i.enumToString(t,n)],r,!1):u.get_element()[v](u._internetExplorerEventNames[i.enumToString(t,n)])},addCssClass:function(n,t){var f=this._element.className.split(" "),e,i,o,u,s,h;if(!t){f.contains(n)||(this._element.className=this._element.className+" "+n);return}for(e="_"+n,i=[],f.contains(n)||i.push(n),o=r.IEnumerator.getEnumerator(f);o.moveNext();)u=o.get_current(),u.endsWith(e)||(i.push(u),i.push(u+e));for(this._element.className="",s=r.IEnumerator.getEnumerator(i);s.moveNext();)h=s.get_current(),r.isNullOrEmpty(h)||(this._element.className=this._element.className+" "+h)},removeCssClass:function(n,t){for(var u=this,h="_"+n,c=u._element.className.split(" "),f=[],s=r.IEnumerator.getEnumerator(c),i,e,o;s.moveNext();)i=s.get_current(),t?i===n||i.endsWith(h)||f.push(i):i!==n&&f.push(i);for(u._element.className="",e=r.IEnumerator.getEnumerator(f);e.moveNext();)o=e.get_current(),r.isNullOrEmpty(o)||(u._element.className=u._element.className+" "+o)},addAttribute:function(n,t){r.isNullOrEmpty(n)||r.isNullOrUndefined(t)||this._element.setAttribute(n,t)},removeAttribute:function(n){r.isNullOrEmpty(n)||this._element.removeAttribute(n)},addChild:function(n){n.get_element()==null&&n.set_element(h(n)),this._element.appendChild(n.get_element()),this.addLogicalChild(n)},removeChild:function(n){this._element.removeChild(n.get_element())},insertAt:function(n,t){var i=this;t.get_element()==null&&t.set_element(h(t)),i.get_element().children.length>n?i.get_element().insertBefore(t.get_element(),i.get_element().children[n]):i._element.appendChild(t.get_element()),i.addLogicalChild(t)},addLogicalChild:function(n){n.onVisualInitialized()},clearChildren:function(){this._element.innerHTML=""},findElementById:function(n){var t,i;if(this._getResourceId()===n)return this._element;for(t=0;t<this._element.children.length;t++)if(i=new s(this._element.children[t]).findElementById(n),i!=null)return i;return null},_getResourceId:function(){var n=this._element.wlc_resourceid,t;return n==null&&(t=this._element.attributes!=null?this._element.attributes.getNamedItem("resourceid"):null,n=t!=null?t.value:"",this._element.wlc_resourceid=n),n}}}(window.originaljQuery||jQuery),function(n){var u=window,e=u.document,i=u.MsgrUI,r=u.ss,f=i.UIElement,s=f.prototype,o=i._flyout=function(n){f.call(this,n)},t=o.prototype=new f;t.constructor=o,t._documentElement$1=null,t._globalClickHandler$1=null,t._globalKeydownHandler=null,t._focusOutTimer$1=-1,t.get_isActivated=function(){return this.get_isVisible()},t.set_isActivated=function(n){return n!==this.get_isVisible()&&(this.get_element().style.visibility=n?"":"hidden",this.get_element().style.display=n?"":"none",n?(this._setCapture$1(),this.get_element().focus()):this._releaseCapture$1()),n},t.onVisualInitialized=function(){s.onVisualInitialized.call(this),this.addCssClass("WebIMFlyout",!1),n(this.get_element()).bind("focusout",r.Delegate.create(this,this._onFocusOut$1))},t._onFocusOut$1=function(){var n=this;n._focusOutTimer$1!==-1&&window.clearTimeout(this._focusOutTimer$1),n._focusOutTimer$1=window.setTimeout(r.Delegate.create(n,function(){n._focusOutTimer$1=-1;for(var t=e.activeElement;n.get_element()!==t&&!r.isNullOrUndefined(t.parentNode);)if(t=t.parentNode,t.parentNode===e.body){n.set_isActivated(!1);return}}),500)},t._setCapture$1=function(){this._documentElement$1=new f(e.documentElement),this._globalClickHandler$1=r.Delegate.create(this,this._onDocumentClick$1),this._globalKeydownHandler=r.Delegate.create(this,this._onDocumentKeydown),this._documentElement$1.attachEvent(i.EventType.mouseUp,this._globalClickHandler$1),this._documentElement$1.attachEvent(i.EventType.keyDown,this._globalKeydownHandler);var n=window.event;r.isNullOrUndefined(n)||(n.cancelBubble=!0,n.returnValue=!1)},t._releaseCapture$1=function(){this._documentElement$1!=null&&(this._documentElement$1.detachEvent(i.EventType.mouseUp,this._globalClickHandler$1),this._documentElement$1.detachEvent(i.EventType.keyDown,this._globalKeydownHandler),this._globalClickHandler$1=null,this._globalKeydownHandler=null,this._documentElement$1=null)},t._onDocumentClick$1=function(){this.get_isActivated()&&this.set_isActivated(!1)},t._onDocumentKeydown=function(t){if(t.keyCode==27&&this.get_isActivated()){this.set_isActivated(!1);for(var i=n(this.get_element()),r=null;(!r||r.length==0)&&i.length>0;){while(i.next().length==0&&i[0]!=u.document)i=i.parent();i=i.nextAll(),r=i.find("a, textarea, button").filter(":visible")}r.length>0&&r[0].focus()}}}(window.originaljQuery||jQuery),function(){var t=window,f=t.document,i=t.MsgrUI,r=t.ss,u=i.UIElement,o=u.prototype,e=i.KeyboardAccessible=function(n){u.call(this,n)},n=e.prototype=new u;n.constructor=e,n.dispose=function(){},n.onVisualInitialized=function(){o.onVisualInitialized.call(this),this.attachEvent(i.EventType.keyDown,r.Delegate.create(this,this._onKeyDown$1))},n._onMoveUp$1=function(n){if(this.get_element().children.length>1){var t=f.activeElement.parentNode;do if(t=t.previousSibling,r.isNullOrUndefined(t))t=this.get_element().children[this.get_element().children.length-1];else if(t===n.srcElement)break;while(t.nodeType!==1||t.style.visibility==="hidden"||t.style.display==="none");t.children[0].focus()}},n._onMoveDown$1=function(n){if(this.get_element().children.length>1){var t=f.activeElement.parentNode;do if(t=t.nextSibling,r.isNullOrUndefined(t))t=this.get_element().children[0];else if(t===n.srcElement)break;while(t.nodeType!==1||t.style.visibility==="hidden"||t.style.display==="none");t.children[0].focus()}},n._onKeyDown$1=function(n){if(n.keyCode===9)return n.returnValue;if(n.keyCode===38)this._onMoveUp$1(n);else if(n.keyCode===40)this._onMoveDown$1(n);else return n.returnValue;return n.cancelBubble=!0,n.returnValue=!1,!1}}(),function(){var u=window,t=u.MsgrUI,e=u.ss,i=t._flyout,r=i.prototype,f=t._confirmationDialog=function(){i.call(this)},n=f.prototype=new i;n.constructor=f,n._confirmationText$2=null,n._acceptButtonText$2=null,n._onAccept$2=null,n._dialogText$2=null,n._acceptButton$2=null,n._template=t._templates._confirmationDialog,n.get_isActivated=function(){return r.get_isActivated.call(this)},n.set_isActivated=function(n){return this._dialogText$2.set_text(this._confirmationText$2),this._acceptButton$2.set_text(this._acceptButtonText$2),r.set_isActivated.call(this,n),n},n.onVisualInitialized=function(){r.onVisualInitialized.call(this),this._dialogText$2=new t.UIElement(this.findElementById("DialogText")),this._acceptButton$2=new t.UIElement(this.findElementById("AcceptButton")),this._acceptButton$2.attachEvent(t.EventType.click,e.Delegate.create(this,this._onAcceptButtonClicked$2))},n.setContent=function(n,t,i){this._confirmationText$2=n,this._acceptButtonText$2=t,this._onAccept$2=i},n._onAcceptButtonClicked$2=function(){this.set_isActivated(!1),this._onAccept$2!=null&&this._onAccept$2.invoke()}}(),function(){var o="t_cbr",h='<a href="#" onclick="return false;" class="ContextMenuItem" role="menuitem">{0}<\/a>',c='\r\n<a href="#" onclick="return false;" class="ContextMenuItem" role="menu" submenu>\r\n    <span class="ContextMenuText">{0}<\/span>\r\n    <span class="ContextMenuChevron">\r\n        <img src="{1}"/>\r\n    <\/span>\r\n<\/a>',f=window,l=f.document,r=f.MsgrUI,u=r.EventType,t=f.ss,i=r.UIElement,e=r._flyout,a=e.prototype,s=r._contextMenu=function(n){e.call(this,n)},n=s.prototype=new e;n.constructor=s,n._menuItemList$2=null,n._template=r._templates._contextMenu,n.dispose=function(){this.clearMenuItems()},n.onVisualInitialized=function(){a.onVisualInitialized.call(this),this._menuItemList$2=new i(this.findElementById("MenuItemList"))},n.addMenuItem=function(n,f,e,o){var a=new i(l.createElement("li"));this._menuItemList$2.addChild(a),o?(a.set_innerHtml(t.format(c,n,r._templates.messagingImageStrip)),a.get_element().children[0].setAttribute("aria-label",n)):a.set_innerHtml(t.format(h,n));var s=new i(a.get_element().children[0]),v=this,y=function(n){o||v.set_isActivated(!1),t.isNullOrUndefined(f)||f.invoke(n)};return s.attachEvent(u.click,y),s.attachEvent(u.mouseDown,t.Delegate.create(this,this._onMenuItemMouseDown$2)),s.attachEvent(u.mouseUp,t.Delegate.create(this,this._onMenuItemMouseUp$2)),s.attachEvent(u.mouseOut,t.Delegate.create(this,this._onMenuItemMouseUp$2)),t.isNullOrEmpty(e)||s.addAttribute("sutra",e),s},n.clearMenuItems=function(){this._menuItemList$2.clearChildren()},n._onMenuItemMouseDown$2=function(n){var t;if(n.currentTarget!=null)t=new i(n.currentTarget);else if(n.srcElement!=null)t=new i(n.srcElement);else return;t.addCssClass(o,!1)},n._onMenuItemMouseUp$2=function(n){var t;if(n.currentTarget!=null)t=new i(n.currentTarget);else if(n.srcElement!=null)t=new i(n.srcElement);else return;t.removeCssClass(o,!1)}}(),function(){var u=window,t=u.MsgrUI,i=t.UIElement,r=t.ModernConversationTextBox=function(n){i.call(this,n)},n=r.prototype=new i;n.constructor=r,n.get_text=function(){return this.get_element().value},n.set_text=function(n){return n==null&&(n=""),this.get_element().value=n,n},n.dispose=function(){},n.onVisualInitialized=function(){}}(),function(n){var u=window,f=u.document,i=u.MsgrUI,s=u.Microsoft.Live.Messenger,r=u.ss,e=i.UIElement,o=i._modernConversationInputControl=function(n,t){e.call(this,t),this._aggregatedConversation$1=n,this._conversation$1=this._aggregatedConversation$1.get_currentConversation(),this._buddyContact$1=this._conversation$1.get_buddyContact(),this._defaultText$1=i._getLocString("sendMessage")},t=o.prototype=new e;t.constructor=o,t._conversation$1=null,t._aggregatedConversation$1=null,t._buddyContact$1=null,t._defaultText$1=null,t._defaultTextVisible$1=!1,t._maxCharLength$1=400,t._textbox$1=null,t.get_textBox=function(){return this._textbox$1},t.get_disabled=function(){return this._textbox$1.get_element().getAttribute("disabled")},t.set_disabled=function(n){return this.get_disabled()!==n&&(n?this._textbox$1.addAttribute("disabled","true"):this._textbox$1.removeAttribute("disabled")),n},t.addText=function(n){this._defaultTextVisible$1?(this._hideDefaultText$1(),this._textbox$1.set_text(n)):this._textbox$1.set_text(this._textbox$1.get_text()+n)},t.dispose=function(){n(this._aggregatedConversation$1).unbind("currentConversationChanged",r.Delegate.create(this,this._onCurrentConversationChanged$1)),this._textbox$1.detachEvent(i.EventType.blur,r.Delegate.create(this,this._onBlur$1)),this._textbox$1.detachEvent(i.EventType.focus,r.Delegate.create(this,this._onFocus$1)),this._textbox$1.detachEvent(i.EventType.keyDown,r.Delegate.create(this,this._onKeyDown$1))},t.onVisualInitialized=function(){n(this._aggregatedConversation$1).bind("currentConversationChanged",r.Delegate.create(this,this._onCurrentConversationChanged$1)),this._textbox$1=new i.ModernConversationTextBox(this.findElementById("TextBox")),this._textbox$1.addAttribute("aria-label",this._defaultText$1),this._textbox$1.attachEvent(i.EventType.blur,r.Delegate.create(this,this._onBlur$1)),this._textbox$1.attachEvent(i.EventType.focus,r.Delegate.create(this,this._onFocus$1)),this._textbox$1.attachEvent(i.EventType.keyDown,r.Delegate.create(this,this._onKeyDown$1))},t._checkForOverflow$1=function(){this._textbox$1.get_text().length>this._maxCharLength$1&&this._textbox$1.set_text(this._textbox$1.get_text().substring(0,this._maxCharLength$1-1))},t._showDefaultText$1=function(){this._textbox$1.set_text(this._defaultText$1),this._defaultTextVisible$1=!0,this.addCssClass("DefaultText",!0)},t._hideDefaultText$1=function(){this._textbox$1.set_text(""),this._defaultTextVisible$1=!1,this.removeCssClass("DefaultText",!0)},t._onBlur$1=function(){this._defaultTextVisible$1||this._textbox$1.get_text()!==""||this._showDefaultText$1()},t._onFocus$1=function(){this._defaultTextVisible$1&&this._hideDefaultText$1()},t._onKeyDown$1=function(n){var t,i;return this._checkForOverflow$1(),t=null,f.parentWindow!=null&&(t=f.parentWindow.event),n.keyCode!==13||n.shiftKey?(this._conversation$1.notifyUserTyped(),n.keyCode===86&&n.ctrlKey&&u.setTimeout(r.Delegate.create(this,this._checkForOverflow$1),100)):(i=this._textbox$1.get_text(),i!==""&&(this._conversation$1.sendMessage(new s.TextMessage(i)),this._textbox$1.set_text("")),n.returnValue=!1,t!=null&&(t.returnValue=!1),n.preventDefault&&n.preventDefault()),n.returnValue},t._onCurrentConversationChanged$1=function(){this._conversation$1=this._aggregatedConversation$1.get_currentConversation()}}(window.originaljQuery||jQuery),function(n){var o="Typing.png",r=window,s=r.document,u=r.MsgrUI,h=r.Microsoft.Live.Messenger,i=r.ss,f=u.UIElement,e=u._modernConversationTypingControl=function(n,t){f.call(this,t),this._aggregatedConversation$1=n,this._conversation$1=this._aggregatedConversation$1.get_currentConversation(),this._buddyContact$1=this._conversation$1.get_buddyContact()},t=e.prototype=new f;t.constructor=e,t._conversation$1=null,t._buddyContact$1=null,t._aggregatedConversation$1=null,t._typingText$1=null,t.dispose=function(){n(this._aggregatedConversation$1).unbind("currentConversationChanged",i.Delegate.create(this,this._onCurrentConversationChanged$1)),n(this._conversation$1.get_typingAddresses()).unbind("collectionChanged",i.Delegate.create(this,this._onTypingAddressesChanged$1))},t.onVisualInitialized=function(){n(this._aggregatedConversation$1).bind("currentConversationChanged",i.Delegate.create(this,this._onCurrentConversationChanged$1)),n(this._conversation$1.get_typingAddresses()).bind("collectionChanged",i.Delegate.create(this,this._onTypingAddressesChanged$1));var t=s.createElement("img");t.src=h.MessengerUtility.getImagePath()+o,t.className="TypingControlImage",this.insertAt(0,new f(t)),this._typingText$1=new f(this.findElementById("TypingText")),this.get_element().style.visibility="hidden"},t._onTypingAddressesChanged$1=function(){var n=this._conversation$1.get_typingAddresses().get_count();n===0||n===1&&this._conversation$1.get_typingAddresses().get_item(0).get_isUser()?this.get_element().style.visibility="hidden":(this.get_element().style.visibility="visible",this._typingText$1.set_text(n===1?i.format(u._getLocString("typingIndicator"),this._conversation$1.get_typingAddresses().get_item(0).get_contact().get_displayName()):i.format(u._getLocString("typingIndicatorMultiple"),n)))},t._onCurrentConversationChanged$1=function(){this.get_element().style.visibility="hidden",n(this._conversation$1.get_typingAddresses()).unbind("collectionChanged",i.Delegate.create(this,this._onTypingAddressesChanged$1)),this._conversation$1=this._aggregatedConversation$1.get_currentConversation(),n(this._conversation$1.get_typingAddresses()).bind("collectionChanged",i.Delegate.create(this,this._onTypingAddressesChanged$1))}}(window.originaljQuery||jQuery),function(){var i=window,h=i.$B,u=i.document,t=i.MsgrUI,f=i.Microsoft.Live.Messenger,e=i.ss,o=t._flyout,c="Facebook",l="Google",a="emoji_strip_messenger.png",v="emoji_strip_facebook.png",y="emoji_strip_google.png",p="EmoticonImage",w="EmoticonAnchor",r=35,b=[[":)",":(",":d","(cool)",":o",";)"],[";(",":|",":*",":P",":$","|-)"],["|(","(inlove)","(yawn)","(doh)",":@","(wasntme)"],["(party)","(worry)","(mm)","(nerd)",":x","(hi)"],["(devil)","(angel)","(envy)","(wait)","(wonder)","(giggle)"],["(clap)","(think)","(bow)","(rofl)","(smirk)","(nod)"],["(yes)","(no)","(love)","(flower)","(rain)","(sun)"],["(music)","(bandit)","(tmi)","(coffee)","(pi)","(cash)"],["(flex)","(cake)","(beer)","(drink)","(dance)","(star)"]],k=[[":)",":(",":D",":o",":p",";("],[";)","(love)"]],d=[[":)",":(",":D",":p",";(",";)"],["(love)"]],s=t._modernConversationEmoticonPanel=function(n,t){o.call(this,n),this._inputControl$2=t},n=s.prototype=new o;n.constructor=s,n._messengerEmoticonPicker$2=null,n._facebookEmoticonPicker$2=null,n._googleEmoticonPicker$2=null,n._inputControl$2=null,n.dispose=function(){this._messengerEmoticonPicker$2=null,this._facebookEmoticonPicker$2=null,this._googleEmoticonPicker$2=null},n.onVisualInitialized=function(){var n=this;n._messengerEmoticonPicker$2=new t.KeyboardAccessible(n.findElementById("MessengerEmoticons")),n._facebookEmoticonPicker$2=new t.KeyboardAccessible(n.findElementById("FacebookEmoticons")),n._googleEmoticonPicker$2=new t.KeyboardAccessible(n.findElementById("GoogleEmoticons")),n.addLogicalChild(n._messengerEmoticonPicker$2),n.addLogicalChild(n._facebookEmoticonPicker$2),n.addLogicalChild(n._googleEmoticonPicker$2),n._addEmoticons$2(b,n._messengerEmoticonPicker$2,f.MessengerUtility.getEmoticonUrlPath()+a),n._addEmoticons$2(k,n._facebookEmoticonPicker$2,f.MessengerUtility.getEmoticonUrlPath()+v),n._addEmoticons$2(d,n._googleEmoticonPicker$2,f.MessengerUtility.getEmoticonUrlPath()+y)},n.show=function(n){var t=this;t.set_isActivated(!0),n===c?(t._messengerEmoticonPicker$2.set_isVisible(!1),t._googleEmoticonPicker$2.set_isVisible(!1),t._facebookEmoticonPicker$2.set_isVisible(!0),t._facebookEmoticonPicker$2.get_element().focus()):n===l?(t._messengerEmoticonPicker$2.set_isVisible(!1),t._facebookEmoticonPicker$2.set_isVisible(!1),t._googleEmoticonPicker$2.set_isVisible(!0),t._googleEmoticonPicker$2.get_element().focus()):(t._facebookEmoticonPicker$2.set_isVisible(!1),t._googleEmoticonPicker$2.set_isVisible(!1),t._messengerEmoticonPicker$2.set_isVisible(!0),t._messengerEmoticonPicker$2.get_element().focus())},n._onEmoticonClicked$2=function(n){var t=n.srcElement,i=t.nodeName.toLowerCase()==="a"?t.children[0].attributes.getNamedItem("alt").value:t.attributes.getNamedItem("alt").value;this._inputControl$2.get_disabled()||(this._inputControl$2.get_textBox().get_element().focus(),this._inputControl$2.addText(i)),this.set_isActivated(!1)},n._addEmoticons$2=function(n,i,f){for(var d=n[0].length*r,y=0,b=e.IEnumerator.getEnumerator(n),l,o,s,a,v;b.moveNext();){for(var g=b.get_current(),c=0,k=e.IEnumerator.getEnumerator(g);k.moveNext();)l=k.get_current(),o=u.createElement("img"),o.className=p,o.src=f,o.alt=l,o.title=l,o.style.marginTop=-(y*r)+"px",h.ltr?o.style.marginLeft=-(c*r)+"px":o.style.marginRight=-(d-(c+1)*r)+"px",s=u.createElement("a"),s.href="#",s.className=w,s.setAttribute("onclick","return false;"),s.appendChild(o),a=new t.UIElement(s),a.attachEvent(t.EventType.click,e.Delegate.create(this,this._onEmoticonClicked$2)),v=new t.UIElement(u.createElement("li")),v.addChild(a),i.addChild(v),c++;y++}}}(),function(){var n=window,i=n.$Do,r=n.wLive,u=n.$WLXIM,f=n.MsgrUI,t=n.ss;i.when("WLXContactPickerV2",0,function(){var n=r.ContactList.ViewModels.PersonFactory,i=f.GroupChatPersonFactory=function(t){n.call(this,t)},e=i.prototype=new n;e.constructor=i,e.createContacts=function(n){for(var f=[],o=t.IEnumerator.getEnumerator(n.getContacts()),s,i,e,r;o.moveNext();)if(s=o.get_current(),i=u.user.findContactById(s.getId()),!t.isNullOrUndefined(i)&&(i.get_skypeAddress()!=null||i.get_windowsLiveAddress()!=null)){e=this._createCommonModelFromPerson(n),r=n.getContactEmails(),!t.isNullOrUndefined(r)&&r.length>0?f.push(this._createContactFromCommonModel(e,r[0])):f.push(this._createContactFromCommonModel(e,i.get_skypeAddress()?i.get_skypeAddress().get_skypeName():""));break}return f}})}(),function(){var a='<textarea class="cp_textarea"><\/textarea>',o=300,c=80,r=window,v=r.$WLXIM,s=r.$Config,y=r.$Network,p=r.$Do,k=r.$ic,u=r.wLive,e=r.document,i=r.MsgrUI,t=r.ss,w=r.Microsoft.Live.Messenger,f=i.UIElement,b=f.prototype,h=i._contactPickerControl=function(){f.call(this),new f(e.getElementById("sidebar")).addChild(this),this._rosterContacts$1=[]},l=null,n=h.prototype=new f(null);n.constructor=h,n._dataModelOptions$1=null,n._dataModel$1=null,n._pickerModelOptions$1=null,n._contactPickerModel$1=null,n._pickerControlOptions$1=null,n._contactPicker$1=null,n._conversation$1=null,n._groupVersion$1=0,n._rosterContacts$1=null,n._callback$1=null,n._container$1=null,n._addButton$1=null,n._infobar$1=null,n._resetDataModel$1=!1,n._template=i._templates._contactPickerControl,h.get_instance=function(){return l==null&&(l=new h),l},n.get_conversation=function(){return this._conversation$1},n.onVisualInitialized=function(){b.onVisualInitialized.call(this),this.set_isVisible(!1),this.findElementById("Title").innerText=i._getLocString("addToConversation"),this._addButton$1=new f(this.findElementById("AddButton")),this._addButton$1.set_text(i._getLocString("add")),this._addButton$1.attachEvent(i.EventType.click,t.Delegate.create(this,this._onAddButtonClicked$1));var n=new f(this.findElementById("CancelButton"));n.set_text(i._getLocString("cancel")),n.attachEvent(i.EventType.click,t.Delegate.create(this,this._onCancelButtonClicked$1)),this._infobar$1=new f(this.findElementById("Infobar")),this._infobar$1.set_text(i._getLocString("contactPickerMaxLimit")),this._infobar$1.set_isVisible(!1)},n.show=function(n,i){var r=this,s=r._conversation$1 instanceof w.GroupConversation?r._conversation$1.get_version():0,h=r._conversation$1==null||r._conversation$1.get_id()!==n.get_id()||r._groupVersion$1!==s,e,f;r._conversation$1=n,r._groupVersion$1=s,r._callback$1=i,r.set_isVisible(!0),r._populateRosterContacts$1(),r._contactPicker$1==null?r._initialize$1():h||r._resetDataModel$1?(e=u.ContactPickerV2,f=e.ViewModels.ContactPickerModel,r._resetDataModel$1=!1,r._contactPicker$1.dispose(),r._contactPickerModel$1.dispose(),r._dataModel$1.dispose(),r._container$1.clearChildren(),r._container$1.get_element().innerHTML=a,r._pickerModelOptions$1.selectionMaximum=o-r._conversation$1.get_roster().get_count(),r._dataModel$1=new u.ContactList.ViewModels.FlatContactsDataModel(r._dataModelOptions$1),r._contactPickerModel$1=new f(r._dataModel$1,r._pickerModelOptions$1),r._contactPickerModel$1.$.bind(f.Events.selectedContacts,t.Delegate.create(r,r._onContactSelected$1)),r._contactPickerModel$1.$.bind(f.Events.deselectedContacts,t.Delegate.create(r,r._onContactDeselected$1)),r._contactPicker$1=new e.Controls.ContactPicker(r._container$1.get_element(),r._contactPickerModel$1,r._pickerControlOptions$1),r._contactPicker$1.setFocus(),r._showOrHideInfobar$1(!1)):(r._removeSelectedContacts$1(),r._contactPicker$1.setFocus(),r._showOrHideInfobar$1(!1)),r._addButton$1.get_element().disabled=!0},n._initialize$1=function(){var n=this;if(!n._isContactPickerLoaded$1()){n._loadContactPicker$1();return}n._dataModelOptions$1={},n._dataModelOptions$1.personFactory=i.GroupChatPersonFactory,n._dataModelOptions$1.personFilterFn=t.Delegate.create(n,n._personFilter$1),n._dataModelOptions$1.includeCategories=!1,n._dataModelOptions$1.includeGroups=!1,n._dataModelOptions$1.includeMeContact=!1,n._pickerModelOptions$1={},n._pickerModelOptions$1.allowDuplicateSelection=!1,n._pickerModelOptions$1.allowFreeformEntry=!1,n._pickerModelOptions$1.selectionMaximum=o-n._conversation$1.get_roster().get_count(),n._pickerControlOptions$1={},n._pickerControlOptions$1.maxHeight=6e3,n._pickerControlOptions$1.contactListBottomMargin=c,n._pickerControlOptions$1.maxLinesInAddressWell=3,n._pickerControlOptions$1.ariaLabel=i._getLocString("contactSearchDefaultText"),n._dataModel$1=new u.ContactList.ViewModels.FlatContactsDataModel(n._dataModelOptions$1),n._contactPickerModel$1=new u.ContactPickerV2.ViewModels.ContactPickerModel(n._dataModel$1,n._pickerModelOptions$1),n._contactPickerModel$1.$.bind(u.ContactPickerV2.ViewModels.ContactPickerModel.Events.selectedContacts,t.Delegate.create(n,n._onContactSelected$1)),n._contactPickerModel$1.$.bind(u.ContactPickerV2.ViewModels.ContactPickerModel.Events.deselectedContacts,t.Delegate.create(n,n._onContactDeselected$1)),n._container$1=new f(n.findElementById("Container")),n._contactPicker$1=new u.ContactPickerV2.Controls.ContactPicker(n._container$1.get_element(),n._contactPickerModel$1,n._pickerControlOptions$1),n._contactPicker$1.setFocus(),n._showOrHideInfobar$1(!1)},n._populateRosterContacts$1=function(){var n,i;if(this._rosterContacts$1.length=0,this._conversation$1!=null&&this._conversation$1.get_roster().get_count()>0)for(n=t.IEnumerator.getEnumerator(this._conversation$1.get_roster());n.moveNext();)i=n.get_current(),this._rosterContacts$1.push(i.get_contact().get_id())},n._personFilter$1=function(n){var t=this._getMwtContact$1(n);return t!=null&&(t.get_skypeAddress()!=null||t.get_windowsLiveAddress()!=null)&&!this._rosterContacts$1.contains(t.get_id())?!0:!1},n._onAddButtonClicked$1=function(){var n,r,t,u,i;if(this.set_isVisible(!1),n=this._contactPickerModel$1.selectedContacts(),n.length>0){for(r=new Array(n.length),t=0;t<n.length;t++)this._contactPickerModel$1.deselectContactBySelectedContactId(n[t].id()),u=n[t].contact().pwcObject(),i=this._getMwtContact$1(u),r[t]=i.get_skypeAddress()!=null?i.get_skypeAddress():i.get_windowsLiveAddress();this._resetDataModel$1=!0,this._callback$1.invoke(r)}else this._callback$1.invoke(null)},n._onCancelButtonClicked$1=function(){this.set_isVisible(!1),this._removeSelectedContacts$1(),this._callback$1.invoke(null)},n._removeSelectedContacts$1=function(){var i=this._contactPickerModel$1.selectedContacts(),n,r;if(i.length>0)for(n=t.IEnumerator.getEnumerator(i);n.moveNext();)r=n.get_current(),this._contactPickerModel$1.deselectContactBySelectedContactId(r.id())},n._getMwtContact$1=function(n){for(var r=t.IEnumerator.getEnumerator(n.getContacts()),u,i;r.moveNext();)if(u=r.get_current(),i=v.user.findContactById(u.getId()),!t.isNullOrUndefined(i)&&(i.get_skypeAddress()!=null||i.get_windowsLiveAddress()!=null))return i;return null},n._showOrHideInfobar$1=function(n){n?(this._infobar$1.set_isVisible(!0),this._pickerControlOptions$1.contactListBottomMargin=c+this._infobar$1.get_element().clientHeight+20,this._contactPicker$1.resetSettings(this._pickerControlOptions$1)):(this._infobar$1.set_isVisible(!1),this._pickerControlOptions$1.contactListBottomMargin=c,this._contactPicker$1.resetSettings(this._pickerControlOptions$1))},n._onContactSelected$1=function(n,i){for(var u=t.IEnumerator.getEnumerator(i.contacts),r;u.moveNext();)r=u.get_current(),r.error()&&r.error(!1);this._addButton$1.get_element().disabled=!1,this._conversation$1.get_roster().get_count()+this._contactPickerModel$1.selectedContacts().length>=o&&this._showOrHideInfobar$1(!0)},n._onContactDeselected$1=function(){var n=this._contactPickerModel$1.selectedContacts().length;n===0&&(this._addButton$1.get_element().disabled=!0),this._conversation$1.get_roster().get_count()+n<o&&this._showOrHideInfobar$1(!1)},n._isContactPickerLoaded$1=function(){try{if(t.isNullOrUndefined(u.ContactPickerV2.Controls.ContactPicker)||t.isNullOrUndefined(e.getElementById("cp_inputTemplate")))return!1}catch(n){return!1}return!0},n._loadContactPicker$1=function(){var n=t.format("{0}//{1}/handlers/loadcontactpicker.mvc",window.location.protocol,window.location.hostname);y.fetchXML(n,t.Delegate.create(this,this._onRequestComplete$1),"GET")},n._onRequestComplete$1=function(n){var u,i,r;if(!this._isContactPickerLoaded$1()&&n.status===200&&n.readyState===4){for(t.isNullOrUndefined(s.ContactPickerV2)&&(s.ContactPickerV2={}),t.isNullOrUndefined(s.ContactPickerV2.DefaultAriaLabel)&&(s.ContactPickerV2.DefaultAriaLabel=""),u=e.createElement("div"),u.innerHTML=n.responseText;u.children.length>0;){if(i=u.children[0],u.removeChild(i),!t.isNullOrEmpty(i.tagName)&&i.tagName.toLowerCase()==="script"&&i.type==="text/javascript"){if(r=e.createElement("script"),r.type=i.type,i.src)r.src=i.src;else try{r.appendChild(e.createTextNode(i.innerHTML))}catch(f){r.text=i.innerHTML}i=r}e.body.appendChild(i)}$icm.addTemplates(window.icPwcData),p.when("WLXContactPickerV2",0,t.Delegate.create(this,this._initialize$1))}}}(),function(n){var i=window,u=window.document,r=i.MsgrUI,f=i.Microsoft.Live.Messenger.PresenceStatus,e="<li><a class='ContactTile' sutra='contacttile' href='#' onclick='return false;'><div class='Chiclet' resourceid='Chiclet' sutra='contacttilechiclet'><\/div><div class='Name' resourceid='Name' sutra='contacttiledisplayname'><\/div><div resourceid='AVGlyphs' class='AVGlyphs' sutra='contacttileavglyphs'><div class='VideoGlyph'><img /><\/div><div class='AudioGlyph'><img /><\/div><\/div><\/a><\/li>",t=null;r._contactTile=function(i,o){var h=this,s=null,l=null,a=null;h.get_element=function(){return s.get(0)},h.get_contact=function(){return i},h.render=function(){if(!s){if(!t){var i=n(e);i.find("img").attr("src",r._templates.messagingImageStrip),t=u.createDocumentFragment(),t.appendChild(i.get(0))}s=n(t.cloneNode(!0).childNodes[0]),l=s.find("[resourceid='Chiclet']"),a=s.find("[resourceid='AVGlyphs']")}return v(),c(),s.get(0)},h.activate=function(){s.click(p),n(i).bind("propertyChanged",y),n(i.get_presence()).bind("propertyChanged",c)},h.deactivate=function(){s.unbind("click"),n(i).unbind("propertyChanged",y),n(i.get_presence()).unbind("propertyChanged",c)};var v=function(){s.find("[resourceid='Name']").text(i.get_displayName())},c=function(){i.get_presence().get_status()==f.online?l.addClass("Online"):l.removeClass("Online"),i.get_isAudioVideoCapable()?a.show():a.hide(),o&&o.presenceChangedEventHandler(h,i.get_presence().get_status())},p=function(n){!n.isPropagationStopped()&&o&&o.clickEventHandler(h),n.stopPropagation()},y=function(n,t,i){switch(i.get_propertyNamePascal()){case"DisplayName":case"FullName":case"IsIdentityVerified":v();break;case"CurrentAddress":case"IsAppearOfflineTo":c()}}}}(window.originaljQuery||jQuery),function(){var n=window,t=n.MsgrUI;t._contactTileEventsHandler=function(){var n=this,t=function(){},i=function(){};n.clickEventHandler=t,n.presenceChangedEventHandler=i,n.set_clickEventHandler=function(i){n.clickEventHandler=i&&i instanceof Function?i:t},n.set_presenceChangedEventHandler=function(t){n.presenceChangedEventHandler=t&&t instanceof Function?t:i}}}(),function(n){var t=window,i=t.$icm,r=t.MsgrUI,u="<div class='PictureGrid GridView'><\/div>";r._pictureGridControl=function(t,r){var s;var e=this,f=null,o=[];e.get_element=function(){return f.get(0)},e.render=function(){return f||(f=n(u)),n.each(t,function(n,t){var r=i.createICForPerson("icTmMessagingUserTileGridTemplate",t.getId(),{toolTipType:"name"});o.push(r),f.append(r.render())}),f.get(0)},e.activate=function(){n.each(o,function(t,i){i.activate(),n("#"+i.id).click({person:i.person},s)})},e.deactivate=function(){n.each(o,function(t,i){n("#"+i.id).unbind("click",s),i.deactivate()})},e.showAsListView=function(n){n?f.removeClass("GridView"):f.addClass("GridView")},s=function(n){r&&r instanceof Function&&r(n.data.person,n.srcElement)}}}(window.originaljQuery||jQuery),function(){var n=window,t=n.MsgrUI;t._contactSearchIndexer=function(){var n=this;n.matchField=function(n){return n.get_displayName()},n.getKeysAndWeights=function(n){var s=n.get_displayName(),f=wLive.Search.Helpers.getSuffixStringsFor(s),t=[],u,o,i,e,r;for(f[0]&&t.push(new wLive.Search.RankSearchKeyWeight(f[0],1.5,1)),u=1,o=f.length;u<o;u++)t.push(new wLive.Search.RankSearchKeyWeight(f[u],1,u+1));return i=n.get_emailAddress(),i&&(i=i.toLowerCase(),t.push(new wLive.Search.RankSearchKeyWeight(i,.75,1)),e=i.split("@"),e.length>1&&e[1]&&t.push(new wLive.Search.RankSearchKeyWeight(e[1],.5,1))),r=n.get_skypeName(),r&&r.length>0&&(r=r.toLowerCase(),t.push(new wLive.Search.RankSearchKeyWeight(r,.75,1))),t},n.autoComplete=function(n){return n.get_displayName()},n.isValid=function(){return!0},n.compareParents=null,n.comparer=function(n,t){var r=n.get_id(),u=t.get_id(),i=0;return r>u?i=1:r<u&&(i=-1),i}}}(),function(n){var t=window,r=n(t.document),u=t.$B,e=t.$Do,i=t.MsgrUI,o="<div resourceid='ContactSearch' class='WebIMContactSearch'><div class='ContactSearchBox'><input resourceid='ContactSearchInput' class='ContactSearchInput' type='search' disabled='true' maxlength='50' sutra='contactsearchbox'><\/input><div class='ContactSearchGlyph' sutra='contactsearchglyph'><img /><\/div><\/div><div resourceid='ContactSearchResult' class='ContactSearchResult' sutra='contactsearchresult'><div resourceid='InfoBar' class='ContactSearchInfoBar' sutra='contactsearchinfobar'><\/div><ul resourceid='ContactSearchList' class='ContactSearchList' sutra='contactsearchlist'><\/ul><\/div><\/div>",s=9,h=13,c=27,l=38,f=40;i._contactSearchControl=function(a){var nt=this,p=null,v=null,b=null,d=null,w=null,tt=null,y=null,ct=a.get_contact().get_id(),g=i._getLocString("contactSearchLoading"),lt=!(u.IE&&u.V<=9),it=30;nt.get_element=function(){return p.get(0)},nt.render=function(){if(!p){p=n(o),v=p.find("[resourceid='ContactSearchInput']"),b=p.find("[resourceid='ContactSearchResult']"),d=p.find("[resourceid='InfoBar']"),w=p.find("[resourceid='ContactSearchList']");var r;t.$Utility.isHighContrast()?r="sb/search":(r="h/command2",p.find("img").addClass("ImageStrip")),r+=u.rtl?"_rtl.png":".png",p.find("img").attr("src",t.$Config.imgsBase+r),d.text(i._getLocString("contactSearchNoResults"))}return k(),p.get(0)},nt.activate=function(){e.when("wlxsearchshared",0,et)},nt.deactivate=function(){e.remove("wlxsearchshared",0,et),v.unbind("focus",ot),v.unbind("keyup",st),v.unbind("keydown",ht),r.unbind("click",ut)};var k=function(){lt?(v.val(""),v.attr("placeholder",g)):v.val(g),v.attr("aria-label",g),b.hide(),y=null,r.unbind("click",ut)},at=function(){for(var u=a.get_contacts(),r=[],n=0;n<u.get_count();n++)u.get_item(n).get_isEmailOnlyContact()||r.push(u.get_item(n));r=r.sort(rt),tt=new t.wLive.Search.Indexer(new i._contactSearchIndexer),tt.initialize(r)},vt=function(t){var f,u,e,o;tt||at();var i=[],r=[],s=tt.getMatches(t,100).result;for(f=0;f<s.length;f++)(u=s[f],u.get_id()!=ct)&&(e=u.get_presence(),e&&e.get_status()==1?i.push(u):r.push(u));w.empty(),o=t.toLowerCase().split(" "),i=i.sort(rt),n.each(i,function(n,t){ft(t,o)}),r=r.sort(rt),n.each(r,function(n,t){ft(t,o)}),i.length+r.length==0?(w.hide(),d.show()):(d.hide(),w.show()),b.show()},yt=function(t){var e=w.find("li"),u,o,i,r;if(e.length!=0&&(y==null?y=n(e[0]):(y.removeClass("Hover"),t==f?u=y.next():(u=y.prev(),o=v.val(),v.val(o)),u.length>0&&(y=u)),n(y).addClass("Hover"),i=b.get(0),i.scrollHeight>i.clientHeight)){if(r=e.index(y.get(0)),i.scrollTop<=r*it&&i.clientHeight+i.scrollTop>=(r+1)*it)return;i.scrollTop=t==f?(r+1)*it-i.clientHeight:r*it}},ft=function(t,r){var f=new i._contactTile(t),u=f.render();n(u).attr("contactid",t.get_id()),pt(u,r,t),w.append(u),n(u).click(wt)},pt=function(t,i,r){for(var v=r.get_displayName(),o=n("<span/>"),h=v.split(" "),u,c,s,e,l,a,f=0;f<h.length;f++){for(u=h[f],c=!1,s=0;s<i.length;s++)if((e=i[s],e.length!=0)&&u.length>0&&u.toLowerCase().startsWith(e)){c=!0,l=n("<span class='t_elnk' sutra='contactsearchmatch'/>").text(u.substring(0,e.length)),a=n("<span/>").text(u.substring(e.length)),o.append(l).append(a);break}c||n("<span/>").text(u).appendTo(o),f<h.length-1&&n("<span/>").text(" ").appendTo(o)}n(t).find("[resourceid='Name']").empty().append(o)},rt=function(n,t){n.get_displayName().toLowerCase().localeCompare(t.get_displayName().toLowerCase())},et=function(){v.removeAttr("disabled"),v.focus(ot),v.keyup(st),v.keydown(ht),g=i._getLocString("contactSearchDefaultText"),k()},wt=function(i){k();var r=n(i.currentTarget).attr("contactid");t.$WLXIM.startConversationWithContactId(r,"contactList",!0)},ot=function(){v.val()==g&&v.val(""),r.click(ut)},ut=function(n){n.srcElement!=v.get(0)&&n.srcElement!=w.get(0)&&n.srcElement!=d.get(0)&&k()},st=function(t){if(t.keyCode==c){k(),b.hide(),v.blur();return}if(t.keyCode==l||t.keyCode==f){yt(t.keyCode);return}if(t.keyCode==h&&y){n(y).click();return}var i=v.val().trim();i?vt(i):b.hide()},ht=function(n){v.is(":focus")==!0&&n.keyCode==s&&k()}}}(window.originaljQuery||jQuery),function(n){var i=window,l=i.document,o=i.$pwc,a=i.ss,r=i.MsgrUI,t=r.PeopleFilter,s=i.wLive.People,f=s.NetworkID,v=s.SortOrder,h=i.Microsoft.Live.Messenger,c=h.PresenceStatus,y=h.Services.SkyJSHelper,p="<div class='WebIMPeople' sutra='peoplecontrol'><div class='Header' sutra='peoplecontrolheader'><h1 resourceid='Title' class='Title' sutra='peoplecontroltitle'><\/h1><a resourceid='Filter' class='Filter' sutra='peoplecontrolfilter' href='#' onclick='return false;'><div resourceid='FilterText' class='FilterText'><\/div><div class='Chevron'><img /><\/div><\/a><div resourceid='FilterMenuContainer' class='FilterMenuContainer' sutra='peoplecontrolfilterflyout'><\/div><\/div><div resourceid='Status' sutra='peoplecontrolstatus' style='clear: both;'><\/div><ul resourceid='ContactList' class='ContactList' sutra='peoplecontrollist'><\/ul><\/div>",e=20,u="renderComplete";r._peopleControl=function(s){var k=this,w=null,ot=null,tt=null,st=null,d=null,ht=null,g=[],it=new r._contactTileEventsHandler,h=s.get_settings().get_peopleFilter()||t.all,rt=0,b=null,lt=!1,nt={};k.get_element=function(){return w.get(0)},k.render=function(t){if(!w)if(w=n(p),w.find("img").attr("src",r._templates.messagingImageStrip),ot=w.find("[resourceid='Filter']"),tt=w.find("[resourceid='FilterText']"),st=w.find("[resourceid='FilterMenuContainer']"),d=w.find("[resourceid='Status']"),ht=w.find("[resourceid='ContactList']"),w.find("[resourceid='Title']").text(r._getLocString("peopleControlTitle")),d.text(r._getLocString("noOnlineContacts")),t){i.setTimeout(function(){ft(!0)},10);var f=function(){lt=!0,n(nt).unbind(u,f),n(k).triggerHandler(u)};n(nt).bind(u,f)}else ft();return t&&lt&&n(k).triggerHandler(u),w.get(0)},k.activate=function(){o.$persons.bind("changed",wt),ot.click(bt),it.set_clickEventHandler(gt),it.set_presenceChangedEventHandler(ni),n.each(g,function(n,t){t.activate()})},k.deactivate=function(){o.$persons.unbind("changed",wt),ot.unbind("click"),it.set_clickEventHandler(null),it.set_presenceChangedEventHandler(null),n.each(g,function(n,t){t.deactivate()})};var ft=function(r){var f,o,c;d.hide(),ht.empty(),g=[],f=vt(),f.length==0&&(h!=t.all||h!=t.available)&&(h=t.all,s.get_settings().set_peopleFilter(h),f=vt()),yt(),r?(o=0,c=function(r){var s=f.slice(r,r+e);s.length>0&&(at(s),o+=ct(g.slice(r,r+e))),s.length<e?i.setTimeout(function(){h==t.available&&o==0&&d.show(),g.length>0?w.show():w.hide(),n(nt).triggerHandler(u)},10):i.setTimeout(function(){c(r+e)},10)},i.setTimeout(function(){c(0)},10)):(at(f),h==t.available&&ct(g)==0&&d.show(),g.length>0?w.show():w.hide())},at=function(t){var i=l.createDocumentFragment();n.each(t,function(n,t){var u=new r._contactTile(t,it);g.push(u),i.appendChild(u.render())}),ht.append(i)},et=function(n){var i=[];switch(n){case t.all:case t.available:i.push(f.windowsLive),i.push(f.skype),i.push(f.facebook),i.push(f.google);break;case t.skype:i.push(f.windowsLive),i.push(f.skype);break;case t.facebook:i.push(f.facebook);break;case t.google:i.push(f.google)}return i},vt=function(){var t={};t.networks=et(h),t.isIMCapable=!0;var r=o.getPersons(t,v.displayName),i=[],u=s.get_contact();return n.each(r,function(n,t){for(var e=t.getContacts(),r,f=0;f<e.length;f++)if(r=s.findContactById(e[f].getId()),r&&r.get_currentAddress()&&r!==u){i.push(r);break}}),i},ct=function(i){if(h==t.all)d.hide(),n.each(i,function(t,i){n(i.get_element()).show()});else if(h==t.available)return rt=i.length,n.each(i,function(t,i){i.get_contact().get_presence().get_status()!=c.online&&(n(i.get_element()).hide(),rt--)}),rt;return 0},yt=function(){switch(h){case t.all:tt.text(r._getLocString("peopleFilterAll"));break;case t.available:tt.text(r._getLocString("statusOnline"));break;case t.skype:tt.text("Skype");break;case t.facebook:tt.text("Facebook");break;case t.google:tt.text("Google")}},bt=function(n){n.isPropagationStopped()||(b||(b=new r._contextMenu(null),new r.UIElement(st[0]).addChild(b),kt()),b.set_isActivated(!0))},kt=function(){var n,u,i;for(b.clearMenuItems(),b.addMenuItem(r._getLocString("peopleFilterAll"),ut,"flyoutoptionall").addAttribute("filterValue",t.all),b.addMenuItem(r._getLocString("statusOnline"),ut,"flyoutoptionavailable").addAttribute("filterValue",t.available),n={},n.isIMCapable=!0,n.networks=et(t.skype),y.skypeEnabled&&o.getPersons(n).length>1&&b.addMenuItem("Skype",ut,"flyoutoptionskype").addAttribute("filterValue",t.skype),u=a.IEnumerator.getEnumerator(s.get_networks());u.moveNext();)i=u.get_current(),i.get_isFacebook()&&i.get_supportsIM()&&(n.networks=et(t.facebook),o.getPersons(n).length>0&&b.addMenuItem("Facebook",ut,"flyoutoptionfacebook").addAttribute("filterValue",t.facebook)),i.get_isGoogle()&&i.get_supportsIM()&&(n.networks=et(t.google),o.getPersons(n).length>0&&b.addMenuItem("Google",ut,"flyoutoptiongoogle").addAttribute("filterValue",t.google))},pt=function(n){var i="";switch(n){case t.all:i="AllContacts";break;case t.available:i="Available";break;case t.skype:i="Skype";break;case t.facebook:i="Facebook";break;case t.google:i="Google"}return i},dt=function(n){var t={};t.filterChangedFrom=pt(h),t.filterChangedTo=pt(n),i.$BSI.reportEvent("WebIM.PeopleFilterChanged",t)},ut=function(r){var o,f,c,l,a;r&&(o=r.currentTarget||r.target,o&&o.getAttribute&&(f=o.getAttribute("filterValue"),f&&(f=parseInt(f),f!=h&&(dt(f),h==t.all&&f==t.available||h==t.available&&f==t.all?(h=f,yt(),c=0,l=function(n){var r=g.slice(n,n+e);c+=ct(r),r.length<e?h==t.available&&c==0&&d.show():i.setTimeout(function(){l(n+e)},10)},i.setTimeout(function(){l(0)},10)):(h=f,k.deactivate(),a=function(){n(nt).unbind(u,a),k.activate()},n(nt).bind(u,a),ft(!0)),s.get_settings().set_peopleFilter(h)))))},gt=function(n){var u=n.get_contact(),e=u.get_currentAddress(),f,r,o;switch(h){case t.skype:u.get_skypeAddress()?e=u.get_skypeAddress():u.get_windowsLiveAddress()&&(e=u.get_windowsLiveAddress());break;case t.facebook:for(f=u.get_addresses(),r=0,o=f.get_count();r<o;r++)if(f.getItem(r).get_network().get_isFacebook()){e=f.getItem(r);break}break;case t.google:for(f=u.get_addresses(),r=0,o=f.get_count();r<o;r++)if(f.getItem(r).get_network().get_isGoogle()){e=f.getItem(r);break}}i.$WLXIM.startConversationWithIMAddress(u,e,"webIMPeopleList",null)},ni=function(i,r){if(h==t.available){var u=n(i.get_element());r==c.online?u.is(":visible")||(rt++,d.hide(),n(i.get_element()).show()):u.is(":visible")&&(u.hide(),--rt==0&&d.show())}},wt=function(t,i){var f=i.added,e=i.removed,r;(f&&f.length>0||e&&e.length>0)&&(b!=null&&b.dispose(),b=null,st.empty(),k.deactivate(),r=function(){n(nt).unbind(u,r),k.activate()},n(nt).bind(u,r),ft(!0))}}}(window.originaljQuery||jQuery),function(n){var t=window,r=t.$pwc,e=t.ss,i=t.MsgrUI,u=t.Microsoft.Live.Messenger,o=t.wLive.People.SortOrder,s=t.Microsoft.Live.Messenger.GroupConversation,h="<div class='WebIMMessagingModule' sutra='messagingmodule'><div resourceid='Pictures'><div resourceid='PictureGridContainer' class='PictureGridContainer' sutra='picturegrid'><\/div><div resourceid='ViewAllLink' class='ViewAllLink'><a href='#' onclick='$WLXIM.showSidebar(); $WLXIM.onChatViewBack();' sutra='viewalllink'><\/a><\/div><\/div><div resourceid='Upsell' class='Upsell' sutra='messagingmoduleupsell'><div resourceid='Text' class='Text' sutra='messagingmoduleinfomessage'><\/div><a resourceid='Link' class='Link Anchor' onclick='$WLXIM.showSidebar(); $WLXIM.onChatViewBack();'><div resourceid='MessagingIcon' class='MessagingIcon t_cbr' sutra='messagingicon'><img /><\/div><div resourceid='LinkText' class='LinkText' sutra='startnowmessage'><\/div><\/a><\/div><div resourceid='Status' class='Status' sutra='messagingmodulestatus'><div resourceid='Message' class='Message'><\/div><a resourceid='Link' class='Link'><\/a><\/div><div resourceid='StyleOverrideContainer'><\/div><\/div>",c=35,l=99,a=35,f=20,v=105,y="<style type='text/css'>.WebIMMessagingModule .c_ic_h_mm_t {{ width: {0}px; }} .WebIMMessagingModule .c_ic_text_h {{ width: {1}px; }} .WebIMMessagingModule .c_ic_text_h .c_ic_name_mm {{ max-width: {1}px; }}<\/style>";i.MessagingModuleControl=function(p,w){var ut=this,k=null,d=null,it=null,ft=null,g=null,et=null,nt=null,ot=null,st=null,ht=null,b=null,tt=[];ut.get_element=function(){return k.get(0)},ut.render=function(){return k=n(h),k.find("[resourceid='Title']").text(i._getLocString("messagingTitle")),d=k.find("[resourceid='Pictures']"),it=d.find("[resourceid='PictureGridContainer']"),ft=d.find("[resourceid='ViewAllLink']"),ft.find("a").text(i._getLocString("messagingModuleViewAll")),g=k.find("[resourceid='Upsell']"),g.find("[resourceid='Text']").text(i._getLocString("MessagingModuleUpsellText")),et=g.find("[resourceid='Link']"),et.find("[resourceid='LinkText']").text(i._getLocString("messagingModuleStartNow")),et.find("img").attr("src",i._templates.messagingImageStrip),nt=k.find("[resourceid='Status']"),ot=nt.find("[resourceid='Message']"),st=nt.find("[resourceid='Link']"),ht=k.find("[resourceid='StyleOverrideContainer']"),w&&(w.tabIndex||w.tabIndex==0)&&!isNaN(w.tabIndex)&&k.find("a").attr("tabindex",w.tabIndex),rt(!1),k.get(0)},ut.activate=function(){n(p).bind("propertyChanged",yt),n(p.get_aggregatedConversations()).bind("getMoreConversationsCompleted",pt),r.$persons.bind("changed",vt),n(t.$WLXIM.sidebar).bind("landingPageControlVisible",at),k.bind("resize",wt),b&&(b.activate(),ct())},ut.deactivate=function(){n(p).unbind("propertyChanged",yt),n(p.get_aggregatedConversations()).unbind("getMoreConversationsCompleted",pt),r.$persons.unbind("changed",vt),n(t.$WLXIM.sidebar).unbind("landingPageControlVisible",at),k.unbind("resize",wt),b&&b.deactivate()};var rt=function(n){var t=p.get_aggregatedConversations();p.get_status()!==u.UserStatus.signedIn||r.getPersons({isIMCapable:!0}).length>1&&t.get_count()==0&&t.get_hasMoreConversationsOnServer()?bt(n):b?(g.hide(),nt.hide(),d.show()):(tt=gt(),tt.length>0?kt():dt())},bt=function(n){d.hide(),g.hide(),nt.show();var r=i._getLocString("messagingPaneSignIn"),f="",e="return false;";n&&(p.get_status()===u.UserStatus.autoReconnectWaiting?(r=i._getLocString("messagingPaneReconnect").format(t.$WLXIM.getReconnectingTime().min+":"+t.$WLXIM.getReconnectingTime().sec),f=i._getLocString("messagingPaneReconnectNow"),e="$WLXIM.reconnect();",t.setTimeout(function(){rt(n)},1e3)):p.get_status()===u.UserStatus.signedOut&&(r=i._getLocString("messagingPaneSignOut"),f=i._getLocString("messagingPaneSigninButton"),e="location.reload()")),ot.text(r),st.text(f),st.attr("onclick",e),lt()},kt=function(){g.hide(),nt.hide(),d.show(),it.html(""),b=new i._pictureGridControl(tt,ni),it.append(b.render()),w&&(w.tabIndex||w.tabIndex==0)&&!isNaN(w.tabIndex)&&it.find(".c_ic a").attr("tabindex",w.tabIndex),ct()},dt=function(){d.hide(),nt.hide(),g.show(),lt()},gt=function(){var u=12,e,t,f,h;if(w&&w.containerWidth&&!isNaN(w.containerWidth)&&(e=3*Math.floor((w.containerWidth-c)/34),e>u&&(u=e)),t=r.getPersons({isIMCapable:!0},o.messagingRelevance),t.remove(r.getMe()),t.length<=u)return t;if(f=p.get_aggregatedConversations().get_items(),f.length==0)return t.slice(0,2*u);for(var i=[],l=Math.ceil(u/2),n=0;n<f.length&&i.length<l;n++)f[n].get_currentConversation()instanceof s||(h=r.getPerson(f[n].get_buddyContact().get_id()),h&&i.push(h));for(n=0;n<t.length&&i.length<u;n++)i.contains(t[n])||i.push(t[n]);return i.sort(function(n,t){return t.getMessagingRelevance()-n.getMessagingRelevance()}),i=i.concat(t.slice(n,n+u))},at=function(n,t){t?ft.hide():ft.show()},vt=function(n,t){var f=!1,i,r=t.added,e,u;if(r&&r.length>0)for(e=tt.length>0?tt[tt.length-1].getMessagingRelevance():-1,i=0;i<r.length;i++)if(r[i].getMessagingAddresses().length>0&&r[i].getMessagingRelevance()>e){f=!0;break}if(u=t.removed,!f&&u&&u.length>0)for(i=0;i<u.length;i++)if(tt.contains(u[i])){f=!0;break}f&&(b&&(b.deactivate(),b=null),rt(!1),b&&b.activate())},ni=function(n,i){for(var f=n.getContacts(),u,r=0;r<f.length;r++)if(u=p.findContactById(f[r].getId()),u&&u.get_currentAddress()){t.$WLXIM.startConversation(u,0,"messagingModule",null,i);break}},yt=function(n,t,i){i.get_propertyName()=="Status"&&rt(!0)},pt=function(){b||(rt(!1),b&&b.activate())},wt=function(){d.is(":visible")?ct():lt()},ct=function(){if(b){var t=k.parent().parent().height()-l;t=t-(t+5)%a,b.showAsListView(t>=135),it.css("max-height",t+"px"),t>=135&&(ht.html(""),ht.append(n(e.format(y,k.width(),k.width()-40))))}},lt=function(){var n=k.parent().height()-v;n=Math.floor(n/f)*f,g.find("[resourceid='Text']").css("max-height",n),ot.css("max-height",n)}}}(window.originaljQuery||jQuery),function(n){var t=window,f=t.document,i=t.$pwc,r=t.MsgrUI,e="<div class='WebIMFavorites' sutra='favoritescontrol'><h1 resourceid='Title' class='Title' sutra='favoritestitle' /><ul resourceid='FavoritesList' class='FavoritesList' sutra='favoriteslist'><\/ul><\/div>",o="<li><a class='FavoritesItem' sutra='favoritesitem' href='#' onclick='return false;'><div resourceid='UserTile' class='UserTile' sutra='favoritesitemusertile'><\/div><div class='Name' resourceid='Name' sutra='favoritesitemdisplayname'><\/div><div resourceid='AVGlyphs' class='AVGlyphs' sutra='favoritesitemavglyphs'><div class='VideoGlyph'><img /><\/div><div class='AudioGlyph'><img /><\/div><\/div><\/a><\/li>",u=null;r._favoritesControl=function(s){var l=this,h=null,v=null,c=[],a={};l.get_element=function(){return h.get(0)},l.render=function(){if(!h){h=n(e),v=h.find("[resourceid='FavoritesList']");var t=n(o);t.find("img").attr("src",r._templates.messagingImageStrip),u=f.createDocumentFragment(),u.appendChild(t.get(0))}return h.find("[resourceid='Title']").text(r._getLocString("favoritesTitle")),y(),h.get(0)},l.activate=function(){for(var u,t=0,r=c.length;t<r;t++)c[t].activate();for(u=h.find("li"),t=0,r=u.length;t<r;t++)n(u[t]).click(p);n.each(a,function(t){var r=s.findContactById(t);n(r.get_presence()).bind("propertyChanged",w)}),i.$persons.bind("changed",b)},l.deactivate=function(){for(var u,t=0,r=c.length;t<r;t++)c[t].deactivate(),c[t].dispose();for(c=[],u=h.find("li"),t=0,r=u.length;t<r;t++)n(u[t]).unbind("click",p);n.each(a,function(t){var r=s.findContactById(t);n(r.get_presence()).unbind("propertyChanged",w)}),i.$persons.unbind("changed",b)};var y=function(){var e,o,b,f,r,y,p,l,w;for(v.empty(),a={},e=i.getFavorites(),e.sort(function(n,t){return n.getDisplayNameWithFallback().localeCompare(t.getDisplayNameWithFallback())}),o=0,b=e.length;o<b;o++)if(f=e[o],f.getMessagingAddresses().length>0)for(r=n(u.cloneNode(!0).childNodes[0]),y=t.$icm.createICForPerson("icTmUserTileTemplate",f.getId(),{toolTipType:"name"}),c.push(y),r.attr("personid",f.getId()),r.find("[resourceid='UserTile']").append(y.render()),r.find("a.c_ic_frame_clip").attr("tabindex","-1"),r.find("[resourceid='Name']").text(f.getDisplayNameWithFallback()),f.canCall()||r.find("[resourceid='AVGlyphs']").hide(),v.append(r),p=f.getContacts(),l=0;l<p.length;l++)if(w=s.findContactById(p[l].getId()),w){a[w.get_id()]=r;break}v.find("li").length==0?h.hide():h.show()},p=function(r){for(var o=i.getPerson(n(r.currentTarget).attr("personid")),f=o.getContacts(),u=0,e=f.length;u<e;u++)if(s.findContactById(f[u].getId())){t.$WLXIM.startConversationWithContactId(f[u].getId(),"favorites",!0);return}},w=function(n,t){var i=t.get_contact(),r=a[i.get_id()];i.get_isAudioVideoCapable()?r.find("[resourceid='AVGlyphs']").show():r.find("[resourceid='AVGlyphs']").hide()},b=function(n,t){(t.added&&t.added.length>0||t.changed&&t.changed.length>0||t.removed&&t.removed.length>0)&&(l.deactivate(),y(),l.activate())}}}(window.originaljQuery||jQuery),function(){var r=window,i=r.MsgrUI,f=r.Microsoft.Live.Messenger,n=i.UIElement,u=i._modernConversationRosterItem=function(t){n.call(this),this._address$1=t},t=u.prototype=new n(null);t.constructor=u,t._address$1=null,t._template=i._templates._modernConversationRosterItem,t.onVisualInitialized=function(){var i=new n(this.findElementById("DisplayName")),t;i.set_text(this._address$1.get_contact().get_displayName()),t=new n(this.findElementById("StatusBar")),t.set_isVisible(this._address$1.get_presence().get_status()===f.PresenceStatus.online)}}(),function(){var t=window,o=t.document,s=t.$WLXIM,l=t.MC,i=t.MsgrUI,h=t.Microsoft.Live.Messenger,c=h.Services.SkyJSHelper,u=t.ss,r=i._flyout,f=r.prototype,e=i._modernConversationRosterControl=function(n,t,i){r.call(this,i),this._aggregatedConversation$2=n,this._confirmationDialog$2=t},n=e.prototype=new r;n.prototype=e,n._aggregatedConversation$2=null,n._confirmationDialog$2=null,n.get_isActivated=function(){return f.get_isActivated.call(this)},n.set_isActivated=function(n){return f.set_isActivated.call(this,n),n&&(this.clearChildren(),this._populateChildren$2()),n},n._populateChildren$2=function(){var t,n,r,f;for(this.get_element().style.bottom="",t=u.IEnumerator.getEnumerator(this._aggregatedConversation$2.get_currentConversation().get_roster());t.moveNext();)n=t.get_current(),n.get_isUser()||(r=new i._modernConversationRosterItem(n),this.addChild(r),r.addAttribute("ctid",n.get_contact().get_id()));f=o.documentElement.clientHeight-this.get_element().offsetTop-this.get_element().offsetHeight,this.get_element().style.bottom=f<90?"90px":""},n._onRosterItemClicked$2=function(n){var t,r,f;this.set_isActivated(!1),t=this._aggregatedConversation$2.get_user().findContactById(n.currentTarget.getAttribute("ctid")),t.get_isTemporaryContact()?(r=this,f=function(){var n={};n.greeting=u.format(i._getLocString("flyoutsSendInviteGreeting"),t.get_displayName()),n.userId=r._aggregatedConversation$2.get_user().get_skypeAddress().get_address(),n.contactId=t.get_skypeAddress().get_address(),c.getInstance().Outlook.sendRequest(n)},this._confirmationDialog$2.setContent(i._getLocString("flyoutsAddToSkypeText"),i._getLocString("flyoutsAddToSkypeButton"),f),this._confirmationDialog$2.set_isActivated(!0)):s.startConversation(t)}}(),function(){var r=window,u=r.ss,n=r.MsgrUI,e=r.Microsoft.Live.Messenger,t=n.UIElement,f=n._modernConversationHistoryItem=function(n,i,r){t.call(this),this._message$1=n,this._sent$1=i,this._senderAttribution$1=r},i=f.prototype=new t;i.constructor=f,i._message$1=null,i._sent$1=!1,i._senderAttribution$1=!1,i._template=n._templates._modernConversationHistoryItem,i.onVisualInitialized=function(){var c=this._message$1.get_timestamp().getTime().toString(),r=new t(this.findElementById("ModernConversationHistoryItem")),i,f,l,o,s,h;(r.addAttribute("aria-labelledby",c),this._sent$1?(r.addCssClass("t_sent",!1),r.addCssClass(n.Utility.backgroundLightThemeClassName,!1),i=new t(this.findElementById("Pointer")),i.addCssClass("t_sent_pointer",!1),i.addCssClass(n.Utility.borderTopLightThemeClassName,!1),this.get_element().scrollIntoView()):(r.addCssClass("t_received",!1),r.addCssClass(n.Utility.backgroundThemeClassName,!1),i=new t(this.findElementById("Pointer")),i.addCssClass("t_received_pointer",!1),i.addCssClass(n.Utility.borderTopThemeClassName,!1)),f=new t(this._message$1.createTextElement(!0,e.EmoticonSize.medium)),l=new t(this.findElementById("Text")),l.addChild(f),this._message$1.get_inviteMessage())||(o=new t(this.findElementById("Timestamp")),o.set_text(n.Utility._getTimeFormat(this._message$1.get_timestamp())),s=new t(this.findElementById("Label")),s.get_element().id=c,this._senderAttribution$1?(h=new t(this.findElementById("Sender")),h.set_text(this._message$1.get_sender().get_contact().get_displayName()),h.set_isVisible(!0),s.set_text(u.format(n._getLocString("receivedMessageLabelWithSender"),h.get_text(),o.get_text(),f.get_text()))):this._sent$1?s.set_text(u.format(n._getLocString("sentMessageLabel"),o.get_text(),f.get_text())):s.set_text(u.format(n._getLocString("receivedMessageLabel"),o.get_text(),f.get_text())))}}(),function(n){function p(n,t,i,f){function l(n){var t=null,e=!1,i=n,u;i.code>=300?(t=r.format("{0}:{1}",i.code,i.text),o.Logger.logDetails("InviteAcceptCallbackFailure",{errorDetails:t}),e=!0):(u=f.get_buddyAddress(),u.set_isPendingInbound(!1),u.changeToSkypeAddress(),c.startConversationWithContactId(f.get_buddyContact().get_id(),null,!0)),o.WebmainHelper.addQoSStats(o.WebmainHelper.qoSApiSkypeAcceptRequest,t,o.WebmainHelper.qoSSkypeAcceptRequestApiStartTime,h,!1),o.WebmainHelper.stopQoS(h,!e,t)}function a(){n._showOrHideInvite$1(!1),f.removeInviteRequest()}var h,s,e;a(),h=o.WebmainHelper.startQoS(o.WebmainHelper.qoSScenarioSkypeAcceptRequest),o.WebmainHelper.qoSResetTime(o.WebmainHelper.qoSScenarioSkypeAcceptRequest),s={},e={},s.userId=t,s.contactId=i,e.data=s,e.success=l,e.error=l,u.Services.SkyJSHelper.getInstance().Outlook.acceptRequest(e)}var f=window,h=f.document,c=f.$WLXIM,a=f.$Config,o=f.MC,i=f.MsgrUI,u=f.Microsoft.Live.Messenger,s=u.MessageType,r=f.ss,e=i.UIElement,v=e.prototype,y="common/spinner_grey_40_transparent.gif",l=i._modernConversationHistoryControl=function(n,t,r,u){e.call(this,t),this._aggregatedConversation$1=n,this._inviteRequestElement$1=new e(r),this._inviteRequestElement$1.set_isVisible(!1),this._modernConversationControl$1=u,this._dayOfWeek$1=i._getLocString("dayOfWeek").split(",")},t=l.prototype=new e;t.constructor=l,t._aggregatedConversation$1=null,t._modernConversationControl$1=null,t._previousMessage$1=null,t._previousTopMessage$1=null,t._itemsContainer$1=null,t._historyLoadingIndicator$1=null,t._inviteRequestElement$1=null,t._dayOfWeek$1=null,t._consumptionHorizonSet$1=!1,t._consumptionHorizonTimeout=-1,t._acceptButton$1=null,t._declineButton$1=null,t._scrollByUserAction=!1,t.dispose=function(){this._consumptionHorizonTimeout>-1&&(f.clearTimeout(this._consumptionHorizonTimeout),this._consumptionHorizonTimeout=-1),n(this._aggregatedConversation$1.get_history()).unbind("collectionChanged",r.Delegate.create(this,this._onConversationHistoryChanged$1)),n(this._aggregatedConversation$1).unbind("propertyChanged",r.Delegate.create(this,this._onConversationPropertyChanged$1)),n(this._aggregatedConversation$1).unbind("sendMessageFailed",r.Delegate.create(this,this._onSendMessageFailed$1))},t.onVisualInitialized=function(){v.onVisualInitialized.call(this),n(this._aggregatedConversation$1.get_history()).bind("collectionChanged",r.Delegate.create(this,this._onConversationHistoryChanged$1)),n(this._aggregatedConversation$1).bind("propertyChanged",r.Delegate.create(this,this._onConversationPropertyChanged$1)),n(this._aggregatedConversation$1).bind("sendMessageFailed",r.Delegate.create(this,this._onSendMessageFailed$1)),this._itemsContainer$1=new i.UIElement(this.findElementById("ItemsContainer")),this.addLogicalChild(this._itemsContainer$1),this._historyLoadingIndicator$1=new e(this.findElementById("Spinner")),this._historyLoadingIndicator$1.get_element().src=a.WebIM.imgBase+y,this._batchInitialRender$1(0)},t._batchInitialRender$1=function(n){for(var u=this._aggregatedConversation$1.get_history(),i,e,t=n;t<u.get_count();t++)if(i=u.get_item(t),(i.get_type()===s.textMessage||i.get_type()===s.threadActivityMessage)&&this._addMessage$1(i),t%10==0&&t!==0){e=this,f.setTimeout(function(){e._batchInitialRender$1(t+1)},10);return}this._aggregatedConversation$1.get_hasMoreHistoryOnServer()?this._callAfterRepaint$1(r.Delegate.create(this,this._prefetchHistory$1)):this._callAfterRepaint$1(r.Delegate.create(this,this._setConsumptionHorizon$1))},t._addMessage$1=function(n,t){var f=this,o,s,l,a;if(n.get_inviteMessage()){if(f._inviteRequestElement$1.get_isVisible())return;o=new i._modernConversationHistoryItem(n instanceof u.TextMessage?n:null,!1,!1),new e(f._inviteRequestElement$1.findElementById("InviteGreeting")).addChild(o),s=null,l=f._aggregatedConversation$1.get_conversations();for(a in l)if(l[a].get_id()==n.get_conversationId()){s=l[a];break}f._acceptButton$1=new e(f._inviteRequestElement$1.findElementById("InviteAccept")),f._acceptButton$1.set_text(i._getLocString("flyoutsAcceptButton")),f._acceptButton$1.attachEvent(i.EventType.click,function(){var t=f._aggregatedConversation$1.get_user().get_skypeAddress().get_address(),i=n.get_sender().get_skypeName();p(f,t,i,s)}),f._declineButton$1=new e(f._inviteRequestElement$1.findElementById("InviteDecline")),f._declineButton$1.set_text(i._getLocString("flyoutsDeclineButton")),f._declineButton$1.attachEvent(i.EventType.click,function(){function t(n){n&&(f._showOrHideInvite$1(!1),s.removeInviteRequest(),s.get_buddyAddress().set_isPendingInbound(!1))}c.showDeclineInviteFlyout(f._declineButton$1.get_element(),f._aggregatedConversation$1.get_buddyContact().get_id(),n.get_sender().get_skypeName(),t,t)}),f._showOrHideInvite$1(!0),n.set_inviteMessageType(u.InviteMessageType.inviteSeen);return}n instanceof u.TextMessage&&r.isNullOrEmpty(n.get_text())||(f._addConversationDivider$1(n,t),n instanceof u.TextMessage?o=n.get_sender().get_isUser()?new i._modernConversationHistoryItem(n instanceof u.TextMessage?n:null,!0,!1):new i._modernConversationHistoryItem(n instanceof u.TextMessage?n:null,!1,f._aggregatedConversation$1.get_currentConversation()instanceof u.GroupConversation):(o=new e(h.createElement("li")),o.addCssClass("ModernConversationHistory_ActivityMessage",!1),o.addAttribute("sutra","activitymessage"),o.set_text(i.Utility.getActivityMessageString(n instanceof u.ThreadActivityMessage?n:null))),t?(f._itemsContainer$1.insertAt(1,o),f._previousTopMessage$1=n):(f._itemsContainer$1.addChild(o),f._previousMessage$1=n),o.addAttribute("ts",n.get_timestamp().getTime().toString()))},t._prefetchHistory$1=function(){this._aggregatedConversation$1.get_hasMoreHistoryOnServer()&&(this.get_element().scrollTop<this.get_element().clientHeight||this._aggregatedConversation$1.get_history().get_count()===0)?(this.get_element().scrollTop<=20&&this._historyLoadingIndicator$1.set_isVisible(!0),this._aggregatedConversation$1.getMoreHistory()):this._setConsumptionHorizon$1()},t._addFailedMessage$1=function(){var t=new e(null);this._itemsContainer$1.addChild(t),t.set_text(i._getLocString("failedMessage")),t.addCssClass("ModernConversationControl_TextFailed",!0)},t._addConversationDivider$1=function(n,t){var o=t?this._previousTopMessage$1:this._previousMessage$1,c=this._aggregatedConversation$1.get_currentConversation()instanceof u.GroupConversation,f,s;(r.isNullOrUndefined(o)||n.get_networkName()!==o.get_networkName()||n.get_timestamp().getDate()!==o.get_timestamp().getDate())&&(f=new e(h.createElement("li")),t?this._itemsContainer$1.insertAt(0,f):this._itemsContainer$1.addChild(f),f.addCssClass("ModernConversationHistory_ConversationDivider",!1),s=c?u.Network.get__skype().get_name():n.get_networkId()==="WL"?i._getLocString("networkMessenger"):n.get_networkName(),f.set_text(r.format(i._getLocString("conversationDivider"),this._getTimeToDisplay$1(n.get_timestamp()),s)))},t._getTimeToDisplay$1=function(n){var t=new Date,r;return n.getFullYear()===t.getFullYear()&&n.getMonth()===t.getMonth()&&n.getDate()===t.getDate()?i._getLocString("today"):new Date-n<6048e5?this._dayOfWeek$1[n.getDay()]:(r=i._getLocStringNS("live.shared.marketinfo.webim.client.DateReceivedFormat"),r.format(n.getMonth()+1,n.getDate(),n.getFullYear().toString().substr(2),"","","",""))},t._setConsumptionHorizon$1=function(){var s,u,t,e;if(!this._consumptionHorizonSet$1){this._consumptionHorizonSet$1=!0;for(var h=this._aggregatedConversation$1.get_consumptionHorizon(),o=this._aggregatedConversation$1.get_history(),n=0;n<o.get_count();n++)if(o.get_item(n).get_timestamp()>h)break;if(n>2){for(s=o.get_item(n-2).get_timestamp().getTime().toString(),u=this._itemsContainer$1.get_element().children,t=0;t<u.length;t++)if(u[t].getAttribute("ts")===s){e=this,e._consumptionHorizonTimeout=f.setTimeout(function(){e.get_element().scrollTop=u[t].offsetTop,e._consumptionHorizonTimeout=-1},1e3);break}}else this.get_element().scrollTop=0;this.attachEvent(i.EventType.scroll,r.Delegate.create(this,this._onScroll)),this._aggregatedConversation$1.markAllConversationsAsRead()}},t._showOrHideInvite$1=function(n){n?this._inviteRequestElement$1.get_isVisible()||(this._inviteRequestElement$1.set_isVisible(!0),this.get_element().style.top="240px"):this._inviteRequestElement$1.get_isVisible()&&(this.get_element().style.top="130px",this._inviteRequestElement$1.set_isVisible(!1))},t._onScroll=function(){this._scrollByUserAction=!0,this._prefetchHistory$1()},t._onConversationHistoryChanged$1=function(n,t,f){var e,l,h,c,a,o;if(this.detachEvent(i.EventType.scroll,r.Delegate.create(this,this._onScroll)),f.get_action()===u.NotifyCollectionChangedAction.add)if(f.get_newItems()[0].get_isHistoryMessage()){for(a=this.get_element().scrollHeight-this.get_element().scrollTop,o=f.get_newItems().length-1;o>=0;o--)e=f.get_newItems()[o],(e.get_type()===s.textMessage||e.get_type()===s.threadActivityMessage)&&this._addMessage$1(e,!0);this.get_element().scrollTop=this.get_element().scrollHeight-a,this._historyLoadingIndicator$1.set_isVisible(!1),this._callAfterRepaint$1(r.Delegate.create(this,this._prefetchHistory$1))}else{for(l=this.get_element().scrollTop,h=!1,this._scrollByUserAction&&this.get_element().scrollHeight-this.get_element().scrollTop>this.get_element().clientHeight&&(h=!0),c=r.IEnumerator.getEnumerator(f.get_newItems());c.moveNext();)e=c.get_current(),(e.get_type()===s.textMessage||e.get_type()===s.threadActivityMessage)&&this._addMessage$1(e);this.get_element().scrollTop=h?l:this.get_element().scrollHeight,i.Utility.isChatViewVisible()&&this.get_isVisible()&&this._aggregatedConversation$1.markAllConversationsAsRead()}else f.get_action()===u.NotifyCollectionChangedAction.reset&&this._itemsContainer$1.clearChildren();this._consumptionHorizonSet$1&&this.attachEvent(i.EventType.scroll,r.Delegate.create(this,this._onScroll))},t._onConversationPropertyChanged$1=function(n,t,i){i.get_propertyNamePascal()!=="HasMoreHistory"||this._aggregatedConversation$1.get_hasMoreHistoryOnServer()||this._historyLoadingIndicator$1.set_isVisible(!1)},t._onSendMessageFailed$1=function(n,t,i){if(i.get_message().get_type()===s.textMessage){var r=i.get_message();this._addFailedMessage$1(r instanceof u.TextMessage?r:null)}},t._callAfterRepaint$1=function(n){var t=this._itemsContainer$1.get_element().children,r=t.length>0?t[t.length-1]:this._itemsContainer$1.get_element(),i=null;i=function(){r.clientWidth===0?f.setTimeout(i,100):n.invoke()},f.setTimeout(i,100)}}(window.originaljQuery||jQuery),function(n){var s=window,e=s.$WLXIM,r=s.MsgrUI,u=s.Microsoft.Live.Messenger,h=u.IMAddressType,c=u.NetworkStatus,f=u.PresenceStatus,l=u.UserStatus,t=s.ss,a=r.UIElement,o="anchor",v=r._modernConversationInfoBarControl=function(n,i,r,u,f,e){var s,o;for(a.call(this,e),this._aggregatedConversation$1=u,this._user$1=this._aggregatedConversation$1.get_user(),this._contact$1=this._aggregatedConversation$1.get_currentConversation().get_buddyContact(),this._currentContactIMAddress$1=this._aggregatedConversation$1.get_currentConversation().get_buddyAddress(),this._inputControl$1=n,this._emoticonLaunchElement$1=i,this._historyControl$1=r,this._bottomElement$1=f,s=t.IEnumerator.getEnumerator(this._user$1.get_networks());s.moveNext();)o=s.get_current(),o.get_isFacebook()&&(this._facebookNetwork$1=o),o.get_isGoogle()&&(this._googleNetwork$1=o)},i=v.prototype=new a;i.constructor=v,i._inputControl$1=null,i._currentContactIMAddress$1=null,i._emoticonLaunchElement$1=null,i._historyControl$1=null,i._aggregatedConversation$1=null,i._user$1=null,i._contact$1=null,i._facebookNetwork$1=null,i._googleNetwork$1=null,i._bottomElement$1=null,i._networkOnClicked$1=null,i._groupChatError$1=null,i.onVisualInitialized=function(){var i=this;n(i._aggregatedConversation$1).bind("currentConversationChanged",t.Delegate.create(i,i._onCurrentConversationChanged$1)),n(i._aggregatedConversation$1.get_history()).bind("collectionChanged",t.Delegate.create(i,i._onHistoryCollectionChanged$1)),n(i._user$1).bind("propertyChanged",t.Delegate.create(i,i._onPropertyChanged$1)),n(i._user$1.get_presence()).bind("propertyChanged",t.Delegate.create(i,i._onPropertyChanged$1)),n(i._contact$1).bind("propertyChanged",t.Delegate.create(i,i._onPropertyChanged$1)),n(i._currentContactIMAddress$1).bind("propertyChanged",t.Delegate.create(i,i._onPropertyChanged$1)),n(i._currentContactIMAddress$1.get_linkedContact()).bind("propertyChanged",t.Delegate.create(i,i._onPropertyChanged$1)),i._facebookNetwork$1!=null&&n(i._facebookNetwork$1).bind("propertyChanged",t.Delegate.create(i,i._onPropertyChanged$1)),i._googleNetwork$1!=null&&n(i._googleNetwork$1).bind("propertyChanged",t.Delegate.create(i,i._onPropertyChanged$1)),i._aggregatedConversation$1.get_currentConversation()instanceof u.GroupConversation&&(n(i._aggregatedConversation$1.get_currentConversation()).bind("infoUpdated",t.Delegate.create(i,i._updateInfoBar$1)),n(i._aggregatedConversation$1.get_currentConversation()).bind("operationFailed",t.Delegate.create(i,i._onGroupConversationOperationFailed$1))),i._updateInfoBar$1()},i.dispose=function(){var i=this;n(i._aggregatedConversation$1).unbind("currentConversationChanged",t.Delegate.create(i,i._onCurrentConversationChanged$1)),n(i._aggregatedConversation$1.get_history()).unbind("collectionChanged",t.Delegate.create(i,i._onHistoryCollectionChanged$1)),n(i._user$1).unbind("propertyChanged",t.Delegate.create(i,i._onPropertyChanged$1)),n(i._user$1.get_presence()).unbind("propertyChanged",t.Delegate.create(i,i._onPropertyChanged$1)),n(i._contact$1).unbind("propertyChanged",t.Delegate.create(i,i._onPropertyChanged$1)),n(i._currentContactIMAddress$1).unbind("propertyChanged",t.Delegate.create(i,i._onPropertyChanged$1)),n(i._currentContactIMAddress$1.get_linkedContact()).unbind("propertyChanged",t.Delegate.create(i,i._onPropertyChanged$1)),i._facebookNetwork$1!=null&&n(i._facebookNetwork$1).unbind("propertyChanged",t.Delegate.create(i,i._onPropertyChanged$1)),i._googleNetwork$1!=null&&n(i._googleNetwork$1).unbind("propertyChanged",t.Delegate.create(i,i._onPropertyChanged$1)),i._aggregatedConversation$1.get_currentConversation()instanceof u.GroupConversation&&(n(i._aggregatedConversation$1.get_currentConversation()).unbind("infoUpdated",t.Delegate.create(i,i._updateInfoBar$1)),n(i._aggregatedConversation$1.get_currentConversation()).unbind("operationFailed",t.Delegate.create(i,i._onGroupConversationOperationFailed$1)))},i.setInviteInfo=function(){var i,u;e.isSkypeInvitesEnabled()&&(i=this,i.set_innerHtml(""),i._currentContactIMAddress$1.get_linkedContact().get_skypeInviteSent()?i.set_text(r._getLocString("addContactSent")):(i._currentContactIMAddress$1.get_linkedContact().get_skypePendingOutbound()?u=t.format(r._getLocString("addContactSentWithResend"),t.format(r._templates.anchorFormat,r._getLocString("addContactResend"))):i._currentContactIMAddress$1.get_type()!==h.shortCircuit||i._currentContactIMAddress$1.get_isPendingInbound()||(u=t.format(r._templates.anchorFormat,r._getLocString("addContact"))),u&&(i.set_innerHtml(u),i._attachAnchorClickEvent$1(i.findElementById(o),function(){n(i).triggerHandler("sendSkypeInvite")}))))},i.setBlockContactInfo=function(){var i=t.format(r._templates.anchorFormat,r._getLocString("appearOfflineUnblockLink")),n=e.isSkypeBlockEnabled();this.set_innerHtml(t.format(r._getLocString("appearOfflineDefaultText"),n?i:"")),n&&this._attachAnchorClickEvent$1(this.findElementById(o),t.Delegate.create(this,this._onUnblockClicked$1)),this._inputControl$1.set_disabled(!0),this._emoticonLaunchElement$1.get_element().style.visibility="hidden"},i.setUnblockContactInfo=function(){var i,r;for(e.unblockPerson(this._aggregatedConversation$1.get_currentConversation().get_buddyContact().get_id(),null,null),this._aggregatedConversation$1.get_currentConversation().get_buddyAddress().get_type()!==h.shortCircuit&&(this._inputControl$1.set_disabled(!1),this.set_innerHtml(""),this._emoticonLaunchElement$1.get_element().style.visibility="visible",n(this).triggerHandler("infobarUpdated")),i=t.IEnumerator.getEnumerator(this._contact$1.get_linkedContacts());i.moveNext();)r=i.get_current(),r.set_isBlocked(!1)},i._deleteConversations=function(){var i=this,u=t.IEnumerator.getEnumerator(i._aggregatedConversation$1.get_conversations()),o=i._aggregatedConversation$1.get_conversations().length,f=0,r;for(i.setDeleteConversationInfo(!1);u.moveNext();)r=u.get_current(),e.user.remove_conversation(r,+new Date,function(n){n?(f++,f==o&&i._contact$1.get_id()==r.get_buddyContact().get_id()&&e.onChatViewBack()):i.setDeleteConversationInfo(!0)})},i.setDeleteConversationInfo=function(i){if(i){var u=t.format(r._templates.anchorFormat,r._getLocString("InfobarDeleteFailedTryAgainText"));this.set_innerHtml(t.format(r._getLocString("InfobarDeleteFailedText"),u)),this._attachAnchorClickEvent$1(this.findElementById(o),t.Delegate.create(this,this._deleteConversations))}else this.set_innerHtml(r._getLocString("InfobarDeleteText"));n(this).triggerHandler("infobarUpdated")},i._updateInfoBar$1=function(){this._update$1(),n(this).triggerHandler("infobarUpdated")},i._update$1=function(){var e=this._contact$1.get_displayName(),n=this._aggregatedConversation$1.get_currentConversation().get_network(),s,a,i;if(!t.isNullOrEmpty(this._groupChatError$1)){this.set_text(this._groupChatError$1),this._groupChatError$1="";return}if(this.set_innerHtml(""),this.setInviteInfo(),this.get_innerHtml()!=""){this._inputControl$1.set_disabled(!0),this._emoticonLaunchElement$1.get_element().style.visibility="hidden";return}if(this._aggregatedConversation$1.get_currentConversation().get_buddyAddress().get_linkedContact().get_isBlocked()){this.set_innerHtml(""),this.setBlockContactInfo();return}if(this._aggregatedConversation$1.get_currentConversation().get_mostRecentMessage()!=null&&this._aggregatedConversation$1.get_currentConversation().get_mostRecentMessage().get_inviteMessage()){this.set_innerHtml(""),this._inputControl$1.set_disabled(!0),this._emoticonLaunchElement$1.get_element().style.visibility="hidden";return}if(this._aggregatedConversation$1.get_currentConversation().get_buddyAddress().get_type()===h.shortCircuit||this._aggregatedConversation$1.get_currentConversation().get_buddyAddress().get_linkedContact().get_skypePendingOutbound()){this.set_innerHtml(""),this._inputControl$1.set_disabled(!0),this._emoticonLaunchElement$1.get_element().style.visibility="hidden";return}if((n.get_isFacebook()||n.get_isGoogle())&&this._user$1.get_presence().get_status()===f.appearOffline){s=t.format(r._templates.anchorFormat,r._getLocString("becomeAvailableInfo")),this.set_innerHtml(t.format(r._getLocString("networkAppearOfflineInfo"),n.get_name(),s)),this._attachAnchorClickEvent$1(this.findElementById(o),t.Delegate.create(this,this._onBecomeAvailableClicked$1)),this._inputControl$1.set_disabled(!0),this._emoticonLaunchElement$1.get_element().style.visibility="hidden";return}if((n.get_isFacebook()||n.get_isGoogle())&&n.get_status()===c.signedOut){a=t.format(r._templates.anchorFormat,t.format(r._getLocString("networkTurnOnInfo"),n.get_name())),this.set_innerHtml(t.format(r._getLocString("networkUserOfflineInfo"),a)),this._networkOnClicked$1=n.get_id(),this._attachAnchorClickEvent$1(this.findElementById(o),t.Delegate.create(this,this._onTurnOnConnectNetworkClicked$1)),this._inputControl$1.set_disabled(!0),this._emoticonLaunchElement$1.get_element().style.visibility="hidden";return}if((n.get_isFacebook()||n.get_isGoogle())&&n.get_status()===c.signingIn||this._user$1.get_status()===l.signingIn){this.set_innerHtml(r._getLocString("signingInInfo")),this._inputControl$1.set_disabled(!0),this._emoticonLaunchElement$1.get_element().style.visibility="hidden";return}if((n.get_isFacebook()||n.get_isGoogle())&&n.get_status()===c.signingOut||this._user$1.get_status()===l.signingOut){this.set_innerHtml(r._getLocString("signingOutInfo")),this._inputControl$1.set_disabled(!0),this._emoticonLaunchElement$1.get_element().style.visibility="hidden";return}if((n.get_isFacebook()||n.get_isGoogle())&&n.get_status()===c.autoReconnectWaiting||this._user$1.get_status()===l.autoReconnectWaiting){this.set_innerHtml(t.format(r._getLocString("signingInInfo"),30)),this._inputControl$1.set_disabled(!0),this._emoticonLaunchElement$1.get_element().style.visibility="hidden";return}if(i=this._aggregatedConversation$1.get_currentConversation().get_buddyAddress(),n.get_isFacebook()&&i.get_presence().get_status()===f.offline&&!i.get_isFacebookMobileEnabled()||n.get_isGoogle()&&i.get_presence().get_status()===f.offline){this.set_text(t.format(r._getLocString("networkOfflineImInfo"),e,n.get_name())),this._inputControl$1.set_disabled(!1),this._emoticonLaunchElement$1.get_element().style.visibility="visible";return}if(i.get_presence().get_status()===f.offline&&!(this._aggregatedConversation$1.get_currentConversation()instanceof u.GroupConversation)&&!this._aggregatedConversation$1.get_currentConversation().get_supportsOfflineMessages()){this.set_text(t.format(r._getLocString("contactOfflineInfo"),e)),this._inputControl$1.set_disabled(!0),this._emoticonLaunchElement$1.get_element().style.visibility="hidden";return}this.set_innerHtml(""),this._inputControl$1.set_disabled(!1),this._emoticonLaunchElement$1.get_element().style.visibility="visible"},i._attachAnchorClickEvent$1=function(n,t){var i=new a(n);i.attachEvent(r.EventType.click,t)},i._onUnblockClicked$1=function(){this.setUnblockContactInfo()},i._onCurrentConversationChanged$1=function(){n(this._currentContactIMAddress$1).unbind("propertyChanged",t.Delegate.create(this,this._onPropertyChanged$1)),this._currentContactIMAddress$1=this._aggregatedConversation$1.get_currentConversation().get_buddyAddress(),n(this._currentContactIMAddress$1).bind("propertyChanged",t.Delegate.create(this,this._onPropertyChanged$1)),this._updateInfoBar$1()},i._onPropertyChanged$1=function(n,t,i){(i.get_propertyNamePascal()==="Status"||i.get_propertyNamePascal()==="IsOnline"||i.get_propertyNamePascal()==="Block"||i.get_propertyNamePascal()==="SkypePendingOutbound")&&this._updateInfoBar$1()},i._onHistoryCollectionChanged$1=function(n,i,r){var f=r.get_newItems(),u,e;if(f)for(u=t.IEnumerator.getEnumerator(f);u.moveNext();)if(e=u.get_current(),e.get_sender().get_type()===h.shortCircuit){this._updateInfoBar$1();return}},i._onTurnOnConnectNetworkClicked$1=function(){var t=null;this._facebookNetwork$1!=null&&this._networkOnClicked$1===this._facebookNetwork$1.get_id()?t=this._facebookNetwork$1:this._googleNetwork$1!=null&&(t=this._googleNetwork$1),t!=null&&t.get_supportsIM()&&t.set_imEnabled(!0)},i._onBecomeAvailableClicked$1=function(){this._user$1.get_presence().get_status()===f.appearOffline?this._user$1.get_presence().set_status(f.online):this._user$1.get_presence().get_status()===f.offline&&this._user$1.signIn()},i._onGroupConversationOperationFailed$1=function(n,i,f){var e,o,s;if(i===u.GroupConversationOperationType.addMembers&&f.length>0){for(e="",o=t.IEnumerator.getEnumerator(f);o.moveNext();)s=o.get_current(),e+=e!==""?", ":"",e+=s.get_contact().get_displayName();this._groupChatError$1=t.format(r._getLocString("addContactFailed"),e)}this._updateInfoBar$1()}}(window.originaljQuery||jQuery),function(n){var e="●",u=window,i=u.MsgrUI,o=u.ss,r=i.UIElement,f=i._modernConversationNetworkMenuItem=function(){r.call(this)},t=f.prototype=new r;t.constructor=f,t._selectedIndicator$1=null,t._networkAttributionText$1=null,t._address$1=null,t._isSelected$1=!1,t._template=i._templates._modernConversationNetworkMenuItem,t.get_isSelected=function(){return this._isSelected$1},t.set_isSelected=function(n){return this._isSelected$1=n,this._isSelected$1?(this._selectedIndicator$1.get_element().style.visibility="",this._selectedIndicator$1.addAttribute("sutra","networkselected")):(this._selectedIndicator$1.get_element().style.visibility="hidden",this._selectedIndicator$1.removeAttribute("sutra")),n},t.get_address=function(){return this._address$1},t.set_address=function(n){return this._address$1=n,n},t.get_text=function(){return this._networkAttributionText$1.get_text()},t.set_text=function(n){return this._networkAttributionText$1.set_text(n),n},t.onVisualInitialized=function(){this.attachEvent(i.EventType.click,o.Delegate.create(this,this._onClicked$1)),this._selectedIndicator$1=new r(this.findElementById("SelectedIndicator")),this._selectedIndicator$1.set_text(e),this._networkAttributionText$1=new r(this.findElementById("NetworkAttributeName"))},t.dispose=function(){this._networkAttributionText$1=null,this._selectedIndicator$1=null},t._onClicked$1=function(){n(this).triggerHandler("selected",[this])}}(window.originaljQuery||jQuery),function(n){var u=window,s=u.$B,r=u.MsgrUI,t=u.ss,f=r.UIElement,o=f.prototype,e=r._modernConversationNetworkControl=function(n,t,i){f.call(this,t.get_element()),this._aggregatedConversation$1=n,this._conversation$1=this._aggregatedConversation$1.get_currentConversation(),this._contextMenu$1=new r._contextMenu(null),i.addChild(this._contextMenu$1),this._contextMenu$1.addAttribute("sutra","networks")},i=e.prototype=new f;i.constructor=e,i._conversation$1=null,i._buddyContact$1=null,i._contextMenu$1=null,i._currentSelectedMenuItem$1=null,i._aggregatedConversation$1=null,i.get_contextMenu=function(){return this._contextMenu$1},i.dispose=function(){this._detachEvents$1()},i.onVisualInitialized=function(){o.onVisualInitialized.call(this),this._attachEvents$1(),this._updateNetworkLabel$1()},i._updateNetworkLabel$1=function(){this._buddyContact$1!=null&&this._buddyContact$1.get_addresses().get_count()>1?(this.get_element().style.cursor="pointer",this.get_element().children[1].style.display=""):(this.get_element().style.cursor="default",this.get_element().children[1].style.display="none")},i._attachEvents$1=function(){n(this._aggregatedConversation$1).bind("currentConversationChanged",t.Delegate.create(this,this._onCurrentConversationChanged$1)),n(this._conversation$1.get_roster()).bind("collectionChanged",t.Delegate.create(this,this._onRosterCollectionChanged$1)),this.attachEvent(r.EventType.click,t.Delegate.create(this,this._onCurrentNetworkLabelClicked$1)),this._conversation$1.get_roster().get_count()<=2&&(this._buddyContact$1=this._conversation$1.get_buddyContact(),this._buddyContact$1!=null&&(n(this._buddyContact$1).bind("propertyChanged",t.Delegate.create(this,this._onContactPropertyChanged$1)),n(this._buddyContact$1.get_presence()).bind("propertyChanged",t.Delegate.create(this,this._onPresencePropertyChanged$1))))},i._detachEvents$1=function(){n(this._aggregatedConversation$1).unbind("currentConversationChanged",t.Delegate.create(this,this._onCurrentConversationChanged$1)),n(this._conversation$1.get_roster()).unbind("collectionChanged",t.Delegate.create(this,this._onRosterCollectionChanged$1)),this.detachEvent(r.EventType.click,t.Delegate.create(this,this._onCurrentNetworkLabelClicked$1)),this._buddyContact$1!=null&&(n(this._buddyContact$1).unbind("propertyChanged",t.Delegate.create(this,this._onContactPropertyChanged$1)),n(this._buddyContact$1.get_presence()).unbind("propertyChanged",t.Delegate.create(this,this._onPresencePropertyChanged$1)))},i._showAvailableNetworks$1=function(){var i=this,c,l,s,h,o;if(i._buddyContact$1!=null){for(c=i._conversation$1.get_buddyAddress(),i._contextMenu$1.clearMenuItems(),l=i._getDuplicateNetworksList$1(i._buddyContact$1.get_addresses()),s=t.IEnumerator.getEnumerator(i._buddyContact$1.get_addresses());s.moveNext();){var f=s.get_current(),e=new r._modernConversationNetworkMenuItem,a=i._contextMenu$1.addMenuItem("",null,"");a.addChild(e),e.set_address(f),n(e).bind("selected",t.Delegate.create(i,i._onMenuItemClicked$1)),a.attachEvent(r.EventType.click,t.Delegate.create(i,function(n){n.currentTarget.children[0].click()})),h=r.Utility.getLocalizedStatusText(f),l.contains(f.get_network().get_name())?(o="",o=f.get_network().get_isGoogle()?f.get_linkedContact().get_emailAddress():f.get_linkedContact().get_fullName(),e.set_text(t.format(r._getLocString("networkNameAndStatus"),r.Utility.getNetworkLabel(f.get_network()),o,h))):e.set_text(t.format(r._getLocString("networkAndStatus"),r.Utility.getNetworkLabel(f.get_network()),h)),f.get_id()===c.get_id()&&(e.set_isSelected(!0),i._currentSelectedMenuItem$1=e)}u.setTimeout(t.Delegate.create(i,function(){i._contextMenu$1.set_isActivated(!0);var n=i._contextMenu$1.get_element(),t=n.offsetWidth>170?"30px":"auto";u.$B.ltr?n.style.right=t:n.style.left=t}),250)}},i._getDuplicateNetworksList$1=function(n){for(var r=[],u=[],f=t.IEnumerator.getEnumerator(n),e,i;f.moveNext();)e=f.get_current(),i=e.get_network().get_name(),r.contains(i)?u.push(i):r.push(i);return u},i._onCurrentNetworkLabelClicked$1=function(n){this._buddyContact$1!=null&&this._buddyContact$1.get_addresses().get_count()>1&&this._showAvailableNetworks$1(),t.isNullOrUndefined(n.stopPropagation)?n.cancelBubble=!0:n.stopPropagation()},i._onPresencePropertyChanged$1=function(n,t,i){i.get_propertyNamePascal()==="Status"&&this._updateNetworkLabel$1()},i._onContactPropertyChanged$1=function(n,t,i){i.get_propertyNamePascal()==="IsContact"&&this._updateNetworkLabel$1()},i._onRosterCollectionChanged$1=function(){this._detachEvents$1(),this._conversation$1.get_roster().get_count()<=2&&this._attachEvents$1(),this._updateNetworkLabel$1()},i._onMenuItemClicked$1=function(t,i){this._currentSelectedMenuItem$1.set_isSelected(!1),this._currentSelectedMenuItem$1=i,this._currentSelectedMenuItem$1.set_isSelected(!0);var r=this._aggregatedConversation$1.get_user().get_conversations().create(this._currentSelectedMenuItem$1.get_address());r!==this._aggregatedConversation$1.get_currentConversation()&&this._aggregatedConversation$1.set_currentConversation(r),n(this).triggerHandler("networkMenuItemSelected")},i._onCurrentConversationChanged$1=function(){n(this._conversation$1.get_roster()).unbind("collectionChanged",t.Delegate.create(this,this._onRosterCollectionChanged$1)),this._detachEvents$1(),this._conversation$1=this._aggregatedConversation$1.get_currentConversation(),n(this._conversation$1.get_roster()).bind("collectionChanged",t.Delegate.create(this,this._onRosterCollectionChanged$1)),this._attachEvents$1(),this._updateNetworkLabel$1()}}(window.originaljQuery||jQuery),function(n){var f=window,b=f.$Utility,k=f.document,c=f.$Config,o=f.$WLXIM,l=f.MC,r=f.MsgrUI,s=f.Microsoft.Live.Messenger,a=s.IMAddressType,e=s.Services.SkyJSHelper,i=f.ss,v=r._templates,u=r.UIElement,y=u.prototype,d=b.isHighContrast()?"emoticon-menu-icon-white.png":"emoticon-menu-icon.png",g="common/spinner_grey_40_transparent.gif",p="webimChatView",nt=!0,w=r.ModernConversationControl=function(t,r,f,c){u.call(this),c||(c=o.user),this._contactId$1=r==null?f.get_contact().get_id():r,this._buddyContact$1=c.get_contacts().findByIdWithoutRoleCheck(this._contactId$1),this._aggregatedConversation$1=c.get_aggregatedConversations().getAggregatedConversationByContact(this._buddyContact$1),this._aggregatedConversation$1||(c.get_conversations().create(this._buddyContact$1),this._aggregatedConversation$1=c.get_aggregatedConversations().getAggregatedConversationByContact(this._buddyContact$1)),this._aggregatedConversation$1.get_currentConversation()instanceof s.GroupConversation&&(this._isGroupConversation$1=!0),f==null||this._isGroupConversation$1||this._aggregatedConversation$1.set_currentConversation(c.get_conversations().create(f)),this._parentElement$1=new u(t),this._parentElement$1.addChild(this),this._buddyContact$1!=null&&n(this._buddyContact$1.get_presence()).bind("propertyChanged",i.Delegate.create(this,this._onPresenceChanged$1)),this._isGroupConversation$1&&n(this._aggregatedConversation$1.get_currentConversation()).bind("infoUpdated",i.Delegate.create(this,this._onGroupConversationInfoUpdated$1)),n(c.get_conversations()).bind("conversationDeleted",i.Delegate.create(this,h)),e.skypeAudioVideoEnabled&&(n(e).bind("callStarted",i.Delegate.create(this,this._onCallStarted$1)),n(e).bind("pluginLoaded",i.Delegate.create(this,this._onPluginLoaded$1)),n(e).bind("callFinished",i.Delegate.create(this,this._onCallFinished$1)))},t=w.prototype=new u,h;t.constructor=w,t._aggregatedConversation$1=null,t._isGroupConversation$1=!1,t._contactId$1=null,t._buddyContact$1=null,t._currentConversationLinkedContact$1=null,t._currentConversationBuddyAddress$1=null,t._parentElement$1=null,t._container$1=null,t._callButtonsElement$1=null,t._videoCallElement$1=null,t._audioCallElement$1=null,t._disableVideoCallElement$1=null,t._disableAudioCallElement$1=null,t._spinningWheelElement$1=null,t._addMembersElement$1=null,t._historyBottom$1=null,t._titleElement$1=null,t._presenceElement$1=null,t._networkElement$1=null,t._rosterCountElement$1=null,t._emoticonLaunchElement$1=null,t._commandMenuElement=null,t._commandContextMenu$1=null,t._confirmationDialog$1=null,t._blockMenu$1=null,t._deleteMenu$1=null,t._unblockMenu$1=null,t._blockAllMenu$1=null,t._unblockAllMenu$1=null,t._sendSkypeInviteElement=null,t._leaveGroupMenu$1=null,t._historyControl$1=null,t._typingControl$1=null,t._networkControl$1=null,t._inputControl$1=null,t._emoticonPanel$1=null,t._infoBarControl$1=null,t._rosterControl$1=null,t._userTileIC=null,t._skypeUpsell=null,t._emoticonPanelElement=null,t._template=i.format(v._modernConversationControl,v.messagingImageStrip),t.get_isVisible=function(){return y.get_isVisible.call(this)},t.set_isVisible=function(n){if(n&&r._contactPickerControl.get_instance().get_isVisible()){var t=r._contactPickerControl.get_instance().get_conversation();if(t&&t===this._aggregatedConversation$1.get_currentConversation())return!1;r._contactPickerControl.get_instance().set_isVisible(!1)}return y.set_isVisible.call(this,n),n},t.dispose=function(){var t=this;n(t).unbind("propertyChanged",i.Delegate.create(t,t._onPropertyChanged$1)),t._aggregatedConversation$1.get_currentConversation()instanceof s.GroupConversation&&n(t._aggregatedConversation$1.get_currentConversation()).unbind("infoUpdated",i.Delegate.create(t,t._onGroupConversationInfoUpdated$1)),n(o.user.get_conversations()).unbind("conversationDeleted",i.Delegate.create(t,h)),n(t._aggregatedConversation$1).unbind("currentConversationChanged",i.Delegate.create(t,t._onCurrentConversationChanged$1)),n(t._infoBarControl$1).unbind("infobarUpdated",i.Delegate.create(t,t._resizeHistoryControl$1)),n(t._infoBarControl$1).unbind("sendSkypeInvite",i.Delegate.create(t,t._sendSkypeInviteFromInfobar)),t._buddyContact$1!=null&&n(t._buddyContact$1.get_presence()).unbind("propertyChanged",i.Delegate.create(t,t._onPresenceChanged$1)),e.skypeAudioVideoEnabled&&(n(e).unbind("callStarted",i.Delegate.create(t,t._onCallStarted$1)),n(e).unbind("pluginLoaded",i.Delegate.create(t,t._onPluginLoaded$1)),n(e).unbind("callFinished",i.Delegate.create(t,t._onCallFinished$1))),t._userTileIC&&(t._userTileIC.deactivate(),t._userTileIC.dispose()),t._historyControl$1.dispose(),t._typingControl$1.dispose(),t._inputControl$1.dispose(),t._emoticonPanel$1.dispose(),t._infoBarControl$1.dispose(),t._historyControl$1=null,t._typingControl$1=null,t._inputControl$1=null,t._emoticonPanel$1=null,t._infoBarControl$1=null,t._historyBottom$1=null,t._container$1.clearChildren(),t._container$1=null,t._networkControl$1!=null&&(n(t._networkControl$1).unbind("networkMenuItemSelected",i.Delegate.create(t,t._onNetworkControlDismissed$1)),t._networkControl$1.dispose(),t._networkControl$1=null),t._emoticonLaunchElement$1.detachEvent(r.EventType.click,i.Delegate.create(t,t._onEmoticonLaunchElementClicked$1)),t._emoticonLaunchElement$1=null},t.onVisualInitialized=function(){var t=this,f;t.set_isVisible(!0),n(t).bind("propertyChanged",i.Delegate.create(t,t._onPropertyChanged$1)),t._initializeHeader$1(),t._container$1=new u(t.findElementById("Container")),t._historyBottom$1=new u(t.findElementById("HistoryBottom")),t._emoticonLaunchElement$1=new u(t.findElementById("EmoticonLaunch")),t._emoticonLaunchElement$1.addAttribute("aria-label",r._getLocString("addEmoticon")),t._inputControl$1=new r._modernConversationInputControl(t._aggregatedConversation$1,t.findElementById("Input")),t._historyControl$1=new r._modernConversationHistoryControl(t._aggregatedConversation$1,t.findElementById("History"),t.findElementById("InviteRequest"),t),t._typingControl$1=new r._modernConversationTypingControl(t._aggregatedConversation$1,t.findElementById("Typing")),t._emoticonPanelElement=n(t.findElementById("EmoticonPanel")),t._emoticonPanel$1=new r._modernConversationEmoticonPanel(t._emoticonPanelElement[0],t._inputControl$1),t._infoBarControl$1=new r._modernConversationInfoBarControl(t._inputControl$1,t._emoticonLaunchElement$1,t._historyControl$1,t._aggregatedConversation$1,t.findElementById("HistoryBottom"),t.findElementById("InfoBar")),n(t._infoBarControl$1).bind("infobarUpdated",i.Delegate.create(t,t._resizeHistoryControl$1)),n(t._infoBarControl$1).bind("sendSkypeInvite",i.Delegate.create(t,t._sendSkypeInviteFromInfobar)),t._container$1.addLogicalChild(t._inputControl$1),t._container$1.addLogicalChild(t._historyControl$1),t._container$1.addLogicalChild(t._typingControl$1),t._container$1.addLogicalChild(t._emoticonLaunchElement$1),t._container$1.addLogicalChild(t._emoticonPanel$1),t._container$1.addLogicalChild(t._infoBarControl$1),t.addLogicalChild(t._container$1),t._isGroupConversation$1&&t._inputControl$1.set_disabled(t._isGroupMessagingDisabled$1()),f=k.createElement("img"),f.src=s.MessengerUtility.getEmoticonUrlPath()+d,t._emoticonLaunchElement$1.addChild(new u(f)),t._emoticonLaunchElement$1.attachEvent(r.EventType.click,i.Delegate.create(t,t._onEmoticonLaunchElementClicked$1)),t._setupSkypUpsell(),n(t._aggregatedConversation$1).bind("currentConversationChanged",i.Delegate.create(t,t._onCurrentConversationChanged$1)),t._aggregatedConversation$1.get_currentConversation()!=null&&(t._currentConversationBuddyAddress$1=t._aggregatedConversation$1.get_currentConversation().get_buddyAddress(),t._currentConversationLinkedContact$1=t._aggregatedConversation$1.get_currentConversation().get_buddyAddress().get_linkedContact(),n(t._currentConversationBuddyAddress$1).bind("propertyChanged",i.Delegate.create(t,t._onContactOrAddressPropertyChanged$1)),n(t._currentConversationLinkedContact$1).bind("propertyChanged",i.Delegate.create(t,t._onContactOrAddressPropertyChanged$1))),n(t._aggregatedConversation$1.get_history()).bind("collectionChanged",function(){t._showOrHideDeleteMenuButton(),t._showOrHideCommandMenuButton()}),t._resizeHistoryControl$1()},t.getContactStatusOnCurrentNetwork=function(){var n=this._aggregatedConversation$1.get_currentConversation().get_buddyAddress();return r.Utility.getLocalizedStatusText(n)},t.getCurrentNetwork=function(){return r.Utility.getNetworkLabel(this._aggregatedConversation$1.get_currentConversation().get_network())},t._enableInputBox=function(){this._inputControl$1.set_disabled(!1),this._emoticonLaunchElement$1.get_element().style.visibility="visible"},t._setupSkypUpsell=function(){var t=this,u;if(t._skypeUpsell=n(t._historyBottom$1.findElementById("SkypeUpsell")),u=t._buddyContact$1.get_skypeAddress(),u){var f=t._buddyContact$1.get_firstName()||t._buddyContact$1.get_lastName()||t._buddyContact$1.get_displayName(),e="<a href='#' onclick='return false;'>"+r._getLocString("chatViewUpsellSwitch")+"<\/a>",o="<img src='"+u.get_network().get_iconUrl()+"' />";t._skypeUpsell.html(i.format(r._getLocString("chatViewUpsell"),o,"<span><\/span>",e)),t._skypeUpsell.find("span").text(f),t._skypeUpsell.find("a").click(function(){var n=t._aggregatedConversation$1.get_user().get_conversations().create(t._buddyContact$1.get_skypeAddress());t._aggregatedConversation$1.set_currentConversation(n)})}t._showOrHideSkypeUpsell()},t._initializeHeader$1=function(){var t=this,e=new u(t.findElementById("Header")),s=new u(e.findElementById("CommandBar")),l=new u(s.findElementById("BackButton")),v,y,h,p,a;l.addAttribute("aria-label",r._getLocString("backButton")),l.attachEvent(r.EventType.click,o.onChatViewBack),s.addLogicalChild(l),t._callButtonsElement$1=new u(s.findElementById("CallButtons")),t._initializeCallButtons$1(),v=i.Delegate.create(t,function(){t._aggregatedConversation$1.get_currentConversation().get_roster().get_count()<300?(t.set_isVisible(!1),r._contactPickerControl.get_instance().show(t._aggregatedConversation$1.get_currentConversation(),i.Delegate.create(t,t._onAddContactsCompleted$1))):(t._confirmationDialog$1.setContent(r._getLocString("contactPickerMaxLimit"),r._getLocString("OK"),null),t._confirmationDialog$1.set_isActivated(!0))}),t._addMembersElement$1=new u(s.findElementById("AddMembersButton")),t._addMembersElement$1.addAttribute("aria-label",r._getLocString("addButton")),t._addMembersElement$1.attachEvent(r.EventType.click,v),s.addLogicalChild(t._addMembersElement$1),t._showOrHideAddMembersButton$1(),t._commandMenuElement=new u(s.findElementById("CommandMenu")),t._commandMenuElement.attachEvent(r.EventType.click,i.Delegate.create(t,t._onCommandIconClicked$1)),s.addLogicalChild(t._commandMenuElement),t._initializeCommandMenu(),y=new u(s.findElementById("ConfirmationDialogContainer")),t._confirmationDialog$1=new r._confirmationDialog,y.addChild(t._confirmationDialog$1),t._titleElement$1=new u(e.findElementById("Title")),t._updateTitle$1(),t._isGroupConversation$1?(t._userTileIC=f.$icm.createNonContactIC("icTmGroupTileXLTemplate",this._buddyContact$1.get_displayName()),h=new u(t.findElementById("Roster")),t._rosterCountElement$1=new u(h.findElementById("RosterCount")),h.set_isVisible(!0),p=i.Delegate.create(t,function(){t._rosterControl$1==null&&(t._rosterControl$1=new r._modernConversationRosterControl(t._aggregatedConversation$1,t._confirmationDialog$1,h.findElementById("RosterContainer")),e.addLogicalChild(t._rosterControl$1));var n=t._aggregatedConversation$1.get_currentConversation().get_roster();n.get_count()===0||t._isUserInGroup$1()&&n.get_count()===1||t._rosterControl$1.set_isActivated(!0)}),e.findElementById("Status").style.display="none",t._rosterCountElement$1.attachEvent(r.EventType.click,p),t._updateRosterCount$1()):(t._userTileIC=f.$pwc.getPerson(this._buddyContact$1.get_id())?f.$icm.createICForPerson("icTmUserTileXLTemplate",this._buddyContact$1.get_id(),{useActiveMessagingAddress:!0,toolTipType:"name"}):f.$icm.createNonContactIC("icTmUserTileXLTemplate",this._buddyContact$1.get_displayName()),a=i.Delegate.create(t,function(){f.open(i.replaceAll(c.WebIM.cdv,"contact_id=","contact_id="+t._buddyContact$1.get_id()))}),n(e.findElementById("UserTile")).click(a),t._titleElement$1.attachEvent(r.EventType.click,a),t._titleElement$1.addCssClass("Link",!1),t._presenceElement$1=new u(e.findElementById("Presence")),t._networkElement$1=new u(e.findElementById("Network")),t._networkControl$1=new r._modernConversationNetworkControl(t._aggregatedConversation$1,new u(e.findElementById("NetworkSwitcher")),new u(e.findElementById("NetworkMenuContainer"))),n(t._networkControl$1).bind("networkMenuItemSelected",i.Delegate.create(t,t._onNetworkControlDismissed$1)),t.addLogicalChild(t._networkControl$1),t._updateStatusText$1()),f.setTimeout(function(){var i=n(e.findElementById("UserTile"));i.append(t._userTileIC.render()),t._userTileIC.activate(),t._isGroupConversation$1&&(i.find(".c_ic_frame_clip").css("cursor","default"),t._titleElement$1.get_element().style.cursor="default")},500)},t._initializeCommandMenu=function(){var t=this,o,e,f,s;if(t._commandContextMenu$1==null&&(o=new u(t.findElementById("ContextMenuContainer")),t._commandContextMenu$1=new r._contextMenu(null),o.addChild(t._commandContextMenu$1),t._commandContextMenu$1.addAttribute("sutra","chatviewcontextmenu"),t._deleteMenu$1=t._commandContextMenu$1.addMenuItem(r._getLocString("commandDelete"),i.Delegate.create(t,t._onDeleteClicked),"deleteconversation"),t._blockMenu$1=t._commandContextMenu$1.addMenuItem(r._getLocString("commandBlock"),i.Delegate.create(t,t._onBlockClicked$1),"blockuser"),t._unblockMenu$1=t._commandContextMenu$1.addMenuItem(r._getLocString("commandUnblock"),i.Delegate.create(t,t._onUnblockClicked$1),"unblockuser"),t._blockAllMenu$1=t._commandContextMenu$1.addMenuItem(r._getLocString("commandBlockAll"),i.Delegate.create(t,t._onBlockClicked$1),"blockall"),t._unblockAllMenu$1=t._commandContextMenu$1.addMenuItem(r._getLocString("commandUnblockAll"),i.Delegate.create(t,t._onUnblockClicked$1),"unblockall"),t._sendSkypeInviteElement=t._commandContextMenu$1.addMenuItem(r._getLocString("commandAddToSkype"),i.Delegate.create(t,t._sendSkypeInvite),"addskypecontact"),t._isGroupConversation$1&&(t._leaveGroupMenu$1=t._commandContextMenu$1.addMenuItem(r._getLocString("commandLeaveGroup"),i.Delegate.create(t,t._onLeaveGroupClicked$1),"chatviewleavegroup"))),t._updateSendSkypeInviteMenu$1(),t._updateBlockUnblockMenus$1(),t._isGroupConversation$1)t._leaveGroupMenu$1.set_isVisible(t._isUserInGroup$1());else for(e=t._buddyContact$1.get_linkedContacts(),f=0,s=e.get_count();f<s;f++)n(e.get_item(f)).bind("propertyChanged",function(){t._updateSendSkypeInviteMenu$1(),t._updateBlockUnblockMenus$1(),t._showOrHideCommandMenuButton()});t._showOrHideDeleteMenuButton(),t._showOrHideCommandMenuButton()},t._onAddContactsCompleted$1=function(n){(this.set_isVisible(!0),n==null||n.length<=0)||(this._isGroupConversation$1?this._aggregatedConversation$1.get_currentConversation().addMembers(n):(n[n.length]=this._aggregatedConversation$1.get_buddyContact().get_skypeAddress()!=null?this._aggregatedConversation$1.get_buddyContact().get_skypeAddress():this._aggregatedConversation$1.get_buddyContact().get_windowsLiveAddress(),this._aggregatedConversation$1.get_user().get_conversations().createGroup(n)))},t._updateTitle$1=function(){var n=this._aggregatedConversation$1.get_currentConversation();this._isGroupConversation$1&&!i.isNullOrEmpty(n.get_title())?this._titleElement$1.set_text(n.get_title()):(this._titleElement$1.set_text(this._buddyContact$1.get_displayName()),this._updateTitleNarratorLabel$1())},t._updateStatusText$1=function(){var n=this._aggregatedConversation$1.get_currentConversation().get_roster().get_item(0);this._presenceElement$1.set_text(""),n.get_type()===a.shortCircuit||n.get_type()===a.skype&&n.get_linkedContact().get_skypePendingOutbound()||this._presenceElement$1.set_text(this.getContactStatusOnCurrentNetwork()+", "),this._networkElement$1.set_text(i.format("{0} ",this.getCurrentNetwork())),this._updateTitleNarratorLabel$1()},t._updateTitleNarratorLabel$1=function(){var n=this._titleElement$1.get_text();i.isNullOrUndefined(this._presenceElement$1)||(n+=" "+this._presenceElement$1.get_text()),i.isNullOrUndefined(this._networkElement$1)||(n+=" "+this._networkElement$1.get_text()),this._titleElement$1.addAttribute("aria-label",n)},t._attachAnchorClickEvent$1=function(n,t){var i=new u(n);i.attachEvent(r.EventType.click,t)},t._updateRosterCount$1=function(){var n=this._aggregatedConversation$1.get_currentConversation().get_roster().get_count();this._rosterCountElement$1.findElementById("Count").innerText=n===1?r._getLocString("rosterCountSingle"):i.format(r._getLocString("rosterCount"),n)},t._initializeCallButtons$1=function(){var n=this;n._videoCallElement$1=new u(n._callButtonsElement$1.findElementById("VideoCallButton")),n._videoCallElement$1.addAttribute("aria-label",r._getLocString("videoButton")),n._videoCallElement$1.attachEvent(r.EventType.click,i.Delegate.create(n,n._onVideoCallIconClicked$1)),n._callButtonsElement$1.addLogicalChild(n._videoCallElement$1),n._disableVideoCallElement$1=new u(n._callButtonsElement$1.findElementById("DisableVideoCallButton")),n._audioCallElement$1=new u(n._callButtonsElement$1.findElementById("AudioCallButton")),n._audioCallElement$1.addAttribute("aria-label",r._getLocString("audioButton")),n._audioCallElement$1.attachEvent(r.EventType.click,i.Delegate.create(n,n._onAudioCallIconClicked$1)),n._callButtonsElement$1.addLogicalChild(n._audioCallElement$1),n._disableAudioCallElement$1=new u(n._callButtonsElement$1.findElementById("DisableAudioCallButton")),e.isCallInProgress?n._disableCallButtons$1():n._enableCallButtons$1(),n._spinningWheelElement$1=new u(n.findElementById("SpinningWheel")),n._spinningWheelElement$1.get_element().src=c.WebIM.imgBase+g,n._spinningWheelElement$1.set_isVisible(!1),(n._isGroupConversation$1||!n._aggregatedConversation$1.get_currentConversation().get_roster().get_item(0).get_isAudioVideoCapable())&&n._callButtonsElement$1.set_isVisible(!1)},t._setFocus$1=function(){this._inputControl$1==null||this._inputControl$1.get_textBox().get_element().disabled||this._inputControl$1.get_textBox().get_element().focus()},t._onCommandIconClicked$1=function(){var t=this;t._commandContextMenu$1.set_isActivated(!0),t._emoticonPanel$1.set_isActivated(!1)},t._updateSendSkypeInviteMenu$1=function(){var t,n;if(this._sendSkypeInviteElement.set_isVisible(!1),!this._isGroupConversation$1)for(t=i.IEnumerator.getEnumerator(this._buddyContact$1.get_addresses());t.moveNext();)if(n=t.get_current(),o.isSkypeInvitesEnabled()){n.get_linkedContact().get_skypeInviteSent()||n.get_isPendingInbound()||n.get_type()!==s.IMAddressType.shortCircuit&&!n.get_linkedContact().get_skypePendingOutbound()||this._sendSkypeInviteElement.set_isVisible(!0);break}},t._updateBlockUnblockMenus$1=function(){var n,t,i,r,u;if(this._blockMenu$1.set_isVisible(!1),this._unblockMenu$1.set_isVisible(!1),this._blockAllMenu$1.set_isVisible(!1),this._unblockAllMenu$1.set_isVisible(!1),n=!1,t=!1,!this._isGroupConversation$1&&o.isSkypeBlockEnabled()){for(i=0;i<this._buddyContact$1.get_addresses().get_count();i++)r=this._buddyContact$1.get_addresses().get_item(i).get_linkedContact(),r.get_isBlockable()&&(u=r.get_isBlocked(),n=n||u,t=t||!u);n&&t?(this._blockAllMenu$1.set_isVisible(!0),this._unblockAllMenu$1.set_isVisible(!0)):n?this._unblockMenu$1.set_isVisible(!0):t&&this._blockMenu$1.set_isVisible(!0)}},t._onEmoticonLaunchElementClicked$1=function(){this._emoticonPanel$1.show(this._aggregatedConversation$1.get_currentConversation().get_network().get_name()),i.isNullOrUndefined(this._networkControl$1)||this._networkControl$1.get_contextMenu().set_isActivated(!1)},t._onCurrentConversationChanged$1=function(){this._callButtonsElement$1.set_isVisible(this._aggregatedConversation$1.get_currentConversation().get_roster().get_item(0).get_isAudioVideoCapable()),this._currentConversationLinkedContact$1!=null&&n(this._currentConversationLinkedContact$1).unbind("propertyChanged",i.Delegate.create(this,this._onContactOrAddressPropertyChanged$1)),this._currentConversationBuddyAddress$1!=null&&n(this._currentConversationBuddyAddress$1).unbind("propertyChanged",i.Delegate.create(this,this._onContactOrAddressPropertyChanged$1)),this._currentConversationBuddyAddress$1=this._aggregatedConversation$1.get_currentConversation().get_buddyAddress(),this._currentConversationLinkedContact$1=this._aggregatedConversation$1.get_currentConversation().get_buddyAddress().get_linkedContact(),n(this._currentConversationBuddyAddress$1).bind("propertyChanged",i.Delegate.create(this,this._onContactOrAddressPropertyChanged$1)),n(this._currentConversationLinkedContact$1).bind("propertyChanged",i.Delegate.create(this,this._onContactOrAddressPropertyChanged$1)),this._showOrHideSkypeUpsell(),this._showOrHideAddMembersButton$1(),this._updateStatusText$1(),this._resizeHistoryControl$1()},t._onContactOrAddressPropertyChanged$1=function(){this._updateStatusText$1()},t._onPresenceChanged$1=function(){this._callButtonsElement$1.set_isVisible(this._aggregatedConversation$1.get_currentConversation().get_roster().get_item(0).get_isAudioVideoCapable()),this._updateStatusText$1(),this._resizeHistoryControl$1()},t._onVideoCallIconClicked$1=function(){var t=this._aggregatedConversation$1.get_currentConversation().get_buddyContact();e.getInstance().Outlook.startCall(t.get_skypeName(),t.get_cid(),!0,this._aggregatedConversation$1.get_user().createSkypeInitializationInfo(t),this._aggregatedConversation$1.get_currentConversation().get_network().get_id()),e.reportAudioVideoStarted(!0)},t._onAudioCallIconClicked$1=function(){var t=this._aggregatedConversation$1.get_currentConversation().get_buddyContact();e.getInstance().Outlook.startCall(t.get_skypeName(),t.get_cid(),!1,this._aggregatedConversation$1.get_user().createSkypeInitializationInfo(t),this._aggregatedConversation$1.get_currentConversation().get_network().get_id()),e.reportAudioVideoStarted(!1)},t._resizeHistoryControl$1=function(){var n=this._historyBottom$1.get_element().clientHeight,t;n>0&&(this._historyControl$1.get_element().style.bottom=n+20+"px"),this._emoticonPanelElement&&this._skypeUpsell&&(t=this._skypeUpsell.is(":visible")?this._skypeUpsell.height():0,this._emoticonPanelElement.css("bottom",100+t+"px"))},t._enableCallButtons$1=function(){this._disableAudioCallElement$1.set_isVisible(!1),this._disableVideoCallElement$1.set_isVisible(!1),this._audioCallElement$1.set_isVisible(!0),this._videoCallElement$1.set_isVisible(!0)},t._disableCallButtons$1=function(){this._audioCallElement$1.set_isVisible(!1),this._videoCallElement$1.set_isVisible(!1),this._disableAudioCallElement$1.set_isVisible(!0),this._disableVideoCallElement$1.set_isVisible(!0)},t._onPropertyChanged$1=function(n,t,i){i.get_propertyNamePascal()==="IsVisible"&&this._resizeHistoryControl$1()},t._onNetworkControlDismissed$1=function(){this._setFocus$1()},t._onCallStarted$1=function(){this._callButtonsElement$1.get_isVisible()&&this._spinningWheelElement$1.set_isVisible(!0),this._disableCallButtons$1()},t._onPluginLoaded$1=function(){this._spinningWheelElement$1.set_isVisible(!1)},t._onCallFinished$1=function(){this._spinningWheelElement$1.set_isVisible(!1),this._enableCallButtons$1()},t._onGroupConversationInfoUpdated$1=function(){this._updateTitle$1(),this._updateRosterCount$1(),this._addMembersElement$1.set_isVisible(this._isUserInGroup$1()),this._inputControl$1.set_disabled(this._isGroupMessagingDisabled$1()),this._leaveGroupMenu$1.set_isVisible(this._isUserInGroup$1()),this._showOrHideCommandMenuButton()},t._isUserInGroup$1=function(){var n=this._aggregatedConversation$1.get_currentConversation(),t=this._aggregatedConversation$1.get_user().get_contact();return n.rosterContainsAddress(t.get_skypeAddress())||n.rosterContainsAddress(t.get_windowsLiveAddress())},t._isGroupMessagingDisabled$1=function(){return!this._isUserInGroup$1()||this._aggregatedConversation$1.get_currentConversation().get_roster().get_count()===1},t._onLeaveGroupClicked$1=function(){this._confirmationDialog$1.setContent(r._getLocString("confirmationDialogLeaveText"),r._getLocString("confirmationDialogLeaveButton"),i.Delegate.create(this._aggregatedConversation$1.get_currentConversation(),this._aggregatedConversation$1.get_currentConversation().leaveGroup)),this._confirmationDialog$1.set_isActivated(!0)},t._onBlockClicked$1=function(){o.showBlockFlyout(this.get_element(),this._buddyContact$1.get_id(),i.Delegate.create(this,this._blockContactCallback$1),null)},t._onDeleteClicked=function(){var n=this,t={content:r._getLocString("CommandDeleteConfirmText"),anchor:n.get_element(),buttons:{action:r._getLocString("CommandDeleteConfirmButton")},sutra:{flyoutName:"DeleteConfirmationFlyout"},performAction:function(){n._infoBarControl$1._deleteConversations(n._aggregatedConversation$1.get_conversations())}};o.showFlyout(t)},t._onUnblockClicked$1=function(){this._infoBarControl$1.setUnblockContactInfo()},t._sendSkypeInviteFromInfobar=function(){this._sendSkypeInvite(p,!0)},t._sendSkypeInvite=function(n,t){var f=this._aggregatedConversation$1.get_currentConversation().get_buddyAddress(),r,u;if(e.getInstance().Outlook.isUserLinkStatusActive()){for(n!=p&&(n="webimMenu"),o.sendSkypeInvite(this._buddyContact$1.get_id(),n,null,null),r=i.IEnumerator.getEnumerator(this._buddyContact$1.get_addresses());r.moveNext();)u=r.get_current(),u.get_network().get_isSkype()&&u.get_linkedContact().set_skypeInviteSent(!0);f.get_network().get_isSkype()&&this._infoBarControl$1.setInviteInfo()}else o.showConnectToSkypeFlyout(t===!0?this._infoBarControl$1.get_element():this.get_element())},t._showOrHideCommandMenuButton=function(){if(this._commandContextMenu$1!=null){var t=n(this._commandContextMenu$1.get_element()).find("a");this._commandMenuElement.set_isVisible(t.filter(function(){return n(this).css("display")!="none"}).length>0)}},t._showOrHideDeleteMenuButton=function(){!nt&&this._aggregatedConversation$1.get_history().get_count()>0?this._deleteMenu$1.set_isVisible(!0):this._deleteMenu$1.set_isVisible(!1)},t._showOrHideSkypeUpsell=function(){if(this._skypeUpsell.hide(),this._buddyContact$1.get_skypeAddress()){var n=this._aggregatedConversation$1.get_currentConversation().get_buddyAddress();n!=this._buddyContact$1.get_skypeAddress()&&n!=this._buddyContact$1.get_windowsLiveAddress()&&this._skypeUpsell.show()}},t._showOrHideAddMembersButton$1=function(){this._addMembersElement$1.set_isVisible(!1),(this._isGroupConversation$1||this._aggregatedConversation$1.get_user().get_skypeAddress()!=null&&l.GroupChatFeatures.phase===l.GroupChatPhase.creation&&(this._buddyContact$1.get_skypeAddress()!=null||this._buddyContact$1.get_windowsLiveAddress()!=null)&&(this._aggregatedConversation$1.get_currentConversation().get_network().get_isSkype()||this._aggregatedConversation$1.get_currentConversation().get_network().get_isWindowsLive()))&&this._addMembersElement$1.set_isVisible(this._isUserInGroup$1())},t._blockContactCallback$1=function(n){var t,r;if(n)for(this._inputControl$1.set_disabled(!0),this._infoBarControl$1.setBlockContactInfo(),this._emoticonLaunchElement$1.get_element().style.visibility="hidden",this._resizeHistoryControl$1(),t=i.IEnumerator.getEnumerator(this._buddyContact$1.get_linkedContacts());t.moveNext();)r=t.get_current(),r.set_isBlocked(!0)},h=function(n,t){this._buddyContact$1.get_id()==t.get_buddyContact().get_id()&&o.onChatViewBack()}}(window.originaljQuery||jQuery),function(n){var f=window,e=f.document,r=f.MsgrUI,h=f.Microsoft.Live.Messenger.Services.SkyJSHelper,i=f.ss,u=r.UIElement,c=u.prototype,l="Accept",o="Error",a='<a href="#" onclick="return false;" class="RecentConversationsControl_ConnectedToAddLink">{0}<\/a>',s=r._recentConversationsConnectedToControl=function(n){u.call(this,n)},t=s.prototype=new u;t.constructor=s,t._connectedToText$1=null,t._connectedToAddLink$1=null,t._addLinkVisible$1=!1,t._manageUrlFormat$1=f.$Config.WebIM.pm,t._user$1=null,t.get_user=function(){return this._user$1},t.set_user=function(n){return n!=null&&this._user$1!==n&&(this.dispose(),this._user$1=n,this.onVisualInitialized()),n},t.get_addLinkVisible=function(){return i.isNullOrUndefined(this._connectedToAddLink$1)?!0:this._connectedToAddLink$1.get_isVisible()},t.set_addLinkVisible=function(n){return i.isNullOrUndefined(this._connectedToAddLink$1)||(this._connectedToAddLink$1.set_isVisible(n),this._setConnectedToWidth$1()),this._addLinkVisible$1=n,n},t.dispose=function(){i.isNullOrUndefined(this._user$1)||(n(this._user$1.get_networks()).unbind("propertyChanged",i.Delegate.create(this,this._onNetworksPropertyChanged$1)),this._user$1=null)},t.onVisualInitialized=function(){c.onVisualInitialized.call(this),i.isNullOrUndefined(this._user$1)||(n(this._user$1.get_networks()).bind("propertyChanged",i.Delegate.create(this,this._onNetworksPropertyChanged$1)),this._populateConnectedToBar$1())},t._populateConnectedToBar$1=function(){var v,y,n,t,f,s,k,w;for(this.clearChildren(),v=e.createElement("span"),v.className="RecentConversationsControl_ConnectedToText",this._connectedToText$1=new u(v),this._connectedToText$1.set_text(r._getLocString("connectedTo")),this.addChild(this._connectedToText$1),y=i.IEnumerator.getEnumerator(this._user$1.get_networks());y.moveNext();)if(n=y.get_current(),h.skypeEnabled||n.get_id()!=="SKYPE"){var c=n.get_id(),p=n.get_tokenState(),b=p===o?n.get_iconErrorUrl():n.get_iconUrl(),d=n.get_supportsIM();(p===l||p===o||c==="WL"||c==="SKYPE")&&c!=null&&b!=null&&d&&(t=null,f=e.createElement("img"),f.src=b,f.alt=r.Utility.getNetworkLabel(n),f.style.border="0",f.style.padding="0px 5px 0px 5px",n.get_isWindowsLive()||n.get_isSkype()||(t=e.createElement("a"),i.isNullOrEmpty(this._manageUrlFormat$1)||(t.href=i.format(this._manageUrlFormat$1,c)),t.appendChild(f),t.setAttribute("aria-label",i.format(r._getLocString("manageNetwork"),r.Utility.getNetworkLabel(n)))),s=e.createElement("div"),s.style.display="inline",s.setAttribute("sutra","connectedtonetworklink"),k=t!=null?t:f,s.appendChild(k),this.addChild(new u(s)))}w=e.createElement("div"),w.innerHTML=i.format(a,r._getLocString("add")),this._connectedToAddLink$1=new u(w.children[0]),this._connectedToAddLink$1.addAttribute("sutra","connectedtoaddlink"),this._connectedToAddLink$1.addAttribute("aria-label",r._getLocString("addNetworks")),this._connectedToAddLink$1.attachEvent(r.EventType.click,i.Delegate.create(this,this._onConnectedToAddLinkClicked$1)),this.addChild(this._connectedToAddLink$1),this._connectedToAddLink$1.set_isVisible(this._addLinkVisible$1),this._setConnectedToWidth$1()},t._onNetworksPropertyChanged$1=function(){this._populateConnectedToBar$1()},t._onConnectedToAddLinkClicked$1=function(){n(this).triggerHandler("connectedToAddLinkClicked")},t._setConnectedToWidth$1=function(){var r=240,t,i;this.get_element().scrollWidth>r&&(t=r,i=n(this.get_element()).find("img"),t-=i.length*i.outerWidth(),this._connectedToAddLink$1.get_isVisible()&&(t-=n(this._connectedToAddLink$1.get_element()).outerWidth()),this._connectedToText$1.get_element().style.maxWidth=t+"px")}}(window.originaljQuery||jQuery),function(n){var f=window,i=f.MsgrUI,u=f.Microsoft.Live.Messenger,o=u.NotifyCollectionChangedAction,r=f.ss,e=i.UIElement,h="UserTile",c="DisplayName",l="MessageText",a="Timestamp",s=i._recentConversationsItem=function(n,t,r){this._lastMessageTimestamp$1=new Date(0),e.call(this,r),this._aggregatedConversation$1=n,this._buddyContact$1=t,this._dayOfWeek$1=i._getLocString("dayOfWeek").split(",")},t=s.prototype=new e;t.constructor=s,t._userTileElement=null,t._nameElement$1=null,t._messageElement$1=null,t._timeElement$1=null,t._aggregatedConversation$1=null,t._buddyContact$1=null,t._dayOfWeek$1=null,t._template=i._templates._recentConversationsItem,t.get_buddyContact=function(){return this._buddyContact$1},t.get_aggregatedConversation=function(){return this._aggregatedConversation$1},t.get_lastMessageTimestamp=function(){return this._lastMessageTimestamp$1},t.dispose=function(){n(this._aggregatedConversation$1).unbind("propertyChanged",r.Delegate.create(this,this._onConversationPropertyChanged$1)),n(this._aggregatedConversation$1).unbind("recentMessageReceived",r.Delegate.create(this,this._onConversationRecentMessageReceived$1)),n(this._aggregatedConversation$1.get_history()).unbind("collectionChanged",r.Delegate.create(this,this._onConversationHistoryChanged$1)),this._buddyContact$1!=null&&n(this._buddyContact$1).unbind("propertyChanged",r.Delegate.create(this,this._onContactPropertyChanged$1)),this.detachEvent(i.EventType.click,r.Delegate.create(this,this._onClicked$1))},t.onVisualInitialized=function(){var t,o,s;if(n(this._aggregatedConversation$1).bind("propertyChanged",r.Delegate.create(this,this._onConversationPropertyChanged$1)),n(this._aggregatedConversation$1).bind("recentMessageReceived",r.Delegate.create(this,this._onConversationRecentMessageReceived$1)),n(this._aggregatedConversation$1.get_history()).bind("collectionChanged",r.Delegate.create(this,this._onConversationHistoryChanged$1)),this._buddyContact$1!=null&&n(this._buddyContact$1).bind("propertyChanged",r.Delegate.create(this,this._onContactPropertyChanged$1)),this.attachEvent(i.EventType.click,r.Delegate.create(this,this._onClicked$1)),this._userTileElement=new e(this.findElementById(h)),this._nameElement$1=new e(this.findElementById(c)),this._messageElement$1=new e(this.findElementById(l)),this._timeElement$1=new e(this.findElementById(a)),this._aggregatedConversation$1.get_currentConversation()instanceof u.GroupConversation?t=f.$icm.createNonContactIC("icTmGroupTileTemplate",this._buddyContact$1.get_displayName()):(o=f.$pwc.getPerson(this._buddyContact$1.get_id()),t=o?f.$icm.createICForPerson("icTmUserTileTemplate",o.getId(),{toolTipType:"name"}):f.$icm.createNonContactIC("icTmUserTileTemplate",this._buddyContact$1.get_displayName())),n(this._userTileElement.get_element()).append(t.render()),n(this._userTileElement.get_element()).find("a.c_ic_frame_clip").attr("tabindex","-1"),t.activate(),this._updateDisplayName$1(),s=this._aggregatedConversation$1.getMostRecentMessage(),s!=null){this._updateLastMessage$1(s);return}this._aggregatedConversation$1.get_currentConversation()instanceof u.GroupConversation&&n(this._aggregatedConversation$1.get_currentConversation()).bind("infoUpdated",r.Delegate.create(this,this._onGroupConversationInfoUpdated)),this.set_isVisible(!1)},t.addConversation=function(){this._updateLastMessage$1()},t._updateLastMessage$1=function(t){if(t==null&&(t=this._aggregatedConversation$1.getMostRecentMessage()),t!=null&&this._lastMessageTimestamp$1<t.get_timestamp()){this._lastMessageTimestamp$1=t.get_timestamp();var r;t instanceof u.TextMessage?(r=t.createTextElementNoUrls(!0,u.EmoticonSize.small),n(r).find("br").remove()):r=t instanceof u.ThreadActivityMessage?i.Utility.getActivityMessageElement(t):i.Utility.getActivityMessageElement(null),this._messageElement$1.clearChildren(),this._messageElement$1.addChild(new e(r)),this._timeElement$1.set_text(this._getLabelTime$1(t.get_timestamp())),this.get_isVisible()||this.set_isVisible(!0),n(this).triggerHandler("itemAdded",[this]),this._highlightItem$1()}else t==null&&n(this).triggerHandler("itemDeleted",[this])},t._updateDisplayName$1=function(){if(this._buddyContact$1!=null){this._nameElement$1.clearChildren(),this._nameElement$1.set_text(this._buddyContact$1.get_displayName());var n;n=this._aggregatedConversation$1.get_currentConversation()instanceof u.GroupConversation?r.isNullOrEmpty(this._aggregatedConversation$1.get_currentConversation().get_title())?i._getLocString("groupConversationWith"):i._getLocString("groupConversationTitle"):i._getLocString("conversationWith"),this.get_element().children[0].setAttribute("aria-label",r.format(n,this._buddyContact$1.get_displayName()))}},t._highlightItem$1=function(){var n="Highlight";this._aggregatedConversation$1.get_hasUnreadMessages()?(this._nameElement$1.addCssClass("TextSemiBold",!1),this._nameElement$1.addCssClass(n,!0),this._messageElement$1.addCssClass("TextSemiBold",!1),this._messageElement$1.addCssClass("t_highlight",!1),this._messageElement$1.addCssClass(i.Utility.fontColorThemeClassName,!1),this._timeElement$1.addCssClass(n,!0)):(this._nameElement$1.removeCssClass("TextSemiBold",!1),this._nameElement$1.removeCssClass(n,!0),this._messageElement$1.removeCssClass("TextSemiBold",!1),this._messageElement$1.removeCssClass("t_highlight",!1),this._messageElement$1.removeCssClass(i.Utility.fontColorThemeClassName,!1),this._timeElement$1.removeCssClass(n,!0)),i._recentConversationsListControl.updateUnreadConversationCount()},t._getLabelTime$1=function(n){var u=new Date,f=i._getLocStringNS("live.shared.marketinfo.webim.client.DateReceivedFormat"),t,r;if(n.getFullYear()===u.getFullYear()&&n.getMonth()===u.getMonth()&&n.getDate()===u.getDate())f=i._getLocStringNS("live.shared.marketinfo.webim.client.TimeReceivedFormat");else if(new Date-n<6048e5)return this._dayOfWeek$1[n.getDay()];return t=n.getHours(),r=n.getMinutes(),f.format(n.getMonth()+1,n.getDate(),n.getFullYear().toString().substr(2),t>12?t-12:t,t,r<10?"0"+r:r,t<12?i._getLocStringNS("live.shared.strings.webim.client.Am"):i._getLocStringNS("live.shared.strings.webim.client.Pm"))},t._onConversationPropertyChanged$1=function(n,t,i){i.get_propertyNamePascal()==="ConsumptionHorizon"&&this._highlightItem$1()},t._onConversationRecentMessageReceived$1=function(n,t,i){this._updateLastMessage$1(i.get_message())},t._onConversationHistoryChanged$1=function(n,t,i){(i.get_action()===o.add||i.get_action()===o.remove)&&this._updateLastMessage$1()},t._onContactPropertyChanged$1=function(n,t,i){switch(i.get_propertyNamePascal()){case"DisplayName":case"FullName":case"IsIdentityVerified":this._updateDisplayName$1()}},t._onGroupConversationInfoUpdated=function(){var t=this._aggregatedConversation$1.get_currentConversation();t.get_userInitiated()&&this._aggregatedConversation$1.get_user().get_presence().get_status()===u.PresenceStatus.appearOffline&&(t.set_userInitiated(!1),this._onClicked$1())},t._onClicked$1=function(){n(this).triggerHandler("clicked",[this,null])}}(window.originaljQuery||jQuery),function(n){var y="common/spinner_grey_40_transparent.gif",r=window,p=r.$Config,u=r.$WLXIM,e=r.MC,f=r.MsgrUI,h=r.Microsoft.Live.Messenger,c=h.NotifyCollectionChangedAction,i=r.ss,o=f.UIElement,w=o.prototype,s=-1,a=0,v=8,l=f._recentConversationsListControl=function(n){o.call(this,n)},t=l.prototype=new o;t.constructor=l,t._user$1=null,t._aggregatedConversations=null,t._itemsContainer$1=null,t._showMoreLink=null,t._errorMessage=null,t._loadingIndicator$1=null,t._getConversationsPending$1=!0,t._addPending=!0,t._initialRenderComplete=!1,t._contactListItemMap={},t._noVisibleItems=!0,l.updateUnreadConversationCount=function(){var t=0;(u.user&&n.each(u.user.get_aggregatedConversations().get_items(),function(n,i){i instanceof h.AggregatedConversation&&i.get_hasUnreadMessages()&&t++}),t!==a)&&(a=t,u.updateMessagingCount&&(s!==-1&&r.clearTimeout(s),s=r.setTimeout(function(){u.updateMessagingCount(t),s=-1},200)))},t.get_user=function(){return this._user$1},t.set_user=function(n){return n!=null&&this._user$1!==n&&(this.dispose(),this._user$1=n,this._aggregatedConversations=this._user$1.get_aggregatedConversations(),this.onVisualInitialized()),n},t.get_visibleItemCount=function(){var i=0,r=this._contactListItemMap,n,u,t;for(n in r)u={key:n,value:r[n]},t=u.value,t&&t.get_isVisible()&&i++;return i},t.dispose=function(){i.isNullOrUndefined(this._user$1)||(n(this._aggregatedConversations).unbind("collectionChanged",i.Delegate.create(this,this._onConversationsCollectionChanged$1)),n(this._aggregatedConversations).unbind("getMoreConversationsCompleted",i.Delegate.create(this,this._onGetMoreConversationsCompleted)),this._removeConversations$1(),this._user$1=null,n(this).unbind())},t.onVisualInitialized=function(){w.onVisualInitialized.call(this),i.isNullOrUndefined(this._user$1)||(this.findElementById("Title").innerText=f._getLocString("recentConversationsTitle"),this._itemsContainer$1=new f.KeyboardAccessible(this.findElementById("ItemsContainer")),this.addLogicalChild(this._itemsContainer$1),this._showMoreLink=new o(this.findElementById("ShowMore")),this._showMoreLink.set_text(f._getLocString("showMore")),this._showMoreLink.set_isVisible(!1),this._showMoreLink.attachEvent(f.EventType.click,i.Delegate.create(this,this._onShowMoreLinkClicked)),this._errorMessage=new o(this.findElementById("ErrorMessage")),this._errorMessage.set_text(f._getLocString("recentListCallFailed")),this._errorMessage.set_isVisible(!1),this._loadingIndicator$1=new o(this.findElementById("Spinner")),this._loadingIndicator$1.get_element().src=p.WebIM.imgBase+y,this._updateUI(),n(this._aggregatedConversations).bind("collectionChanged",i.Delegate.create(this,this._onConversationsCollectionChanged$1)),n(this._aggregatedConversations).bind("getMoreConversationsCompleted",i.Delegate.create(this,this._onGetMoreConversationsCompleted)),n(u.sidebar).bind("onSidebarOpenCompletedEvent",i.Delegate.create(this,this._updateUI)))},t._updateUI=function(){if(this._addPending&&!this._getConversationsPending$1){var n=this._itemsContainer$1.get_element().children.length,t=this._aggregatedConversations.get_items();t.length>=n+v?(this._addListItems(t.slice(n,n+v)),this._onAddListItemsCompleted()):this._aggregatedConversations.get_hasMoreConversationsOnServer()?(this._getConversationsPending$1=!0,this._aggregatedConversations.getMoreConversationsFromServer()):(this._addListItems(t.slice(n,t.length)),this._onAddListItemsCompleted())}},t._addListItems=function(t){e.Logger.logAction("RecentConversationsControl.AddConversations. Count="+t.length);var r=this;n.each(t,function(t,u){var o=u.get_buddyContact(),e;o&&o.get_id()&&!r._contactListItemMap[o.get_id()]&&(e=new f._recentConversationsItem(u,o,null),r._contactListItemMap[o.get_id()]=e,r._itemsContainer$1.addChild(e),n(e).bind("clicked",i.Delegate.create(r,r._onItemClicked$1)),n(e).bind("propertyChanged",i.Delegate.create(r,r._onItemPropertyChanged)),u.get_currentConversation()instanceof h.GroupConversation&&u.get_currentConversation().get_userInitiated()&&(u.get_currentConversation().set_userInitiated(!1),n(e).triggerHandler("clicked",[e])))})},t._removeListItem=function(t){var u,r,f;e.Logger.logAction("RecentConversationsControl.DeleteConversation."),u=this,r=t.get_buddyContact(),r==null||i.isNullOrEmpty(r.get_id())||(f=u._contactListItemMap[r.get_id()],u._itemsContainer$1.removeChild(f),n(f).unbind("clicked"),n(f).unbind("propertyChanged"),u._contactListItemMap[r.get_id()]=null)},t._onAddListItemsCompleted=function(){this._addPending=!1,this._loadingIndicator$1.set_isVisible(!1),this._showMoreLink.set_isVisible((u.getTestFlags()&e.TestFlags.RecentListLoadFailure)==e.TestFlags.RecentListLoadFailure||this._aggregatedConversations.get_hasMoreConversationsOnServer()&&this._user$1.get_contacts().get_count()>1||this._aggregatedConversations.get_count()>this._itemsContainer$1.get_element().children.length),!this._errorMessage.get_isVisible()&&this._noVisibleItems&&this.get_visibleItemCount()==0&&this.set_isVisible(!1),this._initialRenderComplete||(this._initialRenderComplete=!0,n(this).triggerHandler("initialRenderComplete"))},t._onShowMoreLinkClicked=function(){this._addPending=!0,this._showMoreLink.set_isVisible(!1),this._loadingIndicator$1.set_isVisible(!0),this._updateUI()},t._removeConversations$1=function(){var u=this._contactListItemMap,t,f,r;for(t in u)f={key:t,value:u[t]},r=f.value,n(r).unbind("clicked",i.Delegate.create(this,this._onItemClicked$1)),r.dispose();this.__contactListItemMap={},this._itemsContainer$1.clearChildren()},t._moveItem$1=function(n,t){var i=this._itemsContainer$1.get_element();i.removeChild(n.get_element()),i.children.length>t?i.insertBefore(n.get_element(),i.children[t]):i.appendChild(n.get_element())},t._onConversationsCollectionChanged$1=function(n,t,r){var f,e,o,u,s,h;switch(r.get_action()){case c.replaced:case c.add:for(f=r.get_newStartingIndex(),e=i.IEnumerator.getEnumerator(r.get_newItems());e.moveNext();)o=e.get_current(),u=o.get_buddyContact(),u&&u.get_id()&&(this._contactListItemMap[u.get_id()]?this._moveItem$1(this._contactListItemMap[u.get_id()],f):f<this._itemsContainer$1.get_element().children.length||this._itemsContainer$1.get_element().children.length==0&&!this._getConversationsPending$1?(this._addListItems([o]),this._moveItem$1(this._contactListItemMap[u.get_id()],f)):this._updateUI());break;case c.remove:for(s=i.IEnumerator.getEnumerator(r.get_oldItems());s.moveNext();)h=s.get_current(),this._removeListItem(h)}},t._onGetMoreConversationsCompleted=function(n,t){this._getConversationsPending$1=!1,this._errorMessage.set_isVisible(t.callFailed||(u.getTestFlags()&e.TestFlags.RecentListLoadFailure)==e.TestFlags.RecentListLoadFailure),this._updateUI()},t._onItemPropertyChanged=function(n,t,i){this._noVisibleItems&&i.get_propertyNamePascal()==="IsVisible"&&t.get_isVisible()&&(this.set_isVisible(!0),this._noVisibleItems=!1)},t._onItemClicked$1=function(n,t){t!=null&&u.startConversationWithContactId(t.get_buddyContact().get_id(),"recentConversations",!0)}}(window.originaljQuery||jQuery),function(n){var i=window,s=i.$Config,u=i.wLive.People,h=u.NetworkID,c=u.SortOrder,t=i.MsgrUI,l=i.Microsoft.Live.Messenger,r=l.Services.SkyJSHelper,y=u.Reporter,p="<div class='WebIMUpsell' sutra='webimupsellbody'><div class='Separator'><\/div><div resourceid='Skype' class='Skype' sutra='upsellskype'><h1 resourceid='Title' class='Title' sutra='upsellskypeheader'><\/h1><div resourceid='Text' class='Text' sutra='upsellskypetext'><\/div><div resourceid='PictureGridContainer' class='PictureGridContainer' sutra='picturegrid'><\/div><a resourceid='MoreLink' class='MoreLink' sutra='upsellmorelink' href='#' onclick='return false;'><\/a><div resourceid='FlyoutContainer' class='FlyoutContainer' sutra='upsellflyout' style='display: none;'><\/div><\/div><div resourceid='Other' class='Other' sutra='upsellother'><h1 resourceid='Title' class='Title'><\/h1><\/div><a resourceid='CloseLink' class='CloseLink' sutra='nothanks' href='#' onclick='return false;'><\/a><\/div>",a="<a class='UpsellItem' href='#' onclick='return false;'><img /><div resourceid='Text' class='Text'><\/div><\/a>",w="<div class='FlyoutItem' sutra='upsellflyoutitem'><\/div>",v=["zh-cn","mn-mong-cn","bo-cn","ug-cn","ii-cn"],b="skype_linking",f="FB",e="GOOG",k="chat,dashboard_agg,status_publish",d="chat",o=16;t._upsellControl=function(u){var pt;var it=this,nt=null,g=null,ct=null,et=null,ot=null,tt=null,lt=null,ht=null,rt=null,ut=null,ft=null,at=[],yt=!1,ti=i.$Config.mkt.toLowerCase();for(pt in v)if(v[pt]==ti){yt=!0;break}yt||at.push(f),at.push(e),it.get_element=function(){return nt.get(0)},it.render=function(){return nt||(nt=n(p),g=nt.find("[resourceid='Skype']"),ct=g.find("[resourceid='Text']"),et=g.find("[resourceid='PictureGridContainer']"),ot=g.find("[resourceid='MoreLink']"),tt=nt.find("[resourceid='Other']"),lt=tt.find("[resourceid='Title']"),ht=nt.find("[resourceid='CloseLink']"),g.find("[resourceid='Title']").text(t._getLocString("upsellSkypeHeader")),ht.text(t._getLocString("upsellClose")),wt(),bt()),nt.get(0)},it.activate=function(){rt&&(rt.activate(),et.click(dt)),tt.find(".UpsellItem").click(kt),ot.click(ni),ht.click(gt),n(u.get_networks()).bind("propertyChanged",st),n(r).bind("initCompleted",st),vt(!u.get_settings().get_upsellClosedFlag()&&nt.find(".UpsellItem").length>0)},it.deactivate=function(){rt&&(rt.deactivate(),et.unbind("click",dt)),tt.find(".UpsellItem").unbind("click",kt),ot.unbind("click",ni),ht.unbind("click",gt),n(u.get_networks()).unbind("propertyChanged",st),n(r).unbind("initCompleted",st)},it.show=function(){nt.show(),u.get_settings().set_upsellClosedFlag(!1),st()};var st=function(){nt.is(":visible")&&(it.deactivate(),wt(),bt(),it.activate(),vt(g.is(":visible")||tt.is(":visible")))},wt=function(){var u,f;g.find(".UpsellItem").remove(),et.empty().hide(),r.skypeEnabled&&r.initCompleted&&!r.getInstance().Outlook.isUserLinkStatusActive()?(u=n(a),u.attr("id",b),u.attr("target","_blank"),u.attr("sutra","skypelink"),u.attr("onclick","window.open('"+s.WebIM.sau+"', '', 'height=520,width=720')"),u.find("img").attr("src",t.Utility.getNetworkIconsPath()+"skypeUpsell.png"),g.append(u),f=i.$pwc.getPersons({hasPictures:!0,networks:[h.shortCircuit]},c.messagingRelevance),f.length>=3?(rt=new t._pictureGridControl(f.slice(0,o)),et.show().append(rt.render()),ft=f.length>o?f.slice(o,f.length):[],ft.concat(i.$pwc.getPersons({hasPictures:!1,networks:[h.shortCircuit]},c.messagingRelevance)),ft.length>0?ot.css("display","block").text(i.ss.format(t._getLocString("upsellSkypeMoreLink"),ft.length)):ot.hide(),ct.text(t._getLocString("upsellFoundOnSkypeDescription")),u.find("[resourceid='Text']").text(t._getLocString("upsellFoundOnSkype")).addClass("MultiLine")):(ct.text(t._getLocString("upsellSkypeDescription")),u.find("[resourceid='Text']").text(t._getLocString("upsellSkype")).removeClass("MultiLine")),g.show()):g.hide()},bt=function(){var i;tt.find(".UpsellItem").remove(),g.find(".UpsellItem").length>0?lt.text(t._getLocString("upsellOtherNetworksHeader")):lt.text(t._getLocString("upsellOtherNetworksNoSkypeHeader"));for(var s=u.get_networks(),r=at.slice(0),n=0,o=s.get_count();n<o;n++)i=s.getItem(n),(i.get_id()==f||i.get_id()==e)&&i.get_tokenState()!=="Reject"&&i.get_supportsIM()&&r.remove(i.get_id());for(n=0,o=r.length;n<o;n++)ii(r[n]);r.length>0?tt.show():tt.hide()},ii=function(i){var r=n(a);r.attr("netid",i),r.attr("sutra",i.toLowerCase()+"link"),r.find("img").attr("src",l._globalConfiguration._getNetworkIconUrl(i)),r.find("[resourceid='Text']").text(i==e?t._getLocString("upsellGoogle"):t._getLocString("upsellFacebook")),tt.append(r)},vt=function(t){t?nt.show():nt.hide(),n(it).triggerHandler("visibilityChanged",{visible:t,hasUpsellNetworks:nt.find(".UpsellItem").length>0})},kt=function(t){var r,u,e;if(t&&t.currentTarget&&(r=n(t.currentTarget).attr("netid"),r&&(u=i.ss.format(s.WebIM.nm,r,r==f?k:d),u+=i.location.href,e=i.open(u,"","height=520,width=720"),e)))try{e.focus()}catch(o){y.logError("WebIM Upsell","Failed to focus on Connect Network window.")}},dt=function(){g.find(".UpsellItem").click()},gt=function(){vt(!1),u.get_settings().set_upsellClosedFlag(!0)},ni=function(){var i,u,r;for(ut||(ut=new t._flyout(g.find("[resourceid='FlyoutContainer']")[0]),new t.UIElement(g).addLogicalChild(ut)),ut.set_innerHtml(""),i=0,u=ft.length;i<u;i++)r=n(w),r.text(ft[i].getDisplayNameWithFallback()),ut.addChild(new t.UIElement(r[0]));ut.set_isActivated(!0)}}}(window.originaljQuery||jQuery),function(n){var t=window,i=t.MsgrUI,u="<div class='LandingPage'><div resourceid='Scrollable' class='Scrollable'><div resourceid='RecentList' class='RecentConversationsControl_Items' sutra='recentconversations'><h1 resourceid='Title' class='Title' sutra='recentconversationstitle'><\/h1><ul resourceid='ItemsContainer' class='RecentConversationsContainer' sutra='recentconversationscontainer'><\/ul><a resourceid='ShowMore' class='ShowMore' sutra='showmore'><\/a><div resourceid='ErrorMessage' class='ErrorMessage' sutra='recenterror'><\/div><img resourceid='Spinner' class='Spinner' sutra='recentconversationsloading'><\/img><\/div><\/div><div resourceid='ConnectedTo' class='RecentConversationsControl_ConnectedTo' sutra='connectedtowidget'><\/div><\/div>",r="onSidebarOpenCompletedEvent";i.LandingPageControl=function(f){var v=this,s=null,o=null,b=null,y=null,h=null,p=null,l=null,e=null,c=null,a=-1;v.get_element=function(){return s.get(0)},v.render=function(){return s||(s=n(u),o=s.find("[resourceid='Scrollable']"),b=new i.UIElement(s[0]),y=new i._contactSearchControl(f),h=new i._recentConversationsListControl(o.find("[resourceid='RecentList']")[0]),c=new i._recentConversationsConnectedToControl(s.find("[resourceid='ConnectedTo']")[0]),s.prepend(y.render())),s.get(0)},v.activate=function(){y.activate(),n(h).bind("initialRenderComplete",k),n(c).bind("connectedToAddLinkClicked",g),b.addLogicalChild(h),b.addLogicalChild(c),h.set_user(f),c.set_user(f),n(t).resize(w),n(t.$WLXIM.sidebar).bind(r,w)},v.deactivate=function(){y.deactivate(),n(h).unbind("initialRenderComplete",k),n(c).unbind("connectedToAddLinkClicked",g),h.dispose(),c.dispose(),p&&p.deactivate(),l&&l.deactivate(),e&&(n(e).unbind("visibilityChanged",d),e.deactivate()),n(t).unbind("resize",w),n(t.$WLXIM.sidebar).unbind(r,w),a>-1&&(t.clearTimeout(a),a=-1)},v.get_visibleItemCount=function(){return h.get_visibleItemCount()};var w=function(){a>-1&&t.clearTimeout(a),a=t.setTimeout(function(){a=-1;var t=n("#sidebar").height();t-=n(y.get_element()).outerHeight(),t-=n(c.get_element()).outerHeight(),e&&n(e.get_element()).is(":visible")&&(t-=n(e.get_element()).outerHeight()),o.css("max-height",t+"px"),o.height()>0?o.removeAttr("collapsed"):o.attr("collapsed","")},50)},k=function(){n(h).unbind("initialRenderComplete",k),p=new i._favoritesControl(f),l=new i._peopleControl(f),e=new i._upsellControl(f),n(e).bind("visibilityChanged",d),o.append(p.render()),o.after(e.render()),p.activate(),e.activate();var t=function(){n(l).unbind("renderComplete",t),l.activate()};n(l).bind("renderComplete",t),o.append(l.render(!0))},d=function(n,t){c.set_addLinkVisible(!t.visible&&t.hasUpsellNetworks),w()},g=function(){e.show()}}}(window.originaljQuery||jQuery),function(){var n=window,t=n.$Network;t.registerScript("webimui")}(),window.JSDownload_webim=1