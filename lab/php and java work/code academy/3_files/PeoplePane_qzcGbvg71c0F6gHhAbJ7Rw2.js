(function(n){"use strict";function c(n,t){var u=ct(t),i=n.getSelectedMessageThread(),r={contactsToAdd:[u],entryPoint:HM.InstrumentationEntryPoint.RightRail};return i&&(r.queryAddingContactFrom=HM.createItemListQuery({containerId:i.id(),containerType:HM.ItemListQueryContainerType.Message}),r.messageQueriesToFetch=[HM.createItemListQuery({containerId:i.id(),containerType:HM.ItemListQueryContainerType.Message})]),r}function et(n,t,r){var u=n.getSelectedMessageThread(),f=v("");HM.GetUnconnectedAddFriendUrl(t.NetworkId,t.MemberId,t.PublicId,u?i.data.makeMessageAsConversation(u.id()):null,function(u){f.location=u,t.isPendingFriend(!0),r.get(function(n){n.addPendingFriend(t.NetworkId,t.MemberId)}),i.Dispatcher.fireCmd("addcontacts",c(n,t.SenderId)).deferred.then(function(){o=!1},function(){o=!1})})}function ot(n,i,r){HM.AddSocialNetworkRelationship(i.NetworkId,i.MemberId,function(u){var l;if(u.Success)i.isPendingFriend(!0),r.get(function(n){n.addPendingFriend(i.NetworkId,i.MemberId)});else if(u.CanTheUserTakeRemedialAction){var v=a(n,i.NetworkId,"HMErrorFix","false"),e=s.AddFriendError,c=t.biciReporter.locationID.ERRORBAR;t.biciReporter.reportConnectionErrorShownEvent(i.NetworkId,c),l=h.createTopBar({content:e.AuthError.format(f[i.NetworkId].Name),dismissalMode:h.BarDismissalMode.Explicit,buttons:{action:e.ActionButton,close:e.CloseButton}}),l.show().then(function(n){n.buttonClicked==="action"&&(t.biciReporter.reportConnectionErrorClickEvent(i.NetworkId,c),$BSI.navigateTo(v,"_blank"))})}else h.createTopBar({content:s.AddFriendError.Error.format(f[i.NetworkId].Name),dismissalMode:h.BarDismissalMode.Timeout}).show();o=!1})}function st(n,t,r){i.Dispatcher.fireCmd("addcontacts",c(n,t.SenderId)).deferred.always(function(){ot(n,t,r)})}function b(n){n.NetworkId==="TWITR"?at(n):lt(n)}function ht(n,t,r){r.get(function(n){n.addPendingFriend(t.NetworkId,t.MemberId)}),b(t),i.Dispatcher.fireCmd("addcontacts",c(n,t.SenderId)).deferred.then(function(){l(n,t),o=!1},function(){l(n,t),o=!1})}function ct(n){var t=new HM.ContactToAdd;return t.FirstName="",t.LastName="",t.EmailAddress=n,t}function lt(n){var t,i;n.NetworkId==="FB"&&(i=r.Facebook.SignupUrl,t=i.format(e.userEmail.encodeUrl(),n.MemberId?n.MemberId.encodeUrl():"",e.userFirstName.encodeUrl(),e.userLastName.encodeUrl())),t&&$BSI.navigateTo(t,"_blank")}function at(n){var t;if(n.NetworkId==="TWITR")var i=r.FullNameTemplate.format(e.userFirstName,e.userLastName),t='<form action="{0}" method="post" target="_blank"><input name="user[name]" type="hidden" value="{1}" /><input name="user[email]" type="hidden" value="{2}" /><input name="follow" type="hidden" value="{3}" /><\/form>'.format(r.Twitter.SignupUrl,i.encodeHtml(),e.userEmail.encodeHtml(),n.PublicId?n.PublicId.encodeHtml():"");t&&vt(t)}function vt(t){var i=n(t),u=n("body"),r;u.append(i),r=i.get()[0],r.submit(),i.remove()}function l(i,r){var f=s[r.NetworkId].Upsell,o=f.SignupHeader,c=f.SignupDescription,l=tt(i,r.NetworkId,"true",e.userFirstName,"HMNwAct"),u=h.createModalDialog({title:o,content:c,buttons:{action:s.Upsell.ConnectButton,close:s.Upsell.CancelButton}});n(u).bind("buttonclick.connection",function(n,i,u){u==="action"&&(t.biciReporter.reportConnectUpsellClickEvent(r.NetworkId,t.biciReporter.locationID.SIGNUPDIALOG),v(l))}),u.show().then(function(){n(u).unbind(".connection")})}function k(i,r){var u=n(this).view().data;t.biciReporter.reportViewProfileClickEvent(u,r),$BSI.navigateTo(u.viewProfileUrl(),"_blank")}function d(i,r,u){var f=n(this).view().data;o||f.isPendingFriend()||(o=!0,t.biciReporter.reportUpsellClickEvent(f,u),r.get(function(n){n.isUserConnected(f.NetworkId)?st(i,f,r):n.isUserSignedUp(f.NetworkId)?et(i,f,r):ht(i,f,r)}))}function g(i,r,u){var f=n(this).view().data;t.biciReporter.reportConnectUpsellClickEvent(f.NetworkId,u),nt(i,f,u,"HMAlrdyF"),r.clearCache()}function nt(n,t,i,r){var u=tt(n,t.NetworkId,"false",t.FullName,r);u&&v(u)}function yt(i,r,u){var f=n(this).view().data;t.biciReporter.reportSelfUpsellClickEvent(f,u),f.isUserSignedUp()?nt(i,f,u,"HMMeViewCt"):(b(f),l(i,f)),r.clearCache()}function tt(n,t,i,u,f){var o,e,s,h;switch(t){case"FB":e=r.Facebook.ConnectUrl;break;case"TWITR":e=r.Twitter.ConnectUrl;break;default:e=null}return e&&(s=it(n,t),h=u?u.encodeUrl():"",o=e.format($Config.hcid,h,f,s.encodeUrl(),i)),o}function a(n,t,i,u){var e,f,o;switch(t){case"FB":f=r.Facebook.ReconnectUrl;break;case"TWITR":f=r.Twitter.ReconnectUrl;break;default:f=null}return f&&(o=it(n),e=f.format($Config.hcid,i,u,o.encodeUrl())),e}function it(n){var r=n.getSelectedMessageThread(),t=window.location;return"{0}//{1}{2}?n={3}{4}".format(t.protocol,t.host,t.pathname,i.DynamicNonce(),r?"&tid={0}".format(i.data.makeMessageAsConversation(r.id())):"")}function rt(n){var e,s,o,i,u;if(!f&&(f={},e=r.NetworkHelpers,e))for(s=e.length,o=0;o<s;o++)i=e[o],u=new t[i.Ctor](n),u.Name=i.Name,u.ID=i.ID,u.ApplicationId=i.ApplicationId,u.SmallIconUrl=i.SmallIconUrl,u.MediumIconUrl=i.MediumIconUrl,u.ProfileUrlTemplate=i.ProfileUrlTemplate,f[i.ID]=u}function v(n){var t=700,i=450,r=window.outerWidth!==undefined?window.outerWidth:document.documentElement.clientWidth,u=window.outerHeight!==undefined?window.outerHeight:document.documentElement.clientHeight,f=window.screenX!==undefined?window.screenX:window.screenLeft,e=window.screenY!==undefined?window.screenY:window.screenTop,o=f+(r-t)/2,s=e+(u-i)/2;return window.open(n,"_blank","toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=yes,resizable=yes,top={0},left={1},height={2},width={3}".format(s,o,i,t))}var i=window.ol=window.ol||{},y=i.controlHelpers=i.controlHelpers||{},t=y.SocialInbox=y.SocialInbox||{},r=i.config.socialInbox,e=i.config.userInformation,s=i.strings.SocialInbox,o=!1,f=null,u=null,h=wLive.Controls.Notifications,p=window.$f,ut={si:"32,0,30,31,",ac:"63,0,30,31,",vc:"94,0,30,31,"},ft="ic/icmenu2_gray.png,ic/icmenu2_gray.png,",w=["si","vc","ac"];t.PeoplePaneControl=function(i,e,o,s){function ot(n){var u,r,f,o;h&&h.dispose(),h=new t.PeoplePaneModel,u=c,h.isSafe(n.isSafe),h.isSelf(n.isSelf),h.isContact(n.isContact),h.contactID(n.contactID),h.fullName(n.fullName),r=!0,st(y),h.isSelf()?(e.get(function(n){it(n,u)}),e.isReady()?(h.isLoading(!1),r=!1):h.isLoading(!0)):h.isSafe()&&(f=!!n.membershipInfo&&!!n.membershipInfo.socialNetworkMembers,h.isSenderOnAnyNetwork(f),f?(o=ct(n.membershipInfo.socialNetworkMembers),i.getActivity(n.senderId,o,function(t){lt(t,n.membershipInfo,n.senderId,u)}),i.isFreshActivityAvailable(n.senderId,o)?(h.isLoading(!1),r=!1):h.isLoading(!0)):h.isContact()||h.nullStateBingParams(wt(h.fullName()))),r&&b()}function st(i){var s=i.senderCid,f=null,c,e,r,o,l;if($Do.iff("$pwc",0,function(){if(s==="0"){var n=$pwc.getPersonsByEmail(i.senderId);f=n.length>0&&n[0]}else f=$pwc.getPerson(s)}),u&&u.dispose(),f){u=new wLive.IC.ICPresence(!1,"PeoplePane"),u.setPerson(f);n(u).on("presenceChanged",ht);for(c=u.actions,tt(),e=0;e<w.length;e++)if(r=c[w[e]],r){o=r.id,l=r.performAction,h.addSkypeEntryPoint(new t.PeoplePaneSkypeModel($IS.CreateFromConfig(ft,ut[o],$Config.imgsBase,!0),o,r.isEnabled()));n("#PeoplePaneContainer").on("click.skypeEntryPoints",".SkypeEntryPoints #"+o,n.proxy(function(n){this(null,n.target)},l))}}}function ht(){var t,n,i;if(h&&h.SkypeEntryPoints){for(t=u.actions,n=0;n<h.SkypeEntryPoints.length;n++)i=t[h.SkypeEntryPoints[n].entryPointId()].isEnabled(),h.SkypeEntryPoints[n].isShowing(i);b()}}function ct(n){var r=[],t,i;for(t in n)n.hasOwnProperty(t)&&(i=new HM.SocialNetworkMemberInfo,i.SocialNetworkId=n[t].SocialNetwork,i.UserId=n[t].SocialNetworkMemberID,r.push(i));return r}function it(n,i){var u,o,f,e;if(c===i){if(h.isLoading(!1),h.clearSelfUpsells(),u=r.NetworkHelpers,u)for(o=u.length,f=0;f<o;f++)e=u[f],n.isUserConnected(e.ID)||h.addSelfUpsell(new t.PeoplePaneSelfUpsellModel(e,n.isUserSignedUp(e.ID)));b()}}function lt(n,t,i,r){c===r&&(h.isLoading(!1),h.clearConnectionErrors(),n&&n.errorNetworks&&vt(h,n.errorNetworks),h.clearActivities(),n&&n.activity&&h.addActivity(at(n.activity)),e.get(function(u){pt(u,n?n.activity:null,t,i,r)}),e.isReady()?h.isLoading(!1):(h.isLoading(!0),b()))}function at(n){var i=null,r=f[n.SourceId];return r&&(i=new t.PeoplePaneActivityModel(n,r)),i}function vt(n,t){for(var u,i,r=0;r<t.length;r++)u=t[r],i=f[u],i&&n.addConnectionError({NetworkId:u,name:i.Name,iconUrl:i.SmallIconUrl,checkStatusUrl:a(v,i.ID,"HMErrorFix","false")})}function pt(n,i,u,e,o){var a,v,y,s,l,p;if(c===o){if(h.isLoading(!1),h.clearUpsells(),a=r.NetworkHelpers,a&&u&&u.socialNetworkMembers){var w=u.socialNetworkMembers,k=i?i.SourceId:null,d=a.length;for(v=0;v<d;v++)if(y=a[v],s=y.ID,s!=k&&(l=w[s],l)){if(n.userHasMemberID(s,l.SocialNetworkMemberID)){h.isSelf(!0),h.clearActivities(),h.clearUpsells(),h.clearConnectionErrors(),it(n,c);return}p=new t.PeoplePaneUpsellModel(l,e,f[s],n.isUserSignedUp(s),n.isUserConnected(s),n.isPendingFriend(s,l.SocialNetworkMemberID),n.isFriend(s,l.SocialNetworkMemberID)),h.addUpsell(p)}}b()}}function b(){var i=t.biciReporter,r;i.clearEventQueue(),r=n.templates("#PP_MainTemplate"),n("#PeoplePaneContainer").link(r,h,{biciReporter:i}),setTimeout(function(n){return function(){c===n&&et.isPeoplePaneShowing()&&i.reportQueuedEvents()}}(c),1e3),setTimeout(function(t){return function(){c===t&&h.isLoading()&&n(".PeoplePane .Loading").html(nt)}}(c),1e3)}function wt(n){var t;var i="",r=n.split(" "),u=r.length;if(u>0)for(i=r[0].encodeUrl(),t=1;t<u;t++)i+="+"+r[t].encodeUrl();return i}function bt(){n("#PeoplePaneContainer").delegate(".PeoplePane .FriendUpsells .FriendUpsell .PhotoUrl, .PeoplePane .FriendUpsells .FriendUpsell .FullName, .PeoplePane .FriendUpsells .FriendUpsell .NetworkIcon, .PeoplePane .FriendUpsells .FriendUpsell .ViewProfile","click",function(){k.call(this,e,t.biciReporter.locationID.PEOPLEPANE)}).delegate(".PeoplePane .FriendUpsells .FriendUpsell .UpsellMessage a","click",function(){d.call(this,v,e,t.biciReporter.locationID.PEOPLEPANE)}).delegate(".PeoplePane .ConnectUpsells .ConnectUpsell","click",function(){g.call(this,v,e,t.biciReporter.locationID.PEOPLEPANE)}).delegate(".PeoplePane .Self .Upsell","click",function(){yt.call(this,v,e,t.biciReporter.locationID.ME)}).delegate(".PeoplePane .NoNetworksNonContact a","click",dt).delegate(".PeoplePane .ConnectionError a","click",gt)}function kt(){n("#PeoplePaneContainer").undelegate(".PeoplePane .FriendUpsells .FriendUpsell .PhotoUrl, .PeoplePane .FriendUpsells .FriendUpsell .FullName, .PeoplePane .FriendUpsells .FriendUpsell .NetworkIcon, .PeoplePane .FriendUpsells .FriendUpsell .ViewProfile","click").undelegate(".PeoplePane .FriendUpsells .FriendUpsell .UpsellMessage a","click").undelegate(".PeoplePane .ConnectUpsells .ConnectUpsell","click").undelegate(".PeoplePane .Self .Upsell","click").undelegate(".PeoplePane .NoNetworksNonContact a","click").undelegate(".PeoplePane .ConnectionError a","click"),tt()}function tt(){n("#PeoplePaneContainer").off("click.skypeEntryPoints")}function dt(){return t.biciReporter.reportBingUpsellClickEvent(),!0}function gt(){var i=n(this).view().data;return i&&t.biciReporter.reportConnectionErrorClickEvent(i.NetworkId,t.biciReporter.locationID.PEOPLEPANE),!0}var l=this,et=o,v=s,c="",y=null,h=null,nt;bt(),rt(v),nt=p?p.createLoading({width:"20px",height:"20px",useTransparentFallback:!0}):n.templates("#PP_LoadingTemplate").render({}),l.render=function(n,t){(n!==c||t.isSafe!==y.isSafe)&&(c=n,y=t,ot(y))},l.reset=function(){c="",y=null,h&&(h.dispose(),tt(),u&&u.dispose(),u=null),h=null,n("#PeoplePaneContainer").html("")},l.dispose=function(){l.reset(),kt(),l=nt=null}},t.GetCheckStatusUrl=function(n,t,i,r){return a(n,t,i,r)},t.SentMailUpsellControl=function(i,r){function s(){n(document).delegate(".SocialNetworkUpsellContainer .FriendUpsells .FriendUpsell .PhotoUrl, .SocialNetworkUpsellContainer .FriendUpsells .FriendUpsell .FullName, .SocialNetworkUpsellContainer .FriendUpsells .FriendUpsell .NetworkIcon, .SocialNetworkUpsellContainer .FriendUpsells .FriendUpsell .ViewProfile","click",function(){k.call(this,i,t.biciReporter.locationID.SENTMAILNOTIFICATION)}),n(document).delegate(".SocialNetworkUpsellContainer .FriendUpsells .FriendUpsell .UpsellMessage a","click",function(){d.call(this,o,i,t.biciReporter.locationID.SENTMAILNOTIFICATION)}),n(document).delegate(".SocialNetworkUpsellContainer .FriendUpsells .ConnectUpsell","click",function(){g.call(this,o,i,t.biciReporter.locationID.SENTMAILNOTIFICATION)})}function h(){n(document).undelegate(".SocialNetworkUpsellContainer .FriendUpsells .FriendUpsell .PhotoUrl, .SocialNetworkUpsellContainer .FriendUpsells .FriendUpsell .FullName, .SocialNetworkUpsellContainer .FriendUpsells .FriendUpsell .NetworkIcon, .SocialNetworkUpsellContainer .FriendUpsells .FriendUpsell .ViewProfile","click"),n(document).undelegate(".SocialNetworkUpsellContainer .FriendUpsells .FriendUpsell .UpsellMessage a","click"),n(document).undelegate(".SocialNetworkUpsellContainer .FriendUpsells .ConnectUpsell","click")}var e=this,o=r,u=null;rt(r),s(),e.render=function(r,e){var o,s,l;if(o=i.getIfReady(),o){for(u=new t.PeoplePaneModel,u.clearUpsells(),s=0;s<e.length;s++){var h=e[s],c=h.SocialNetwork,a=new t.PeoplePaneUpsellModel(h,h.senderId,f[c],o.isUserSignedUp(c),o.isUserConnected(c),o.isPendingFriend(c,h.SocialNetworkMemberID),!1);u.addUpsell(a)}l=t.biciReporter,l.clearEventQueue(),n(r).link(n.templates("#PP_InlineUpsellListTemplate"),u,{biciReporter:l}),l.reportQueuedEvents()}},e.dispose=function(){e.reset(),h()},e.reset=function(){u&&u.dispose(),u=null}},t.ActivityUtils={MS_PER_MINUTE:6e4,MS_PER_HOUR:36e5,MS_PER_DAY:864e5,MS_PER_WEEK:6048e5},t.ActivityUtils.parseDate=function(n){var i=null,u=new Date(n),f,r;return isNaN(u)?(f=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})Z$/,r=f.exec(n),r&&r.length===7&&(i=new Date,i.setUTCFullYear(r[1]),i.setUTCMonth(r[2]-1),i.setUTCDate(r[3]),i.setUTCHours(r[4],r[5],r[6],0))):i=u,i&&i.setTime(i.getTime()-i.getTimezoneOffset()*t.ActivityUtils.MS_PER_MINUTE),i},t.ActivityUtils.renderFriendlyDate=function(n,i){var r,f,c,u,e,o,h;return r=s.Time,f=i,n&&(c=new Date,u=c.getTime()-n.getTime(),u<t.ActivityUtils.MS_PER_MINUTE?f=r.Moment:u<t.ActivityUtils.MS_PER_HOUR?(e=Math.round(u/t.ActivityUtils.MS_PER_MINUTE),f=e==1?r.OneMinute:r.Minutes.format(e)):u<t.ActivityUtils.MS_PER_DAY?(o=Math.round(u/t.ActivityUtils.MS_PER_HOUR),f=o==1?r.OneHour:r.Hours.format(o)):(u<t.ActivityUtils.MS_PER_WEEK||!f)&&(h=Math.round(u/t.ActivityUtils.MS_PER_DAY),f=h==1?r.OneDay:r.Days.format(h))),f},t.ActivityUtils.renderMessageText=function(t,i,r){var f,e,o,u,s;if(r=r||{},f="",e=0,i)for(o=0;o<i.length;o++)u=i[o],f+=t.substring(e,u.Start).encodeHtml(),s=r[u.Type],f+=s?n.templates(s).render({entity:u}):t.substring(u.Start,u.End).encodeHtml(),e=u.End;return e<t.length&&(f+=t.substring(e,t.length).encodeHtml()),f},t.ActivityUtils.getMediaImageUrl=function(n){var r=null,t,u,i;if(n&&n.Photo&&(t=n.Photo.Streams,t))for(u=t.length,i=0;i<u;i++)t[i].Size==="Small"&&(r=t[i].Url);return r},t.biciReporter=new function(){var n=this,f="C",i="N",r="UL",o="PPV",s="AR",e="F",t=function(n){var i=this,r=n,t={};i.addDatapoint=function(n,i){t[n]=i},i.report=function(){$BSI.reportEvent(r,t)}},u=[];n.locationID={PEOPLEPANE:"PP",SENTMAILNOTIFICATION:"SMC",ME:"Me",SIGNUPDIALOG:"SgnUp",HEADER:"Hdr",ERRORBAR:"EBar"},n.peoplePaneViewID={UPSELL:"Upsl",STATUS:"Stat",ME:"Me",BING:"Bing",CONTACT:"Cntct",NOSTATUS:"NoStat",UNSAFE:"BL",NOPANE:"NoPP"},n.reactionID={LIKE:"Lk",COMMENT:"Cmnt",REPLY:"Rply",RETWEET:"Retwt",FAVORITE:"Fav"},n.clearEventQueue=function(){u=[]},n.reportQueuedEvents=function(){for(var t=0;t<u.length;t++)u[t].report();n.clearEventQueue()},n.enqueueUpsellShownEvent=function(n,o){var s,h;s=new t("Log.VProf"),s.addDatapoint(r,o),s.addDatapoint(i,n.networkId()),s.addDatapoint(f,n.isUserConnected()?"1":"0"),s.addDatapoint(e,n.isFriend()?"1":"0"),u.push(s),n.isFriend()||(h=new t(n.isUserSignedUp()?"Log.AddFrUp":"Log.SUUp"),n.isUserSignedUp()&&h.addDatapoint(f,n.isUserConnected()?"1":"0"),h.addDatapoint(r,o),h.addDatapoint(i,n.networkId()),u.push(h))},n.enqueueConnectUpsellShownEvent=function(n,f){var e=new t("Log.ConUp");e.addDatapoint(r,f),e.addDatapoint(i,n),u.push(e)},n.enqueueSelfUpsellShownEvent=function(n,f){var e=new t(n.isUserSignedUp()?"Log.ConUp":"Log.SUUp");e.addDatapoint(r,f),e.addDatapoint(i,n.NetworkId),u.push(e)},n.enqueueConnectionErrorShownEvent=function(n,f){var e=new t("Log.FixUp");e.addDatapoint(r,f),e.addDatapoint(i,n.NetworkId),u.push(e)},n.enqueueReactionsShownEvent=function(n){var r=new t("Log.ActReact");r.addDatapoint(i,n.ActivityData.SourceId),u.push(r)},n.enqueueBingUpsellShownEvent=function(){var n=new t("Log.BingUp");u.push(n)},n.enqueuePeoplePaneViewEvent=function(n){var i=new t("Log.PplPn");i.addDatapoint(o,n),u.push(i)},n.reportUpsellClickEvent=function(n,u){var e=new t(n.isUserSignedUp()?"Log.AddFrUp.Clk":"Log.SUUp.Clk");e.addDatapoint(r,u),e.addDatapoint(i,n.networkId()),n.isUserSignedUp()&&e.addDatapoint(f,n.isUserConnected()?"1":"0"),e.report()},n.reportConnectUpsellClickEvent=function(n,u){var f=new t("Log.ConUp.Clk");f.addDatapoint(r,u),f.addDatapoint(i,n),f.report()},n.reportSelfUpsellClickEvent=function(n,u){var f=new t(n.isUserSignedUp()?"Log.ConUp.Clk":"Log.SUUp.Clk");f.addDatapoint(r,u),f.addDatapoint(i,n.NetworkId),f.report()},n.reportConnectionErrorShownEvent=function(n,u){var f=new t("Log.FixUp");f.addDatapoint(r,u),f.addDatapoint(i,n),f.report()},n.reportConnectionErrorClickEvent=function(n,u){var f=new t("Log.FixUp.Clk");f.addDatapoint(r,u),f.addDatapoint(i,n),f.report()},n.reportReactionClickEvent=function(n){var i=new t("Log.ActReact.Clk");i.addDatapoint(s,n),i.report()},n.reportBingUpsellClickEvent=function(){var n=new t("Log.BingUp.Clk");n.report()},n.reportViewProfileClickEvent=function(n,u){var o=new t("Log.VProf.Clk");o.addDatapoint(r,u),o.addDatapoint(i,n.networkId()),o.addDatapoint(f,n.isUserConnected()?"1":"0"),o.addDatapoint(e,n.isFriend()?"1":"0"),o.report()}}})(window.originaljQuery||window.jQuery),function(n){"use strict";var u=window.ol=window.ol||{},o=u.controlHelpers=u.controlHelpers||{},t=o.SocialInbox=o.SocialInbox||{},h=u.config.socialInbox,i=h.Facebook,e=u.strings.SocialInbox,r=i?e[i.SourceId]:null,f=wLive.Controls.Notifications,s;t.FacebookNetworkHelper=function(r){function l(){var t=n("#PeoplePaneContainer");t.delegate(".PeoplePane .Facebook .Reactions .Like","click",a),t.delegate(".PeoplePane .Facebook .Reactions .Comment","click",v)}function a(){if(!o){o=!0,t.biciReporter.reportReactionClickEvent(t.biciReporter.reactionID.LIKE);var s=n(this).parents(".ActivityContainer").view(),r=s.data.ActivityData;HM.AddSocialNetworkReaction(r.SourceId,"LIKE",r.ObjectId,!r.Reactions.LikeReaction.HasReacted,function(n){var a;if(n.Success)r.Reactions.LikeReaction.HasReacted=!r.Reactions.LikeReaction.HasReacted;else if(n.CanTheUserTakeRemedialAction){var v=t.GetCheckStatusUrl(c,i.SourceId,"HMErrorFix","false"),h=e.ReactionError,l=t.biciReporter.locationID.ERRORBAR;t.biciReporter.reportConnectionErrorShownEvent(u.ID,l),a=f.createTopBar({content:h.AuthError.format(u.Name),dismissalMode:f.BarDismissalMode.Explicit,buttons:{action:h.ActionButton,close:h.CloseButton}}),a.show().then(function(n){n.buttonClicked==="action"&&(t.biciReporter.reportConnectionErrorClickEvent(u.ID,l),$BSI.navigateTo(v,"_blank"))})}else f.createTopBar({content:e.ReactionError.Error.format(u.Name),dismissalMode:f.BarDismissalMode.Timeout}).show();s.refresh(s.ctx),o=!1})}return!0}function v(){return t.biciReporter.reportReactionClickEvent(t.biciReporter.reactionID.COMMENT),!0}var u=this,h=new s,c=r,o=!1;l(),u.activityTemplate="#PP_FacebookActivityTemplate",u.presenter=h,u.getUserIDForProfile=function(n){return n.memberId()},u.renderActivity=function(t){return n.templates("#PP_FacebookActivityTemplate").render({activity:t},h)}},s=function(){var u="Like",e="Unlike",f="Comment",o={Url:"#PP_EntityUrlTemplate"},n=this;n.hasMessage=function(n){return n&&n.Message},n.getMessage=function(n){var t=null;return n&&n.Message&&(t=n.Message),t},n.renderMessage=function(n){return t.ActivityUtils.renderMessageText(n.Text,n.Entities,o)},n.renderDate=function(n){return t.ActivityUtils.renderFriendlyDate(t.ActivityUtils.parseDate(n.Published),n.PublishedString)},n.getMedia=function(n){var r,u;var f=null,e=n&&n.Message&&n.Message.Text,i=null;return n&&n.Title&&n.Title!==e&&(i=n.Title),r=null,n&&n.Caption&&n.Caption!==e&&n.Caption!==i&&(r=n.Caption),u=t.ActivityUtils.getMediaImageUrl(n),(i||u||r)&&(f={title:i,caption:r,imageUrl:u,linkUrl:n.Link.SafeUrl}),f},n.getLikeReaction=function(n){var t=n.Reactions[u+"Reaction"];return{id:u,canReact:t?t.CanReact:!1,text:r.Reactions[t.HasReacted?e:u],icon:i.Reactions[t.HasReacted?e:u].IconClass,sutra:r.Sutra&&r.Sutra[u]||""}},n.getCommentReaction=function(n){var t=n.Reactions[f+"Reaction"];return{id:f,canReact:t?t.CanReact:!1,text:r.Reactions[f],icon:i.Reactions[f].IconClass,actionUrl:n.AttributionLink.SafeUrl,sutra:r.Sutra&&r.Sutra[f]||""}}}}(window.originaljQuery||window.jQuery),function(n){"use strict";var r=window.ol=window.ol||{},f=r.controlHelpers=r.controlHelpers||{},t=f.SocialInbox=f.SocialInbox||{},o=r.config.socialInbox,i=o.Twitter,s=r.strings.SocialInbox,u=i?s[i.SourceId]:null,e;t.TwitterNetworkHelper=function(){function o(){var t=n("#PeoplePaneContainer");t.delegate(".PeoplePane .Twitter .Reactions .Reply","click",s),t.delegate(".PeoplePane .Twitter .Reactions .Retweet","click",h),t.delegate(".PeoplePane .Twitter .Reactions .Favorite","click",c)}function s(){return r.reportReactionClickEvent(r.reactionID.REPLY),!0}function h(){return r.reportReactionClickEvent(r.reactionID.RETWEET),!0}function c(){return r.reportReactionClickEvent(r.reactionID.FAVORITE),!0}var u=this,f=new e,r;o(),u.activityTemplate="#PP_TwitterActivityTemplate",u.presenter=f,r=t.biciReporter,u.getUserIDForProfile=function(n){return n.publicId()},u.renderActivity=function(t){return n.templates("#PP_TwitterActivityTemplate").render({activity:t},f)}},e=function(){function r(n){return n.OriginalActivity?n.OriginalActivity:n}var f={Url:"#PP_EntityUrlTemplate",UserMention:"#PP_TwitterEntityUserMentionTemplate",Hashtag:"#PP_TwitterEntityHashtagTemplate"},n=this;n.renderTweet=function(n){n=r(n);var i=n.Message;return t.ActivityUtils.renderMessageText(i.Text,i.Entities,f)},n.renderDate=function(n){return t.ActivityUtils.renderFriendlyDate(t.ActivityUtils.parseDate(n.Published),n.PublishedString)},n.getAuthor=function(n){return n=r(n),n.Author.ScreenName},n.getAuthorAttributionLink=function(n){return n=r(n),n.Author.ProfileUrl},n.getAuthorFullName=function(n){return n=r(n),n.Author.Name},n.getObjectId=function(n){return n=r(n),n.ObjectId},n.getMedia=function(n){var i=null,r=t.ActivityUtils.getMediaImageUrl(n);return r&&(i={imageUrl:r,linkUrl:n.Link.SafeUrl}),i},n.getReaction=function(n,t){n=r(n);var f=n.Reactions[t+"Reaction"];return{id:t,canReact:f?f.CanReact:!1,text:u.Reactions[t],icon:i.Reactions[t].IconClass,actionUrl:i.Reactions[t].ActionUrl.format(this.getObjectId(n)),sutra:u.Sutra&&u.Sutra[t]||""}},n.isRetweet=function(n){return n.OriginalActivity}}}(window.originaljQuery||window.jQuery),function(n){"use strict";function t(t,i,r){return r===undefined?r=t[i]:n.observable(t).setProperty(i,r),r}var r=window.ol=window.ol||{},f=r.controlHelpers=r.controlHelpers||{},i=f.SocialInbox=f.SocialInbox||{},u=r.strings.SocialInbox,e=r.config.socialInbox;i.PeoplePaneModel=function(){var r=this;r.attribution=null;var e=[],o=[],s=[],u=[],f=[];r.initialize=function(){r.attribution=t(r,"Attribution",new i.PeoplePaneAttributionModel),t(r,"ConnectionErrors",e),t(r,"Activities",o),t(r,"SelfUpsells",s),t(r,"Upsells",u),t(r,"SkypeEntryPoints",f)},r.dispose=function(){r.attribution&&r.attribution.dispose(),r.attribution=null},r.isLoading=function(n){return t(r,"IsLoading",n)},r.isSenderOnAnyNetwork=function(n){return t(r,"IsSenderOnAnyNetwork",n)},r.isSelf=function(n){return t(r,"IsSelf",n)},r.isSafe=function(n){return t(r,"IsSafe",n)},r.isContact=function(n){return t(r,"IsContact",n)},r.contactID=function(n){return t(r,"ContactID",n)},r.nullStateBingParams=function(n){return t(r,"NullStateBingParams",n)},r.fullName=function(n){return t(r,"FullName",n)},r.addConnectionError=function(t){n.observable(e).insert(e.length,t)},r.clearConnectionErrors=function(){n.observable(e).remove(0,e.length)},r.hasConnectionErrors=function(){return e.length>0},r.addActivity=function(t){n.observable(o).insert(o.length,t)},r.clearActivities=function(){n.observable(o).remove(0,o.length)},r.hasActivities=function(){return o.length>0},r.addSelfUpsell=function(t){n.observable(s).insert(s.length,t)},r.clearSelfUpsells=function(){n.observable(s).remove(0,s.length)},r.hasSelfUpsells=function(){return s.length>0},r.addUpsell=function(t){n.observable(u).insert(u.length,t)},r.clearUpsells=function(){n.observable(u).remove(0,u.length)},r.hasFriendUpsells=function(){if(u)for(var n=0;n<u.length;n++)if(!u[n].IsFriend)return!0;return!1},r.firstUpsell=function(){return u&&u.length>0?u[0]:0},r.addSkypeEntryPoint=function(t){n.observable(f).insert(f.length,t)},r.clearSkypeEntryPoint=function(){n.observable(f).remove(0,f.length)},r.skypeDivClass=function(){for(var t=!0,n=0;n<f.length;n++)if(f[n].isShowing()){t=!1;break}return"SkypeEntryPoints"+(t?" NoDisplay":"")},r.initialize()},i.PeoplePaneSkypeModel=function(n,i,r){var u=this;u.initialize=function(){u.entryPointEltMarkup(n),u.entryPointId(i),u.isShowing(r)},u.dispose=function(){},u.entryPointEltMarkup=function(n){return t(u,"EntryPointEltMarkup",n)},u.entryPointId=function(n){return t(u,"EntryPointId",n)},u.isShowing=function(n){return t(u,"IsShowing",n)},u.classToUse=function(){return u.isShowing()?"":"NoDisplay"},u.initialize()},i.PeoplePaneAttributionModel=function(){var n=this;n.networks=[],n.dispose=function(){n.networks=null},n.initialize=function(){var t,u,i;if(n.PreferencesUrl=r.baseLegacyUrl(r.config.socialInbox.preferencesUrl),t=e.NetworkHelpers,t)for(u=t.length,i=0;i<u;i++)n.networks.push({name:t[i].Name,iconUrl:t[i].SmallIconUrl})},n.initialize()},i.PeoplePaneActivityModel=function(n,i){var r=this;r.dispose=function(){r.template=null,r.presenter=null,r.activityData(null)},r.initialize=function(){r.activityData(n),r.template=i.activityTemplate,r.presenter=i.presenter,r.name=i.Name,r.iconUrl=i.MediumIconUrl},r.activityData=function(n){return t(r,"ActivityData",n)},r.initialize()},i.PeoplePaneSelfUpsellModel=function(n,i){var r=this;r.initialize=function(){r.networkId(n.ID),r.isUserSignedUp(i),r.shouldShowConnectUpsell(!i),r.name=n.Name,r.iconUrl=n.MediumIconUrl},r.dispose=function(){},r.networkId=function(n){return t(r,"NetworkId",n)},r.isUserSignedUp=function(n){return t(r,"IsUserSignedUp",n)},r.shouldShowConnectUpsell=function(n){return t(r,"ShouldShowConnectUpsell",n)},r.connectUpsellText=function(){return u.Upsell.AlreadyMember.format(n.Name)},r.initialize()},i.PeoplePaneUpsellModel=function(n,i,r,f,o,s,h){var c=this;c.initialize=function(){c.senderId(i),c.networkId(n.SocialNetwork),c.memberId(n.SocialNetworkMemberID),c.photoUrl(n.PhotoUrl),c.publicId(n.PublicID);var t;t=n.FirstName&&n.LastName?e.FullNameTemplate.format(n.FirstName,n.LastName):n.FirstName?n.FirstName:n.LastName,c.fullName(t),c.isUserSignedUp(f),c.isUserConnected(o),c.isPendingFriend(s),c.isFriend(h),c.shouldShowConnectUpsell(!o),c.name=r.Name,c.iconUrl=r.SmallIconUrl,c.mediumIconUrl=r.MediumIconUrl},c.dispose=function(){},c.networkId=function(n){return t(c,"NetworkId",n)},c.senderId=function(n){return t(c,"SenderId",n)},c.memberId=function(n){return t(c,"MemberId",n)},c.publicId=function(n){return t(c,"PublicId",n)},c.photoUrl=function(n){return t(c,"PhotoUrl",n)},c.fullName=function(n){return t(c,"FullName",n)},c.upsellText=function(n){var t=u.Upsell.SignUp;return f&&(t=n?u.Upsell.PendingFriends:u[r.ID].Upsell.AddFriend),t},c.noHoverClass=function(n){var t=null;return n&&(t="NoHover"),t},c.isUserConnected=function(n){return t(c,"IsUserConnected",n)},c.isUserSignedUp=function(n){return t(c,"IsUserSignedUp",n)},c.isPendingFriend=function(n){return t(c,"IsPendingFriend",n)},c.isFriend=function(n){return t(c,"IsFriend",n)},c.shouldShowConnectUpsell=function(n){return t(c,"ShouldShowConnectUpsell",n)},c.connectUpsellText=function(){return f?u[r.ID].Upsell.AlreadyFriends:u.Upsell.AlreadyMember.format(r.Name)},c.viewProfileUrl=function(){return r.ProfileUrlTemplate.format(r.getUserIDForProfile(c))},c.isSignupUpsell=function(){return!c.isFriend()&&!c.isPendingFriend()&&!c.isUserSignedUp()},c.initialize()}}(window.originaljQuery||window.jQuery)