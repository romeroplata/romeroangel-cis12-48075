function HmType$callBase(n,t,i){var r=n.prototype[t];return i!==undefined?r.apply(this,i):r.call(this)}var HmType;(function(){"use strict";var u=window.ol=window.ol||{},n=ol.data=ol.data||{},t=n.fpp=n.fpp||{},i=t.FppEngine,f=window.ActionQueue,r=window.ActionQueueTypes.ActionType;i.registerFppConfig("sendmessage",{fppMethod:"SendMessage_ec",tokenConfig:{friendlyName:"SendMessage_ec",actionType:r.blocking,getTokenKeys:function(){return[null]}},cmdArgs:[{name:"to",type:String},{name:"from",type:String},{name:"cc",type:Object},{name:"bcc",type:Object},{name:"priority",type:Number},{name:"subject",type:String},{name:"message",type:String},{name:"attachmentIds",type:Array},{name:"draftId",type:String},{name:"draftFolderId",type:String},{name:"originalMessageId",type:String},{name:"rfc822MessageId",type:String},{name:"rfc822InReplyTo",type:String},{name:"rfc822References",type:String},{name:"sentState",type:Number},{name:"sendByPlainTextFormat",type:Boolean},{name:"meetingICalId",type:String},{name:"shareSkyDriveNumFiles",type:Number},{name:"computeFriendshipCacheAndMeInformation",type:Boolean},{name:"checkForgottenAttachment",type:Boolean}],returnServerResults:!0,suppressServerErrors:!0})})(),function(n){"use strict";var o=window.ol=window.ol||{},i=ol.data=ol.data||{},f=i.fpp=i.fpp||{},r=f.FppEngine,s=window.ActionQueue,e=window.ActionQueueTypes.ActionType,u={fppMethod:"SaveDraftM2",tokenConfig:{friendlyName:"SaveDraft",actionType:e.async,getTokenKeys:function(n){return[n.args.draftId||null]}},cmdArgs:[{name:"to",type:String},{name:"from",type:String},{name:"fromName",type:String},{name:"cc",type:String},{name:"bcc",type:String},{name:"priority",type:Number},{name:"subject",type:String},{name:"message",type:String},{name:"attachmentList",type:String},{name:"inlineAttList",type:String},{name:"rfc822MsgId",type:String},{name:"rfc822References",type:String},{name:"rfc822InReplyTo",type:String},{name:"draftId",type:String},{name:"originalMessageId",type:String},{name:"replyState",type:Number},{name:"isAutoSave",type:Boolean},{name:"meetingICalId",type:String},{name:"saveAsPlainText",type:Boolean}],returnServerResults:!0,useCompatibleQueryContainer:!0},t;r.registerFppConfig("savedraftm2",u),t=n.extend(!0,{},u),t.fppMethod="SaveDraftM4",t.suppressServerErrors=!0,t.useCompatibleQueryContainer=!1,t.cmdArgs.push({name:"isInlineReply",type:Boolean}),r.registerFppConfig("savedraft",t)}(window.originaljQuery||window.jQuery),function(){"use strict";var u=window.ol=window.ol||{},n=ol.data=ol.data||{},t=n.fpp=n.fpp||{},i=t.FppEngine,f=window.ActionQueue,r=window.ActionQueueTypes.ActionType;i.registerFppConfig("initiatecompose",{fppMethod:"GetComposeData",tokenConfig:{friendlyName:"GetComposeData",actionType:r.view,getTokenKeys:function(t,i){var r=n.FppUtils.getMessageAndConversationQueries(i.itemListQueries),u=[];return r&&r.length===1&&(u=[r[0].containerId,r[0].folderId]),u}},cmdArgs:[{name:"actionType",type:Number},{name:"detectNeedToShowSafetyWarning",type:Boolean},{name:"isInline",type:Boolean},{name:"query",type:Object}],shouldMakeFppCall:function(n,t){return t.args.respondingItemId&&!t.args.composeData}})}(),function(){"use strict";var u=window.ol=window.ol||{},n=ol.data=ol.data||{},t=n.fpp=n.fpp||{},i=t.FppEngine,r=window.ActionQueueTypes.ActionType;i.registerFppConfig("dismissinlinereplybubble",{fppMethod:"DismissInlineReplyBubble",tokenConfig:{friendlyName:"DismissInlineReplyBubble",actionType:r.async,getTokenKeys:function(){return[null]}},cmdArgs:[],returnServerResults:!0})}(),function(){function i(n){return n=n.replace(/(&#8220;)|(&#8221;)|[“”\u8220\u8221]/g,'"'),n.replace(/(&#8216;)|(&#8217;)|[‘’\u8216\u8217]/g,"'")}function r(n){return(n.charAt(0)==='"'||n.charAt(0)==="'")&&n.charAt(0)===n.charAt(n.length-1)&&(n=n.substring(1,n.length-1)),n}function u(){return $pwc.names.isLastNameFirst()}function f(n){var t=n.First;return n.First=n.Last,n.Last=t,n}var e=window.wLive||{},n=window.ol=window.ol||{},t;n.ContactsUtil={},t=n.ContactsUtil,t.getFirstLastNames=function(n){var t=n.DisplayName,e,o;return t=i(t),t=r(t),e={First:"",Last:""},t&&(t!=n.PreferredEmail&&(o=t.indexOf(" "),o!==-1?(e.First=t.substr(0,o),e.Last=t.substr(o+1)):e.First=t),u()&&f(e)),e}}(),function(n){"use strict";function f(){return{regularFiles:[],inlineFiles:[],roundTrippedInlineFiles:[],shareSkyDriveFiles:null,numRegularFiles:0}}var i=window.ol=window.ol||{},r=i.vm=i.vm||{},u=36,e=r.Attachments=function(t){var u=this,f;u.controlNamespace=ol.createControlNamespace("Attachments"),u.initAccessorValues(t),f=n.proxy(u.arrayChangeHandler,u),n.observable.simpleOn([u.RegularFiles],"arrayChange."+u.controlNamespace,function(n,t){u.numRegularFiles(u.RegularFiles.length),u.arrayChangeHandler(n,t)}),n.observable.simpleOn([u.InlineFiles],"arrayChange."+u.controlNamespace,f),u.shareSkyDriveIsReady=n.Deferred(),ol.config.pageManager.manifests.Compose.initContext.shareSkyDrive&&(u.shareSkyDriveIsReady=i.init.NotifyLoad(i.config.compose.featureBuckets.shareSkyDrive).then(function(){u.shareSkyDriveFiles(new r.ShareSkyDrive)}))},t=e.prototype;t.arrayChangeHandler=function(n,t){var i,r;if(t.change==="remove")for(i=0;i<t.items.length;i++)r=t.items[i],r.dispose()},t.empty=function(){var t=this;n.observable(t.RegularFiles).remove(0,t.RegularFiles.length),n.observable(t.InlineFiles).remove(0,t.InlineFiles.length),t.ShareSkyDriveFiles&&t.ShareSkyDriveFiles.empty(),t.roundTrippedInlineFiles([])},t.serializeAttachmentsList=function(){for(var i=this.RegularFiles.concat(this.InlineFiles),r=[],t,n=0;n<i.length;n++)t=i[n],t.Id&&r.push(encodeURIComponent(t.Id));return r.join("|")},t.serializeRoundTrippedInlineFiles=function(){for(var t=[],i,n=0;n<this.RoundTrippedInlineFiles.length;n++)i=this.RoundTrippedInlineFiles[n],t.push(encodeURIComponent(i));return t.join("|")},t.allAttachmentsHeadersList=function(){for(var i=[],r=this.RegularFiles.concat(this.InlineFiles).concat(this.RoundTrippedInlineFiles),n,t=0;t<r.length;t++)n=r[t],n.id?n.id()&&i.push(n.id()):i.push(n);return i},t.findFileWithExternalUploaderId=function(n){for(var r=this,u=r.RegularFiles.length,i=null,t=0;t<u;t++)if(i=r.RegularFiles[t],i.externalUploaderId()===n)return i;return null},t.processingDeferred=function(){for(var i=[],n=null,r=this,u=r.RegularFiles.concat(r.InlineFiles),t=0;t<u.length;t++)n=u[t],n.hasError()||(i.push(n.thumbnailDeferred),i.push(n.uploadDeferred));return ol.deferredUtils.whenAll(i)},t.isUploading=function(){for(var i=this,t=null,n=0;n<i.RegularFiles.length;n++)if(t=i.RegularFiles[n],t.uploading()&&!t.hasError())return!0;for(n=0;n<i.InlineFiles.length;n++)if(t=i.InlineFiles[n],!t.hasError()&&(t.uploading()||!t.imageIsOnScreen()))return!0;return!1},t._getNumValidItems=function(n){for(var i=this,r=n?i.InlineFiles:i.RegularFiles,u=0,t=0;t<r.length;t++)r[t].hasError()||u++;return u},t.getNumValidRegularFiles=function(){return this._getNumValidItems(!1)},t.getNumValidAllFiles=function(){return this._getNumValidItems(!0)+this._getNumValidItems(!1)},t.getTotalItemSizeExcludingFilesWithErrors=function(){for(var i=this,r=0,t=i.RegularFiles.concat(i.InlineFiles),n=0;n<t.length;n++)!t[n].hasError()&&t[n].size()&&(r+=t[n].size());return r},t.deserializeAttachmentsList=function(n){var t=this;t._deserializeAttachmentsList(n.AttachmentIdHeaders,!1),t.roundTrippedInlineFiles(n.InlineIdHeaders||[])},t._deserializeAttachmentsList=function(n,t){if(n)for(var i=0;i<n.length;i++)this._deserializeAttachment(n[i],t)},t._deserializeAttachment=function(t,i){var s=this,f,e,o;t&&(f=decodeURIComponent(t).split("|"),f.type=f[1],f.id=f[2].substring(0,u),f.name=f[2].substring(u),f.size=parseInt(f[3]),e=new r.AttachmentFile({enableThumbnails:!1,type:f.type,name:f.name,size:f.size,id:t,uploaded:!0,uploadProgress:"100%"}),e.thumbnailDeferred.resolve(),e.uploadDeferred.resolve(),o=i?s.InlineFiles:s.RegularFiles,n.observable(o).insert(o.length,e))},t.cleanupInlineImageErrors=function(){for(var i=this,t=i.InlineFiles.length-1;t>=0;t--)i.InlineFiles[t].hasError()&&n.observable(i.InlineFiles).remove(t,1)},t.removeFile=function(t,i){var u=this,f=i?u.InlineFiles:u.RegularFiles,r=n.inArray(t,f);return r>=0&&n.observable(f).remove(r,1),r>=0},t.haveAnyErrors=function(){for(var t=this,i=!1,r=t.InlineFiles.concat(t.RegularFiles),u,n=0;n<r.length;n++)u=r[n],i|=u.hasError();return!!i},t.dispose=function(){for(var t=this,i=0,i=0;i<t.RegularFiles.length;i++)t.RegularFiles[i].dispose();for(i=0;i<t.InlineFiles.length;i++)t.InlineFiles[i].dispose();n.observable.simpleOff([t.RegularFiles],"arrayChange."+t.controlNamespace),n.observable.simpleOff([t.InlineFiles],"arrayChange."+t.controlNamespace)},ol.AddOptionsAccessorAndInitFunctions(t,f)}(window.originaljQuery||window.jQuery),function(n){"use strict";var t=ol.ComposeKeyboardShortcuts=function(t){var i=this,r=n.extend({},{initContext:null},t),u={none:0,showAddressBook:2,sendMsg:3,sendMsg2:3,saveDraft:7,cancelMsg:50,spellCheck:51,emojiPicker:52,showFontNames:54,showFontSizes:55,showFontColors:56,showHighlightColors:57,insertNumberedList:58,insertBulletedList:59,outdent:60,indent:61,justifyLeft:62,justifyCenter:63,justifyRight:64,insertLink:65};i._recordShortcutInstrumentation=function(n){var t=u[n]||0;t&&$BSI.reportEvent("KB.Actions",{Shortcut:t})},i.onKeyShortcut=function(t){var f=t.e,e=t.name,h,u,a;i._recordShortcutInstrumentation(e);var c=ol.config.cookies.pdCookie,l=!0,o=!0,s=r.initContext;return s.hasSeenKbdUi||"sendMsg"!==e||(l=confirm(ol.GetString("KeyboardShortcuts.Alert.Text")),s.hasSeenKbdUi=!0,ol.writeOption(s.uiSeenKbdUrl),h=ol.Cookies.get(c),h.ksui="1",ol.Cookies.setPermanent(c,h),o=!1),l&&(u=e,u==="cancelMsg"&&(a=f.keyCode,n(document.body).bind("keyup",function v(t){if(t.keyCode===a)return n(document).unbind("keyup",v),t.stopImmediatePropagation(),!1})),u==="cancelMsg"&&t.notificationsDismissed||ol.Cmd("compose.action").fire({action:u,entryPoint:HM.InstrumentationEntryPoint.KeyboardShortcut,event:f}),f.stopImmediatePropagation(),o=!1),o},i.keyShortcutsEnabled=function(){return!ol.isMenuOpen()}}}(window.originaljQuery||window.jQuery),function(n){"use strict";function o(){return{thread:null,initContext:null,hasMultipleAddresses:!1,isPortraitLayout:!1,needToComputeFriendshipCache:!0,emojiPicker:null,isRespondingInline:!1,userFont:null,keyboardHandler:null,defaultFromAddress:null}}function e(){return t.Cookies.isPlainTextCookieSet()?t.vm.Compose.TextModes.PlainText:t.vm.Compose.TextModes.RichText}var t=window.ol=window.ol||{},f=t.vm=t.vm||{},r=window.wLive.Controls.Notifications,u={newmessage:HM.MessageActionType.None,reply:HM.MessageActionType.Reply,replyall:HM.MessageActionType.ReplyAll,forward:HM.MessageActionType.Forward,resumedraft:HM.MessageActionType.ResumeDraft,accept:HM.MessageActionType.Accept,decline:HM.MessageActionType.Decline,tentative:HM.MessageActionType.Tentative},s={reply:"CanNotReplyAddress",replyall:"CanNotReplyAddress",forward:"CanNotForward"},h={reply:"replyAction",replyall:"replyAllAction",forward:"forwardAction"},i=f.Compose=function(i){function et(){var n,r,u,e,f;t.InitAccessorValues(o,i),t.Cmd("begincomposesession").subscribe(tt),t.Cmd("endcomposesession").subscribe(w),t.Cmd("rrutocompose").subscribe(nt),t.Cmd("deletedraft").subscribe(g),t.Cmd("compose.switchtofull").subscribe(d),t.Cmd("compose.updateusercomposedata").subscribe(ut),n=t.config.pageManager.manifests.Compose.initContext,o.initContext(n,{silentlyUpdate:!0}),o.userFont(ot(n.userFont),{silentlyUpdate:!0}),o.fromAddresses(n.fromAddresses,{silentlyUpdate:!0}),o.defaultFromAddress(n.defaultFromAddress,{silentlyUpdate:!0}),r=t.config.keyboardShortcuts,u=t.config.compose.kbdShortcuts,r.enabled&&u&&(e=new t.ComposeKeyboardShortcuts({initContext:n}),f=new t.KeyboardHandler({handler:e,sequenceTree:u,timeout:r.timeout,ctrlAltOrFunctionKeyRequired:!0}),t.Cmd("keyboardhandler.register").fire({handler:f,page:t.config.pageManager.manifests.Compose.name}),o.KeyboardHandler=f),t.init.NotifyLoad(t.config.compose.featureBuckets.emojiPicker).then(function(){o.emojiPicker(new t.vm.EmojiPicker)}),y()}function k(n,t,i){var r=parseInt(n),u;return u=i,r>-1&&r<t.length&&(u=t[r]),u}function v(n){return n==="1"}function ot(n){var i=["","","","","",""];return n&&(i=n.split("|")),{bold:v(i[0]),italic:v(i[1]),underline:v(i[2]),fontName:k(i[3],t.config.compose.RTE.FONT_NAME,t.config.compose.defaultFontName),fontSize:k(i[4],t.config.compose.RTE.FONT_SIZE,t.config.compose.RTE.DEFAULT_FONT_SIZE),fontColor:i[5]}}function d(n){var i,e,u,r;a=!0,o.isRespondingInline(!1),i=n.thread,e=!i.isFullCompose(),e&&(i.isFullCompose(!0),u=i.quotedText(),i.composeMessageBody(i.composeMessageBody()+u),i.quotedText(""),r=i.Attachments.shareSkyDriveFiles(),r&&r.totalFileCount()>0&&i.Attachments.shareSkyDriveFiles(new f.ShareSkyDrive({postMessageBody:r.postMessageBody()+u}))),o.thread(i),t.Cmd("nav.compose").fire({thread:o.thread(),skipHistory:!1,prePopulatedBody:!0,alreadyRecordedStart:!0,initialState:n.initialState})}function g(n){c&&c.containerId===n.thread.id()&&(t.Dispatcher.unregister(o.apply,o),c=null);var r=n.thread,i=this.deferred;t.vm.MessageThread.performActionOnThreads("deletemsg",[r],n,!0).then(i.resolve,i.reject)}function y(){var n=new t.vm.MessageThread({isFullCompose:!0,isComposeSession:!0,composeVm:o});o.thread(n),o._needToResetThread=!1}function nt(i){var u,r,f;l=n.Deferred(),u=i.actionType===HM.MessageActionType.ResumeDraft,r=u?i.composeData.MessageId:t.data.getTemporaryId("mg"),p(r),f=t.Dispatcher.fireCmd("initiatecompose",{temporaryId:r,respondingItemId:i.composeData.MessageId,actionType:i.actionType,detectNeedToShowSafetyWarning:!1,query:null,composeData:i.composeData,needToComputeFriendshipCache:!0,isInline:!1,viewId:0,prePopulatedBody:i.prePopulatedBody,entryPoint:HM.InstrumentationEntryPoint.RRU,action:t.compose.GetActionFromActionType(i.actionType),composeLoaded:t.Instrumentation.composeLoaded()}).deferred,f.fail(b),rt()}function tt(i){var u=this,e,f,o,c,l;if(e=i.selectedContainerId,e===t.config.sysFldrs.draftsFid&&i.action!=="resumedraft"&&i.action!=="newmessage"){u.deferred.reject();return}if(e===t.config.sysFldrs.junkFid&&i.action!=="newmessage"){u.deferred.reject();return}if(f=i.thread,o=n.Deferred().resolve(!1),f){if(c=h[i.action],l=c?f[c]():null,l&&l===s[i.action]){r.createTopBar({content:i.action==="forward"?t.GetString("EditMessage.CannotForwardMessage"):t.GetString("EditMessage.CannotReplyToAddress"),dismissalMode:r.BarDismissalMode.Timeout}).show(),u.deferred.reject();return}o=it(f.passwordSafetySet(),f.warnOnReplyForward(),f.safetyType())}o.then(function(n){var t=ht(i,n);setTimeout(t?u.deferred.resolve:u.deferred.reject,0)},u.deferred.reject)}function it(i,u,f){var o=null,s=!0,e,h,c;return i?(o=t.GetString("EditMessage.PasswordSafetyQuestion"),s=!1):u&&(f!==HM.BodySafetyType.Unsafe&&(o=t.GetString("EditMessage.ReplyForwardWithPicturesQuestion")),s=!1),e=n.Deferred(),o?(h="<span>"+o+"<\/span>",c=r.createFlyout({content:h,anchor:n("#Reply")[0],buttons:{action:t.GetString("EditMessage.ReplyForwardWithPicturesQuestion.ContinueButton")}}),c.show().then(function(n){n.buttonClicked==="action"?e.resolve(s):e.reject()})):e.resolve(s),e.promise()}function st(n,i){var r={},u=!0;switch(i){case"replyall":r.to=n.replyAllToRecipients(),r.cc=n.replyAllCcRecipients();break;case"reply":r.to=n.replyToRecipients(),r.cc=n.replyCcRecipients();break;case"forward":break;default:u=!1}return u&&(r.fromDetails=t.vm.Compose.initializeFromAddress(n.replyFromAddress(),t.compose.composeVm)),r}function ht(i,r){var h,w;if(c)return!1;l=n.Deferred(),t.Instrumentation.startCSIPerfScenario({performanceId:"NavCompose",tr:"nav.compose",deferred:l});var k=i.action==="resumedraft",f=i.thread?i.thread.id():i.respondingItemId,s={},a=k?f:t.data.getTemporaryId("mg");if(i.canRespondInline?(o.isRespondingInline(!0),s=st(i.thread,i.action)):(o._needToResetThread&&y(),o.isRespondingInline(!1),p(a)),h=null,f)var v=t.data.isMessageAsConversationId(f),d=t.data.isMessageId(f)||v,h=HM.createItemListQuery({containerId:v?t.data.getMidFromMessageAsConversation(f):f,containerType:d?HM.ItemListQueryContainerType.Message:HM.ItemListQueryContainerType.Conversation,bodyProperties:HM.createBodyProperties({safetyType:HM.BodySafetyType.Unsafe})});return o.needToComputeFriendshipCache(i.needToComputeFriendshipCache),w=t.Dispatcher.fireCmd("initiatecompose",{temporaryId:a,respondingItemId:f,actionType:u[i.action],detectNeedToShowSafetyWarning:r,query:h||null,composeData:i.composeData,needToComputeFriendshipCache:i.needToComputeFriendshipCache,viewId:i.thread?i.thread.ViewId:0,skipHistory:i.skipHistory,to:s.to,cc:s.cc,fromDetails:s.fromDetails,isInline:o.isRespondingInline(),prePopulatedBody:i.composeData&&i.composeData.MessageBody,replyingMessageHasAttachments:i.thread&&i.thread.HasAttachments,plainText:e()===t.vm.Compose.TextModes.PlainText}).deferred,t.Cmd("keyboardhandler.enable").fire({value:!1,page:t.config.pageManager.manifests.Inbox.name}),w.fail(b),t.Cmd("loadpeoplepaneresources").fire(),rt(),!0}function p(n){c&&t.Dispatcher.unregister(o.apply,o),c=HM.createItemListQuery({containerId:n,containerType:HM.ItemListQueryContainerType.Message,bodyProperties:null}),t.Dispatcher.register([c],o.apply,o,o.handleInvalidQueries)}function w(i){var r,u;t.Cmd("keyboardhandler.enable").fire({value:!0,page:t.config.pageManager.manifests.Inbox.name}),t.Dispatcher.unregister(o.apply,o),c=null,r=n.when(),i&&i.isFullCompose&&a&&(u=this,r=u.deferred.pipe(function(){if(a=!1,i.dontNavigate)return n.when();var r=n.extend({},i,{dontInstrument:!i.messageSent,alreadyRecordedStart:i.messageSent,composeCompleted:!0});return t.Cmd("nav.inbox").fire(r).deferred}).pipe(function(){return o._needToResetThread=!0,setTimeout(y,200),n.when()})),r.pipe(function(){i&&(i.messageSent&&t.Cmd("smc.show").fire(i),i.serverErrorMessage&&t.Dispatcher.fireCmd("setservererrormessage",{serverErrorMessage:i.serverErrorMessage}))})}function rt(){var n=o.initContext().usePicwForContactPicker;n&&setTimeout(function(){HM.GetUserComposeData(n,ft,{},null)},0)}function ut(n){ft(n.userComposeData)}function ft(n){n.picwEmails&&n.picwEmails.length>0&&o.picwEmails(n.picwEmails),n.fromAddresses&&n.fromAddresses.length>0&&o.fromAddresses(n.fromAddresses),n.defaultFromAddress&&n.defaultFromAddress!==o.defaultFromAddress()&&o.defaultFromAddress(n.defaultFromAddress)}function b(){l&&l.reject(),w()}var o=this,c,a,l;o.initAccessorValues(i),a=!1,l=null,o.picwEmails=function(n,i){return t.ComplexTypeAccessor(o,"PicwEmails",n,null,i)},o.fromAddresses=function(n,i){return n&&o.hasMultipleAddresses(n.length>1,i),t.ComplexTypeAccessor(o,"FromAddresses",n,null,i)},o.apply=function(i,r){var e=r[c.key()],h,u,f,s;if(e)for(h in e.messages)u=e.messages[h],u.isComposeSession&&((u.composeActionType!==HM.MessageActionType.None||u.composeData)&&o.thread().update(u),o.thread().id(u.messageId),c&&u.messageId!==c.containerId&&p(u.messageId),f=o.thread().composeData(),(f||u.composeActionType===HM.MessageActionType.None)&&!a&&(s=n.when(),f&&(s=it(!1,f.ShowReplyForwardWarning)),s.then(function(){a=!0,o.recordComposeRenderData({thread:o.thread()}),t.Cmd("nav.compose").fire({thread:o.thread(),skipHistory:i.args.skipHistory,prePopulatedBody:i.args.prePopulatedBody,alreadyRecordedStart:i.args.entryPoint!==HM.InstrumentationEntryPoint.RRU})},b)))},o.recordComposeRenderData=function(n){if(l){l.resolve();for(var t in HM.MessageActionType)if(n.thread.ComposeActionType===HM.MessageActionType[t]){$CSIPerf.addCsd("type",t);break}$CSIPerf.addCsd("inlinereply",!n.thread.isFullCompose())}},o.finishInlineReplyRender=function(n){o.recordComposeRenderData(n),t.Instrumentation.endCSIPerfScenario()},o.handleInvalidQueries=function(n,i){var r=i[c.key()];r&&r.isQueryInvalidationChange&&(t.Dispatcher.unregister(o.apply,o),c=null)},o.dispose=function(){t.Cmd("begincomposesession").unsubscribe(tt),t.Cmd("endcomposesession").unsubscribe(w),t.Cmd("rrutocompose").unsubscribe(nt),t.Cmd("deletedraft").unsubscribe(g),t.Cmd("compose.switchtofull").unsubscribe(d),t.Cmd("compose.updateusercomposedata").unsubscribe(ut)},et()};t.AddOptionsAccessorAndInitFunctions(i.prototype,o),i.prototype.thread=function(n,i){var r=this;return r.Thread&&n!==undefined&&r.Thread.dispose(),t.AccessorWithOptions(r,"Thread",n,i)},i.TextModes={RichText:"RichText",PlainText:"PlainText",HTML:"HTML"},i.Priorities={High:2,Normal:0,Low:1},i.initializeSendersFromComposeData=function(n,i,r){var r=r||t.compose.composeVm,u;i&&i.From&&(u=i.From),n.senderDetails(t.vm.Compose.initializeFromAddress(u,r))},i.mapComposeDataToMessageThread=function(n){var r=n.thread,u=n.composeData||{},s=n.composeVm||t.compose.composeVm,l=n.ignoreBody,a=n.ignoreAddress,h=s.initContext(),f,o,c;a&&r.isComposeReady()||(r.cc(u.CC||""),r.bcc(u.BCC||""),r.to(u.To||""),i.initializeSendersFromComposeData(r,u,s)),r.subject(u.Subject||""),f=r.composeActionType(),f===HM.MessageActionType.Accept||f===HM.MessageActionType.Decline||f===HM.MessageActionType.Tentative?r.meetingRequestInfo({time:u.MeetingRequestTime||"",location:u.MeetingRequestLocation||"",action:f}):r.meetingRequestInfo(null),r.importance(u.Priority?u.Priority:0),r.textMode(e(),!0),r.Attachments||r.attachments(new t.vm.Attachments),o="",r.plainText()||(o+=h.userFontHtml),o+=h.signature,$B.IE&&$B.V>=10&&(o+="&nbsp;"),c=u.MessageBody||o,r.Attachments.deserializeAttachmentsList(u),l||r.composeMessageBody(c)},i.isInlineComposeReadyImmediately=function(n){return n.composeActionType===HM.MessageActionType.ReplyAll||n.composeActionType===HM.MessageActionType.Reply?!!n.to&&!!n.senderDetails.fromAddress:n.composeActionType===HM.MessageActionType.Forward||n.composeActionType===HM.MessageActionType.ResumeDraft?!1:!0},i.initializeFromAddress=function(n,t){var u,f,r,i;if(u=!1,n)for(r=t.fromAddresses(),i=0;i<r.length;i++)if(n===r[i].Address){f=HM.createSenderDetails({fromAddress:n,displayName:r[i].Name,icFullName:r[i].Name}),u=!0;break}return u||(f=HM.createSenderDetails({fromAddress:t.defaultFromAddress(),displayName:t.initContext().defaultFromName})),f},i.setUserTileSrc=function(){var n=this,t,i;n._contactsReady=!0,t=n._icInstance=$icm.createICForPerson(n._fromAddrICTemplate,$Config.cid,{toolTipType:"none"}),t&&(i=n.contents().find(".FromUserTile"),i.append(t.render()),t.activate(i.find(".c_ic")))},t.compose={composeVm:new t.vm.Compose,GetActionFromActionType:function(n){for(var t in u)if(u[t]===n)return t}}}(window.originaljQuery||window.jQuery),function(){var n=ol.templateMap=ol.templateMap||{};n["#composePageTemplate"]={tmpls:[],links:{},tags:{},bnds:[{fn:function(n){return[{tmpl:0,params:"thread=Thread ~composeVm=#data ",props:{thread:n.Thread},ctx:{composeVm:n},args:[]}]},paths:["Thread"],_ctxs:"composeControl"},{fn:function(){return[{tmpl:0,params:"",props:{},args:[]}]},paths:[],_ctxs:"pageFooterControl"}],_is:"template",allowCode:!0,tmplName:"composePageTemplate",htmlTag:"div",fn:{fn:function(n,t,i){var i=i||jsviews,u=i._tag,r="";return r+="    ",r+=u("composeControl",t,this,1),r+='    <div class="composeFooterContainer">        ',r+=u("pageFooterControl",t,this,2),r+"    <\/div>"}}},n["#contactPickerManagerTemplate"]={tmpls:[{tmpls:[],links:{},tags:{},bnds:[{fn:function(n){return{params:"DraftSavedLabel",props:{},args:[n.DraftSavedLabel]}},paths:["DraftSavedLabel"],_ctxs:">"}],_is:"template",allowCode:!0,htmlTag:"span",tmplName:"contactPickerManagerTemplate/if",fn:{fn:function(n,t,i){var i=i||jsviews,u=i._cnvt,r="";return r+='           <span class="DraftArea">',r+=u("html",t,1),r+"<\/span>         "}}}],links:{},tags:{},bnds:[{fn:function(n,t){return{params:"~tag.ToInlineError",props:{},args:[t.hlp("tag").ToInlineError]}},paths:["~tag.ToInlineError"],_ctxs:":"},{fn:function(){return[{tmpl:0,params:"",props:{},args:[]}]},paths:[],_ctxs:"contactPickerToControl"},{fn:function(n,t){return{params:"~tag.CcInlineError",props:{},args:[t.hlp("tag").CcInlineError]}},paths:["~tag.CcInlineError"],_ctxs:":"},{fn:function(){return[{tmpl:0,params:"",props:{},args:[]}]},paths:[],_ctxs:"contactPickerCcControl"},{fn:function(n,t){return{params:"~tag.BccInlineError",props:{},args:[t.hlp("tag").BccInlineError]}},paths:["~tag.BccInlineError"],_ctxs:":"},{fn:function(){return[{tmpl:0,params:"",props:{},args:[]}]},paths:[],_ctxs:"contactPickerBccControl"}],_is:"template",allowCode:!0,tmplName:"contactPickerManagerTemplate",htmlTag:"div",fn:{fn:function(n,t,i,r){var i=i||jsviews,f,e=i._tag,o=i._cnvt,u="";return u+='    <div class="Row To">        <div class="errorDiv" ',u+=(f=t.hlp("sutra")("toinlineerror"))!=r?f:"",u+=' role="alert" tabindex="-1" data-link="css-display{getDisplay: ~tag.ToInlineError}">',u+=o("",t,1),u+='<\/div>       <div class="ShowCcBccContainer">           <span class="ShowCcBcc" data-link="css-display{getDisplay: !~tag.ShowBcc}">                <div class="ButtonLink">                    <a class="showBcc" ',u+=(f=t.hlp("sutra")("showbcc"))!=r?f:"",u+=' href="#">                        ',u+=(f=t.hlp("ol").GetString("EditMessage.AddBcc"))!=r?f:"",u+='                    <\/a>                <\/div>            <\/span>            <span class="ShowCcBcc ShowCc" data-link="css-display{getDisplay: !~tag.ShowCc}">                <div class="ButtonLink">                    <a class="showCc" ',u+=(f=t.hlp("sutra")("showcc"))!=r?f:"",u+=' href="#">                        ',u+=(f=t.hlp("ol").GetString("EditMessage.AddCc"))!=r?f:"",u+="                    <\/a>                <\/div>            <\/span>         ",u+=e("if",t,this,[{tmpl:1,params:"!IsFullCompose",props:{},args:[!n.IsFullCompose]}]),u+='       <\/div>        <span class="ContactHeader ButtonLink">            <a class="toBtn" href="#" title="',u+=(f=t.hlp("ol").GetString("EditMessage.ContactPicker.Tooltip"))!=r?f:"",u+='" ',u+=(f=t.hlp("sutra")("tobutton"))!=r?f:"",u+=">                ",u+=(f=t.hlp("ol").GetString("EditMessage.To"))!=r?f:"",u+="            <\/a>        <\/span>        ",u+=e("contactPickerToControl",t,this,2),u+='    <\/div>    <div id="Cc" class="Row CC" data-link="css-display{getDisplay: ~tag.ShowCc}">        <div class="errorDiv" ',u+=(f=t.hlp("sutra")("ccinlineerror"))!=r?f:"",u+=' role="alert" tabindex="-1" data-link="css-display{getDisplay: ~tag.CcInlineError}">',u+=o("",t,3),u+='<\/div>        <div class="ContactHeader ButtonLink">            <a class="ccBtn" href="#" title="',u+=(f=t.hlp("ol").GetString("EditMessage.ContactPicker.Tooltip"))!=r?f:"",u+='"  ',u+=(f=t.hlp("sutra")("ccbutton"))!=r?f:"",u+=">                ",u+=(f=t.hlp("ol").GetString("EditMessage.Cc"))!=r?f:"",u+="            <\/a>        <\/div>        ",u+=e("contactPickerCcControl",t,this,4),u+='    <\/div>    <div id="Bcc" class="Row BCC" data-link="css-display{getDisplay: ~tag.ShowBcc}">        <div class="errorDiv" ',u+=(f=t.hlp("sutra")("bccinlineerror"))!=r?f:"",u+=' role="alert" tabindex="-1" data-link="css-display{getDisplay: ~tag.BccInlineError}">',u+=o("",t,5),u+='<\/div>        <div class="ContactHeader ButtonLink">            <a class="bccBtn" href="#"  title="',u+=(f=t.hlp("ol").GetString("EditMessage.ContactPicker.Tooltip"))!=r?f:"",u+='"  ',u+=(f=t.hlp("sutra")("bccbutton"))!=r?f:"",u+=">                ",u+=(f=t.hlp("ol").GetString("EditMessage.Bcc"))!=r?f:"",u+="            <\/a>        <\/div>        ",u+=e("contactPickerBccControl",t,this,6),u+"    <\/div>"}}},n["#fromAddressHeaderTemplate"]={tmpls:[],links:{},tags:{},bnds:[],_is:"template",allowCode:!0,tmplName:"fromAddressHeaderTemplate",htmlTag:"span",fn:{fn:function(n,t,i){var i=i||jsviews,u=i.converters.html,r="";return r+='    <span class="FromContainer">        <div class="Name t_atc">',r+=u(n.displayName),r+='<\/div>        <div class="Address t_qtc">',r+=u(n.fromAddress),r+"<\/div>    <\/span>"}}},n["#inlineFromAddressHeaderTemplate"]={tmpls:[],links:{},tags:{},bnds:[],_is:"template",allowCode:!0,tmplName:"inlineFromAddressHeaderTemplate",htmlTag:"span",fn:{fn:function(n,t,i){var i=i||jsviews,u=i.converters.html,r="";return r+='    <span class="FromContainer">        <span class="Name t_atc">',r+=u(n.displayName),r+='<\/span>&nbsp;&nbsp;&nbsp;        <span class="Address t_qtc">',r+=u(n.fromAddress),r+"<\/span>    <\/span>"}}},n["#fromAddressSelectorTemplate"]={tmpls:[{tmpls:[{tmpls:[],links:{},tags:{},bnds:[{fn:function(n){return[{tmpl:0,params:'SenderDetails tmpl="#fromAddressHeaderTemplate"',props:{tmpl:"#fromAddressHeaderTemplate"},args:[n.SenderDetails]}]},paths:["SenderDetails"],_ctxs:"for"}],_is:"template",allowCode:!0,htmlTag:"span",tmplName:"fromAddressSelectorTemplate/if/if",fn:{fn:function(n,t,i,r){var i=i||jsviews,f,e=i._tag,u="";return u+='                            <span class="FromUserTile"><\/span>                            ',u+=e("for",t,this,1),u+='                            <span class="c_chev">',u+=(f=t.hlp("ol").config.compose.chevronHtml)!=r?f:"",u+"<\/span>                        "}}},{tmpls:[],links:{},tags:{},bnds:[{fn:function(n){return[{tmpl:0,params:'SenderDetails tmpl="#inlineFromAddressHeaderTemplate"',props:{tmpl:"#inlineFromAddressHeaderTemplate"},args:[n.SenderDetails]}]},paths:["SenderDetails"],_ctxs:"for"}],_is:"template",allowCode:!0,htmlTag:"span",tmplName:"fromAddressSelectorTemplate/if/else",fn:{fn:function(n,t,i,r){var i=i||jsviews,f,e=i._tag,u="";return u+="                            ",u+=e("for",t,this,1),u+='                            <span class="c_chev">',u+=(f=t.hlp("ol").config.compose.inlineChevronHtml)!=r?f:"",u+"<\/span>                        "}}},{tmpls:[],links:{},tags:{},bnds:[],_is:"template",allowCode:!0,htmlTag:"li",tmplName:"fromAddressSelectorTemplate/if/for",fn:{fn:function(n,t,i,r){var i=i||jsviews,f,e=i.converters.html,u="";return u+="                        <li ",u+=(f=t.hlp("sutra")("dropdownmenuitem"))!=r?f:"",u+='>                            <a class="fam_i" href="#">                                <div class="Name t_atc">',u+=e(n.Name),u+='<\/div>                                <div class="Address t_qtc">',u+=e(n.Address),u+"<\/div>                            <\/a>                        <\/li>                    "}}}],links:{},tags:{},bnds:[{fn:function(n,t){return[{tmpl:3,params:"~composeVm.FromAddresses",props:{},args:[t.hlp("composeVm").FromAddresses]}]},paths:["~composeVm.FromAddresses"],_ctxs:"for"}],_is:"template",allowCode:!0,htmlTag:"a",tmplName:"fromAddressSelectorTemplate/if",fn:{fn:function(n,t,i,r){var i=i||jsviews,f,e=i._tag,u="";return u+="                <a ",u+=(f=t.hlp("sutra")("Hotmail.Link"))!=r?f:"",u+='                     href="#"                     class="FromSelectorLink c_ml fam_c"                     onclick="try{$menu.create(event,0,{bindEnterKey: true});}catch(e){};return false"                     onmousedown="try{$menu.create(event,0,{bindEnterKey: true});}catch(e){};return false">                    <div>                        ',u+=e("if",t,this,[{tmpl:1,params:"IsFullCompose",props:{},args:[n.IsFullCompose]},{tmpl:2,params:"",props:{},args:[]}]),u+="                    <\/div>                <\/a>                <ul ",u+=(f=t.hlp("sutra")("dropdownmenu"))!=r?f:"",u+=' class="c_m t_hovl">                    ',u+=e("for",t,this,1),u+"                <\/ul>            "}}},{tmpls:[{tmpls:[],links:{},tags:{},bnds:[{fn:function(n){return[{tmpl:0,params:'SenderDetails tmpl="#fromAddressHeaderTemplate"',props:{tmpl:"#fromAddressHeaderTemplate"},args:[n.SenderDetails]}]},paths:["SenderDetails"],_ctxs:"for"}],_is:"template",allowCode:!0,htmlTag:"span",tmplName:"fromAddressSelectorTemplate/else/if",fn:{fn:function(n,t,i){var i=i||jsviews,u=i._tag,r="";return r+='                    <span class="FromUserTile"><\/span>                    ',r+=u("for",t,this,1),r+"                "}}},{tmpls:[],links:{},tags:{},bnds:[{fn:function(n){return[{tmpl:0,params:'SenderDetails tmpl="#inlineFromAddressHeaderTemplate"',props:{tmpl:"#inlineFromAddressHeaderTemplate"},args:[n.SenderDetails]}]},paths:["SenderDetails"],_ctxs:"for"}],_is:"template",allowCode:!0,htmlTag:"",tmplName:"fromAddressSelectorTemplate/else/else",fn:{fn:function(n,t,i){var i=i||jsviews,u=i._tag,r="";return r+="                    ",r+=u("for",t,this,1),r+"                "}}}],links:{},tags:{},bnds:[],_is:"template",allowCode:!0,htmlTag:"span",tmplName:"fromAddressSelectorTemplate/else",fn:{fn:function(n,t,i){var i=i||jsviews,u=i._tag,r="";return r+="                ",r+=u("if",t,this,[{tmpl:1,params:"IsFullCompose",props:{},args:[n.IsFullCompose]},{tmpl:2,params:"",props:{},args:[]}]),r+"            "}}}],links:{},tags:{},bnds:[{fn:function(n,t){return[{tmpl:1,params:"~composeVm.HasMultipleAddresses",props:{},args:[t.hlp("composeVm").HasMultipleAddresses]},{tmpl:2,params:"",props:{},args:[]}]},paths:["~composeVm.HasMultipleAddresses"],_ctxs:"else"}],_is:"template",allowCode:!0,tmplName:"fromAddressSelectorTemplate",htmlTag:"div",fn:{fn:function(n,t,i,r){var i=i||jsviews,f,e=i._tag,u="";return u+="    <div ",u+=(f=t.hlp("sutra")("fromselector"))!=r?f:"",u+=' class="Row From">        <div class="fromAddrMenu">            ',u+=e("if",t,this,1),u+"        <\/div>    <\/div>"}}},n["#composeOptionsTemplate"]={tmpls:[{tmpls:[],links:{},tags:{},bnds:[],_is:"template",allowCode:!0,htmlTag:"ul",tmplName:"composeOptionsTemplate/if",fn:{fn:function(n,t,i){var i=i||jsviews;return'        <ul id="rteMode" class="ComposeOptions OptMenu"><\/ul>        <span class="c_ms"><\/span>    '}}}],links:{},tags:{},bnds:[],_is:"template",allowCode:!0,tmplName:"composeOptionsTemplate",htmlTag:"ul",fn:{fn:function(n,t,i){var i=i||jsviews,u=i._tag,r="";return r+="    ",r+=u("if",t,this,[{tmpl:1,params:"!~ol.config.compose.useTextareaRte ",props:{},args:[!t.hlp("ol").config.compose.useTextareaRte]}]),r+'    <ul id="msgPriority" class="ComposeOptions OptMenu"><\/ul>'}}},n["#composeOptionsListTemplate"]={tmpls:[{tmpls:[],links:{},tags:{},bnds:[],_is:"template",allowCode:!0,htmlTag:"li",tmplName:"composeOptionsListTemplate/for",fn:{fn:function(n,t,i,r){var i=i||jsviews,f,e=i.converters.html,u="";return u+="        <li ",u+=(f=t.hlp("sutra")(n.SutraTag))!=r?f:"",u+=" >            <a ",u+=(f=t.hlp("sutra")("Hotmail.Link"))!=r?f:"",u+='                 href="#"                 title="',u+=(f=n.Tooltip)!=r?f:"",u+='"                 data-link="class{:~getSelectedClass(#data, #parent.parent.data.SelectedItem)}">                ',u+=(f=t.hlp("ol").config.compose.radioButtonHtml)!=r?f:"",u+='                <span class="Caption">',u+=e(n.Text),u+"<\/span>            <\/a>        <\/li>    "}}}],links:{},tags:{},bnds:[{fn:function(n){return[{tmpl:1,params:"Items",props:{},args:[n.Items]}]},paths:["Items"],_ctxs:"for"}],_is:"template",allowCode:!0,tmplName:"composeOptionsListTemplate",htmlTag:"li",fn:{fn:function(n,t,i){var i=i||jsviews,u=i._tag,r="";return r+="    ",r+=u("for",t,this,1),r+""}}},n["#MeetingRequestTemplate"]={tmpls:[{tmpls:[],links:{},tags:{},bnds:[{fn:function(n){return{params:"action",props:{},args:[n.action]}},paths:["action"],_ctxs:"getMeetingRequestAction:"}],_is:"template",allowCode:!0,htmlTag:"div",tmplName:"MeetingRequestTemplate/if",fn:{fn:function(n,t,i,r){var i=i||jsviews,f,e=i._cnvt,u="";return u+='        <div class="meetingRequestHeader slideOnResize">            <div class="MeetRes When">                <span class="Label">                    ',u+=(f=t.hlp("ol").GetString("MeetingRequest.When"))!=r?f:"",u+='                <\/span>                <span class="Content">',u+=(f=n.time)!=r?f:"",u+='<\/span>            <\/div>            <div class="MeetRes Loc">                <span class="Label">                    ',u+=(f=t.hlp("ol").GetString("MeetingRequest.Location"))!=r?f:"",u+='                <\/span>                <span class="Content">',u+=(f=n.location)!=r?f:"",u+='<\/span>            <\/div>            <div class="MeetRes Action">                <span class="Label">                    ',u+=(f=t.hlp("ol").GetString("MeetingRequest.Action"))!=r?f:"",u+='                <\/span>                <span class="Content">',u+=e("getMeetingRequestAction",t,1),u+"<\/span>            <\/div>        <\/div>    "}}}],links:{},tags:{},bnds:[{fn:function(n){return[{tmpl:1,params:"#data",props:{},args:[n]}]},paths:["#data"],_ctxs:"if"}],_is:"template",allowCode:!0,tmplName:"MeetingRequestTemplate",htmlTag:"div",fn:{fn:function(n,t,i){var i=i||jsviews,u=i._tag,r="";return r+="    ",r+=u("if",t,this,1),r+""}}},n["#composeTemplate"]={tmpls:[{tmpls:[],links:{},tags:{},bnds:[],_is:"template",allowCode:!0,htmlTag:"span",tmplName:"composeTemplate/if",fn:{fn:function(n,t,i,r){var i=i||jsviews,f,u="";return u+='                    <span class="InlineCommandHeader">                        <a href="#" class="switchToFull" title="',u+=(f=t.hlp("ol").GetString("EditMessage.GoToFullCompose"))!=r?f:"",u+='" aria-label="',u+=(f=t.hlp("ol").GetString("EditMessage.GoToFullCompose"))!=r?f:"",u+='" data-link="class{getSwitchToFullClass: ~tag.IsSending}" ',u+=(f=t.hlp("sutra")("switchtofull"))!=r?f:"",u+'>                            <img src="./clear.gif" class="i_comp_f" ><\/img>                        <\/a>                    <\/span>              '}}},{tmpls:[],links:{},tags:{},bnds:[{fn:function(n){return{params:"DraftSavedLabel",props:{},args:[n.DraftSavedLabel]}},paths:["DraftSavedLabel"],_ctxs:">"},{fn:function(n,t){return[{tmpl:0,params:'~sutraTag="subjectfield"                                   ~autocomplete="off"                                   ~spellCheck="true"                                   ~name="fSubject"                                   ~className=~tag.SubjectClassName                                   ~maxLength=~ol.config.compose.maxSubjectLength                                   ~ariaLabel=~ol.GetString("Accessibility.MessageSubjectLabel")                                   ~placeholder=~ol.GetString("EditMessage.Subject")                                   ~data=#data                                   ~propertyName="Subject"                               ',props:{},ctx:{sutraTag:"subjectfield",autocomplete:"off",spellCheck:"true",name:"fSubject",className:t.hlp("tag").SubjectClassName,maxLength:t.hlp("ol").config.compose.maxSubjectLength,ariaLabel:t.hlp("ol").GetString("Accessibility.MessageSubjectLabel"),placeholder:t.hlp("ol").GetString("EditMessage.Subject"),data:n,propertyName:"Subject"},args:[]}]},paths:[],_ctxs:"watermarkedInputControl"}],_is:"template",allowCode:!0,htmlTag:"div",tmplName:"composeTemplate/if",fn:{fn:function(n,t,i,r){var i=i||jsviews,f,e=i._tag,o=i._cnvt,u="";return u+='                          <div class="DraftArea" ',u+=(f=t.hlp("sutra")("saveddraftdialog"))!=r?f:"",u+="><p>",u+=o("html",t,1),u+='<\/p><\/div>                          <div class="SubjectArea TextLightI">                              ',u+=e("watermarkedInputControl",t,this,2),u+"                          <\/div>                      "}}},{tmpls:[],links:{},tags:{},bnds:[{fn:function(n,t){return[{tmpl:0,params:"~data=Attachments ~options=~tag.carouselOptions() ~thread=#data ",props:{},ctx:{data:n.Attachments,options:t.hlp("tag").carouselOptions(),thread:n},args:[]}]},paths:[],_ctxs:"carouselControl"}],_is:"template",allowCode:!0,htmlTag:"",tmplName:"composeTemplate/if",fn:{fn:function(n,t,i){var i=i||jsviews,u=i._tag,r="";return r+="                        ",r+=u("carouselControl",t,this,1),r+"                    "}}},{tmpls:[],links:{},tags:{},bnds:[{fn:function(n){return[{tmpl:0,params:"~data=#data ",props:{},ctx:{data:n},args:[]}]},paths:[],_ctxs:"rteContextMenuControl"}],_is:"template",allowCode:!0,htmlTag:"",tmplName:"composeTemplate/if",fn:{fn:function(n,t,i){var i=i||jsviews,u=i._tag,r="";return r+="                          ",r+=u("rteContextMenuControl",t,this,1),r+"                      "}}},{tmpls:[],links:{},tags:{},bnds:[],_is:"template",allowCode:!0,htmlTag:"div",tmplName:"composeTemplate/if",fn:{fn:function(n,t,i){var i=i||jsviews,u=i._cnvt,r="";return r+='                  <div class="showQuotedTextContainer">                    <a href="#" class="showQuotedText" title=\'',r+=u("attr",t,{params:'~ol.GetString("EditMessage.ShowQuotedText")',props:{},args:[t.hlp("ol").GetString("EditMessage.ShowQuotedText")]}),r+='\'>                      <img src="./clear.gif" class="i_comp_m" />                      <span>',r+=u("attr",t,{params:'~ol.GetString("EditMessage.ShowQuotedText")',props:{},args:[t.hlp("ol").GetString("EditMessage.ShowQuotedText")]}),r+"<\/span>                    <\/a>                  <\/div>                  "}}},{tmpls:[],links:{},tags:{},bnds:[{fn:function(n){return[{tmpl:0,params:"~data=Attachments.ShareSkyDriveFiles ~thread=#data ",props:{},ctx:{data:n.Attachments.ShareSkyDriveFiles,thread:n},args:[]}]},paths:[],_ctxs:"shareSkyDriveControl"}],_is:"template",allowCode:!0,htmlTag:"",tmplName:"composeTemplate/if",fn:{fn:function(n,t,i){var i=i||jsviews,u=i._tag,r="";return r+="            ",r+=u("shareSkyDriveControl",t,this,1),r+"        "}}},{tmpls:[],links:{},tags:{},bnds:[{fn:function(n){return[{tmpl:0,params:"~data=Attachments ",props:{},ctx:{data:n.Attachments},args:[]}]},paths:[],_ctxs:"silverlightUploaderControl"}],_is:"template",allowCode:!0,htmlTag:"",tmplName:"composeTemplate/if",fn:{fn:function(n,t,i){var i=i||jsviews,u=i._tag,r="";return r+="            ",r+=u("silverlightUploaderControl",t,this,1),r+"        "}}}],links:{},tags:{},bnds:[{fn:function(n){return[{tmpl:0,params:"~data=#data ",props:{},ctx:{data:n},args:[]}]},paths:[],_ctxs:"fromAddressSelectorControl"},{fn:function(n){return[{tmpl:0,params:"~data=#data ",props:{},ctx:{data:n},args:[]}]},paths:[],_ctxs:"contactPickerManagerControl"},{fn:function(n,t){return[{tmpl:0,params:"~data=~tag.rteToolbarVm ~thread=#data",props:{},ctx:{data:t.hlp("tag").rteToolbarVm,thread:n},args:[]}]},paths:[],_ctxs:"rteToolbarControl"},{fn:function(n){return[{tmpl:0,params:'MeetingRequestInfo tmpl="#MeetingRequestTemplate"',props:{tmpl:"#MeetingRequestTemplate"},args:[n.MeetingRequestInfo]}]},paths:["MeetingRequestInfo"],_ctxs:"for"},{fn:function(n,t){return[{tmpl:0,params:"~data=#data ~toolbar=~tag.rteToolbarVm ~isVisible=~tag.isComposeVisible() ",props:{},ctx:{data:n,toolbar:t.hlp("tag").rteToolbarVm,isVisible:t.hlp("tag").isComposeVisible()},args:[]}]},paths:[],_ctxs:"rteControl"},{fn:function(n,t){return[{tmpl:4,params:"~ol.delayLoadedControls.rteContextMenuControl && ~tag.rteContextMenuControlNeeded",props:{},args:[t.hlp("ol").delayLoadedControls.rteContextMenuControl&&t.hlp("tag").rteContextMenuControlNeeded]}]},paths:["~ol.delayLoadedControls.rteContextMenuControl","~tag.rteContextMenuControlNeeded"],_ctxs:"if"},{fn:function(n){return[{tmpl:5,params:"!IsFullCompose && !QuotedTextShown",props:{},args:[!n.IsFullCompose&&!n.QuotedTextShown]}]},paths:["IsFullCompose","QuotedTextShown"],_ctxs:"if"},{fn:function(n,t){return[{tmpl:6,params:"~ol.delayLoadedControls.shareSkyDriveControl && Attachments.ShareSkyDriveFiles",props:{},args:[t.hlp("ol").delayLoadedControls.shareSkyDriveControl&&n.Attachments.ShareSkyDriveFiles]}]},paths:["~ol.delayLoadedControls.shareSkyDriveControl","Attachments.ShareSkyDriveFiles"],_ctxs:"if"},{fn:function(n,t){return[{tmpl:7,params:"~ol.BrowserCapabilities.useSilverlightUploader() && ~ol.delayLoadedControls.silverlightUploaderControl",props:{},args:[t.hlp("ol").BrowserCapabilities.useSilverlightUploader()&&t.hlp("ol").delayLoadedControls.silverlightUploaderControl]}]},paths:["~ol.BrowserCapabilities.useSilverlightUploader","~ol.delayLoadedControls.silverlightUploaderControl"],_ctxs:"if"}],_is:"template",allowCode:!0,tmplName:"composeTemplate",htmlTag:"div",fn:{fn:function(n,t,i,r){var i=i||jsviews,e,f=i._tag,o=i._cnvt,u="";return u+='    <div id="',u+=(e=t.hlp("tag").ControlNamespace)!=r?e:"",u+='" class="',u+=o("getComposeClass",t,{params:"IsFullCompose",props:{},args:[n.IsFullCompose]}),u+='" ',u+=(e=t.hlp("sutra")("composecontrol"))!=r?e:"",u+='>        <div class="ComposeArea">            <div class="',u+=o("getComposeHeaderClass",t,{params:"IsFullCompose",props:{},args:[n.IsFullCompose]}),u+='" ',u+=(e=t.hlp("sutra")("composeheader"))!=r?e:"",u+=">                ",u+=f("if",t,this,[{tmpl:1,params:"!IsFullCompose",props:{},args:[!n.IsFullCompose]}]),u+="              <div>                    ",u+=f("fromAddressSelectorControl",t,this,1),u+="                    ",u+=f("contactPickerManagerControl",t,this,2),u+='                <\/div>            <\/div>            <div class="ComposeContent" ',u+=(e=t.hlp("sutra")("composecontent"))!=r?e:"",u+='>                <div class="ComposeContentHeader">                    <div class="Subject">                        ',u+=f("if",t,this,[{tmpl:2,params:"IsFullCompose",props:{},args:[n.IsFullCompose]}]),u+="                    <\/div>                    ",u+=f("if",t,this,[{tmpl:3,params:"~ol.BrowserCapabilities.fileSelect ",props:{},args:[t.hlp("ol").BrowserCapabilities.fileSelect]}]),u+="                    ",u+=f("rteToolbarControl",t,this,3),u+="                    ",u+=f("for",t,this,4),u+='                <\/div>                <div class="composeRteBox">                  <div class="ComposeMessage carouselSmooth slideOnResize">                      ',u+='                      <label for="fMessageBody" class="NoDisplay">',u+=(e=t.hlp("ol").GetString("Accessibility.MessageBodyLabel"))!=r?e:"",u+="<\/label>                      ",u+=f("rteControl",t,this,5),u+="                      ",u+=f("if",t,this,6),u+="                  <\/div>                  ",u+=f("if",t,this,7),u+="                <\/div>            <\/div>        <\/div>        ",u+=f("if",t,this,8),u+="        ",u+=f("if",t,this,9),u+"    <\/div>"}}},n["#rteToolbarTemplate"]={tmpls:[{tmpls:[{tmpls:[],links:{},tags:{},bnds:[{fn:function(n){return[{tmpl:0,params:"~data=#data ",props:{},ctx:{data:n},args:[]}]},paths:[],_ctxs:"rteToolbarMenuControl"}],_is:"template",allowCode:!0,htmlTag:"",tmplName:"rteToolbarTemplate/for/if",fn:{fn:function(n,t,i){var i=i||jsviews,u=i._tag,r="";return r+="                        ",r+=u("rteToolbarMenuControl",t,this,1),r+"                    "}}},{tmpls:[],links:{},tags:{},bnds:[{fn:function(n){return[{tmpl:0,params:"~data=#data",props:{},ctx:{data:n},args:[]}]},paths:[],_ctxs:"hyperlinkControl"}],_is:"template",allowCode:!0,htmlTag:"",tmplName:"rteToolbarTemplate/for/else",fn:{fn:function(n,t,i){var i=i||jsviews,u=i._tag,r="";return r+="                        ",r+=u("hyperlinkControl",t,this,1),r+"                    "}}},{tmpls:[],links:{},tags:{},bnds:[{fn:function(n){return[{tmpl:0,params:"~data=#data ",props:{},ctx:{data:n},args:[]}]},paths:[],_ctxs:"emojiPickerFlyoutControl"}],_is:"template",allowCode:!0,htmlTag:"",tmplName:"rteToolbarTemplate/for/else",fn:{fn:function(n,t,i){var i=i||jsviews,u=i._tag,r="";return r+="                        ",r+=u("emojiPickerFlyoutControl",t,this,1),r+"                    "}}},{tmpls:[],links:{},tags:{},bnds:[{fn:function(n){return[{tmpl:0,params:"~data=#data",props:{},ctx:{data:n},args:[]}]},paths:[],_ctxs:"rteToolbarItemControl"}],_is:"template",allowCode:!0,htmlTag:"",tmplName:"rteToolbarTemplate/for/else",fn:{fn:function(n,t,i){var i=i||jsviews,u=i._tag,r="";return r+="                        ",r+=u("rteToolbarItemControl",t,this,1),r+"                    "}}}],links:{},tags:{},bnds:[],_is:"template",allowCode:!0,htmlTag:"",tmplName:"rteToolbarTemplate/for",fn:{fn:function(n,t,i){var i=i||jsviews,u=i._tag,r="";return r+="                    ",r+=u("if",t,this,[{tmpl:1,params:'(ButtonType === "menu" || ButtonType === "colormenu")',props:{},args:[n.ButtonType==="menu"||n.ButtonType==="colormenu"]},{tmpl:2,params:'ButtonType === "hyperlink"',props:{},args:[n.ButtonType==="hyperlink"]},{tmpl:3,params:'ButtonType === "EmojiPickerFlyout" ',props:{},args:[n.ButtonType==="EmojiPickerFlyout"]},{tmpl:4,params:"",props:{},args:[]}]),r+"                "}}}],links:{},tags:{},bnds:[],_is:"template",allowCode:!0,tmplName:"rteToolbarTemplate",htmlTag:"div",fn:{fn:function(n,t,i,r){var i=i||jsviews,f,e=i._tag,u="";return u+='    <div class="RteToolbar">        <div class="ButtonList" unselectable="on" ',u+=(f=t.hlp("sutra")("rtetoolbar"))!=r?f:"",u+=">            <ul>                ",u+=e("for",t,this,[{tmpl:1,params:"ToolbarItems",props:{},args:[n.ToolbarItems]}]),u+"            <\/ul>        <\/div>    <\/div>"}}},n["#rteToolbarItemTemplate"]={tmpls:[{tmpls:[],links:{},tags:{},bnds:[],_is:"template",allowCode:!0,htmlTag:"span",tmplName:"rteToolbarItemTemplate/if",fn:{fn:function(n,t,i,r){var i=i||jsviews,f,u="";return u+="                <span>                    ",u+=(f=t.hlp("ol").GetString(n.Character))!=r?f:"",u+"                <\/span>            "}}},{tmpls:[],links:{},tags:{},bnds:[],_is:"template",allowCode:!0,htmlTag:"div",tmplName:"rteToolbarItemTemplate/else",fn:{fn:function(n,t,i,r){var i=i||jsviews,f,u="";return u+='                <div>                    <img unselectable="on" src="',u+=(f=t.hlp("toolbarStrip")())!=r?f:"",u+'"/>                <\/div>            '}}}],links:{},tags:{},bnds:[],_is:"template",allowCode:!0,tmplName:"rteToolbarItemTemplate",htmlTag:"li",fn:{fn:function(n,t,i,r){var i=i||jsviews,f,e=i._tag,u="";return u+="    <li ",u+=(f=t.hlp("sutra")(n.Sutra))!=r?f:"",u+=' data-link="class{stateClass: State Name ButtonType} css-display{:~isItemVisible(IsVisible)}" id="',u+=(f=t.hlp("tag").ControlNamespace)!=r?f:"",u+='">        <a title="',u+=(f=t.hlp("ol").GetShortcutString(n.TitleString,n.ShortcutAction))!=r?f:"",u+='" class="',u+=(f=n.IconType)!=r?f:"",u+='" unselectable="on" href="#" aria-label="',u+=(f=t.hlp("ol").GetShortcutString(n.TitleString,n.ShortcutAction))!=r?f:"",u+='" tabindex="-1">            ',u+=e("if",t,this,[{tmpl:1,params:'IconType === "TextIcon"',props:{},args:[n.IconType==="TextIcon"]},{tmpl:2,params:"",props:{},args:[]}]),u+"        <\/a>    <\/li>"}}},n["#rteToolbarMenuTemplate"]={tmpls:[{tmpls:[{tmpls:[],links:{},tags:{},bnds:[{fn:function(n){return[{tmpl:0,params:"#data tmpl=Template",props:{tmpl:n.Template},args:[n]}]},paths:["#data","Template"],_ctxs:"for"}],_is:"template",allowCode:!0,htmlTag:"",tmplName:"rteToolbarMenuTemplate/if/for",fn:{fn:function(n,t,i){var i=i||jsviews,u=i._tag,r="";return r+="                    ",r+=u("for",t,this,1),r+"                "}}}],links:{},tags:{},bnds:[],_is:"template",allowCode:!0,htmlTag:"ul",tmplName:"rteToolbarMenuTemplate/if",fn:{fn:function(n,t,i,r){var i=i||jsviews,f,e=i._tag,u="";return u+='            <ul class="',u+=(f=t.hlp("tag").menuTypeClass())!=r?f:"",u+='" ',u+=(f=t.hlp("sutra")(n.Menu.SutraTag))!=r?f:"",u+=">                ",u+=e("for",t,this,[{tmpl:1,params:"Menu.Items",props:{},args:[n.Menu.Items]}]),u+"            <\/ul>        "}}}],links:{},tags:{},bnds:[{fn:function(n,t){return[{tmpl:1,params:"~tag.MenuNeeded",props:{},args:[t.hlp("tag").MenuNeeded]}]},paths:["~tag.MenuNeeded"],_ctxs:"if"}],_is:"template",allowCode:!0,tmplName:"rteToolbarMenuTemplate",htmlTag:"li",fn:{fn:function(n,t,i,r){var i=i||jsviews,f,e=i._tag,u="";return u+="    <li ",u+=(f=t.hlp("sutra")(n.Sutra))!=r?f:"",u+=' class="',u+=(f=n.Name)!=r?f:"",u+='" id="',u+=(f=t.hlp("tag").ControlNamespace)!=r?f:"",u+='" data-link="css-display{:~isItemVisible(IsVisible)}">        <a title="',u+=(f=t.hlp("ol").GetShortcutString(n.TitleString,n.ShortcutAction))!=r?f:"",u+='" aria-label="',u+=(f=t.hlp("ol").GetShortcutString(n.TitleString,n.ShortcutAction))!=r?f:"",u+='" class="ImageIcon c_ml" unselectable="on" href="#" tabindex="-1">            <div>                <img unselectable="on" src="',u+=(f=t.hlp("toolbarStrip")())!=r?f:"",u+='"/>            <\/div>        <\/a>        ',u+=e("if",t,this,1),u+"    <\/li>"}}},n["#rteToolbarMenuItemTemplate"]={tmpls:[],links:{},tags:{},bnds:[],_is:"template",allowCode:!0,tmplName:"rteToolbarMenuItemTemplate",htmlTag:"li",fn:{fn:function(n,t,i,r){var i=i||jsviews,f,e=i._cnvt,o=i.converters.html,u="";return u+="    <li ",u+=(f=t.hlp("sutra")(n.SutraTag))!=r?f:"",u+=' data-link="class{stateClass: IsSelected}">        <a unselectable="on" href="#" title="',u+=e("attr",t,{params:"Tooltip",props:{},args:[n.Tooltip]}),u+='" class="menuLinkItem" key="',u+=e("attr",t,{params:"Key",props:{},args:[n.Key]}),u+='">            ',u+=(f=t.hlp("ol").config.compose.radioButtonHtml)!=r?f:"",u+='            <span class="Caption" style="',u+=e("attr",t,{params:"InlineStyle",props:{},args:[n.InlineStyle]}),u+='">',u+=o(n.Text),u+"<\/span>        <\/a>    <\/li>"}}},n["#rteToolbarColorItemTemplate"]={tmpls:[],links:{},tags:{},bnds:[],_is:"template",allowCode:!0,tmplName:"rteToolbarColorItemTemplate",htmlTag:"li",fn:{fn:function(n,t,i,r){var i=i||jsviews,f,u="";return u+="    <li ",u+=(f=t.hlp("sutra")(n.SutraTag))!=r?f:"",u+=' class="Swatch sw',u+=(f=n.Key)!=r?f:"",u+='">        <a href="#"           class="menuLinkItem"            style="background-color:#',u+=(f=n.Key)!=r?f:"",u+='"            color="',u+=(f=n.Key)!=r?f:"",u+'">            &nbsp;        <\/a>    <\/li>'}}},n["#carouselTemplate"]={tmpls:[{tmpls:[],links:{},tags:{},bnds:[{fn:function(n){return[{tmpl:0,params:"data=#data ",props:{data:n},args:[]}]},paths:["#data"],_ctxs:"carouselItemControl"}],_is:"template",allowCode:!0,htmlTag:"",tmplName:"carouselTemplate/for",fn:{fn:function(n,t,i){var i=i||jsviews,u=i._tag,r="";return r+="                        ",r+=u("carouselItemControl",t,this,1),r+"                    "}}},{tmpls:[{tmpls:[],links:{},tags:{},bnds:[{fn:function(n){return[{tmpl:0,params:"#data tmpl=Template",props:{tmpl:n.Template},args:[n]}]},paths:["#data","Template"],_ctxs:"for"}],_is:"template",allowCode:!0,htmlTag:"",tmplName:"carouselTemplate/if/for",fn:{fn:function(n,t,i){var i=i||jsviews,u=i._tag,r="";return r+="                ",r+=u("for",t,this,1),r+"            "}}}],links:{},tags:{},bnds:[{fn:function(n,t){return[{tmpl:1,params:"~tag.Menu.Items",props:{},args:[t.hlp("tag").Menu.Items]}]},paths:["~tag.Menu.Items"],_ctxs:"for"}],_is:"template",allowCode:!0,htmlTag:"ul",tmplName:"carouselTemplate/if",fn:{fn:function(n,t,i,r){var i=i||jsviews,f,e=i._tag,u="";return u+='        <ul class="c_m t_hovl" ',u+=(f=t.hlp("sutra")(t.hlp("tag").Menu.SutraTag))!=r?f:"",u+=">            ",u+=e("for",t,this,1),u+"        <\/ul>        "}}}],links:{},tags:{},bnds:[{fn:function(n){return[{tmpl:1,params:"RegularFiles",props:{},args:[n.RegularFiles]}]},paths:["RegularFiles"],_ctxs:"for"},{fn:function(n,t){return[{tmpl:2,params:"~tag.MenuNeeded",props:{},args:[t.hlp("tag").MenuNeeded]}]},paths:["~tag.MenuNeeded"],_ctxs:"if"}],_is:"template",allowCode:!0,tmplName:"carouselTemplate",htmlTag:"div",fn:{fn:function(n,t,i,r){var i=i||jsviews,f,e=i._tag,u="";return u+='    <div id="',u+=(f=t.hlp("tag").ControlNamespace)!=r?f:"",u+='"         class="Attachments slideOnResize"         ',u+=(f=t.hlp("sutra")("htmlattachmentscontrol"))!=r?f:"",u+='         enabled="false"         data-link="enabled{:~tag.Initialized}">        <div class="carousel"             data-link="class{getCarouselClass: NumRegularFiles ~tag.Collapsed}">            <div data-link="class{getCarouselOptionsClass: NumRegularFiles}                            css-width{:~tag.Width}">                <a title="',u+=(f=t.hlp("ol").GetString("Carousel.ShowHideAttachments"))!=r?f:"",u+='"                   class="carouselCollapser"                   ',u+=(f=t.hlp("sutra")("htmlexpandcollapse"))!=r?f:"",u+=">                    <div style=\"background-image:url('",u+=(f=t.hlp("ol").config.compose.imageSpritePath)!=r?f:"",u+='\')"                         data-link="class{getCollapserCssClass: ~tag.Collapsed NumRegularFiles}">                    <\/div>                <\/a>                <span class="carouselStats"                      ',u+=(f=t.hlp("sutra")("htmluploadinfopane"))!=r?f:"",u+='                      data-link="{:~tag.getUploadProgressMessage(NumRegularFiles, ~tag.NumUploadsInProgress)}">                <\/span>            <\/div>            <div class="carouselListContainer transitionOnHeightChange">                <a class="DisplayNone carouselScroller carouselPrevButton carouselSmooth sprite flipper_left_rest"                   ',u+=(f=t.hlp("sutra")("htmlscrollleft"))!=r?f:"",u+="                   style=\"background-image:url('",u+=(f=t.hlp("ol").config.compose.imageSpritePath)!=r?f:"",u+='\');" href="#">                <\/a>                <a class="DisplayNone carouselScroller carouselNextButton carouselSmooth sprite flipper_right_rest"                   ',u+=(f=t.hlp("sutra")("htmlscrollright"))!=r?f:"",u+="                   style=\"background-image:url('",u+=(f=t.hlp("ol").config.compose.imageSpritePath)!=r?f:"",u+='\');" href="#">                <\/a>                <ul ',u+=(f=t.hlp("sutra")("htmluploadedfiles"))!=r?f:"",u+='                    class="carouselList carouselSmooth">                    ',u+=e("for",t,this,1),u+='                <\/ul>            <\/div>            <form class="DisplayNone zeroSize" action="" method="post" enctype="application/octet-stream">                <input type="submit" name="submit" value="Submit" />            <\/form>            <div class="Content carouselForm">                <div id="fAttachments" class="AttachmentUpload">                    ',u+='                    <input id="isFirstPL" name="isFirstPL" value="isFirstPL" style="display:none" type="text"/>                    <iframe class="DisplayNone ClearLeft" scrolling="no" frameborder="0" src="javascript:\'\';"><\/iframe>                <\/div>            <\/div>        <\/div>        ',u+=e("if",t,this,2),u+"    <\/div>"}}},n["#carouselItemTemplate"]={tmpls:[{tmpls:[],links:{},tags:{},bnds:[],_is:"template",allowCode:!0,htmlTag:"img",tmplName:"carouselItemTemplate/if",fn:{fn:function(n,t,i){var i=i||jsviews;return'                    <img data-link="src{getBackgroundImage: SpriteClass Src HasThumbnail IsImage false)}"/>                '}}}],links:{},tags:{},bnds:[{fn:function(n){return{params:"Name",props:{},args:[n.Name]}},paths:["Name"],_ctxs:">"}],_is:"template",allowCode:!0,tmplName:"carouselItemTemplate",htmlTag:"li",fn:{fn:function(n,t,i,r){var i=i||jsviews,f,e=i._tag,o=i._cnvt,u="";return u+='    <li id="',u+=(f=t.hlp("tag").ControlNamespace)!=r?f:"",u+='"        class="carouselItem c_ml"        ',u+=(f=t.hlp("sutra")("htmluploadedfileitem"))!=r?f:"",u+='        data-link="        title{getItemTooltip: Name Size}        css-opacity{:~tag.Opacity}"        aria-haspopup="true">        <div class="carouselItemWrapper carouselSmooth" data-link="            class{getCarousellItemWrapperCssClass: ItemErrorMessage}            css-width{getItemDimension: \'item\' Width HasThumbnail SpriteClass Src ItemErrorMessage Height}            css-background-color{:Color}">            <div data-link="                class{getItemCssClass: SpriteClass HasThumbnail}                css-display{getImageDisplay: ItemErrorMessage}                css-margin-top{getIconMarginTop: SpriteClass HasThumbnail Height}                css-margin-left{getIconMarginLeft: SpriteClass HasThumbnail Height}                css-background-image{getBackgroundImage: SpriteClass Src HasThumbnail IsImage true}                css-height{getItemDimension: \'image\' Height HasThumbnail SpriteClass Src ItemErrorMessage Height}                css-width{getItemDimension: \'image\' Width HasThumbnail SpriteClass Src ItemErrorMessage Height}">                ',u+=e("if",t,this,[{tmpl:1,params:"~ol.isHighContrast()",props:{},args:[t.hlp("ol").isHighContrast()]}]),u+='            <\/div>            <div class="DisplayNone carouselItemError"                    ',u+=(f=t.hlp("sutra")("htmluploaderror"))!=r?f:"",u+='                data-link="                title{:ItemErrorMessage}                class{getErrorCssClass: \'carouselItemError\' ItemErrorMessage}                {getItemErrorMessageTruncated: ItemErrorMessage}">            <\/div>            <div data-link="                title{getItemTooltip: Name Size}                class{getCaptionCssClass: IsImage HasError EnableThumbnails}">                <p class="captionText"                    ',u+=(f=t.hlp("sutra")("htmlhoverfilename"))!=r?f:"",u+=">                    ",u+=o("html",t,1),u+='                <\/p>            <\/div>            <div class="progressBar t_brc carouselSmooth"                    ',u+=(f=t.hlp("sutra")("htmluploadprogressbar"))!=r?f:"",u+'                data-link="css-width{:UploadProgress}                css-max-width{:Width}                css-display{getUploadVisibility: UploadProgress ItemErrorMessage}">            <\/div>        <\/div>        <div class="carouselItemBorder"            data-link="            css-width{getItemDimension: \'border\' Width HasThumbnail SpriteClass Src ItemErrorMessage Height}            css-height{getItemDimension: \'border\' Height HasThumbnail SpriteClass Src ItemErrorMessage Height}">        <\/div>    <\/li>'}}}}(),function(n){"use strict";function r(t){var i=[],u,o,s,a,h,r,w;if(!t){u=ol.compose.composeVm.userFont(),i.push(new ol.vm.RTEToolbarItem({name:"Bold",sutra:"bold",iconType:"TextIcon",titleString:"RTE.Toolbar.Bold",character:"RTE.Toolbar.BoldCharacter",isAutoToggle:!1,buttonType:"toggle",shortcutAction:"bold",state:u.bold})),i.push(new ol.vm.RTEToolbarItem({name:"Italic",sutra:"italic",iconType:"TextIcon",titleString:"RTE.Toolbar.Italic",character:"RTE.Toolbar.ItalicsCharacter",isAutoToggle:!1,buttonType:"toggle",shortcutAction:"italic",state:u.italic})),i.push(new ol.vm.RTEToolbarItem({name:"Underline",sutra:"Underline",iconType:"TextIcon",titleString:"RTE.Toolbar.Underline",character:"RTE.Toolbar.UnderlineCharacter",isAutoToggle:!1,buttonType:"toggle",shortcutAction:"underline",state:u.underline}));var c=ol.config.compose.RTE,e=c.FONT_NAME,v=c.FONT_ORDER,f=[],l=v.length;for(r=0;r<l;r++)o=v[r],f.push(new ol.vm.MenuItem({key:e[o],text:e[o],sutraTag:"fontnamevalue",inlineStyle:"font-family: '{0}'".format(e[o]),template:"#rteToolbarMenuItemTemplate"}));var b=new ol.vm.Menu({sutraTag:"fontnameselectordropdown",items:f}),y=u.fontName.split(","),p="";for(s=0;s<y.length;s++)if(a=y[s].trim(),n.inArray(a,e)!==-1){p=a;break}for(i.push(new ol.vm.RTEToolbarItem({name:"FontName",sutra:"fontnameselector",iconType:"ImageIcon",titleString:"RTE.Toolbar.ShowFontNames",buttonType:"menu",shortcutAction:"showFontNames",menu:b,state:p,suffix:ol.config.compose.fallbackFontName?","+ol.config.compose.fallbackFontName:""})),h=c.FONT_SIZE,f=[],l=h.length,r=0;r<l;r++)f.push(new ol.vm.MenuItem({key:r+1,text:parseInt(h[r]),sutraTag:"fontsizevalue",template:"#rteToolbarMenuItemTemplate"}));w=new ol.vm.Menu({sutraTag:"fontsizeselectordropdown",items:f}),i.push(new ol.vm.RTEToolbarItem({name:"FontSize",sutra:"fontsizeselector",iconType:"ImageIcon",titleString:"RTE.Toolbar.ShowFontSizes",buttonType:"menu",shortcutAction:"showFontSizes",menu:w,state:n.inArray(u.fontSize,h)+1})),i.push(new ol.vm.RTEToolbarItem({name:"FGColor",sutra:"fontcolorselector",iconType:"ImageIcon",titleString:"RTE.Toolbar.ShowFontColors",buttonType:"colormenu",shortcutAction:"showFontColors",prefix:"#",menu:new ol.vm.Menu({sutraTag:"fontcolorselectordropdown",items:[new ol.vm.MenuItem({sutraTag:"fontcoloritem",template:"#rteToolbarColorItemTemplate",key:"8C0095"}),new ol.vm.MenuItem({sutraTag:"fontcoloritem",template:"#rteToolbarColorItemTemplate",key:"FFFFFF"}),new ol.vm.MenuItem({sutraTag:"fontcoloritem",template:"#rteToolbarColorItemTemplate",key:"5133AB"}),new ol.vm.MenuItem({sutraTag:"fontcoloritem",template:"#rteToolbarColorItemTemplate",key:"E1C404"}),new ol.vm.MenuItem({sutraTag:"fontcoloritem",template:"#rteToolbarColorItemTemplate",key:"2672EC"}),new ol.vm.MenuItem({sutraTag:"fontcoloritem",template:"#rteToolbarColorItemTemplate",key:"D24726"}),new ol.vm.MenuItem({sutraTag:"fontcoloritem",template:"#rteToolbarColorItemTemplate",key:"008A17"}),new ol.vm.MenuItem({sutraTag:"fontcoloritem",template:"#rteToolbarColorItemTemplate",key:"AC193D"}),new ol.vm.MenuItem({sutraTag:"fontcoloritem",template:"#rteToolbarColorItemTemplate",key:"000000"}),new ol.vm.MenuItem({sutraTag:"fontcoloritem",template:"#rteToolbarColorItemTemplate",key:"666666"})],state:u.fontColor})})),i.push(new ol.vm.RTEToolbarItem({name:"BGColor",sutra:"fontbackgroundselector",iconType:"ImageIcon",titleString:"RTE.Toolbar.ShowHighlightColors",shortcutAction:"showHighlightColors",buttonType:"colormenu",prefix:"#",menu:new ol.vm.Menu({sutraTag:"fontbackgroundselectordropdown",items:[new ol.vm.MenuItem({sutraTag:"fontbackgrounditem",template:"#rteToolbarColorItemTemplate",key:"00FFFF"}),new ol.vm.MenuItem({sutraTag:"fontbackgrounditem",template:"#rteToolbarColorItemTemplate",key:"FFFFFF"}),new ol.vm.MenuItem({sutraTag:"fontbackgrounditem",template:"#rteToolbarColorItemTemplate",key:"0000FF"}),new ol.vm.MenuItem({sutraTag:"fontbackgrounditem",template:"#rteToolbarColorItemTemplate",key:"99CCFF"}),new ol.vm.MenuItem({sutraTag:"fontbackgrounditem",template:"#rteToolbarColorItemTemplate",key:"00FF00"}),new ol.vm.MenuItem({sutraTag:"fontbackgrounditem",template:"#rteToolbarColorItemTemplate",key:"CCFFCC"}),new ol.vm.MenuItem({sutraTag:"fontbackgrounditem",template:"#rteToolbarColorItemTemplate",key:"FF00FF"}),new ol.vm.MenuItem({sutraTag:"fontbackgrounditem",template:"#rteToolbarColorItemTemplate",key:"FF99CC"}),new ol.vm.MenuItem({sutraTag:"fontbackgrounditem",template:"#rteToolbarColorItemTemplate",key:"FFFF00"}),new ol.vm.MenuItem({sutraTag:"fontbackgrounditem",template:"#rteToolbarColorItemTemplate",key:"FFFF99"})]})})),i.push(new ol.vm.RTEToolbarItem({name:"InsertOrderList",sutra:"insertorderedlist",iconType:"ImageIcon",titleString:"RTE.Toolbar.InsertNumberedList",shortcutAction:"insertNumberedList"})),i.push(new ol.vm.RTEToolbarItem({name:"InsertUnOrderList",sutra:"insertunorderedlist",iconType:"ImageIcon",titleString:"RTE.Toolbar.InsertBulletedList",shortcutAction:"insertBulletedList"})),i.push(new ol.vm.RTEToolbarItem({name:"Outdent",sutra:"outdent",iconType:"ImageIcon",titleString:"RTE.Toolbar.Outdent",shortcutAction:"outdent"})),i.push(new ol.vm.RTEToolbarItem({name:"Indent",sutra:"indent",iconType:"ImageIcon",titleString:"RTE.Toolbar.Indent",shortcutAction:"indent"})),i.push(new ol.vm.RTEToolbarItem({name:"JustifyLeft",sutra:"justifyleft",iconType:"ImageIcon",titleString:"RTE.Toolbar.JustifyLeft",shortcutAction:"justifyLeft"})),i.push(new ol.vm.RTEToolbarItem({name:"JustifyCenter",sutra:"justifycenter",iconType:"ImageIcon",titleString:"RTE.Toolbar.JustifyCenter",shortcutAction:"justifyCenter"})),i.push(new ol.vm.RTEToolbarItem({name:"JustifyRight",sutra:"justifyright",iconType:"ImageIcon",titleString:"RTE.Toolbar.JustifyRight",shortcutAction:"justifyRight"})),i.push(new ol.vm.RTEToolbarItem({name:"InsertLink",sutra:"insertlink",iconType:"ImageIcon",titleString:"RTE.Toolbar.InsertLink",buttonType:"hyperlink",state:"http://",shortcutAction:"insertLink"})),ol.config.compose.emojiPicker.enablePicker&&i.push(new ol.vm.RTEToolbarItem({name:"Emo",sutra:"emoticonpicker",iconType:"ImageIcon",buttonType:"EmojiPickerFlyout",titleString:"RTE.Toolbar.EmojiPicker",isPlainTextCapable:!0,shortcutAction:"emojiPicker"}))}return{toolbarItems:i}}var t=window.ol=window.ol||{},u=t.vm=t.vm||{},e=t.data=t.data||{},f=u.RTEToolbar=function(n){var i=this,r,t;for(i.initAccessorValues(n),i._buttonMap={},r=0;r<i.ToolbarItems.length;r++)t=i.ToolbarItems[r],i._buttonMap[t.Name]=t,t.Menu&&n&&(t.Menu.EdgeOffsetFunction=n.edgeOffsetFunction),n&&(t.IsVisible=t.IsPlainTextCapable||n.currentTextMode===ol.vm.Compose.TextModes.RichText)},i=f.prototype;ol.AddOptionsAccessorAndInitFunctions(i,r),i.buttonState=function(n,t){return this._buttonMap[n].state(t)},ol.AddOptionsAccessorAndInitFunctions(i,r)}(window.originaljQuery||window.jQuery),function(){"use strict";function r(){return{name:"",sutra:"",iconType:"",titleString:"",isAutoToggle:!1,buttonType:null,character:"",menu:null,isPlainTextCapable:!1,state:null,shortcutAction:null,suffix:"",prefix:"",isVisible:!1}}var n=window.ol=window.ol||{},i=n.vm=n.vm||{},u=i.RTEToolbarItem=function(n){var t=this;t.initAccessorValues(n),n.state&&t.state(n.state)},t=u.prototype;ol.AddOptionsAccessorAndInitFunctions(t,r),t.state=function(n){var t,i;if(n!==undefined&&n!==""&&this.Menu)for(t=0;t<this.Menu.Items.length;t++)i=this.Menu.Items[t],i.isSelected(n===i.Key);return ol.Accessor(this,"State",n)}}(),function(n){"use strict";var r=window,t=r.ol,e=t.getContextObject,o=t.pages,u=r.HM,i=r.wLive,f=i&&i.Animations,s=i&&i.Controls.Notifications;o.Compose=function(){function l(){return t.compose.composeVm}function a(){return n.templates("#composePageTemplate")}function v(){return n.extend({isComposeVisible:y,isPortraitLayout:function(){return h.isPortraitLayout()}},e())}function y(){return c.getCurrentView()===t.config.pageManager.manifests.Compose.name}var r=this,o=null,h=null,i=null,c=null;r.render=function(){return a().render(l(),v())},r.initialize=function(n,r){o=n,c=r,h=l();var u=n.link(a(),h,v());i=t.findChildTag(u.view(!0),"composeControl")[0]},r.dispose=function(){},r.getHistoryState=function(){var n={},i=h.thread(),r=i.composeData(),f,e;return r&&r.MessageId&&(n.cmid=r.MessageId),f=i.id(),e=i.composeActionType(),n.cdid=e===u.MessageActionType.ResumeDraft&&!t.data.isTemporaryId(f)?f:"",n.cacc=e,n},r.onRestoreFromHistory=function(n){var i=!!n.cdid,r=t.Cmd("begincomposesession").fire({action:t.compose.GetActionFromActionType(parseInt(n.cacc,10)),respondingItemId:i?n.cdid:n.cmid,needToComputeFriendshipCache:!0,skipHistory:!0,curView:t.Instrumentation.currentView(),numParticipants:0,priority:u.InstrumentationPriority.Normal,entryPoint:u.InstrumentationEntryPoint.Other,isFullCompose:!0})},r.onBeforeNavigateTo=function(r,u){var f=n.Deferred();this._resizePage=n.proxy(i.resizePage,i);n(window).on("resize",this._resizePage);if(t.TouchUtil.isOrientationSupported())n(window).on("orientationchange",this._resizePage);return f.resolve({context:u})},r.onNavigateTo=function(n,t){n&&!t.isInitialPage&&f.enterContent(o),i.linked.then(function(){i.hasSetFocus(!1),i.gainComposeControl(t.args.initialState),t.args.prePopulatedBody&&i.toggleRTEPlaceholder(!1)})},r.getOnBeforeUnloadString=function(){return i.getOnBeforeUnloadString()},r.onBeforeNavigateFrom=function(r){function l(s){if(s&&(!s.buttonClicked||s.buttonClicked==="alternate"))u.reject({context:r});else{e||i.endComposeSession({messageDeleted:!!h,dontNavigate:!0}),n(window).off("resize",c._resizePage),t.TouchUtil.isOrientationSupported()&&n(window).off("orientationchange",c._resizePage);var l;l=a?f.flyAway(o,{top:-o.outerHeight(),left:0}):n.when(),l.then(function(){u.resolve({context:r})})}}var u=n.Deferred();r=r.args;var a=r&&r.messageSent,e=r&&r.composeCompleted,v=r&&r.messageDeleted,h=i.isDirty()||i.isDraftAutoSaved(),c=this;return y()&&h&&!e&&!v?(u.notify({context:r}),s.createModalDialog({title:"",content:t.GetString("EditMessage.NotSavedWarning"),buttons:{action:t.GetString("EditMessage.NotSavedAction"),alternate:t.GetString("EditMessage.NotSavedCancel")}}).show().then(l)):l(),u.promise()},r.onNavigateFrom=function(){i.loseComposeControl()}}}(window.originaljQuery||window.jQuery),function(n,t){"use strict";var e="composeTemplate",y=window,i=window.wLive.Controls.Notifications,r=n.config.compose,o=t(window),s=960,f={};f[HM.MessageActionType.Accept]="EditMessage.AcceptAction",f[HM.MessageActionType.Tentative]="EditMessage.TentativeAction",f[HM.MessageActionType.Decline]="EditMessage.DeclineAction";var h=["importance","attachmentIds","from","to","cc","bcc","composeMessageBody"],c=["subject"],l=150,u=wLive&&wLive.Animations,a=t.templates(null,{markup:"#"+e,converters:{getMeetingRequestAction:function(t){return n.GetString(f[t])},getComposeClass:function(n){return n?"":"inlineCompose Portrait"},getComposeHeaderClass:function(n){return"ComposeHeader "+(n?"t_sbgc":"")},getDisplay:function(n){return n?"block":"none"},getSwitchToFullClass:function(n){return n?"NoDisplay":"switchToFull"}}}),v={templateId:e,template:a,attr:"html",init:function(i){var r=this,u,f;r.ControlNamespace=n.createControlNamespace(r.tagName),r.isComposeVisible=i.ctx.isComposeVisible||function(){return r.linked.isResolved()},r.composeVm=i.ctx.composeVm,u=$B.IE&&($B.V===9||$B.V===10),f=!u||!$B.rtl,r.SubjectClassName="fSubject t_subj "+(f?"TextLightI":""),r._onComposeActionHandler=t.proxy(r._onComposeAction,this)},render:function(){var i=this;return i.controls={},i._initialState={},i.linked=t.Deferred(),i.thread=i.tagCtx.props.thread,i._isInImeCompositionMode=!1,i.rteContextMenuControlNeeded=!1,i.rteToolbarVm=new n.vm.RTEToolbar({edgeOffsetFunction:i.ctx.calculateEdgeOffsets,currentTextMode:i.thread.textMode()}),i._performEmptySubjectCheck=i.thread.isFullCompose(),i._performForgottenAttachmentCheck=!0,i.tagCtx.render(i.thread,{isMeetingRequestResponse:function(n){return n===HM.MessageActionType.Accept||n===HM.MessageActionType.Tentative||n===HM.MessageActionType.Decline},adjustMenuPosition:function(n,i){if(i){var r=t(i).scrollTop();n.top+=r,n.bottom+=r}return n}})},_getControl:function(t){var i=this;return t==="rteContextMenuControl"&&n.Accessor(this,"rteContextMenuControlNeeded",!0),i.controls[t]||(i.controls[t]=n.findChildTag(i,t)[0]),i.controls[t]},_setImmediate:function(n,t){var i=this;return t=t||0,setTimeout(function(){i.disposed||n()},t)},_safeSetInterval:function(n,t){var i=this;return setInterval(function(){i.disposed||n()},t)},onAfterLink:function(){var i=this,r=i.contents(),f=!i.thread.isFullCompose(),e,o;i._$composeHeader=r.find(".ComposeHeader").first(),i._$composeContent=r.find(".ComposeContent").first(),i._$composeContentHeader=r.find(".ComposeContentHeader").first(),i._$composeMessage=r.find(".ComposeMessage").first(),i._$composeArea=r.find(".ComposeArea").first(),i._$composeContainer=i._$composeArea.parent(),i._$composeContainer.focusin(function(){i.hasSetFocus(!0)}),f&&i.gainComposeControl();r.on("click",".switchToFull",t.proxy(i._switchToFullClick,i));r.on("click",".showQuotedText",t.proxy(i._showQuotedText,i));r.on("click",function(n){n.stopPropagation()});if(f){e=u.expand(i._$composeContainer),n.Cmd("compose.controlready").bubble(i,{$element:_$ge(i.ControlNamespace),animationPromise:e}),i.composeVm.finishInlineReplyRender({thread:i.thread});r.on("focus",".Row.To",function(){i._toggleContactPickerFocusBorder(!0,0,".Row.To")}).on("blur",".Row.To",function(){i._toggleContactPickerFocusBorder(!1,0,".Row.To")}).on("focus",".Row.CC",function(){i._toggleContactPickerFocusBorder(!0,1,".Row.CC")}).on("blur",".Row.CC",function(){i._toggleContactPickerFocusBorder(!1,1,".Row.CC")}).on("focus",".Row.BCC",function(){i._toggleContactPickerFocusBorder(!0,2,".Row.BCC")}).on("blur",".Row.BCC",function(){i._toggleContactPickerFocusBorder(!1,2,".Row.BCC")})}o=i._getControl("contactPickerManagerControl"),o.adjustAll(),i.linked.resolve()},_toggleRteFocusBorder:function(n){var i=this,r,u;i.disposed||i.thread.isFullCompose()||(r=n?"addClass":"removeClass",u=i.contents(),u.find(".RteToolbar, .composeRteBox")[r]("composeFocus"),n&&t(".neighborComposeFocus").removeClass("neighborComposeFocus"))},_toggleContactPickerFocusBorder:function(n,i,r){var e=this,u,f,o,s;e.disposed||(u=n?"addClass":"removeClass",f=e.contents(),f.find(r)[u]("composeFocus"),n&&t(".neighborComposeFocus").removeClass("neighborComposeFocus"),o=e._getControl("contactPickerManagerControl"),s=e._getControl("carouselControl"),o&&s&&(o.showCc()&&i<1?f.find(".Row.CC")[u]("neighborComposeFocus"):o.showBcc()&&i<2?f.find(".Row.BCC")[u]("neighborComposeFocus"):s.height()>0&&i<3?f.find(".carousel")[u]("neighborComposeFocus"):i<4&&f.find(".RteToolbar")[u]("neighborComposeFocus")))},_changeControlState:function(n){for(var u=this,f=["silverlightUploaderControl","rteControl","carouselControl","shareSkyDriveControl"],t,e,r,i=0;i<f.length;i++)t=u._getControl(f[i]),t&&(e=u.composeVm.keyboardHandler(),r=n?t.gainControl:t.loseControl,r&&r.call(t,e))},gainComposeControl:function(r){var u=this,e,f;u._haveControl||u.disposed||(e=!u.thread.isFullCompose(),n.Cmd("keyboardhandler.enable").fire({value:!0,page:n.config.pageManager.manifests.Compose.name}),u._haveControl=!0,n.Cmd("composecommandbar.update").fire({thread:u.thread}),n.Cmd("compose.action").subscribe(u._onComposeActionHandler),u._changeControlState(!0),u._autoSaveStartTick(),n.Cmd("composecommandbar.show").fire(),n.Cmd("inboxcommandbar.hide").bubble(u,{}),e&&n.config.compose.inlineReply.showInlineReplyBubble?(f=u._getControl("rteControl"),f.togglePlaceholder(!0),f.readyPromise().then(function(){var r=t(".switchToFull");r[0]&&(n.config.compose.inlineReply.showInlineReplyBubble=!1,i.createFlyout({content:n.GetString("EditMessage.InlineReply.Fre"),anchor:r[0],options:{bubble:4}}).show(),n.Dispatcher.fireCmd("dismissinlinereplybubble",{}))})):u._setInitialFocus(),u.resizePage(!0),u.thread.isFullCompose()||(u._doBlockCmd=t.proxy(u.blockCmds,u),n.Cmd.registerExecutionStrategy(u._doBlockCmd,!0)),r?u._initialState=r:u._updateInitialState(!0))},loseComposeControl:function(t){var i=this;i._haveControl&&(i._doBlockCmd&&(n.Cmd.unregisterExecutionStrategy(i._doBlockCmd,!0),i._doBlockCmd=null),t||(n.Cmd("composecommandbar.hide").fire(),n.Cmd("composecommandbar.sendingstate").fire({value:!1}),n.Cmd("inboxcommandbar.show").bubble(i,{})),n.Cmd("compose.action").unsubscribe(i._onComposeActionHandler),i._changeControlState(!1),n.Cmd("keyboardhandler.enable").fire({value:!1,page:n.config.pageManager.manifests.Compose.name}),i._haveControl=!1)},getOnBeforeUnloadString:function(){var i=null,t=this;return(t.isDirty()||t.isDraftAutoSaved()||t.thread.Attachments.isUploading())&&(i=n.GetString("EditMessage.NotSavedWarning")),i},_onComposeAction:function(i){var r=this,u;if(r.linked.isResolved()&&!r._pendingSwitchToFullClick&&r._haveControl)switch(i.action){case"sendMsg":case"sendMsg2":case"sendmessage":r._sendMessage(i.entryPoint);break;case"attachfiles":r._cleanupInlineAttachments(),r._getControl("carouselControl").addFile(i.event,!1);break;case"attachinline":r._cleanupInlineAttachments(),r._getControl("carouselControl").addFile(i.event,!0);break;case"shareskydrive":u=r._getControl("rteControl"),u.readyPromise().pipe(function(){return u.initializeShareSkyDrive()}).pipe(function(){var n=r._getControl("shareSkyDriveControl");n&&n.openPicker()});break;case"saveDraft":case"savedraft":r._saveDraft(!1,i.entryPoint);break;case"spellCheck":case"spellcheck":n.Cmd("instrument.spellcheck").fire({entryPoint:HM.InstrumentationEntryPoint.CommandBar,isFullCompose:r.thread.isFullCompose()}),r._getControl("rteControl").spellCheck();break;case"cancelMsg":case"cancelmessage":r._cancelMessage(i.entryPoint);break;case"showAddressBook":r._focusOnCP("to","#toCP")(i.event);break;case"showFontNames":case"showFontSizes":case"showFontColors":case"showHighlightColors":case"insertLink":case"insertNumberedList":case"insertBulletedList":case"outdent":case"indent":case"justifyLeft":case"justifyRight":case"justifyCenter":case"emojiPicker":if(r.thread.isFullCompose()||t(document.activeElement).attr("id")==="ComposeRteEditor_surface"){r._getControl("rteControl").onToolbarAction(i);r._getControl("rteToolbarControl").onToolbarAction(i)}}},_cleanupInlineAttachments:function(){this._getControl("rteControl").cleanupInlineAttachments()},resizePage:function(t){var i=this;i._resizeThrottleId&&clearTimeout(i._resizeThrottleId),i._resizeThrottleId=i._setImmediate(function(){i.thread.isFullCompose()?(i._onRteContentSizeChange(),i.isComposeVisible()&&(o.width()<=s?(i.isPortraitLayout(!0),i._$composeMessage.removeClass("carouselSmooth"),i._$composeContainer.addClass("Portrait"),i._setImmediate(function(){i._$composeContent.css("top",i._$composeHeader.outerHeight()),i._$composeContent.addClass("slideOnResize"),i._$composeMessage.addClass("carouselSmooth")})):i.isPortraitLayout()&&(i.isPortraitLayout(!1),i._$composeContent.removeClass("slideOnResize"),i._$composeMessage.removeClass("carouselSmooth"),i._$composeContainer.removeClass("Portrait"),i._$composeContent.css("top",0),i._setImmediate(function(){i._$composeMessage.addClass("carouselSmooth")})),i._getControl("carouselControl")&&i._getControl("carouselControl").onResize(),i._resizeComposeHeader(t),n.Cmd("composecommandbar.redraw").fire()),i._resizeThrottleId=null):(i._$composeMessage.removeClass("carouselSmooth"),i._onRteContentSizeChange(),i._setImmediate(function(){i._$composeMessage.addClass("carouselSmooth")}))},50)},_resizeComposeHeader:function(n){var i=this;if(i.isComposeVisible()){try{var r=i._getControl("carouselControl")&&i._getControl("carouselControl").initialized()?i._getControl("carouselControl").height():0,u=i._getControl("carouselControl")&&i._getControl("carouselControl").initialized()?t(".carousel").height():0,f=i._$composeContentHeader.position().top+i._$composeContentHeader.height()-u+r;n&&(i._$composeMessage.removeClass("slideOnResize"),i._$composeMessage.removeClass("carouselSmooth")),i._$composeMessage.css("top",f),n&&i._setImmediate(function(){i._$composeMessage.addClass("slideOnResize"),i._$composeMessage.addClass("carouselSmooth")})}catch(e){return}i._setImmediate(function(){i._getControl("contactPickerManagerControl").refreshLayout(i.isPortraitLayout())})}},onCmdBubble:function(t,i,r){var u=this,f,e,o;switch(i.name){case"compose.resize":return u.resizePage(),!1;case"rte.toolbaraction":u._getControl("rteControl").onRteToolbarAction(t,r);return!1;case"rte.insertcontent":return u._getControl("rteControl").insertContent(r.content),!1;case"rte.click":return $menu.closeAll(),u._getControl("contactPickerManagerControl").hideAllContactPickers(),!1;case"rte.dragover":u._getControl("carouselControl").onDragOver(r.event);return!1;case"rte.drop":u._getControl("carouselControl").onDrop(r.event);return!1;case"rte.paste":u._getControl("carouselControl").onPaste(r.event);return!1;case"rte.givefocus":return u._focusOnRte(),!1;case"rte.focus":return u._toggleRteFocusBorder(!0),!1;case"rte.blur":return u._toggleRteFocusBorder(!1),!1;case"carousel.heightchange":return u._resizeComposeHeader(),!1;case"rte.ready":return u._getControl("carouselControl").numberInlineImages(u._getControl("rteControl").numberInlineImages()),!1;case"rte.showcontextmenu":return f=u._getControl("rteContextMenuControl"),f&&f.show(r.event,r.position),!1;case"rte.scroll":return f=u._getControl("rteContextMenuControl"),f&&f.close(),!1;case"compose.skydriverehydrated":u._getControl("shareSkyDriveControl").onRehydrate();break;case"rte.setbody":return u._getControl("rteControl").setBody(r.value),!1;case"rte.keypress":if(n.c.EmojiPickerControl)n.c.EmojiPickerControl.onKeyPress(u,u.thread,r.event);return!1;case"rte.contenteditable":return u._getControl("rteControl").contentEditable(r.value),!1;case"rte.compositionstart":return u._isInImeCompositionMode=!0,!1;case"rte.compositionend":u._isInImeCompositionMode=!1;case"rte.selectionchange":case"rte.inlineimageresize":case"rte.keydown":return u._onRteContentSizeChangeThrottled(),!1;case"rte.cleanupinlineimages":return u._cleanupInlineAttachments(),!1;case"skydrive.contextmenu":if(e=u._getControl("shareSkyDriveControl"),e)e.onContextMenuAction(r);return!1;case"compose.controlready":if(u._haveControl&&t.gainControl&&(o=u.composeVm.keyboardHandler(),t.gainControl(o)),t!==u)return!1}},_setInitialFocusImpl:function(){var t=this,i,f,u,r;t.hasSetFocus()||(i=t.thread.composeActionType(),i===HM.MessageActionType.Reply||i===HM.MessageActionType.ReplyAll||i===HM.MessageActionType.ResumeDraft?(f=t._getControl("rteControl"),u=[f.readyPromise()],i===HM.MessageActionType.ResumeDraft&&u.push(t.thread.isComposeDataReady()),n.deferredUtils.whenAll(u).then(function(){t._focusOnRte()})):(r=t._getControl("contactPickerManagerControl"),r&&r.focusOn(r.contactPickerType.to)))},_setInitialFocus:function(){var n=this;n._setImmediate(function(){n._setInitialFocusImpl()})},isSending:function(t){return t?(n.Cmd("composecommandbar.hide").fire(),n.Cmd("composecommandbar.sendingstate").fire({value:!0})):n.Cmd("composecommandbar.show").fire(),n.Accessor(this,"IsSending",t)},hasSetFocus:function(n){return n!==undefined&&(this._hasSetFocus=n),this._hasSetFocus},isPortraitLayout:function(n){return this.thread.isFullCompose()?this.composeVm.isPortraitLayout(n):!0},carouselOptions:function(){var n=this,t=n.composeVm.InitContext;return{maxUploadBytes:parseInt(t.maxUploadBytes),maxUploadFileCount:parseInt(t.maxUploadFileCount),inlineImageHostSelector:"#"+n.ControlNamespace+" .ComposeMessage"}},_saveDraft:function(i,r){var u=this,f;return u._savingDraftPromise?u._savingDraftPromise:u._sendingPromise?u._sendingPromise:i&&!u.isDirty()?t.when():(u._savingDraftPromise=t.Deferred(),u._autoSaveStopTick(),u.thread.draftSavedLabel(n.GetString("EditMessage.DraftSaveInProgress")),f=u.thread.Attachments.processingDeferred(),f.always(function(){u._updateMessageThreadFromLegacyControls(),u.thread.saveDraft(i,r).then(function(n,t){var r=t[0];r?u._saveDraftOnSuccess(r,i):u._saveDraftOnError()},function(){u._saveDraftOnError()})}),u._savingDraftPromise.promise())},_saveDraftOnSuccess:function(t,i){var u=this,f;t.draftId!==null&&(u._isDraftAutoSaved=i,u._updateInitialState()),t.savedTime&&u.thread.draftSavedLabel(n.GetString(u.thread.isFullCompose()?"EditMessage.DraftSavedFormat":"EditMessage.SavedAtFormat").format(t.savedTime)),t.isAutoSaveEnabled?(r.interval=Math.abs(r.autoSaveDraft.interval),u._autoSaveStartTick()):r.autoSaveDraft.interval=Math.abs(r.autoSaveDraft.interval)*-1,f=u._savingDraftPromise,u._savingDraftPromise=null,f.resolve()},_saveDraftOnError:function(){var n=this,t=n._savingDraftPromise;n._savingDraftPromise=null,t.reject()},_updateInitialState:function(n){var t=this,i,r;t._initialState={importance:t.thread.importance(),subject:t.thread.subject(),attachmentIds:t.thread.attachmentIds(),from:t.thread.from()},i=t._getControl("contactPickerManagerControl").getContactPickerValues(!1),t._initialState.to=i&&i.To||"",t._initialState.cc=i&&i.Cc||"",t._initialState.bcc=i&&i.Bcc||"",r=t._getControl("rteControl"),r.readyPromise().then(function(){n?t._setImmediate(function(){t._initialState.composeMessageBody=r.getValue()},0):t._initialState.composeMessageBody=r.getValue()})},_updateMessageThreadFromLegacyControls:function(t,i){var r=this,f,s,e,u,o;if(n.Cmd("compose.updatingthread").bubble(r),f=r._getControl("watermarkedInputControl"),f&&f.triggerChangeEvent(),s=r._getControl("rteControl"),r.thread.ComposeMessageBody=s.getValue(i),e=r._getControl("contactPickerManagerControl"),e&&(u=e.getContactPickerValues(t),u))for(o in u)r.thread[o]=u[o].replace(/[()]/g,"")},isDirty:function(){var n=this,u,t,i,r,f;if(n._updateMessageThreadFromLegacyControls(),u=n._getControl("contactPickerManagerControl"),u&&u.areAnyContactPickersDirty())return!0;for(t=h,n.thread.isFullCompose()&&(t=t.concat(c)),i=0;i<t.length;i++)if(r=t[i],f=$B.Firefox&&r==="composeMessageBody"&&n._initialState.composeMessageBody===""&&n.thread.composeMessageBody()==="<br>",!f&&n.thread[r]()!==n._initialState[r])return!0;return!1},_cancelDraft:function(i){var r=this;return r.disposed?t.when():r._getDraftDonePromise().pipe(function(){return r.thread.isFullCompose()?t.when():u.collapse(r._$composeContainer,u.Direction.Vertical)}).pipe(function(){r.thread.isFullCompose()||(r._$composeContainer.addClass("NoDisplay"),n.Cmd("compose.hiding").bubble(r));var u=r.thread.draftId();return r._isDraftAutoSaved=!1,r.loseComposeControl(),u?n.Cmd("deletedraft").fire({thread:r.thread,entryPoint:i}).deferred:t.when()})},_supportsAutoSave:function(){var n=this;return n.thread.ComposeActionType!==HM.MessageActionType.Accept&&n.thread.ComposeActionType!==HM.MessageActionType.Decline&&n.thread.ComposeActionType!==HM.MessageActionType.Tentative},_autoSaveStartTick:function(){var t=parseInt(r.autoSaveDraft.interval),n=this;n._supportsAutoSave()&&t>0&&!n._autoSaveIntervalID&&(n._autoSaveIntervalID=n._safeSetInterval(function(){n._saveDraft(!0,HM.InstrumentationEntryPoint.Other)},t*6e4))},_autoSaveStopTick:function(){var n=this;n._autoSaveIntervalID>0&&clearInterval(n._autoSaveIntervalID),n._autoSaveIntervalID=0},_getDraftDonePromise:function(){var n=t.Deferred();return t.when(this._savingDraftPromise).always(n.resolve),n.promise()},_cancelMessage:function(r){var u=this;u._cancellingMessage||(u._cancellingMessage=!0,u.isDirty()||u._isDraftAutoSaved?i.createFlyout({title:"",content:n.GetString("EditMessage.Cancel.DirtyWarning"),anchor:t("#CancelMessage")[0],buttons:{action:n.GetString("EditMessage.Cancel.DirtyAction"),alternate:n.GetString("EditMessage.Cancel.DirtyAlternate")}}).show().then(function(t){t.buttonClicked==="action"?u._saveDraft(!1,HM.InstrumentationEntryPoint.Notification).then(function(){u.endComposeSession({entryPoint:HM.InstrumentationComposeCancelAction.Save})}):t.buttonClicked==="alternate"?u._cancelDraft(r).always(function(){u.endComposeSession({messageDeleted:!0,entryPoint:HM.InstrumentationComposeCancelAction.Discard})}):(n.Cmd("instrument.escapecancelcomposesession").fire({messageSent:!1,cancelAction:HM.InstrumentationComposeCancelAction.Escape,entryPoint:HM.InstrumentationEntryPoint.Other}),u._cancellingMessage=!1)}):u.endComposeSession())},endComposeSession:function(i){var r,f,e,o;return i=i||{},i.messageSent=!!i.messageSent,i.messageDeleted=!!i.messageDeleted,r=this,f=!r.thread.isFullCompose(),r._autoSaveStopTick(),e=t.when(),o=!1,f&&!i.dontAnimateCompose&&(e=i.messageSent?u.flyAway(r._$composeContainer,{top:0,left:0}):u.collapse(r._$composeContainer,u.Direction.Vertical),o=!0),e.pipe(function(){if(o&&r._$composeContainer&&r._$composeContainer.addClass("NoDisplay"),$B.IE){var n=t("<input type='text' style='width:1px; height:1px'/>").appendTo(document.body).focus();t(document.body).focus(),n.remove()}return r.loseComposeControl(!!i.keepComposeCommandBar),r.thread.endCompose(i)}).pipe(function(){return r._cancellingMessage=!1,f?(i.messageSent&&n.Instrumentation.endCSIPerfScenario(),n.Dispatcher.fireCmd("refresh").deferred):t.when()})},_sendMessageImpl:function(n){var i=this;return i.disposed?t.Deferred().reject():(i._updateMessageThreadFromLegacyControls(!0),i.thread.sendMessage(i.composeVm.needToComputeFriendshipCache(),i._performForgottenAttachmentCheck,n))},_sendMessage:function(i){var r=this,f,u;r._sendingPromise||(f=t.Deferred(),n.Instrumentation.startCSIPerfScenario({performanceId:"S",deferred:f,tr:"sendmessage"}),r.isSending(!0),r._updateMessageThreadFromLegacyControls(!0),u=r._sendingPromise=t.Deferred(),r._checkForEmptyRecipients().pipe(t.proxy(r._checkForEmptySubject,r)).pipe(t.proxy(r._checkForTooLongRecipients,r)).pipe(t.proxy(r._checkForUploadingAttachments,r)).pipe(t.proxy(r._checkForAttachmentErrors,r)).pipe(t.proxy(r._prepareToSend,r)).pipe(t.proxy(r._getDraftDonePromise,r)).pipe(function(){return r._showInlineError(""),r._sendMessageImpl(i)}).pipe(function(n,t){return r._sendingPromise=null,u.resolve(n,t)},function(n,t){return r._sendingPromise=null,u.reject(n,t)}),u.then(function(n,t){f.resolve(),r._sendMessageSuccess(n,t)},function(n,t){f.reject(),r._sendMessageFailure(n,t,i)}),u.always(function(){n.Cmd("composecommandbar.sendingstate").fire({value:!1})}))},_sendMessageSuccess:function(n,t){var f=this,r,i,u;if(!f.disposed&&f._haveControl){for(r=null,i=0;i<t.length;i++)if(u=t[i],u.type===HM.DLReturnType.ServerErrorMessage){r=u;break}this.endComposeSession({messageSent:!0,potentialContacts:t[0].PotentialContacts||[],potentialSocialNetworkUpsellData:t[0].SocialInboxPotentialUpsellData||{},entryPoint:HM.InstrumentationEntryPoint.Other,serverErrorMessage:r})}},_showConfirmFADAlert:function(r){function e(t){var i=f.DoNotShow,e;i&&n.writeOption(u.composeVm.InitContext.fadDisableUrl),e=t.buttonClicked==="action",u._performForgottenAttachmentCheck=t.buttonClicked==="alternate"&&!i,e&&u._sendMessage(r)}var f={DoNotShow:!1},u=this;i.createModalDialog({title:n.GetString("EditMessage.AttachmentForgotten.Title"),content:t("<span><\/span>").link(t.templates("#ForgotAttachTmpl"),f,n.getContextObject()),buttons:{action:n.GetString("EditMessage.AttachmentForgotten.ActionButton"),alternate:n.GetString("EditMessage.AttachmentForgotten.Cancel")}}).show().then(e)},_sendMessageFailure:function(u,f,e){var s=this,h,c,o;if(!s.disposed&&s._haveControl&&(s.isSending(!1),f))for(h=0;h<f.length;h++)if(c=f[h],c&&c.type===HM.DLReturnType.FppError){o=c.fppError,o=o.Error||o,o&&(o.ErrorCode===r.forgotAttachErrCode?s._showConfirmFADAlert(e):t.inArray(o.ErrorCode,r.inlineErrCodes)>-1?s._showInlineError(o.Message):t.inArray(o.ErrorCode,r.hipErrCodes)>-1?i.createTopBar({content:o.Message,dismissalMode:i.BarDismissalMode.Explicit,buttons:{action:o.ErrorObj.YesCode?n.GetString("Error.EditMessage.UpgradeTierLinkText"):n.GetString("Error.Button.LearnMore"),close:n.GetString("Error.EditMessage.CloseHipError")}}).show().then(function(n){n.buttonClicked==="action"&&$BSI.navigateTo(o.ErrorObj.Link1,"_blank")}):i.createTopBar({content:o.Message,dismissalMode:i.BarDismissalMode.Timeout}).show());break}},_checkForEmptyRecipients:function(){var i=this,r=t.Deferred();return i.thread.To||i.thread.Cc||i.thread.Bcc?r.resolve():(i._showInlineError(n.GetString("Error.EditMessage.MessageAddressesMissing")),r.reject()),r.promise()},_checkForTooLongRecipients:function(){var i=this,r=t.Deferred(),u=n.config.compose.maxRecipientsLength;return i.thread.To&&i.thread.To.trim().length>u||i.thread.Cc&&i.thread.Cc.trim().length>u||i.thread.Bcc&&i.thread.Bcc.trim().length>u?(i._showInlineError(n.GetString("EditMessage.TooManyRecipients")),r.reject()):r.resolve(),r.promise()},_checkForEmptySubject:function(){var n=this,t=n._performEmptySubjectCheck&&!n.thread.Subject;return n._checkAndWarn(t,"EditMessage.SubjectMissing.Warning","EditMessage.SubjectMissing.Action","#SendMessage",function(){n._performEmptySubjectCheck=!1})},_checkForUploadingAttachments:function(){return this._checkAndWarn(this.thread.Attachments.isUploading(),"EditMessage.SendDuringUploadConfirmation","EditMessage.SendDuringUploadConfirmationAction","#SendMessage")},_checkForAttachmentErrors:function(){return this._checkAndWarn(this.thread.Attachments.haveAnyErrors(),"InlineImage.ErrorsInRTE","InlineImage.ErrorsInRTEAction","#InsertMenu")},_checkAndWarn:function(r,u,f,e,o){var s=t.Deferred();return r?i.createFlyout({title:"",content:n.GetString(u),anchor:t(e)[0],buttons:{action:n.GetString(f)}}).show().then(function(n){n.buttonClicked?(o&&o(),s.resolve()):s.reject()},s.reject):s.resolve(),s.promise()},_prepareToSend:function(){var i=this,n,r;return i.thread.Attachments.cleanupInlineImageErrors(),i._cleanupInlineAttachments(),n=null,r=i._getControl("shareSkyDriveControl"),r&&(n=r.generateLinks()),n||(n=t.when()),n.pipe(function(){var n=i._getControl("rteControl");return n.removeDataLinkBindings(),t.when()})},_showInlineError:function(n){var t=this._getControl("contactPickerManagerControl");t&&t.toInlineError(n)},_focusOnCP:function(n,t){var i=this;return function(r){var e=_$ge(i.ControlNamespace),f=e.find(t).is(":visible"),u;return f&&(u=i._getControl("contactPickerManagerControl"),u&&u.focusOn(u.contactPickerType[n]),r.preventDefault()),f}},_focusOn:function(n){var i=this;return function(r){var u=t(n,i._$composeContainer),f=u.is(":visible");return f&&(u.focus(),r.preventDefault()),f}},_focusOnRte:function(){this._getControl("rteControl").focus()},isDraftAutoSaved:function(){return this._isDraftAutoSaved},_onRteContentSizeChangeThrottled:function(){var n=this;n._contentSizeThrottleId&&clearTimeout(n._contentSizeThrottleId),n._contentSizeThrottleId=n._setImmediate(function(){n._onRteContentSizeChange()},l)},_onRteContentSizeChange:function(){var n=this,i;n.disposed||(i=n._getControl("rteControl"),i.rteBodyReady().then(function(){var e,o;if(!n._isInImeCompositionMode&&!n.disposed)try{var r=n._$composeMessage,f=n.isPortraitLayout(),s=!n.thread.isFullCompose()||f&&!i.isPlaceholderShown()&&i.containsContent();s?(e=r.outerHeight()+i.getFullContentHeight(),n.thread.isFullCompose()?f&&!i.isPlaceholderShown()&&r.css("min-height",e):r.css("height",e),n._resizeComposeHeader()):r.css("min-height",""),i.setContentOverflowHidden(f)}catch(u){o="_onRteContentSizeChange: Caught exception {0}".format(u&&u.message?u.message:u),HM.ReportError(o,t.noop)}}))},toggleRTEPlaceholder:function(n){var t=this._getControl("rteControl");t.togglePlaceholder(n)},blockCmds:function(i){var r=this,f,u;return i.name==="autorefresh"?(u=t.Deferred(),u.reject(),u):r._savingDraftPromise&&!i.settings.ignoreOnSave||r._sendingPromise&&!i.settings.ignoreOnSend?r._firstQueuedCmd?(u=t.Deferred(),u.reject(HM.createCommandResult({results:{statusText:"block during inline send/save"}}))):(f=r._savingDraftPromise||r._sendingPromise,r._firstQueuedCmd=i,f.then(function(){r._firstQueuedCmd=null}),f):(!i.settings.keepInlineCompose||i.settings.navigatesTo)&&!r.disposed?(r._saveDraftExitDeferred||(r._saveDraftExitDeferred=r.thread.Attachments.processingDeferred(),r.isDirty()&&(r._saveDraftExitDeferred=r._saveDraftExitDeferred.pipe(function(){return r._saveDraft(!0,HM.InstrumentationEntryPoint.Other)})),r._saveDraftExitDeferred=r._saveDraftExitDeferred.pipe(function(){var t={dontAnimateCompose:!0};switch(i.name){case"reply":case"replyall":case"forward":case"resumedraft":t.keepComposeCommandBar=!0;break;case"clickmsg":case"nav.container":n.Cmd("compose.clickaway").bubble(r,i)}return r.endComposeSession(t)})),r._saveDraftExitDeferred):void 0},_switchToFullClick:function(){var i=this,r;return i._pendingSwitchToFullClick||(i._pendingSwitchToFullClick=!0,r=i._savingDraftPromise||t.when(),r.pipe(function(){return i.thread.isComposeDataReady()}).pipe(function(){return i._getControl("carouselControl").inProcessedDeferred()}).pipe(function(){return i.thread.Attachments.processingDeferred()}).pipe(function(){i.loseComposeControl(!0),i._updateMessageThreadFromLegacyControls(!1,!0),n.Cmd("compose.switchtofull").fire({thread:i.thread,initialState:i._initialState})})),!1},_showQuotedText:function(){var n=this,t=n._getControl("rteControl");return n.thread.isComposeDataReady().pipe(function(){return t.readyPromise()}).pipe(function(){t.appendToBody(n.thread.quotedText()),n.thread.quotedText(""),n.thread.quotedTextShown(!0),n._onRteContentSizeChange()}),!1},onDispose:function(){var t=this;t._onComposeActionHandler&&n.Cmd("compose.action").unsubscribe(t._onComposeActionHandler),n.Cmd("compose.controldisposed").bubble(t),t.disposed=!0,t.controls=t._doBlockCmd=t._onComposeActionHandler=t._$composeHeader=t._$composeContent=t._$composeContentHeader=t._$composeMessage=t._$composeArea=t._$composeContainer=t._sendingPromise=null}};t.views.tags({composeControl:v})}(window.ol,window.originaljQuery||window.jQuery),function(n,t){"use strict";var i="contactPickerToTemplate",r={templateId:i,template:t.templates("#"+i),attr:"html",init:function(){},render:function(){return this.tagCtx.render()}};t.views.tags({contactPickerToControl:r})}(window.ol,window.originaljQuery||window.jQuery),function(n,t){"use strict";var i="contactPickerCcTemplate",r={templateId:i,template:t.templates("#"+i),attr:"html",init:function(){},render:function(){return this.tagCtx.render()}};t.views.tags({contactPickerCcControl:r})}(window.ol,window.originaljQuery||window.jQuery),function(n,t){"use strict";var i="contactPickerBccTemplate",r={templateId:i,template:t.templates("#"+i),attr:"html",init:function(){},render:function(){return this.tagCtx.render()}};t.views.tags({contactPickerBccControl:r})}(window.ol,window.originaljQuery||window.jQuery),function(n,t){"use strict";var u=window,y,r;u.Resize=u.Resize||{},y=u.Resize,u.wLive=u.wLive||{},r=u.wLive,r.Hotmail=r.Hotmail||{};var g=r.Hotmail,l=r.Animations,a=r.Controls.Notifications,v="contactPickerManagerTemplate",p=n.config.compose,f,o=[],s={maxLinesInAddressWell:3,numFrequentContactsShownLimit:5,contactListBottomMargin:80,excludeSelectedFromFrequentList:!0,toggleContactListTransitions:null},h=t.extend({},s,{maxLinesInAddressWell:2}),i=["to","cc","bcc"],e=["To","Cc","Bcc"],w=e,c={To:"To",Bcc:"BCC",Cc:"CC"},b=3,k=t.templates(null,{markup:"#"+v,converters:{getDisplay:function(n){return n?"block":"none"}}}),d={templateId:v,template:k,attr:"html",contactPickerType:{to:0,cc:1,bcc:2},init:function(t){var i=this;i.data=t.ctx.data,i.composeVm=t.ctx.composeVm,i.ControlNamespace=n.createControlNamespace(i.tagName),i.initContext=i.composeVm.initContext(),i._contactsDataModel=null,i._contactPickerModels={},i._contactPickers={},i._$contactPickerButtons={},i._isManagedUser=i.initContext.isManagedUser,i._usePicwForContactPicker=i.initContext.usePicwForContactPicker,i._showPicw=!i.initContext.hideNonContactPicw,i._verifyRecipientsCache={},i._inFlightVerify={},i._isPortraitLayoutCallback=t.ctx.isPortraitLayout||function(){return!0},i._isPortraitLayout=i._isPortraitLayoutCallback(),i.BccInlineError="",i.CcInlineError="",i.ToInlineError="",i.ShowBcc=!1,i.ShowCc=!1,i._isVisible=t.ctx.isVisible||function(){return!0},f=r.ContactList.ViewModels.ContactType,o[f.Person]=1,o[f.Category]=2,o[f.Group]=3,o[f.PicwEmail]=1,i._initializeContacts()},onAfterLink:function(){var n=this,i=n._$contents=n.contents();i.delegate(".showCc","click",t.proxy(n._showCcClick,n)),i.delegate(".showBcc","click",t.proxy(n._showBccClick,n)),n._initializeContactPickers([t.proxy(n.toInlineError,n),t.proxy(n.ccInlineError,n),t.proxy(n.bccInlineError,n)],n._isVisible),n._initializeContactPickerValues(),n.composeVm.PicwEmails&&n.setPicwContacts(n.composeVm.PicwEmails),t.observable.simpleOn(n.composeVm,"propertyChange."+n.ControlNamespace,function(t,i){i.path==="PicwEmails"&&n.setPicwContacts(i.value)}),t.observable.simpleOn(n.data,"propertyChange."+n.ControlNamespace,t.proxy(n._onPropertyChange,n))},render:function(){return this.tagCtx.render(this.data)},_initializeContacts:function(){var i=this,n,t;i._contactsDataModel=new r.ContactList.ViewModels.FlatContactsDataModel({createContactsFromUnmatchedPicwEmails:i._showPicw&&!i._isManagedUser}),n=r.ContactPickerV2.Controls.ContactPicker.ListMode,s.showContactListOnFocus=n.related,h.showContactListOnFocus=n.none,t={},t[n.none]=n.full,t[n.related]=n.full,t[n.full]=n.none,h.toggleContactListTransitions=t,s.enableRemoveButtonForModes=[n.related]},_resetContactPickerType:function(n){for(var r=this,t=r._contactPickerModels[n],i=t.selectedContacts().length;i>0;)t.deselectContactByIndex(0),i--},setPicwContacts:function(n){if(this._usePicwForContactPicker){n=n||[];var t=this;t._contactsDataModel.setPicwEmails(n)}},disposeContacts:function(){this._contactsDataModel&&(this._contactsDataModel.dispose(),this._contactsDataModel=null,this._verifyRecipientsCache={})},_initializeContactPickers:function(u,f){var e=this,a={allowFreeformEntry:!e._isManagedUser},c=r.ContactPickerV2,o=c.ViewModels.ContactPickerModel.Events,l=c.Controls.ContactPicker.Events;e._isPortraitLayout=e._isPortraitLayoutCallback(),t.each(i,function(i,r){var v=e._contactPickerModels[r]=new c.ViewModels.ContactPickerModel(e._contactsDataModel,a),p=e._$contactPickerButtons[r]=t(e.contents().find("."+r+"Btn")[0]),b=n.GetString("EditMessage.ContactPicker.{0}.AriaLabel".format(w[i])),y=e._contactPickers[r]=new c.Controls.ContactPicker(t("#"+r+"CP",e._$contents),v,t.extend({},s,e._isPortraitLayout?h:{},{$toggleButton:p,shouldRefreshLayoutCb:f,ariaLabel:b}));p.click(function(n){y.toggleContactList(),n.preventDefault()}),v.$.bind(o.selectedContacts,function(n,t){e._onContactsAdded(n,t),u[i]("")}),v.$.bind(o.editedContact,t.proxy(e._onContactEdited,e)),v.$.bind(o.refreshedContacts,t.proxy(e._resize,e)),v.$.bind(o.deselectedContacts,t.proxy(e._resize,e)),u&&u[i]&&v.$.bind(o.freeformContactRejected,function(n,t){e._onContactDenied(n,t,u[i])}),y.$.bind(l.userAction,t.proxy(e._onUserAction,e)),y.$.bind(l.removeContactListEntry,t.proxy(e._onRemoveContactListEntry,e)),y.$.bind(l.dragStart,t.proxy(e._onDragStart,e))})},hideAllContactPickers:function(){for(var u=this,r,t,n=0;n<i.length;n++)r=i[n],t=u._contactPickers[r],t.completeUserEntry(),t.hideContactList()},disposeContactPickers:function(){var n,u,r;if(!t.isEmptyObject(this._contactPickerModels)){for(n=this,u=0;u<i.length;u++)r=i[u],n._contactPickers[r]&&(n._contactPickers[r].$.unbind(),n._contactPickers[r].dispose(),n._contactPickers[r]=null),n._contactPickerModels[r]&&(n._contactPickerModels[r].dispose(),n._contactPickerModels[r]=null),n._$contactPickerButtons[r]&&(n._$contactPickerButtons[r].unbind(),n._$contactPickerButtons[r]=null);n._contactPickerModels={},n._contactPickers={},n._$contactPickerButtons={}}},refreshLayout:function(n){var e,r,u,f;if(!t.isEmptyObject(this._contactPickerModels))for(e=n!==this._isPortraitLayout,r=this,u=0;u<i.length;u++)f=i[u],r._contactPickers[f]&&(e?(r._isPortraitLayout=n,r._contactPickers[f].resetSettings(n?h:s)):r._contactPickers[f].refreshLayout())},focusOn:function(n){this._contactPickers[i[n]].setFocus()},_initializeContactPickerValues:function(){var n=this;t.each(i,function(t,i){var r=n.data[e[t]];r&&n._setContactPickerValue(i,r)})},_setContactPickerValue:function(n,t){var i=this;i._contactPickers[n].addFreeformSelection(t);switch(n){case"cc":i.showCc(!0);break;case"bcc":i.showBcc(!0)}},getContactPickerValues:function(n){var u=null,f,r,s,o,h,c;if(!t.isEmptyObject(this._contactPickers))for(u={},f=this,r=0;r<i.length;r++)s=i[r],n&&f._contactPickers[s].completeUserEntry(),o=f._contactPickerModels[s],h=o.selectedContacts(),n?(c=f._serializeContacts(h,o),u[e[r]]=c.join("; ")):u[e[r]]=o.serializeSelection();return u},_serializeContacts:function(n,t){for(var u=[],i,e,s,h,o,c,f=0;f<n.length;f++)if(i=n[f],e=i.displayName().replace(/"/g,'\\"'),i.isGroup())u.push('"'+e+'"');else if(i.isCategory()){for(s=t.getContactsByCategoryContact(i),h=[],o=0;o<s.length;o++)h.push(new r.ContactPickerV2.ViewModels.SelectedContact(null,s[o]));u=u.concat(this._serializeContacts(h,t))}else c=i.email(),u.push(c?'"'+e+'" <'+c+">":e);return u},areAnyContactPickersDirty:function(){for(var t=!1,u=this,r,n=0;n<i.length&&!t;n++)r=i[n],t=u._contactPickers[r]&&u._contactPickers[r].hasIncompleteUserEntry();return t},getContactPickerData:function(){var r={emails:[],categoryIds:[],groupIds:[]},o,u,s,e,f,n;if(!t.isEmptyObject(this._contactPickers))for(o=this,u=0;u<i.length;u++)for(s=i[u],e=o._contactPickerModels[s].selectedContacts(),f=0;f<e.length;f++)n=e[f],n.isCategory()?r.categoryIds.push(n.contact().id()):n.isGroup()?r.groupIds.push(n.contact().id()):n.email()&&r.emails.push(n.email());return r},_showCcClick:function(n){this.showCc(!0),this.focusOn(this.contactPickerType.cc),n.preventDefault()},_showBccClick:function(n){this.showBcc(!0),this.focusOn(this.contactPickerType.bcc),n.preventDefault()},_onContactsAdded:function(n,t){var r=t.contacts,e,i,u,s;for(this._validateEmailsForContacts(r,t.model),this._resize(),e=t.context&&t.context.entryPt,i=0;i<r.length;i++)u=r[i].contact(),s=u?u.type():f.Person,$BSI.reportEvent("SelectClick.Messaging.Mail.CPAdd",{cntEntryPt:e,cntType:o[s]})},_onContactEdited:function(n,t){var i=t.change;i.path!=="Email"&&i.path!=="Contact"&&(i.path!=="Error"||i.value)||this._validateEmailsForContacts([t.contact],t.model)},_onContactDenied:function(t,i,r){r(n.GetString("EditMessage.RecipientsFiltered")),$BSI.reportEvent("Compose.Mail.Errors",{errType:b})},_onUserAction:function(n,t){$BSI.reportEvent("SelectClick.Messaging.Mail.CPClicks",{clkAction:t.type,entryPt:t.input})},_onRemoveContactListEntry:function(n,i){var r=this._contactsDataModel.removePicwContact(i.contact);r&&HM.HidePicwContact(r,t.noop)},_onDragStart:function(){for(var r=this,t,n=0;n<i.length;n++)t=i[n],r._contactPickers[t].hideContactList()},_setErrorFlagsBasedOnValidity:function(n){for(var i=0;i<n.length;i++){var t=n[i],r=t.email(),u=this._verifyRecipientsCache[r];r&&u===!1&&(t.error(!0),t.displayName(t.selectionText()),t.email(null))}},_validateEmailsForContacts:function(n){for(var f={},i=[],s=[],r,o,t,e=0;e<n.length;e++)r=n[e],t=r.email(),t&&(this._verifyRecipientsCache[t]==null?this._inFlightVerify[t]?this._inFlightVerify[t].push(r):(f[t]=f[t]||[],f[t].push(r),i.push(t)):s.push(r));if(s.length>0&&this._setErrorFlagsBasedOnValidity(s),i.length>0){for(o=0;o<i.length;o++)t=i[o],this._inFlightVerify[t]=f[t];var u=this,h=function(n){var f=[],t,r,e;if(n){for(t=0;t<i.length;t++)r=i[t],e=n[t],u._verifyRecipientsCache[r]=e,f=f.concat(u._inFlightVerify[r]),delete u._inFlightVerify[r];u._setErrorFlagsBasedOnValidity(f)}},c=function(n,t,r,f){var e,o;for(f&&f.ErrorCode===p.versionUpgradeErrCode&&a.createTopBar({content:f.Message,dismissalMode:a.BarDismissalMode.Timeout}).show(),e=0;e<i.length;e++)o=i[e],delete u._inFlightVerify[o]};HM.VerifyRecipients(i,h,{},c)}},onDispose:function(){var n=this;n.disposeContactPickers(),n.disposeContacts(),t.observable.simpleOff(n.data,"propertyChange."+n.ControlNamespace),t.observable.simpleOff(n.composeVm,"propertyChange."+n.ControlNamespace),n._$contents=null},_resize:function(){n.Cmd("compose.resize").bubble(this,{})},_animatePart:function(n,t){var r=!t.value?l.collapse:l.expand,i=this;setTimeout(function(){i._resize(),t.skipAnimation||r(n).then(function(){i._resize(),t.isError&&($B.SF_Mac||$B.FF_Mac||$B.CR_Mac)&&n.get(0).focus()})},0)},_onPropertyChange:function(n,t){var r=this,i;(t.path==="To"||t.path==="Cc"||t.path==="Bcc")&&(i=t.path.toLowerCase(),r._resetContactPickerType(i),r._setContactPickerValue(i,t.value))},_inlineError:function(t,i){return i!==undefined&&this._animatePart(this.contents("."+c[t]).find(" .errorDiv"),{value:i,isError:!0}),n.Accessor(this,t+"InlineError",i)},_showContactPicker:function(t,i){var r=this,u;return i!==undefined&&r._animatePart(r.contents("."+c[t])[0],{value:i,skipAnimation:r._isPortraitLayout}),u=n.Accessor(r,"Show"+t,i),i&&r.adjustSize(t),u},bccInlineError:function(n){return this._inlineError("Bcc",n)},ccInlineError:function(n){return this._inlineError("Cc",n)},toInlineError:function(n){return this._inlineError("To",n)},showBcc:function(n){return this._showContactPicker("Bcc",n)},showCc:function(n){return this._showContactPicker("Cc",n)},adjustSize:function(n){var i=this;if(!i.data.isFullCompose()&&(n==="To"||i["show"+n]())){var r=t(i.contents("."+c[n])[0]),u=r.find(".ContactHeader").width(),f=r.find(".cpv2"),e="margin-"+($B.rtl?"right":"left");f.css(e,u)}},adjustAll:function(){for(var n=0;n<e.length;n++)this.adjustSize(e[n])}};t.views.tags({contactPickerManagerControl:d})}(window.ol,window.originaljQuery||window.jQuery),function(n,t){"use strict";var r=window,i;r.wLive=r.wLive||{},i=r.wLive,i.Hotmail=i.Hotmail||{};var e=i.Hotmail,u="fromAddressSelectorTemplate",f={templateId:u,template:t.templates("#"+u),attr:"html",init:function(i){var r=this,u=i.ctx;r.data=u.data,r.ControlNamespace=n.createControlNamespace(r.tagName),r.composeVm=u.composeVm,r._fromAddrICTemplate=n.config.compose.fromAddrICTemplate,r._icInstance=null,t.observable.simpleOn(r.composeVm,"propertyChange."+r.ControlNamespace,function(t,i){i.path==="HasMultipleAddresses"?(r._contactsReady&&r._setUserTileSrcCb(),n.vm.Compose.initializeSendersFromComposeData(r.data,r.data.composeData())):i.path==="DefaultFromAddress"&&n.vm.Compose.initializeSendersFromComposeData(r.data,r.data.composeData())})},onAfterLink:function(){var i=this,r=i.contents();i.data.isFullCompose()&&(i._setUserTileSrcCb=t.proxy(n.vm.Compose.setUserTileSrc,i),$pwc.callWhenReady(i._setUserTileSrcCb));r.on("click","LI",t.proxy(i._onClick,i))},_onClick:function(n){var i=t(n.target).view().data;this.data.senderDetails(HM.createSenderDetails({displayName:i.Name,fromAddress:i.Address})),$menu.closeCurrent(),n.preventDefault()},render:function(){return this.tagCtx.render(this.data)},onDispose:function(){var n=this;n._icInstance&&window.$icm&&($icm.removeIC(n._icInstance),n._icInstance=null),$pwc.removeWhenReadyCallback(n._setUserTileSrcCb),t.observable.simpleOff(n.data,"propertyChange."+n.ControlNamespace),t.observable.simpleOff(n.composeVm,"propertyChange."+n.ControlNamespace)}};t.views.tags({fromAddressSelectorControl:f})}(window.ol,window.originaljQuery||window.jQuery),function(n,t){"use strict";function f(n){return typeof n=="string"&&n.toLowerCase()===w||n===!0}var c="composeRteTemplate",r=window,a=n.BrowserCapabilities,v="#stopSpelling",e={},u,o,h,l,s;$B.Firefox?e={98:"bold",105:"italic",117:"underline"}:$B.SF_Mac?e={117:"underline"}:$B.Safari&&(e={21:"underline"}),u={bold:"Bold",italic:"Italic",underline:"Underline",outdent:"Outdent",indent:"Indent",insertorderedlist:"InsertOrderList",insertunorderedlist:"InsertUnOrderList",justifyleft:"JustifyLeft",justifycenter:"JustifyCenter",justifyright:"JustifyRight",fontname:"FontName",fontsize:"FontSize",forecolor:"FGColor",createlink:"InsertLink"},$B.Firefox?u.hilitecolor="BGColor":u.backcolor="BGColor",o={};for(h in u)o[u[h]]=h;l=150,s=null,r.rteOnClick=function(t){n.Cmd("rte.legacyevent").fire({event:t,name:"rte.click"})},r.rteOnKeyUp=function(t){n.Cmd("rte.legacyevent").fire({event:t,name:"rte.keyup"})},r.rteOnDragOver=function(t){n.Cmd("rte.legacyevent").fire({event:t,name:"rte.dragover"})},r.rteOnDrop=function(t){n.Cmd("rte.legacyevent").fire({event:t,name:"rte.drop"})},r.rteMouseDown=function(t){n.Cmd("rte.legacyevent").fire({event:t,name:"rte.mouse"})},r.rteMouseMove=function(t){n.Cmd("rte.legacyevent").fire({event:t,name:"rte.mouse"})},r.rteMouseUp=function(t){n.Cmd("rte.legacyevent").fire({event:t,name:"rte.mouse"})},r.rteOnPaste=function(t){n.Cmd("rte.legacyevent").fire({event:t,name:"rte.paste"})},r.rteOnFocus=function(t){n.Cmd("rte.legacyevent").fire({event:t,name:"rte.focus"})},r.rteOnBlur=function(t){n.Cmd("rte.legacyevent").fire({event:t,name:"rte.blur"})};var y="rgb(255, 255, 255)",p=16777215,w="true",i=HM.InstrumentationFormatAction,b={bold:i.Bold,fontname:i.FontType,fontsize:i.FontSize,underline:i.Underline,italic:i.Italics,forecolor:i.FontColor,backcolor:i.Highlight,insertunorderedList:i.BulletedList,insertorderedlist:i.NumberedList,indent:i.IndentLeft,outdent:i.IndentRight,justifyleft:i.LeftAlign,justifyright:i.RightAlign,justifycenter:i.CenterAlign,createlink:i.InsertLink},k={templateId:c,template:t.templates("#"+c),attr:"html",rte:null,editorElt:null,init:function(i){var r=this,u=i.ctx;r.data=u.data,r.isVisible=u.isVisible,r.toolbar=u.toolbar,r.ControlNamespace=n.createControlNamespace(r.tagName),r._rteBodyReady=t.Deferred(),r._legacyRteEventHandler=t.proxy(r._onLegacyRteEvent,r),t.observable.simpleOn(r.data,"propertyChange."+r.ControlNamespace,t.proxy(r._onPropertyChange,r)),t.observable.simpleOn([r.data.Attachments.InlineFiles],"arrayChange."+r.ControlNamespace,t.proxy(r._inlineFileArrayChange,r))},rteBodyReady:function(){return this._isDisposed?t.Deferred().reject():this._rteBodyReady},render:function(){return this.tagCtx.render(this.data)},onAfterLink:function(){var n=this,i;n._$root=n.contents("div"),n._$surface=n._$root.find("#ComposeRteEditor_surface"),n.rteContainer=n._$root[0],n.editorElt=n._$root.find(".Container")[0],n.rte=new r.RTE.Editor(n.editorElt,n.isVisible),i=t.proxy(this._onRTEReady,n),n.readyPromise().done(function(){t(document).ready(i)})},readyPromise:function(){return this._isDiposed?t.Deferred().reject():this.rte.rteReadyPromise()},numberInlineImages:function(){var i=this.rte.iframe(),n;return n=t(i).contents(),n.find(".inlineImage").length+n.find(".ecxinlineImage").length},_onLegacyRteEvent:function(t){var i=t.event;switch(t.name){case"rte.click":$menu.closeCurrent();break;case"rte.keyup":this._$surface.keyup();break;case"rte.mouse":this._$surface.trigger(i);return}n.Cmd(t.name).bubble(this,{event:i})},_onKeyPress:function(t){var i,r;(t.ctrlKey||t.metaKey)&&(i=e[t.charCode],i&&(r=this.rte.getSelection(),this.rte.execCommand(r,i,null),t.returnValue=!1)),n.Cmd("rte.keypress").bubble(this,{event:t})},insertContent:function(n){this.rte.insertContent(n)},_onKeyDown:function(t){if($B.IE&&t.keyCode===8&&this.rte.getCurrentSelectionType()==="Control"){t.cancelBubble=!0;var i=this.rte.getSelection();this.rte.execCommand(i,"delete",null)}n.Cmd("rte.keydown").bubble(this,{event:t})},_onExecCommand:function(t,r,e){var o,s;if(e.command!=="fontname"&&e.command!=="fontsize"&&this._updateToolbarButton(u[e.command],e.value),o=b[e.command],o!=null){s=e.resultValue;switch(o){case i.Bold:f(s)||(o=i.RemoveBold);break;case i.Italics:f(s)||(o=i.RemoveItalics);break;case i.Underline:f(s)||(o=i.RemoveUnderline);break;case i.Highlight:(typeof s=="string"&&s.toLowerCase()===y||s===p)&&(o=i.RemoveHighlight);break;case i.NumberedList:f(s)||(o=i.RemoveNumberedList);break;case i.BulletedList:f(s)||(o=i.RemoveBulletedList)}n.Cmd("instrument.formattext").fire({formatAction:o,entryPoint:HM.InstrumentationEntryPoint.Other,isFullCompose:this.data.isFullCompose()})}},_onSelectionChange:function(t,i,r){var u=this;u._selectionChangeTimeout&&clearTimeout(u._selectionChangeTimeout),u._selectionChangeTimeout=u._setTimeout(function(){u._ignoreNextSelection||(u._updateToolbar(r.range),n.Cmd("rte.selectionchange").bubble(u)),u._ignoreNextSelection=!1},l)},_onRTEReady:function(){var i=this,o,e,u,f;i._isReady=!0,o=r.RTE.Editor,i._keyPressHandler=t.proxy(i._onKeyPress,i),i._keyDownHandler=t.proxy(i._onKeyDown,i),i._compositionStartHandler=t.proxy(i._onCompositionStart,i),i._compositionEndHandler=t.proxy(i._onCompositionEnd,i),i.rte.attachRTEEvent("keypress",i._keyPressHandler),i.rte.attachRTEEvent("keydown",i._keyDownHandler),i.rte.attachRTEEvent("compositionstart",i._compositionStartHandler),i.rte.attachRTEEvent("compositionend",i._compositionEndHandler),e=o.Events;t(i.rte).on(e.onexeccommand+"."+i.ControlNamespace,t.proxy(i._onExecCommand,i)).on(e.onselectionchange+"."+i.ControlNamespace,t.proxy(i._onSelectionChange,i));t(i.rte.iframe()).contents().on("contextmenu.cv click.cv",".inlineImage",t.proxy(i._showContextMenu,i)).on("contextmenu.cv click.cv",".shareSkyDriveItem",t.proxy(i._showContextMenu,i)).on("scroll.cv",t.proxy(i._rteScroll,i));i._body=t(t(i.rte.iframe()).contents().find("body")[0]),i._body.attr("aria-label",n.GetString("Accessibility.MessageBodyLabel")),u=this.toolbar,f=i.rte.defaultFont,f.bold=u.buttonState("Bold"),f.italic=u.buttonState("Italic"),f.underline=u.buttonState("Underline"),f.fontname=u.buttonState("FontName"),f.fontsize=u.buttonState("FontSize"),f.forecolor=u.buttonState("FGColor")||"",n.Cmd("rte.ready").bubble(this),i._rteBodyReady.resolve()},_defaultToolbarAction:function(n,i){var u=this,r=o[n.action],f=n.value;if((r==="bold"||r==="italic"||r==="underline")&&(f="1"),this.rte.execCommand(i,r,f),n.waitForDismissMenu)t(wLive.Controls).one("aftermenudismiss",function(){u.focus()});else u.focus();u._updateToolbar(i)},focus:function(){this.rte.focus()},_fixUrlLink:function(t){return t.indexOf("://")>0?t:t.indexOf("mailto:")===0?t:n.String.isValidEmailSyntax(t)?"mailto:"+t:"http://"+t},_onCreateLink:function(n,i){var e=encodeURI(n.value),o=r.RTE.Editor.HTMLEncode(n.value),f,u;($B.IE||$B.Firefox)&&""===i.text?$B.IE?this.rte.insertContent('<a href="{0}">{1}<\/a>'.format(e,o)):(this.rte.saveCurrentFont(i),this.rte.insertContent('<a href="{0}" class="newlyinsertedlink">{1}<\/a>'.format(e,o)),f=t(i.parentElement()).find(".newlyinsertedlink"),f.removeClass("newlyinsertedlink"),u=this.rte.getSelection(),u.selectNode(f[0]),this.rte.applySavedFont(u),u.setStartAfter(f[0]),u.collapse(!0),u.select()):(n.value=this._fixUrlLink(n.value),this._defaultToolbarAction(n,i))},_onFontSize:function(n,t){this._defaultToolbarAction(n,t);var u=r.RTE.getConfig("FONT_SIZE"),i=t.parentElement();(i.tagName==="FONT"||i.tagName==="SPAN")&&(i.style.fontSize=i.size!=""?u[i.size-1]:"",i.onpropertychange=function(){null!=event&&event.propertyName==="size"&&(i.style.fontSize=i.size!=""?u[i.size-1]:"")})},onRteToolbarAction:function(n,t){var i=this.rte.getSelection(),r=o[t.action];r&&(r==="createlink"?this._onCreateLink(t,i):r==="fontsize"?this._onFontSize(t,i):this._defaultToolbarAction(t,i))},_rteScroll:function(t){n.Cmd("rte.scroll").bubble(this,{event:t})},_showContextMenu:function(t){var i=this._$root.offset(),r={left:t.clientX+i.left,top:t.clientY+i.top,right:t.clientX+i.left,bottom:t.clientY+i.top};return n.Cmd("rte.showcontextmenu").bubble(this,{event:t,position:r}),t.cancelBubble=!0,t.stopPropagation(),t.preventDefault(),!1},_inlineFileArrayChange:function(n,i){var u=this,r;if(i.change==="insert")for(r=0;r<i.items.length;r++)u._insertInlineImage(i.items[r]);else for(r=0;r<i.items.length;r++)u._getInlineImageElem(i.items[r]).remove(),t.observable.simpleOff(i.items[r],".rteControl")},_inlineImagePropertyChange:function(i,r){var u=this;r.path==="ImageIsOnScreen"&&(n.Cmd("rte.inlineimageresize").bubble(u),t.observable.simpleOff(i.target,".rteControl"))},_insertInlineImage:function(i){var u=i.cid(),r=this;r.focus(),r.insertContent('<div id="{0}" style="display: inline-block">{1}<\/div>'.format(u,$B.Firefox?'<br _moz_editor_bogus_node="TRUE">':"")),s||(s=t.templates(null,{markup:"#InlineImageTemplate",converters:{getInlineCssClass:function(n){return"inlineImage"+(n?" inlineImageError":"")}}})),t(r.rte.iframe()).contents().find("#"+u).link(s,i,n.getContextObject()),t.observable.simpleOn(i,"propertyChange.rteControl",t.proxy(r._inlineImagePropertyChange,r))},_updateToolbar:function(n){var i,t;if(this.rte.isRTEMode())for(i in u)t=this.rte.queryCommandState(n,i),i==="fontname"?t=this._getFontNameAtSelection(n):i==="fontsize"?t=this._getFontSizeAtSelection(n):i==="createlink"&&(t=n.text),t!==undefined&&t!==""&&this._updateToolbarButton(u[i],t)},_updateToolbarButton:function(n,t){this.toolbar.buttonState(n,t)},_getStyle:function(n,t){for(var i,f,u;n;){if("fontSize"===t){if(i=null,n.style.fontSize&&(i=n.style.fontSize),n.size&&(i=n.size),i)for(f=r.RTE.Editor.getFontSizes(),u=0;u<f;u++)if(f[u]===i)return u+1}else if("fontName"===t){if(n.style.fontFamily)return n.style.fontFamily;if(n.tagName.match(/font/i)&&n.getAttribute("face"))return n.getAttribute("face")}if(n==this.rte._editor)break;n=n.parentElement}return""},_getFontSizeAtSelection:function(n){var t=this.rte.queryCommandValue(n,"fontsize")+"";return t.length===1&&t!=="0"?parseInt(t):this._getStyle(n.parentElement(),"fontSize")},_getFontNameAtSelection:function(n){var i=this.rte.queryCommandValue(n,"fontname")||this._getStyle(n.parentElement(),"fontName"),u,f;i=i.replace(/['"]/g,"");var e=i,o=i.split(","),s=r.RTE.Editor,h=s.getFontNames();for(u=0;u<o.length;u++)if(f=o[u].trim(),t.inArray(f,h)!==-1){e=f;break}return e},_setTimeout:function(n,t){var i=this;return setTimeout(function(){i._isDisposed||n()},t)},onDispose:function(){var n=this,i;n._isDisposed=!0,n.loseControl(),n.rte.detachRTEEvent("keypress",n._keyPressHandler),n.rte.detachRTEEvent("keydown",n._keyDownHandler),n.rte.detachRTEEvent("compositionstart",n._compositionStartHandler),n.rte.detachRTEEvent("compositionend",n._compositionEndHandler),i=r.RTE.Editor.Events,t(n.rte).off(i.onexeccommand+"."+n.ControlNamespace).off(i.onselectionchange+"."+n.ControlNamespace),t(n.rte.iframe()).contents().off(".cv"),n.rte.dispose(),n._spellChecker&&n._spellChecker.dispose(),t.observable.simpleOff(n.data,"propertyChange."+n.ControlNamespace),n.data.Attachments&&t.observable.simpleOff([n.data.Attachments.InlineFiles],"arrayChange."+n.ControlNamespace),n.data=n.rte=n.rteContainer=n._$root=n.editorElt=n._$surface=n._body=n._legacyRteEventHandler=n._spellChecker=n._keyPressHandler=n._keyDownHandler=n._compositionStartHandler=n._compositionEndHandler=null},setBody:function(n){this._body.html(n)},initializeShareSkyDrive:function(){var n=this,i=t.Deferred(),r;return n._isDisposed?i.reject():n.data.Attachments.ShareSkyDriveFiles.TotalFileCount===0?(r=t(this.rte.iframe()).contents(),a.enableObjectResizing&&(r[0].execCommand("enableObjectResizing",!1,"false"),r[0].designMode="off"),n.data.Attachments.shareSkyDriveIsReady.then(function(){var r=n._body.clone(),u=r.find(v),t;u.length?(t=u.first().parent(),n.data.Attachments.ShareSkyDriveFiles.postMessageBody(t.clone().wrap("<p>").parent().html()),t.remove()):n.data.Attachments.ShareSkyDriveFiles.postMessageBody(""),n.data.Attachments.ShareSkyDriveFiles.preMessageBody(r.html()),i.resolve()})):i.resolve(),i.promise()},_updateInlineImages:function(n){var t,i;if(this.data&&this.data.Attachments&&this.data.Attachments.InlineFiles)for(t=0;t<this.data.Attachments.InlineFiles.length;t++)i=this.data.Attachments.InlineFiles[t],n=n.replace(i.src(),"cid:"+i.cid());return n},contentEditable:function(n){this._body.attr("contenteditable",n)},getValue:function(n){var t=this,u,i;return t._isReady?(n||t.cleanupInlineAttachments(),u=t.rte.getValue(),t.removeSpellCheckMarkers(),i=t.rte.getValue(),i!==u&&t._setTimeout(function(){t.restoreSpellCheckMarkers()},0),n?i:this._updateInlineImages(i)):t.rteContainer?(i=r.RTE.value(t.rteContainer),n?i:t._updateInlineImages(i)):void 0},appendToBody:function(n){var i=this,r=t(i._body).find("#ecx_rte_postskyattach"),u=r[0]?r:i._body;t(n).appendTo(u)},_setValue:function(t){var i=this;i.data.TextMode===n.vm.Compose.TextModes.PlainText&&t&&(t=r.RTE.Editor.ConvertLineBreaks(t,!0)),i._isReady?(t!==null&&t!==undefined&&i.rte.setValue(t),i._setTimeout(function(){i.data.Attachments.shareSkyDriveIsReady.then(function(){if(i.data&&i.data.Attachments){var t=i.data.Attachments.ShareSkyDriveFiles.rehydrateExistingSkyDriveItems(i._body);t&&n.Cmd("compose.skydriverehydrated").bubble(i)}})},0)):i.rteContainer&&r.RTE.value(i.rteContainer,t),n.Cmd("compose.resize").bubble(i)},_setRteMode:function(i,u){var o=r.RTE.Mode,e={},f;(e[n.vm.Compose.TextModes.RichText]=o.RichText,e[n.vm.Compose.TextModes.HTML]=o.HTML,e[n.vm.Compose.TextModes.PlainText]=o.PlainText,f=this,e[i]!==f.rte.getMode())&&(i===n.vm.Compose.TextModes.PlainText?(t(f.data.Attachments.InlineFiles).remove(0,f.data.Attachments.InlineFiles.length),f.data.Attachments.ShareSkyDriveFiles&&f.data.Attachments.ShareSkyDriveFiles.empty()):i==n.vm.Compose.TextModes.HTML&&f.togglePlaceholder(!1),f.readyPromise().pipe(function(){f.rte.setMode(e[i]),u&&f.focus(),f._updateToolbar(f.rte.getSelection()),n.Cmd("compose.resize").bubble(f)}))},_onPropertyChange:function(n,i){var r=this,u=i.path,e=i.value,f;u==="ComposeMessageBody"?r._setValue(r.data.ComposeMessageBody):u==="TextMode"?r._setRteMode(i.value):u==="Attachments"&&e===null&&(f=i.oldValue,f&&t.observable.simpleOff([f.InlineFiles],"arrayChange."+r.ControlNamespace))},removeDataLinkBindings:function(){this._body&&this._body.find("* [data-link]").removeAttr("data-link")},spellCheck:function(){var n=this;this.readyPromise().then(function(){!n._spellChecker&&r.SpellChecker&&(n._spellChecker=new r.SpellChecker(n.rte,n.data.IsDraft)),n._spellChecker&&n._spellChecker.check()})},removeSpellCheckMarkers:function(){this._spellChecker&&this._spellChecker.removeAllMarkers()},restoreSpellCheckMarkers:function(){this._spellChecker&&this._spellChecker.remarkMisspellings()},isPlaceholderShown:function(){return this.rte.isPlaceholderShown()},containsContent:function(){var n=this._body.html();return n&&n!=="<br>"},getFullContentHeight:function(){var n=this,r=n._body.outerHeight()-n._body.height()-t(n.rte.iframe()).outerHeight(),i,u;return r+=$B.IE?30:0,i=t("<p/>").appendTo(n._body),u=i.offset().top+i.outerHeight(),i.remove(),r+u},setContentOverflowHidden:function(n){this._body.css("overflow",n?"hidden":"")},togglePlaceholder:function(n){this.rte._togglePlaceholder(n)},getPlaceholder:function(){return this.rte.getPlaceholder()},_onCompositionStart:function(){n.Cmd("rte.compositionstart").bubble(this)},_onCompositionEnd:function(){n.Cmd("rte.compositionend").bubble(this)},_getInlineImageElem:function(n){return this._body.find("#"+n.cid())},_isInlineImageInRte:function(n){return!!this._getInlineImageElem(n).find("img").length},cleanupInlineAttachments:function(){var n=this,i,r,t,u;if(n.data&&n.data.Attachments&&n.data.Attachments.InlineFiles)for(i=n.data.attachments(),r=i.inlineFiles(),t=0;t<r.length;t++)u=r[t],n._isInlineImageInRte(u)||i.removeFile(u,!0)},gainControl:function(t){var i=this;n.Cmd("rte.legacyevent").subscribe(i._legacyRteEventHandler),i.readyPromise().then(function(){i.rte.onViewInitialization(),t&&t.attachToIframe(i.rte.iframe()),i._setRteMode(n.vm.Compose.TextModes.RichText),i._setValue(i.data.ComposeMessageBody),i._setRteMode(i.data.TextMode)}),i.isPageVisible=!0},loseControl:function(t){var i=this;n.Cmd("rte.legacyevent").unsubscribe(i._legacyRteEventHandler),i.readyPromise().then(function(){t&&t.detachFromIframe(i.rte.iframe())})},onToolbarAction:function(n){n.event.type==="keydown"&&this.ignoreNextSelection()},ignoreNextSelection:function(){var n=this;n._selectionChangeTimeout&&clearTimeout(n._selectionChangeTimeout),n._ignoreNextSelection=!0}};t.views.tags({rteControl:k})}(window.ol,window.originaljQuery||window.jQuery),function(n,t){"use strict";var i="rteToolbarTemplate",r=n.config.compose,u={templateId:i,template:t.templates("#"+i),attr:"html",init:function(t){var i=this;i.data=t.ctx.data,i.thread=t.ctx.thread,i.ControlNamespace=n.createControlNamespace(i.tagName)},render:function(){return this.tagCtx.render(this.data,{toolbarStrip:function(){return $Utility.isHighContrast()?r.highContrastToolbarStrip:r.toolbarStrip},isItemVisible:function(n){return n?"inline-block":"none"}})},onToolbarAction:function(n){for(var r=this,i=r.getToolbarItems(),t=0;t<i.length;t++)i[t].data.shortcutAction()===n.action&&i[t].invoke(n.event)},getToolbarItems:function(){var t=this;return n.findChildTag(t,"rteToolbarMenuControl").concat(n.findChildTag(t,"hyperlinkControl")).concat(n.findChildTag(t,"rteToolbarItemControl")).concat(n.findChildTag(t,"emojiPickerFlyoutControl"))},onAfterLink:function(){var n=this;n.subscribed||(n.subscribed=!0,t.observable.simpleOn(n.thread,"propertyChange."+n.ControlNamespace,function(t,i){if(i.path==="TextMode")n.onTextModeChange(!0)}))},onTextModeChange:function(){for(var t=this,i=t.getToolbarItems(),r,n=0;n<i.length;n++)r=i[n],t._toggleVisibility(r)},itemVisibility:function(t){return t.IsPlainTextCapable||this.thread.textMode()===n.vm.Compose.TextModes.RichText},_toggleVisibility:function(n){var r=this,t=n.data,i=r.itemVisibility(t),u=i?wLive.Animations.addToList:wLive.Animations.deleteFromList,f=n.contents(),e=u(f);e.then(function(){t.isVisible(i)})},onDispose:function(){var n=this;t.observable.simpleOff(n.thread,"propertyChange."+n.ControlNamespace)}};t.views.tags({rteToolbarControl:u})}(window.ol,window.originaljQuery||window.jQuery),function(n,t){"use strict";var i="rteToolbarItemTemplate",r=t.templates(null,{markup:"#"+i,converters:{stateClass:function(n,t,i){var r=t;return n&&i==="toggle"&&(r+=" Selected t_bci"),r}}}),u={templateId:i,template:r,attr:"html",init:function(t){var i=this;i.data=t.ctx.data,i.ControlNamespace=n.createControlNamespace(i.tagName)},render:function(){return this.tagCtx.render(this.data)},onAfterLink:function(){var n=this,i=this.contents();i.on("click","a",t.proxy(n.invoke,n))},invoke:function(){var t=this;return t.data.IsAutoToggle&&t.data.state(!t.data.state()),n.Cmd("rte.toolbaraction").bubble(t,{action:t.data.Name,value:t.data.state()}),!1}};t.views.tags({rteToolbarItemControl:u})}(window.ol,window.originaljQuery||window.jQuery),function(n,t){"use strict";var i="rteToolbarMenuTemplate",r={templateId:i,template:t.templates("#"+i),attr:"html",init:function(t){var i=this;i.data=t.ctx.data,i.ControlNamespace=n.createControlNamespace(i.tagName)},render:function(){return this.tagCtx.render(this.data)},onAfterLink:function(){var i=this,r=i.contents();r.on("click","a",function(n){return i.data.Menu&&i.invoke(n),!1});r.on("click",".menuLinkItem",function(){var r=t(this).view().data,u=i.data.Prefix||"",f=i.data.Suffix||"";return i.data.state(r.Key),i.close(),n.Cmd("rte.toolbaraction").bubble(i,{action:i.data.Name,value:u+i.data.state()+f,waitForDismissMenu:!0}),!1})},menuTypeClass:function(){var n="HmMenu OptMenu c_m t_hovl";return this.data.ButtonType==="colormenu"&&(n+=" ColorPicker"),n},invoke:function(t){var i=this;n.Accessor(i,"MenuNeeded",!0);var u=i.contents(),f=u.find(".c_ml")[0],e=u.find(".c_m")[0],r={parentEl:_ge(i.ControlNamespace),menuEl:e,sourceEl:f,eventType:"click",defaultLoc:0,alt:1};i.data.Menu.EdgeOffsetFunction&&(r.edgeOffsets=i.data.Menu.EdgeOffsetFunction(i.ctx.layout),r.noDockCache=!0),$menu.create(t,0,r),i._wlMenuBinding=f.menu,t.type==="keydown"&&i._wlMenuBinding.toggleState()},close:function(){$menu.closeCurrent()}},u;t.views.tags({rteToolbarMenuControl:r}),u=t.templates(null,{markup:"#rteToolbarMenuItemTemplate",converters:{stateClass:function(n){return n?"Selected":""}}}),t.templates("#rteToolbarColorMenuItemTemplate"),n.markControlAsLoaded("rteToolbarMenuControl")}(window.ol,window.originaljQuery||window.jQuery),function(n,t){"use strict";var i="rteToolbarItemTemplate",r=13,u={templateId:i,template:t.templates("#"+i),attr:"html",init:function(t){var i=this;i.data=t.ctx.data,i.ControlNamespace=n.createControlNamespace(i.tagName)},render:function(){return this.tagCtx.render(this.data)},onAfterLink:function(){var n=this,i=this.contents();i.on("click","a",t.proxy(n.invoke,n))},onDispose:function(){var n=this;n._isDisposed=!0,n._flyout&&(n._flyout.dismiss(),n._flyout=null)},invoke:function(){var i=this;return n.init.NotifyLoad(n.config.compose.featureBuckets.hyperlink).then(function(){if(!i._isDisposed){i.data.State.match(/\b((www\.|mailto\:|(news|(ht|f)tp(s?))\:\/\/){1}\S+)\b/ig)||i.data.state("http://"),i.flyoutTemplate||(i.flyoutTemplate=t.templates("#rteToolbarHyperlinkFlyoutTemplate"));var f=t("<div><\/div>").link(i.flyoutTemplate,i.data,i.ctx),u=i._flyout=wLive.Controls.Notifications.createDropDown({content:f,anchor:_ge(i.ControlNamespace),buttons:{action:n.GetString("RTE.InsertHyperlink.OK")},options:{moreCss:"Hyperlink",position:0}});t(u).on("beforeshow.flyout",function(){var f=t(u.content()),e=f.find(".Url");e.on("keyup",function(t){t.which===r&&(e.change(),n.Cmd("rte.toolbaraction").bubble(i,{action:i.data.Name,value:i.data.State}),u.dismiss())});f.find("button").attr("aid","ok")}).on("aftershow.flyout",function(){var i=t(u.content()),r=i.find(".Url");n.callFocus(r)});u.show().then(function(r){t(u).off("beforeshow.flyout"),t(u).off("aftershow.flyout"),r.buttonClicked==="action"&&n.Cmd("rte.toolbaraction").bubble(i,{action:i.data.Name,value:i.data.State})})}}),!1}};t.views.tags({hyperlinkControl:u}),n.markControlAsLoaded("hyperlinkControl")}(window.ol,window.originaljQuery||window.jQuery),function(n,t){"use strict";var i="rteToolbarItemTemplate",r={templateId:i,template:t.templates("#"+i),attr:"html",init:function(t){var i=this;i.data=t.ctx.data,i.ControlNamespace=n.createControlNamespace(i.tagName)},render:function(){return this.tagCtx.render(this.data)},onAfterLink:function(){var n=this,i=this.contents();i.on("click","a",t.proxy(n.invoke,n))},onDispose:function(){var n=this;n._isDisposed=!0},invoke:function(){var i=this;return n.init.NotifyLoad(n.config.compose.featureBuckets.emojiPicker).then(function(){if(!i._isDisposed){i.flyoutTemplate||(i.flyoutTemplate=t.templates("#rteToolbarEmojiPickerFlyoutTemplate"));var n=t("<div><\/div>").link(i.flyoutTemplate,i.data,i.ctx),r=wLive.Controls.Notifications.createDropDown({content:n,anchor:_ge(i.ControlNamespace),options:{moreCss:"EmojiPickerFlyout",position:0}});r.show(),$BSI.reportEvent("ClickedSelected.Business.QuickAdd",{QACategory:"emoji"})}}),!1}};t.views.tags({emojiPickerFlyoutControl:r}),n.markControlAsLoaded("emojiPickerFlyoutControl")}(window.ol,window.originaljQuery||window.jQuery),function(){var n=window.wLive||{},t=n.ContactPickerV2=n.ContactPickerV2||{},i=t.ViewModels=n.ContactPickerV2.ViewModels||{},r=t.Controls=n.ContactPickerV2.Controls||{}}(),function(n){function e(i,o,s){function l(){if(h.model=s||{},i&&(h.model.DisplayName=i.name(),h.model.Email=i.email(),o&&h.model.Email||(h.model.SelectionText=i.raw())),o){if(o.displayName()&&(h.displayName(o.displayName()),h.model.SelectionText||h.model.Email||h.selectionText(o.displayName())),o.email()){var t=new u.EmailAddressParser(o.email());(t.email()||o.sourceId())&&h.email(o.email()),o.displayName()&&(t.email()||o.sourceId())||h.displayName(o.email())}h.contact(o)}h.$model=n(h.model),h.model.Error=h.contactRequiresEmail()&&!h.model.Email}function c(t,i){return i===undefined?i=h.model[t]:n.observable(h.model).setProperty(t,i),i}var h=this;h.id=function(n){return c("Id",n===undefined?n:n.toString())},h.displayName=function(n){return arguments.length===0?h.model.DisplayName?c("DisplayName",n):h.model.Email?c("Email",n):c("SelectionText",n):c("DisplayName",n)},h.hasUserTile=function(){return o&&o.userTile()},h.userTileHtml=function(){var t="",n=h.contact(),i;return n&&n.userTile()&&(i=h.ic=$icm.createICForPerson("CPV2_addressWell",n.id(),{toolTipType:"none",hidePresence:!0}),t=i.render()),t},h.selectionText=function(n){return arguments.length===0&&!h.model.SelectionText?h.model.Email:c("SelectionText",n)},h.email=function(n){return c("Email",n)},h.editing=function(n){return!!c("Editing",n)},h.error=function(n){return!!c("Error",n)},h.contact=function(n){return c("Contact",n)},h.isCategory=function(){var n=h.contact();return!!(n&&n.type()===f.ViewModels.ContactType.Category)},h.isGroup=function(){var n=h.contact();return!!(n&&n.type()===f.ViewModels.ContactType.Group)},h.contactRequiresEmail=function(){return!(h.isCategory()||h.isGroup())},h.isSameContact=function(n){var t=h.contact();return!!(t&&t.equals(n&&n.contact()))},h.tooltip=function(){var r,n,i;return h.error()?r=t.$Config.ContactPickerV2.InvalidAddress:(n=h.displayName(),i=h.email(),r=i&&n!==i?n+" <"+i+">":n),r},h.bindPropertyChange=function(n){h.$model.bind("propertyChange",n)},h.unbindPropertyChange=function(n){h.$model.unbind("propertyChange",n)},h.errorClass=function(){return h.error()?"cp_error":""},h.ctnrDivClass=function(){return h.isCategory()?"cp_ctnrExp":"cp_ctnr"},h.serialize=function(){var n=h.displayName().replace(/"/g,'\\"'),t;return h.isCategory()||h.isGroup()?'"'+n+'"':(t=h.email(),t?'"'+n+'" <'+t+">":n)},h.clone=function(){for(var i={},t,n=0,u=r.length;n<u;n++)t=r[n],i[t]=h.model[t];return new e(null,null,i)},l()}var t=window,o=n,i=t.wLive,r=["DisplayName","Email","SelectionText","Error","Contact"],u=i.ContactPickerV2,f=i.ContactList;u.ViewModels.SelectedContact=e}(window.originaljQuery||jQuery),function(n){function c(i){function o(){s(i)}function f(t,i){return i===undefined?i=e[t]:n.observable(e).setProperty(t,i),i}function s(n){var f,i;if(u.raw(n),n){n=n.replace(/\u200e|\u200f/g,""),n=n.trim();for(var b=new RegExp(r,"gi"),o,a=t.None,s=t.None;(currMatch=b.exec(n))!=null;){var c=currMatch[0],v=c.charAt(0),y=c.charAt(c.length-1);if(s=v==="<"&&y===">"?t.Bracketed:v==='"'&&y==='"'?t.Quoted:t.Bare,s>a&&(o=currMatch,a=s,s===t.Bracketed))break}if(i=n,o){f=o[0];var l=o.index,p=l+f.length,w=l>0?n.substr(0,l).trim():"",e=p<n.length?n.substr(p):"",k=h.exec(f);f=k[1],f.charAt(0)==="'"&&e&&e.charAt(0)==="'"&&(f=f.slice(1),e=e.slice(1).trim()),i=w===""?e:w,u.email(f.trim())}i=i.replace(/^\s*"\s*/,"").trim(),i.length>1&&i.charAt(i.length-2)!=="/"&&(i=i.replace(/\s*"$/,"")),i=i.replace(/\//g,""),i!==""&&i!==f&&u.name(i)}}var u=this,e={};u.email=function(n){return f("Email",n)},u.name=function(n){return f("Name",n)},u.raw=function(n){return f("Raw",n)},o()}function l(n){for(var i=n.split(u),t=i.length-1;t>=0;t--)i[t]=i[t].trim(),i[t].length===0&&i.splice(t,1);return i}var e=window,a=n,i=e.wLive||{},r="(?:[<\"]\\s*)?[a-z0-9\\u0080-\\uFFFF!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9\\u0080-\\uFFFF!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9\\u0080-\\uFFFF](?:[a-z0-9\\u0080-\\uFFFF-]*[a-z0-9\\u0080-\\uFFFF])?\\.)+[a-z0-9\\u0080-\\uFFFF](?:[a-z0-9\\u0080-\\uFFFF-]*[a-z0-9\\u0080-\\uFFFF])?(?:\\s*[>\"])?",o=new RegExp(r,"i"),s=new RegExp("[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@((?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?)","i"),h=/^[<"]?([^<>"]*)[>"]?$/,u=/[,;](?=(?:[^"]*"[^"]*")*(?![^"]*"))/,t={None:0,Quoted:1,Bare:2,Bracketed:3},f=i.ContactPickerV2=i.ContactPickerV2||{};wLive.ContactPickerV2.EmailAddressParser=c,f.EmailAddressParser.isValidEmailSyntax=function(n,t){return n?!!(t?s:o).exec(n.trim()):!1},wLive.ContactPickerV2.EmailAddressParser.parse=function(n){var i,r,t,u;if(!n)return[];for(i=l(n),r=[],t=0,u=i.length;t<u;t++)r.push(new f.EmailAddressParser(i[t]));return r},wLive.ContactPickerV2.EmailAddressParser.endsWithDelimiter=function(n){if(n){var t=n.split(u);return!t[t.length-1].trim()}return!1}}(window.originaljQuery||jQuery),function(n){function o(n,o,s){function nt(){a=t.extend({},e,o),t.each(s||[],function(n,t){h.selectContacts(t)}),p=a.errorOnDomains.split(";"),l.$.bind(f.ViewModels.FlatContactsDataModel.Events.initialize,b)}function y(n,t){return n?l.getContactByEmail(n):l.getContactByName(t)}function b(){for(var n,t=0,u=c.length;t<u;t++)n=c[t],n.contact()||(contact=y(n.email(),n.displayName()),contact&&h.modifySelectedContact(new r.EmailAddressParser(n.selectionText()),n,!0));h.$.triggerHandler(i.initialize)}function tt(n){var i=!1;return t.each(c,function(t,r){if(n.isSameContact(r))return i=!0,!1}),i}function it(n){var i=n.lastIndexOf("@"),r=n.substring(i+1).trim().toLowerCase();return t.inArray(r,p)!==-1}function rt(n){var t=n.email();return n.contactRequiresEmail()&&!t||!n.contact()&&it(t)}function w(n,t){var f=n.target.Id,r=h.getSelectedContactById(f);h.$.triggerHandler(i.editedContact,{model:h,contacts:[r],contact:r,change:t}),v[f]=r,u.cpThrottle("cpRefreshDirty"+g,20,k)}function k(){var u=[],n,f,r;for(n in v)f=v[n],r=h.indexOfSelectedContactId(n),t.observable(c).move(r,r,1),u.push(f);v={},h.$.triggerHandler(i.refreshedContacts,{model:h,contacts:[u]})}function ut(n){for(var f=[],i,e,u,t=0;t<n.length;t++)if(i=n[t],i.isCategory())for(e=h.getContactsByCategoryContact(i),u=0;u<e.length;u++)f.push(new r.ViewModels.SelectedContact(null,e[u]));else f.push(i);return f}var h=this;h.$=t(h);var l=n,a={},c=[],d=0,p,v={},g=Math.random().toString();h.getAlphabetHelper=function(){return l.getAlphabetHelper()},h.getContactList=function(){return l.getContacts()},h.getMergedContactList=function(){return l.getMergedContacts()},h.getPicwContactList=function(n,t){return l.getPicwContacts(n,t)},h.selectContacts=function(n,r,u){t.isArray(n)||(n=[n]),r=typeof r=="number"?r:c.length;var f=[],e=[],o=[],s=[],l=a.selectionMaximum;return a.autoExpandCategories&&(n=ut(n)),t.each(n,function(n,i){a.allowFreeformEntry||i.contact()?!a.allowDuplicateSelection&&tt(i)?o.push(i):l>0&&c.length+f.length>=l?s.push(i):(i.id(++d),i.bindPropertyChange(w),f.push(i)):e.push(i)}),f.length>0&&(t.observable(c).insert(r,f),h.$.triggerHandler(i.selectedContacts,{model:h,contacts:f,context:u})),e.length>0&&h.$.triggerHandler(i.freeformContactRejected,{model:h,contacts:e,context:u}),o.length>0&&h.$.triggerHandler(i.duplicateContactRejected,{model:h,contacts:o,context:u}),s.length>0&&h.$.triggerHandler(i.tooManyContactsRejected,{model:h,contacts:s,context:u}),f},h.addSelectedContact=function(n,t,i){return h.addSelectedContacts([n],t,i)},h.addSelectedContacts=function(n,t,i){for(var o=[],u=0;u<n.length;u++){var e=n[u],s=y(e.email(),e.name()),f=new r.ViewModels.SelectedContact(e,s);f.error(f.contactRequiresEmail()&&!f.email()),o.push(f)}return h.selectContacts(o,t,i)},h.modifySelectedContact=function(n,t,i){var r=t.contact(),u,f;r||(r=y(n.email(),n.name())),n&&(u=n.name(),f=n.email(),t.selectionText(n.raw())),t.displayName(r&&r.displayName()?r.displayName():u),i&&u&&t.displayName(u),t.email(r&&r.email()?r.email():f),t.error(rt(t)),t.contact(r)},h.refreshContacts=function(){k()},h.contactExists=function(n){if(!n)return!1;var t=y(n.email(),n.name());return!!t},h.getContactsByCategory=function(n){return l.getContactsByCategory(n)},h.getContactsByCategoryContact=function(n){var t=n.contact(),i=t.id();return h.getContactsByCategory(i)},h.deselectContactByIndex=function(n){return n>=0&&(selectedContact=c[n],selectedContact.unbindPropertyChange(w),t.observable(c).remove(n,1),h.$.triggerHandler(i.deselectedContacts,{model:h,contacts:[selectedContact]})),null},h.deselectContactBySelectedContactId=function(n){return h.deselectContactByIndex(h.indexOfSelectedContactId(n))},h.indexOfSelectedContactId=function(n){var i=-1;return t.each(c,function(t,r){if(n===r.id())return i=t,!1}),i},h.getSelectedContactByIndex=function(n){return c[n]},h.getSelectedContactById=function(n){return h.getSelectedContactByIndex(h.indexOfSelectedContactId(n))},h.selectedContacts=function(n){return n?c:c.clone()},h.countSelected=function(){return c.length},h.canAddMoreContacts=function(){var n=a.selectionMaximum;return n===0||h.countSelected()<n},h.serializeSelection=function(){var n=[];return t.each(c,function(t,i){n.push(i.serialize())}),n.join("; ")},h.dispose=function(){if(h){for(var n=0;n<c.length;n++)c[n].unbindPropertyChange(w);h.$.unbind(),l.$.unbind(f.ViewModels.FlatContactsDataModel.Events.initialize,b),c=l=p=a=h=h.$=null}},nt()}var s=window,t=n,u=s.wLive,f=u.ContactList,r=u.ContactPickerV2,i,e;r.ViewModels.ContactPickerModel=o,i=o.Events={initialize:"initialize",selectedContacts:"selectedContacts",deselectedContacts:"deselectedContacts",editedContact:"editedContact",refreshedContacts:"refreshedContacts",freeformContactRejected:"freeformContactRejected",duplicateContactRejected:"duplicateContactRejected",tooManyContactsRejected:"tooManyContactsRejected"},e={allowDuplicateSelection:!0,selectionMaximum:0,allowFreeformEntry:!0,autoExpandCategories:!1,errorOnDomains:"home.com;attbi.com;example.com;hotmail.co;yaho.com;hotmai.com;yahoo.co;yahoomail.com;direcway.com;homail.com;ims-ms-daemon;local.transport;ethome.net.tw;ethome.net.tw;hotmil.com;hotmial.com;yhoo.com;collegeclub.com;sbcglobal.com;hotamil.com;yaoo.com;yahoo.net;yhaoo.com;mail.hotmail.com;passport.com;kimo.com.tw;yahooo.com;yahho.com;ol.com;gateway.net;hotmail.com.mx;otmail.com;htomail.com;aol.co;altavista.com;hotmaill.com;taiwan.com;hotmail.con;ahoo.com;hotmail.om;hotmail.net;hormail.com;hotail.com;hotamail.com;yahoo.om;homtail.com;msn.net;sprint.ca;angelfire.com;cm1.ethome.net.tw;yohoo.com;a0l.com;alo.com;msn.de;gmail.co"}}(window.originaljQuery||jQuery),function(n){function h(n,t,i,r,u){var f=this;f._grid=n,f._contact=t,f.uniqueId=t.clientId(),f._searchQuery=i,f._useListDisplayName=r,f._showRemoveButtons=u}var t=window,c=n,i=t.wLive,l=i.ContactList,r=l.ViewModels,f=i.ContactPickerV2,y=f.ViewModels,e="CL_Hov t_cp_hov",a="CL_Sel",v=t.$Config.imgsBase+"ic/groupsnmxl.png",u=r.ContactType,o=r.SearchableProperties,s=r.SearchablePropertyTypes;f.Controls.ContactListTile=h,h.prototype={uniqueId:null,_grid:null,_$container:null,_top:-1,_left:-1,_isDirty:!1,_contact:null,_pendingUpdates:null,_propertyChangeProxy:null,render:function(n,t,i){var r=this;r._$container?((t!==r._top||i!==r._left)&&(r._$container.css({top:t,left:i}),r._top=t,r._left=i),r._renderUpdates()):(r._onBeforeRender(),r._$container=r._grid.createTile(r.uniqueId,t,i,r._getHtml(),r._getCssClasses(),r._getStyles()),r._top=t,r._left=i,r._ic&&r._ic.activate(r._$container.find(".c_ic")))},_searchQuery:null,_onBeforeRender:function(){var n=this;n._propertyChangeProxy=function(t,i){n.onPropertyChange(t,i)},n._contact.bindPropertyChange(n._propertyChangeProxy)},_makeBold:function(n,t,r){return i.Search.Helpers.makeBold(n,t,r)},_getHtml:function(){var n=this,r=n._contact,t=n._useListDisplayName?r.listDisplayName():r.displayName(),i=r.email()||"",u={displayName:null,fieldHtml:null},s,e,h,f;if(t===i&&(i=""),n._searchQuery){if(t=n._makeBold(t,n._searchQuery,!1),s=t!==n._makeBold(r.displayName(),"",!1),e=i||"",i=n._makeBold(e,n._searchQuery,!0),h=i!==n._makeBold(e,"",!0),!h&&!s)for(f=0;f<o.length;f++){var l=o[f],a=l.properties,v=l.type;if(n._findHiddenMatches(a,v,r,u)){t=u.displayName||t;break}}}else t=t.encodeHtml(),i=i.encodeHtml();return c.templates("#cp_contactListTileTemplate").render({displayNameHtml:t,hasUserTile:function(){return!0},userTileHtml:n._getUserTileHtml(),emailHtml:i,hidden:u.fieldHtml?u:null,removeButtonEnabled:n._showRemoveButtons})},_findHiddenMatches:function(n,i,r,u){for(var l=this,f=0;f<n.length;f++){var o=n[f],a=r[o]()||"",e=l._makeBold(a,l._searchQuery,i===s.email);if(e!==a.encodeHtml()){if(i===s.name){var h=r.firstName()||"",c=r.lastName()||"",h=o==="firstName"?e:h.encodeHtml(),c=o==="lastName"?e:c.encodeHtml();u.displayName=t.$pwc.names.formatName(r.nameType(),r.reverseName()?"displayNameReverse":"displayName",null,h,null,c,null)}else u.fieldHtml=e;return!0}}return!1},_getUserTileHtml:function(){var r=this,t=r._contact,n=null,i;return t.type()===u.Person?n=$icm.createICForPerson("CPV2_contactList",t.id(),{showICCard:!0}):(i={},(t.type()===u.Category||t.type()===u.Group)&&(i.userTileUrl=v),n=$icm.createNonContactIC("CPV2_contactList","",i)),r._ic=n,n&&n.render()||""},_getCssClasses:function(){if(this._contact.isSelected())return["CL_Sel"]},_getStyles:n.noop,_renderUpdates:function(){var n=this,t;n._pendingUpdates&&(t=n._pendingUpdates.IsSelected,t!==undefined&&n._$container.toggleClass(a,t),n._pendingUpdates=null)},onPropertyChange:function(n,t){var i=this;i._pendingUpdates=i._pendingUpdates||{},i._pendingUpdates[t.path]=t.value,i._grid.isVisible(i._top)&&i._renderUpdates()},mouseover:function(){this._$container.toggleClass(e,!0)},mouseout:function(n){this._$container.toggleClass(e,!1),this.triggerEvent(n,"mouseoutContact")},mousedown:function(n){this.triggerEvent(n,"mousedownContact")},click:function(n){this.triggerEvent(n,"clickContact")},triggerEvent:function(n,t){var i=this,r={contact:i._contact,tile:i,target:n.target};setTimeout(function(){i._grid&&i._grid.$.triggerHandler(t,r)},0)},remove:function(){var n=this;n._$container&&(n._$container.empty(),n._$container=null),n._ic&&window.$icm&&($icm.removeIC(n._ic),n._ic=null),n.dispose()},dispose:function(){var n=this;n._propertyChangeProxy&&(n._person&&n._person.unbindPropertyChange(n._propertyChangeProxy),n._propertyChangeProxy=null),n._grid=n._contact=n._searchQuery=null},itemEquals:function(n){return this._contact.equals(n)}}}(window.originaljQuery||jQuery),function(n){function i(){}function a(u,f,e){function p(n){v?n():$Do.when("wlxsearchshared",0,function(){$Do.when("$pwc",0,function(){$pwc.callWhenReady(function(){s=new t.Search.Indexer(y),s.initialize(e.getMergedContactList(),!1,function(){v=!0,n()})})})})}function w(n){t.cpThrottle("SearchControl",100,function(){if(n.keyCode!==c&&n.keyCode!==l){var t=o.getQuery(n.target);o.show(t)}})}var o=this;o.$=n(o);var a=r(u).delegate(f,h,w),v=!1,s,y=new wLive.ContactList.ViewModels.ContactsHelper;o.dispose=function(){a.undelegate(),o.$.unbind(),o=o.$=a=null},o.getQuery=function(n){return r(n).val()},o.show=function(n){p(function(){var t=new i,r;t.query=n,n&&n!==""?(r=s.getMatches(n,25),t.contacts=r.result):t.contacts=[],o.$.triggerHandler("search",t)})}}var s=window,r=n,t=s.wLive,u=t.ContactList,v=u.Controls,f=u.ViewModels,e=t.ContactPickerV2,o=e.Controls,y=e.ViewModels,h="keyup.SearchControl",c=9,l=27,p=f.SearchablePropertyTypes,w=f.SearchableProperties;o.SearchResults=i,i.prototype={contacts:[],query:""},o.SearchControl=a}(window.originaljQuery||jQuery),function(n){"use strict";function t(){function u(n){n.ic&&n.ic.activate()}function i(n){n.ic&&window.$icm&&($icm.removeIC(n.ic),n.ic=null)}var t="cp_inputContactTemplate",r={templateId:t,template:n.templates("#"+t),attr:"html",init:function(n){this.data=n.ctx.selectedContact},render:function(){i(this.data)},onAfterLink:function(){u(this.data)},onDispose:function(){i(this.data)}};n.views.tags({cp_selectedContactControl:r})}$Do.when("CPV2_templates",0,t)}(window.originaljQuery||jQuery),function(n){function wi(n){for(var t in vt)if(vt[t]===n)return!0;return!1}function i(vt,bi,ki){function ve(){yf(),nr=bi,nr.$.bind(f.selectedContacts,bu),nr.$.bind(f.refreshedContacts,bu),nr.$.bind(f.initialize,ne),vr=nr.getContactList(),hr=n(vt),iu=hr.find("."+lt),hr.addClass("t_cpv2 cpv2");hr.on("focusin.cpv2",ao).on("focusout.cpv2",vo).on("copy.cpv2",be);pe(),ye(),ur.assignLegacyAutomationIds&&tr.attr("id",hr.attr("id")+"$InputBox"),n(r).bind("resize",hf),lr&&lu&&lr.bind("keydown",te),ss()}function yf(){vf=ui*ur.maxLinesInAddressWell;var t=ur.maxHeight;yr=typeof t=="object"||typeof t=="string"?n(t):null,n.isPlainObject(ur.toggleContactListTransitions)||(ur.toggleContactListTransitions=nt)}function ye(){er=n("<div/>",{"class":"cp_inputContainer"}).appendTo(hr).delegate(ci,"click",co).delegate(at,"focusin",ro).delegate(at,"click",uo).delegate(l,"click",fo).delegate(l,"keydown",wo).delegate(l,"focusin",eo).delegate(l,"mousedown",oo).delegate(l,"mouseout",so).delegate(l,"focusout",ho).delegate(o,"dblclick",ns).delegate(s,"keyup",de).delegate(s,"paste",ke).delegate(s,"keydown",yo).delegate(s,"keypress",po).delegate(yi,$B.IE&&$B.V<=8?"focus":"focusin",lo).link(n.templates("#cp_inputTemplate"),{selectedContacts:nr.selectedContacts(!0),ariaLabel:ur.ariaLabel}),or=er.find(li),ru=er.find(vi),tr=er.find(s);var t=gf(iu,!0);tr.val(t),nr.selectedContacts(!0).length===0?nu(tr):su(tr),kr=new a.Controls.SearchControl(vt,s,nr),kr.$.bind("search",ae),r.document.activeElement===iu[0]&&di.setFocus(),iu.hide(),rf=n("<textarea>",{tabIndex:"-1",autocomplete:"off","class":"cliparea"}).appendTo(hr)}function vu(t){var i=n(t);gf(i),i.val("")}function pe(){sr=n("<div/>",{"class":"cp_clist"}).hide().html(n.templates("#cp_contactListContainerTemplate").render({})).appendTo(hr),sutra(sr,"$Sutra.Shared.ContactPicker"),nf=sr.find(".VirtualizedGrid"),gu=sr.find(".GridContainer"),tf=sr.find(ai)}function pf(t){lf(!0),cf(),gi=new tt.ContactList.Controls.VirtualizedGrid(nf,vr,di,{letterHeader:t,alphabetHelper:nr.getAlphabetHelper(),itemClass:"CL_Row",containerHeight:n(window).height(),supportsHover:!0,maxColumns:1,height:60,fadeBackground:!1},null,sr),gi.render(),gi.$.bind("clickContact",ge),gi.$.bind("clickLetter",no),gi.$.bind("mousedownContact",to),gi.$.bind("mouseoutContact",io),af(!0),setTimeout(function(){ku()},0),tf.toggleClass(oi,!!(fr!==u||cr&&cr!=="")),gi.scrollTo(0),ie()}function we(n,t){for(var i=0;n.length;)n.charAt(0)===t&&(i+=1),n=n.slice(1);return i}function wf(t){var u=n(t.target),o=u.val(),s=we(o,'"')%2,f=t.which===ft&&!(t.ctrlKey||t.shiftKey),h=!f,i=f,e,r;if(u[0]===tr[0]&&!nr.canAddMoreContacts())return setTimeout(function(){tr.val(""),di.$.triggerHandler(v.maxSelectedContactsReached)},0),!1;if(t.type==="keypress"&&!s)for(i=!1,e=t.charCode||t.keyCode,r=0;r<et.length;r++)if(e===et[r]){i=!0;break}return i&&kf(t,h),i}function bf(n,t){var r=!1,i;t||(i=n.val(),i.length>0&&(rr<0||!gi||i!==cr)&&kr.show(i),$Do.when("wlxsearchshared",0,function(){rr>=0&&gi&&(ef(n,gi.getTile(rr)._contact),r=!0)})),$Do.when("wlxsearchshared",0,function(){(t||!r)&&(vu(n),setTimeout(function(){di.setFocus(!1),ar()},0))})}function kf(t,i){bf(n(t.target),i),t.stopPropagation()}function be(){wr.triggerHandler(v.userAction,{type:w.copy,input:e.none})}function ke(t){setTimeout(function(){vu(t.target),nu(n(t.target)),wr.triggerHandler(v.userAction,{type:w.paste,input:e.none})},0)}function de(t){nu(n(t.target))}function df(n){var r=n.hasClass(y),t=n.val(),i;return!t||t.length===0?[]:(t=t.replace(/[\r\n]+/g,ei),i=a.EmailAddressParser.parse(t),n.val(""),su(n),i)}function gf(n,t){var e=n.hasClass(y)||n.hasClass(lt),c=uu(n),u=df(n),o="",f,i,r,s,h;if(t&&u.length>0&&!a.EmailAddressParser.endsWithDelimiter(n.val())&&(o=u.pop().raw()),!e){i=n.view();do r=i.data,i=i.parent;while(!r&&i);r&&(f=nr.indexOfSelectedContactId(r.id()))}return s={entryPt:p.freeform},h=nr.addSelectedContacts(u,f,s),e||nr.deselectContactByIndex(f+h.length),o}function uf(n,t){var i=n.data,r;if(i&&i.editing()!==t)return $selectedContactElt=wu(or,i.id()),r=$selectedContactElt.width(),i.editing(t),setTimeout(function(){if(nr.refreshContacts(),t){var n=br();n.css("min-width",r),nu(n),kr.show(i.selectionText()),di.setFocus(!1)}},0),i}function ne(){he()&&ar()}function ge(t,i){var r,u,f;gi&&(r=i.contact,u=i.tile,n(i.target).closest(".CL_Remove").length>0?wr.triggerHandler(v.removeContactListEntry,[i]):(tr.val()===""&&(fu(rr,gi.getTileCount()),rr=gi.getTileIndex(u),yu(rr)),f=br(),ef(f,r)))}function no(){di.setFocus()}function to(n,t){var i=t.tile;i._$container.toggleClass(k,!0)}function io(n,t){if(gi){var i=t.tile;rr&&gi.getTile(rr)!==i&&i._$container.toggleClass(k,!1)}}function br(){var n=er.find(d);return n.length===0&&(n=tr),n}function uu(t){return n(t).closest(o)}function ro(){cu=!1}function uo(t){var i=n.view(t.target).data;eu(i.id(),{input:e.mouse}),di.setFocus(),t.preventDefault()}function fo(t){var i=n.view(t.target).data;i&&tu(i,wu(tr,i.id())),t.preventDefault()}function eo(){cu=!1}function oo(t){var r=n.view(t.target).data,i;ir&&r===ir.contact||(i=uu(t.target),i.addClass(b))}function so(t){var r=n.view(t.target).data,i;ir&&r===ir.contact||(i=uu(t.target),i.removeClass(b))}function ho(n){var t=uu(n.target);ir.$contactElt&&t[0]===ir.$contactElt[0]&&ou()}function co(t){var i=n.view(t.target).data,r,u;i.isCategory()&&(r=i.id(),u=nr.getContactsByCategoryContact(i),ef(n(t.target),u,nr.indexOfSelectedContactId(r)),eu(r,{type:w.expandCategory,input:e.mouse}),di.setFocus()),t.preventDefault()}function lo(t){ou(),pr&&cr===n(t.target).val()&&br()[0]===tr[0]||ar()}function ao(){cu&&!or.hasClass(ut)&&setTimeout(di.setFocus,0),or.addClass(ut),cu=!0,ff(),ko()}function vo(){setTimeout(function(){document.activeElement&&pu()||or&&or.removeClass(ut)},50),au=setTimeout(function(){dr&&!pu()&&(ff(),di.completeUserEntry(),di.hideContactList()),dr=!0},1e3)}function yo(t){var u=n(t.target).hasClass(y),i=u?n(t.target).val()==="":!1,r;if(!re(t))switch(t.keyCode){case ht:if(u)if(i){if(pr)return di.hideContactList(),t.stopPropagation(),!1}else return setTimeout(function(){n(t.target).val("")},0),ar(),t.stopPropagation(),!1;else return uf(n.view(t.target),!1),setTimeout(function(){di.setFocus(!1),ar()},0),t.stopPropagation(),!1;break;case st:case ot:if(i&&of())return t.stopPropagation(),!1;break;case kt:return gr(1,!0),t.stopPropagation(),!1;case bt:return gr(-1,!0),t.stopPropagation(),!1;case gt:if(gi)return gr(gi.getTileCountPerPage(),!0),t.stopPropagation(),!1;break;case dt:if(gi)return gr(-gi.getTileCountPerPage(),!0),t.stopPropagation(),!1;break;case it:if(r=!0,i?di.hideContactList():(kf(t),r=!1),t.shiftKey||r){if(t.shiftKey&&lr&&lu)return setTimeout(function(){lr.focus()},0),t.stopPropagation(),!1}else return setTimeout(function(){di.setFocus(!1),ar()},0),t.stopPropagation(),!1;break;default:return!wf(t)}}function po(n){wf(n)}function te(n){if(n.keyCode===it&&!n.shiftKey)return di.setFocus(!1),n.stopPropagation(),!1}function gr(n,t){if(!gi)return!1;var f=n/Math.abs(n),i=rr+n,r=gi.getTileCount(),u=!1;for(rr>0&&i<0?i=yu(0)||rr===1?0:1:rr<r-1&&i>=r&&(i=r-1);0<=i&&i<r;){if(yu(i)){u=!0;break}i+=f}return u?(fu(rr,r),rr=i):t&&(f<0?(fu(rr,r),rr=gi.getTileCount(),u=gr(-1,!1)):(fu(rr,r),rr=-1,u=gr(1,!1))),u}function ie(){var t,i,n;if(gi)if(t=er.find(d),t.length===0||r.document.activeElement===tr[0])tr.val()!==""?(rr=-1,gr(1,!1)):(fu(rr,gi.getTileCount()),rr=-1);else if(i=t.view().data.contact(),i){for(n=vr.length-1;n>=0;n-=1)if(vr[n]===i){rr=n,yu(n);break}}else rr=-1,gr(1,!1)}function yu(n){var i,t,r;if(gi)return i=!1,t=gi.getTile(n),gi.isItemVisible(n)||(gi.scrollTo(n),gi.render()),t._contact&&t._$container&&(t._$container.addClass(k),r=br(),r.attr("aria-activedescendant",t._$container.prop("id")),i=!0),i}function fu(n,t){if(gi&&0<=n&&n<t){var i=gi.getTile(n);i._$container&&i._$container.toggleClass(k,!1)}}function wo(t){var r=n.view(t.target).data.id(),i={input:e.key};if(!re(t))switch(t.keyCode){case ot:return of()||sf()||di.setFocus(!0),eu(r,i),t.stopPropagation(),!1;case pt:sf()||di.setFocus(!0),eu(r,i);break;case st:of();break;case wt:sf()||(ou(),di.setFocus(!0));break;case ft:ce(t.target,i);break;case ht:di.setFocus(!0),t.stopPropagation();break;case it:if(t.shiftKey&&lr&&lu)return lr.focus(),t.stopPropagation(),!1}}function re(n){var t=!1,i,r;if((n.metaKey||n.ctrlKey)&&(i=n.keyCode===ii,r=bo(),!r.hasText||i))switch(n.keyCode){case ni:ue(),t=!0;break;case ti:ue(function(){ir.contact&&(eu(ir.contact.id(),{input:e.key}),di.setFocus())}),t=!0}return t}function bo(){var i=!1,u=-1,f=-1,n=document.activeElement,t,e;try{"selectionStart"in n&&(u=n.selectionStart,f=n.selectionEnd,i=f-u>0)}catch(o){}return i||(t=r.$f.getSelectedText(),i=!!t.text,i&&u===-1&&t.parentElement()===n&&"value"in n&&(e=t.text.length,t.moveStart("character",-n.value.length),f=t.text.length,u=f-e)),{hasText:i,start:u,end:f}}function ue(n){var t=ir.contact,i,r;t&&(i=ir.$contactElt,r=t.serialize(),rf.val(r).focus().select(),setTimeout(function(){tu(t,i),n&&n()},0))}function ko(){n(document.body).on("mousedown click dblclick",fe)}function ff(){go(),n(document.body).off("mousedown click dblclick",fe)}function go(){au&&clearTimeout(au),au=0,dr=!0}function fe(t){if(t&&t.target){var r=t.target,i=n(r);if(i.closest(".LetterPickerContainer").length>0){dr=!1;return}if(i.closest(hi).length>0){dr=!1;return}if(lr&&se(lr[0],i[0])){br()[0]===tr[0]?di.completeUserEntry():(ee(),setTimeout(function(){di.setFocus(!1)},0)),dr=!1;return}if(i.hasClass(ct)&&oe(i)){dr=!1;return}if(ee(),t.type!=="mousedown"&&pu()||t.type==="mousedown"&&t.target===document.activeElement){dr=!1;return}di.completeUserEntry(),di.hideContactList()}}function ee(){var n=er.find(d);n.length!==0&&bf(n,!1)}function oe(n){return se(hr,n)}function se(t,i){return n(i).closest(t).length===1}function he(){return pr||pu()}function pu(){return oe(document.activeElement)}function ns(n){ce(n.target,{input:e.mouse})}function ce(t,i){uf(n.view(t),!0),i&&wr.triggerHandler(v.userAction,n.extend({type:w.editContact,input:e.none},i))}function ef(t,i,r){var f,o,s,l,v;t.hasClass(rt)||(t=tr);var w=t.hasClass(y),b=uu(t),c=df(t),e;for(c.length>0&&(e=c[0]),su(tr),n.isArray(i)||(i=[i]),f=0,w||(o=uf(t.view(),!1),o.contact(i[0]),nr.modifySelectedContact(e,o,!1),f=1),s=[];f<i.length;f++)s.push(new a.ViewModels.SelectedContact(e,i[f]));l=cr?p.autocomplete:fr===h?p.contactpicker:p.relevancy,nr.selectContacts(s,r,{entryPt:l}),v=!(t[0]===tr[0]&&t.val()===0),t.val(""),ou(),setTimeout(function(){ur.excludeSelectedFromFrequentList&&fr===u&&ar(!0),di.setFocus(v),ku()},0)}function eu(t,i){var r=nr.getSelectedContactById(t);r===ir.contact&&(ir={}),nr.deselectContactBySelectedContactId(t),ur.excludeSelectedFromFrequentList&&fr===u&&pr&&ar(!0),nu(),setTimeout(ku,0),i&&wr.triggerHandler(v.userAction,n.extend({type:w.deleteContact,input:e.none},i))}function tu(n,t){ou(),n.editing()||(ir={contact:n,$contactElt:t},t.addClass(b),t.find(l).focus(),di.hideContactList())}function ou(){ir.$contactElt&&(ir.$contactElt.removeClass(b),ir={})}function of(){var i=!1,t,r,u,f;return ir.contact&&ir.$contactElt?(r=nr.indexOfSelectedContactId(ir.contact.id())-1,r>=0&&(u=nr.getSelectedContactByIndex(r),f=n(ir.$contactElt.prevAll(o)[0]),tu(u,f),i=!0)):(t=le(),t.contact&&t.$contactElt&&(tu(t.contact,t.$contactElt),i=!0)),i}function sf(){var t,i,r;return!ir.contact||!ir.$contactElt?!1:(t=nr.indexOfSelectedContactId(ir.contact.id()),t<nr.selectedContacts(!0).length-1?(t+=1,i=nr.getSelectedContactByIndex(t),r=n(ir.$contactElt.nextAll(o)[0]),tu(i,r),!0):!1)}function le(){var i=nr.selectedContacts(!0),r=i.length-1,t=null,n=null;return r>=0&&(t=i[r],n=wu(tr,t.id()),n[0]||(n=er.find(d).closest(o))),{contact:t,$contactElt:n}}function wu(t,i){var r=n(t).closest(si);return r.find(o+"[cid='"+i+"']")}function ae(t,i){var e,f;if(!r.document.activeElement||br()[0]!==tr[0]||(e=n(r.document.activeElement),e.hasClass(rt))){if(f=br(),f[0]!==tr[0]&&(fr===u||fr===g)&&f.val()===""){di.hideContactList();return}cr===i.query&&gi&&pr||(i.query===""?ar():es(i.query,i.contacts.sort(pi.ViewModels.SortHelpers.picwComparer)),ie())}}function bu(){setTimeout(function(){nu(tr)},0)}function su(n,t){t=t||parseInt(n.css("min-width"),10)||0;var i=Math.max(t,us(n.val())),r=or[0].clientWidth;return r!==0&&(i=Math.min(i,r-c)),n.width(i),i}function nu(n){var i,u,f;if((n&&su(n),tr)&&(i=or[0].clientWidth,i!==0)){var e=or.position().left,t=e+i-c,r=le();r.$contactElt&&(u=r.$contactElt.position().left,$B.rtl?t=u-c:t-=u+r.$contactElt[0].clientWidth),f=!1,t<c&&(t=i-c,f=!0),tr.width(0),t=su(tr,t),or.css("max-height",vf+"px"),setTimeout(function(){tr&&or&&(f&&(t=or[0].clientWidth-c),tr.width(0),tr.width(t),pr&&cf(),ts())},0)}}function ts(){var i=n(r.document.activeElement).closest(s);i=i.length>0?i:tr;var t=i[0],f=or.scrollTop(),u=0;if(t){while(t&&t!==or[0])u+=t.offsetTop,t=t.offsetParent;(u<f||u>f+or.height())&&or.scrollTop(u)}}function ku(){var n=is(),t=Math.max(ri,or.innerWidth());return sr.width(t),sr.height(n),n=rs(n),gi&&gi.resize(),{width:t,height:n}}function is(){var n=ur.maxHeight,i,r,t;if(yr&&yr.length>0)i=parseInt(yr.css("padding-bottom"),10),r=hr.offset().top+hr.outerHeight()-yr.offset().top,n=yr.innerHeight()-r-i;else{t=sr.outerHeight()-sr.innerHeight(),n=n&&n>0?n-er.outerHeight()-t:Number.MAX_VALUE;var u=$f.getLocation(er[0]),f=$f.clientHeight(),e=u.addScrollTop!=-1?$f.scrollTop():0;n=Math.min(f+e-u.bottom-t-ur.contactListBottomMargin,n)}return Math.max(fi,n)}function rs(n){return n=Math.min(n,gu.outerHeight()),sr.height(n),n}function hf(){var n=ur.shouldRefreshLayoutCb;(!n||n())&&ku()}function us(n){ru.text(n);var t=ru.innerWidth();return ru.text(""),t+c}function cf(){r.$f.dockIt(sr[0],er[0],0,-1,1)}function ar(n){var t=[],f=!1,i,e,r,o;if(fr===g)f=!0;else{if(i=null,ur.excludeSelectedFromFrequentList&&fr==u)for(e=nr.selectedContacts(),i=[],r=0;r<e.length;r++)o=e[r].contact(),o&&i.push(o);t=fr===u?nr.getPicwContactList(ur.numFrequentContactsShownLimit,i):nr.getContactList(),cr="",t.length>0?!n&&pr&&fs(t,vr)||(du(),vr=t,pf(fr===h)):f=!0}f&&(du(),vr=t,di.hideContactList())}function fs(t,i){var u=t===i,r;if(t&&i&&!u&&t.length===i.length)for(u=!0,r=0;r<t.length;r++)if(t[r]!==i[r]){u=!1;break}return u}function es(n,t){du(),vr=t,cr=n,vr.length>0?pf(!1):di.hideContactList()}function du(){gi&&gi.dispose(),gi=null,vr=null,rr=-1}function os(n){var t=br(),i=t.length>0?t.val():tr.val(),r=fr;fr=typeof n=="undefined"?ur.toggleContactListTransitions[fr]:n,wi(fr)||(fr=h),i===""||fr===h?ar(fr!==r):t.keyup(),gi&&(lf(!0),af(!0),cf())}function lf(n){sr.toggle(n).attr("aria-hidden",!n),pr=n}function af(n){if(er.find(s).attr("aria-expanded","false").removeAttr("aria-owns").removeAttr("aria-activedescendant"),n){var t=br();t.attr("aria-owns",gi.getAriaListId()).attr("aria-expanded","true")}}function ss(){i._dragDropContext=null;er.on("dragenter"+t,ys).on("dragover"+t,ps).on("drop"+t,ws);nr.$.on(f.selectedContacts+t,hu).on(f.refreshedContacts+t,hu).on(f.editedContact+t,hu).on(f.initialize+t,hu);hu()}function hu(){var n=er.find(o).off(t).on("dragstart"+t,ls).on("dragend"+t,as).on("drag"+t,vs);if(n.length>0&&n[0].dragDrop)n.on("mousemove"+t,cs)}function hs(){er.off(t),er.find(o).off(t),nr.$.off(t)}function cs(n){var t=n.target;t.dragDrop&&n.button===1&&t.dragDrop()}function ls(t){var r=n.view(t.target).data,u,f,e;wr.triggerHandler(v.dragStart),di.hideContactList(),u=t.originalEvent.dataTransfer,u.setData("Text",r.serialize()),u.setDragImage||(f=n("<div />",{"class":"cpv2_dragtip t_blc"}).text(r.displayName()).css("position","absolute").css("visibility","hidden").css("z-index","10000000").appendTo("body")),e=i._dragDropContext={contact:r,picker:di,dropped:!1,$dragEffectNode:f}}function as(){setTimeout(function(){var n=i._dragDropContext;i._dragDropContext=null,n.$dragEffectNode&&n.$dragEffectNode.remove(),n.dropped&&nr.deselectContactBySelectedContactId(n.contact.id())},1)}function vs(n){var t=i._dragDropContext.$dragEffectNode,r=n.originalEvent;t&&t.css("visibility","visible").offset({top:r.pageY+5,left:r.pageX+5})}function ys(){di.hideContactList()}function ps(n){i._dragDropContext&&n.preventDefault()}function ws(n){var t=i._dragDropContext,r,u;t&&(t.picker!==di&&(t.dropped=!0,r=nr.selectContacts([t.contact.clone()],null,{entryPt:p.freeform}),r.length>0?(u=r[0],tu(u,wu(tr,u.id()))):di.setFocus()),n.preventDefault())}var di=this,nr=null,gi=null,kr=null,vr=[],cr="",ur=n.extend({},yt,ki||{}),hr=null,iu=null,er=null,or=null,tr=null,sr=null,gu=null,nf=null,tf=null,ru=null,rf=null,ir={contact:null,$contactElt:null},cu=!0,vf=105,rr=-1,fr=ur.showContactListOnFocus,lr=ur.$toggleButton,yr=null,lu=ur.handleButtonFocus,pr=!1,au=0,dr=!0,wr=di.$=n(di);di.createTile=function(t,i){return new a.Controls.ContactListTile(t,i,cr,fr===h&&!cr,n.inArray(fr,ur.enableRemoveButtonForModes)>=0&&!cr)},di.toggleContactList=function(n){os(n),di.setFocus(!1)},di.hideContactList=function(){gi&&gi.closeLetterPicker(),pr&&(lf(!1),af(!1)),rr=-1,fr=ur.showContactListOnFocus},di.addFreeformSelection=function(n){tr.val(n),vu(tr)},di.refreshLayout=function(){hf(),nu()},di.setFocus=function(n){var i,t,r,u;if(wr){i=br(),nu(i);try{i.focus()}catch(f){return}t=i[0],t.createTextRange?(r=t.createTextRange(),r.moveStart("character",t.value.length),r.collapse(),r.select()):(u=t.value,t.value="",t.value=u),n&&i&&i.keyup()}},di.completeUserEntry=function(){return vu(tr)},di.hasIncompleteUserEntry=function(){return!!tr.val()},di.resetSettings=function(t){var r=ur,i;delete t.$toggleButton,ur=n.extend({},ur,t||{}),yf(),i=ur.showContactListOnFocus,i!==r.showContactListOnFocus&&i!==fr&&(fr=i,!cr&&he()&&ar()),di.refreshLayout()},di.dispose=function(){wr&&(du(),hs(),wr.unbind(),er.unbind(),tr.unbind(),sr.remove(),pr=!1,ff(),hr.off(".cpv2"),nr.$.unbind(f.selectedContacts,bu),nr.$.unbind(f.refreshedContacts,bu),nr.$.unbind(f.initialize,ne),n(r).unbind("resize",hf),lr&&lu&&lr.unbind("keydown",te),kr&&(kr.$.unbind("search",ae),kr.dispose()),hr.empty(),ir&&(ir.contact=ir.$contactElt=null),kr=ur=vt=hr=iu=er=or=tr=sr=gu=nf=wr=tf=ru=rf=lr=yr=null)},ve()}var r=window,tt=r.wLive,yt={maxHeight:400,contactListBottomMargin:60,maxLinesInAddressWell:3,showContactListOnFocus:u,toggleContactListTransitions:null,numFrequentContactsShownLimit:0,excludeSelectedFromFrequentList:!1,handleButtonFocus:!1,$toggleButton:null,shouldRefreshLayoutCb:null,enableRemoveButtonForModes:[],assignLegacyAutomationIds:!1,ariaLabel:r.$Config.ContactPickerV2.DefaultAriaLabel},ft=13,et=[44,59],it=9,ot=8,pt=46,st=37,wt=39,bt=38,kt=40,dt=33,gt=34,ht=27,ni=67,ti=88,ii=86,ri=200,c=35,ui=35,fi=60,ei="; ",b="cp_selected t_bci",oi="CL_RelatedHidden",y="cp_primaryInput",ct="cp_editInput",rt="cp_anyInput",k="CL_Highlight t_bci",lt="cp_textarea",ut="Focus",si=".cpv2",hi=".cp_clist",o=".cp_Contact",ci="a.cp_exp",l="a.cp_ctBtn",at="a.cp_remBtn",li=".cp_inputArea",ai=".CL_Related",vi=".cp_textRuler",yi="."+y,s="."+rt,d="."+ct,t=".cpdd",g=0,u=1,h=2,a=tt.ContactPickerV2,pi=tt.ContactList,vt=i.ListMode={none:g,related:u,full:h},nt=i.DefaultTransitions={};nt[g]=u,nt[u]=h,nt[h]=u;var p=i.EntryPoints={relevancy:1,autocomplete:2,contactpicker:3,freeform:4},w=i.UserActionType={deleteContact:1,editContact:2,expandCategory:3,copy:4,paste:5},e=i.UserActionInput={none:0,mouse:1,key:2},v=i.Events={userAction:"userAction",removeContactListEntry:"removeContactListEntry",dragStart:"dragStart",maxSelectedContactsReached:"maxSelectedContactsReached"},f=a.ViewModels.ContactPickerModel.Events;a.Controls.ContactPicker=i,$Do.register("WLXContactPickerV2")}(window.originaljQuery||jQuery),function(n){"use strict";var t=window.ol=window.ol||{},i="/mail/AttachmentUploader.aspx?_ec=1",u=-2146828218,r=t.BrowserCapabilities,f=t.UploadManager=function(f,e){function k(){var n=d.find("iframe"),r=(new Date).getTime();n.length>0&&n[0].contentWindow?(l&&(clearTimeout(l),l=0),a=n[0],n.first().load(g).unload(nt),a.contentWindow.location.replace(i)):(r-b)/1e3>y.initRetrySeconds?(l&&(clearTimeout(l),l=0),v.reject(o,t.GetString("Carousel.ServiceErrorRefreshPage"))):l=setTimeout(k,y.initDelayMs)}function w(n){h++,r.asyncUploads?n.start():(p=n,c=!1,n.start(a))}function g(){var r=!0,e,n,f,l;try{a.contentWindow.location.href.endsWith(i)||(r=!1,e=t.GetString("Carousel.UploadInternalError"))}catch(y){y.number===u&&(r=!1,e=t.GetString("Carousel.ServiceErrorRefreshPage"))}n=a.contentWindow;try{r=r&&n.m_bSuccess}catch(y){}if(h===0){c=!0,v.resolve(o);return}if(n){f={uploadSize:null,fileName:n.m_sFileName,fileId:r?n.m_sFileId:null,fileSize:n.m_iFileSize,uiFileSize:n.m_sUiFileSize,fileSizeMeter:n.m_sFileSizeMeter,showMessage:n.m_bShowMessage,errorDescription:n.m_sErrorDescription},f.showMessage=!r||f.showMessage,f.errorDescription=e||f.errorDescription;p.onUploadComplete(f);p=null,h--}c=!0,s.length>0&&(l=s.shift(),w(l))}function nt(){c=!1}var o=this,d=f,a,s=[],h=0,p,c=!1,v=null,b,l,y=n.extend({},{maxAsyncUploads:3,initDelayMs:500,initRetrySeconds:30},e);o.init=function(){return v=n.Deferred(),r.asyncUploads?(c=!0,v.resolve(o)):(b=(new Date).getTime(),y.maxAsyncUploads=1,k()),v.promise()},o.enqueue=function(n){h+1>y.maxAsyncUploads||!c?s.push(n):w(n)},o.dequeue=function(n){for(var t=0;t<s.length;t++)if(n===s[t]){s.splice(t,1),h--;break}n.stop()},o.clearQueue=function(){for(var t=s.length,n=0;n<t;n++)s.shift().stop()},o.startNext=function(){if(h--,h<y.maxAsyncUploads&&s.length>0){var n=s.shift();w(n)}},o.isBusy=function(){return!c},o.getFileInput=function(){var t=a.contentWindow.document.forms[0];return n(t).find("input[type='file']")},o.dispose=function(){o.clearQueue(),v=null},t.UploadManager.instance=function(){return o}}}(window.originaljQuery||window.jQuery),function(n){"use strict";var i=window,t=window.ol=window.ol||{},r="/mail/SilverlightAttachmentUploader.aspx",u=t.Accessor,f={convertTo:function(n){return i.btoa(unescape(encodeURIComponent(n)))},convertFrom:function(n){return decodeURIComponent(escape(i.atob(n)))}},s=t.Uploader=function(i,e,o,s){function g(n){n.contentWindow.document.forms[0].upload.click()}function nt(){l.notify("0%"),c=new XMLHttpRequest,c.open("POST",r,!0),c.setRequestHeader("filename",f.convertTo(y)),c.setRequestHeader("content-type","application/octet-stream"),c.setRequestHeader("silverlightupload","false"),c.setRequestHeader("content-id",h.cid()?"<{0}>".format(h.cid()):""),c.upload.addEventListener("progress",tt),c.addEventListener("error",it),c.addEventListener("load",rt),c.addEventListener("abort",ut),c.send(k)}function tt(n){var t=Math.round(n.loaded/n.total*100);p=n.total,t!==0&&t!==100&&l.notify(t+"%")}function it(n){a(n,t.GetString("Carousel.UploadError"))}function rt(i){var r,u;if(i.target.status!==200){a(i,t.GetString("Carousel.UploadServerError")),c=null;return}try{r=JSON.parse(n("<div/>").html(i.target.response||i.target.responseText).text())}catch(f){a(i,t.GetString("Carousel.UploadUnrecognizedResponse")),c=null;return}if(r.StatusCode&&r.ErrorMessage){a(i,r.ErrorMessage),c=null;return}u={fileName:y,fileId:r.Id,fileSize:p,showMessage:!!r.Caption,errorDescription:r.Caption};h.onUploadComplete(u);c=null,v.startNext()}function a(n,t){l.reject(h,t),c=null,v.startNext()}function ut(){a(t.GetString("Carousel.UploadCanceled"))}var h=this,k=i,y=e,p=0,d=o,l,v=t.UploadManager.instance(),w=n.extend({},{maxAsyncUploads:3},s),b,c;h.cid=function(n){return u(h,"Cid",n)},h.getInputElement=function(){return d},h.uploadResults=function(){return b},h.enqueue=function(){return l=new n.Deferred,w.isExternalUploader||v.enqueue(h),l.promise()},h.start=function(n){n?g(n):nt()},h.stop=function(){c&&c.abort(),l&&l.reject(h,t.GetString("Carousel.UploadCanceled"))},h.onUploadComplete=function(n){l.notify("100%"),b=n,n.showMessage&&n.errorDescription&&!n.fileId?l.reject(h,n.errorDescription):l.resolve(h)},h.dispose=function(){h.stop(),w.isExternalUploader||v.dequeue(h)}}}(window.originaljQuery||window.jQuery),function(n){"use strict";var r=window,t=window.ol=window.ol||{},i=t.BrowserCapabilities,u=t.FileLoader=function(){function s(n){e=n.target.result,u.resolve(r)}function h(){u.reject(r,t.GetString("Carousel.ErrorLoadingFile"))}var r=this,o,e,u,f;i.fileReader&&(f=new FileReader,f.onload=s,f.onerror=h),r.load=function(t){o=t,e=null,u=new n.Deferred;try{f.readAsDataURL(o)}catch(i){u.reject(r,i.message)}return u.promise()},r.data=function(){return e}}}(window.originaljQuery||window.jQuery),function(n){"use strict";var t=window,i=window.ol=window.ol||{},r=new function(){function r(){if(n--,t.length>0){n++;var u=t.shift();u.start(),setTimeout(r,i.throttleDelayMs)}}var t=[],n=0,i={maxConcurrentResize:1,throttleDelayMs:2e3},u=this;u.enqueue=function(u){n+1>i.maxConcurrentResize?t.push(u):(n++,u.start(),setTimeout(r,i.throttleDelayMs))}},f=i.ImageResizer=function(){function y(n){i.blob(n),l.resolve(i)}function p(){setTimeout(function(){e.state()==="pending"&&e.resolve(i)},200)}function w(){e.reject(i,"")}function b(){e.reject(i,"")}var i=this,h,c,e,l,s,o,a,u=document.createElement("canvas"),v=u.getContext&&u.getContext("2d"),f=new Image;f.onload=p,f.onabort=w,f.onerror=b,i.blob=function(n){return _accessor(i,"Blob",n)},i.image=function(){return f},i.load=function(t,i){return h=t,c=i,e=n.Deferred(),f.src=h,e},i.resize=function(t,u,f){return e.reject(i,""),e=n.Deferred(),s=u,o=f,a=t,v&&h?r.enqueue(i):e.reject(i,""),e},i.start=function(){if(!a&&f.height<=s&&f.width<=o){e.resolve(i);return}u.height=s,u.width=f.width*(s/f.height),o&&u.width>o&&(u.width=o,u.height=f.height*(o/f.width)),v.drawImage(f,0,0,u.width,u.height),f.src=u.toDataURL(c)},i.toBlob=function(){var i,h,r,a;if(l=n.Deferred(),u.toBlob)u.toBlob(y);else{var o=u.toDataURL(c),f=atob(o.split(",")[1]),v=o.split(",")[0].split(":")[1].split(";")[0],e=new ArrayBuffer(f.length),s=new Uint8Array(e);for(i=0;i<f.length;i++)s[i]=f.charCodeAt(i);h=t.BlobBuilder||t.MSBlobBuilder||t.WebKitBlobBuilder||t.MozBlobBuilder,r=new h,r.append(e),a=r.getBlob(v),e=null,s=null,r=null,y(a)}return l.promise()}}}(window.originaljQuery||window.jQuery),function(n){"use strict";function y(){return{enableThumbnails:!0,initialHeight:130,initialWidth:130,externalUploaderId:null,id:null,size:0,lastModifiedDate:null,src:"",width:130,height:130,isInline:!1,hasError:!1,color:!1,uploadProgress:"5%",uploading:!1,uploaded:!1,imageIsOnScreen:!1,isImage:!1,spriteClass:"",cid:"",html:"",isLoadingSpinner:!1,type:"",hasThumbnail:!1,name:"",itemErrorMessage:null}}function p(n){if(!n)return"";var t=n.split("."),i=t[t.length-1];return i.toLowerCase()}var i=window.ol=window.ol||{},s=i.vm=i.vm||{},f=50,h=1e3,c=i.BrowserCapabilities,e=i.config.compose,r=i.Accessor,o=e.fileTypes,l=e.imageIconPath,a={findByExtension:function(n){var t=o[n];return t?t:o["default"]}},v="#A7A7A7",u=260,w=s.AttachmentFile=function(t){var i=this;(!c.fileReader||t.isExternalUploader)&&(t.enableThumbnails=!1),i._isExternalUploader=t.isExternalUploader,i._inputElement=t.inputElement,i._file=t.file,i.IsFullCompose=t.isFullCompose,i._dataUrl=null,i._loaderPromise=null,i._uploader=null,i._fileLoader=null,i._imageResizer=null,i.initAccessorValues(t),i.name(t.name),i.height(t.isInline?"":t.initialHeight),i.width(t.isInline?"":t.initialWidth),i.initialHeight(t.isInline?0:t.initialWidth),i.initialWidth(t.isInline?0:t.initialWidth),i.itemErrorMessage(""),i.uploadDeferred=n.Deferred(),i.thumbnailDeferred=n.Deferred(),i._file&&(i.name(i._file.name.match(/[^\\/]*$/)[0]),i._file.externalUploaderId&&i.externalUploaderId(i._file.externalUploaderId),i._file.size&&i.size(i._file.size),i._file.type&&(i.type(i._file.type),i.id(i._file.id),i.isImage(!!(i.type()&&i.type().match("image.*"))),i._file.lastModifiedDate&&i._file.lastModifiedDate.toLocaleDateString?i.lastModifiedDate(i._file.lastModifiedDate.toLocaleDateString()):i.lastModifiedDate(i._file.lastModifiedDate)))},t=w.prototype;t.generateThumbnail=function(n,t){var r=this;!r.hasThumbnail()&&r.isImage()&&r.enableThumbnails()?(r._fileLoader||(r._fileLoader=new i.FileLoader),r._loaderPromise=r._fileLoader.load(r._file),r._loaderPromise.pipe(function(n){return r._imageResizer=new i.ImageResizer,r._imageResizer.load(n.data(),r.type())}).pipe(function(i){var u,e;return r.isInline()?(u=t-(r.IsFullCompose?f:0),e=n-f):u=r.height(),i.resize(!r.isInline(),u,e)}).pipe(function(n){r.isInline()?r._handleInlineImage(n.image()):r._setImage(n.image()),r.hasThumbnail(!0),r.thumbnailDeferred.resolve()}).fail(function(){r.isInline()&&(r.itemErrorMessage(ol.GetString("InlineImage.InlineIsNotAnImageError")),r.hasError(!0)),r.thumbnailDeferred.reject()})):r.thumbnailDeferred.resolve()},t.finishUpload=function(n){var t,i;t=this,t.name(n.fileName),t.id(n.fileId),n.fileSize&&t.size(n.fileSize),t.itemErrorMessage()||(n.showMessage?t.itemErrorMessage(n.errorDescription):(t.itemErrorMessage(""),i=n.fileName.lastIndexOf("."),$BSI.reportEvent("Submit.MailUploadFile",{FileExtension:i==-1?"none":n.fileName.substring(i+1),FileSize:t.size(),aCFT:t.isInline()?2:1}))),t.uploaded(!0),t.uploading(!1),t.uploadDeferred.resolve()},t.upload=function(){var n=this;n.Uploaded||(n._uploader||(n._uploader=new i.Uploader(n._file,n.name(),n._inputElement,{isExternalUploader:n._isExternalUploader}),n.Cid&&n._uploader.cid(n.Cid)),n.uploading(!0),n._uploader.enqueue().done(function(t){var i=t.uploadResults();n.finishUpload(i)}).progress(function(t){n.uploadProgress(t)}).fail(function(t,i){n.itemErrorMessage(i),n.hasError(!0),n.uploadProgress("0%"),n.uploading(!1),n.uploadDeferred.reject()}))},t.cancelUpload=function(){var n=this;n._uploader&&n._uploader.stop()},t.dispose=function(){var n=this;n._uploader&&(n._uploader.dispose(),n._uploader=null)},t._setImage=function(n){var t=this;t.src(n.src),t.height(n.height),t.width(n.width)},t._handleInlineImage=function(t){var i=this;i.hasError()||(i.src(t.src),i.initialHeight(t.height),i.height(t.height),i.initialWidth(t.width),i.width(t.width),n(t).attr("height",t.height).attr("width",t.width),i.html(t.outerHTML),i.isLoadingSpinner(!1),i.imageIsOnScreen(!0))},ol.AddOptionsAccessorAndInitFunctions(t,y),t.width=function(n){var t=this;return n!==undefined&&u!==null&&n>u&&(n=u),r(t,"Width",n)},t.itemErrorMessage=function(n){var t=this;return n&&(t.html(n),t.cancelUpload()),r(t,"ItemErrorMessage",n)},t.uploadProgress=function(n){var t=this;return n==="100%"?(r(t,"UploadProgress","99%"),setTimeout(function(){r(t,"UploadProgress","100%")},h),n):r(t,"UploadProgress",n)},t.name=function(n){var t=this,f=r(t,"Name",n),u,i;return n!==undefined&&(u=p(n),i=a.findByExtension(u),t.isImage(i.fileType==="image"),i.color?t.color(i.color):t.color(v),t.src()||(i.spriteClass?t.spriteClass(i.spriteClass):t.src(l+i.icon))),f}}(window.originaljQuery||window.jQuery),function(n,t){"use strict";var e="carouselItemTemplate",r=57,u=60,o=80,c=30,f={item:"item",image:"image",border:"border"},s=n.BrowserCapabilities,l=n.config.compose,a=1024,h=window,i=h.wLive=h.wLive||{},v=t.templates(null,{markup:"#"+e,converters:{getCarousellItemWrapperCssClass:function(n){return"carouselItemWrapper carouselSmooth"+(n?" hasError":"")},getItemCssClass:function(n,t){var i="carouselIcon sprite ";return n&&!t&&(i=i+n),i},getIconMarginTop:function(n,t,i){var f,e;return t?f=0:(e=u,n&&(e=r),f=(i-(e+c))/2),f},getIconMarginLeft:function(n,t,i){var o=this,f,e;return t?f=0:(e=u,n&&(e=r),f=(i-e)/2),f},getItemDimension:function(n,t,i,e,o,s,h){var l=this,c=0;switch(n){case f.item:c=s?h:t;break;case f.image:if(i)c=t;else{if(e)return r;if(o)return u}break;case f.border:c=s?h:t}return c},getItemErrorMessageTruncated:function(n){return n&&n.length>o&&(n=i.truncateEllipsis(n,o)),n},getCaptionCssClass:function(n,t,i){var r="carouselCaption";return t?r+=" carouselCaptionError":n&&s.fileReader&&i&&(r+=" carouselCaptionBG DisplayNone"),r},getBackgroundImage:function(n,t,i,r,u){var f=l.imageSpritePath;return(i||!n||r&&s.fileReader)&&(f=t),u?"url('"+f+"')":f},getItemTooltip:function(n,t){var i=t>0?"{0}\n{1}KB":"{0}";return i.format(n,(t/a).toFixed(0))},getErrorCssClass:function(n,t){return n+(t?"":" DisplayNone")},getUploadVisibility:function(n,t){return n==="100%"||t?"none":"block"},getImageDisplay:function(n){return n?"none":"block"}}}),y={templateId:e,template:v,attr:"html",init:function(t){var i=this;i.data=t.props.data,i.ControlNamespace=n.createControlNamespace(i.tagName),i.opacity(i.data.Uploaded?1:0)},render:function(){return this.tagCtx.render(this.data)},onAfterLink:function(){var n=this,i=n.getRootElement();i.on("click",t.proxy(n._onCarouselItemClick,n)).on("contextmenu",t.proxy(n._onCarouselItemClick,n))},_onCarouselItemClick:function(t){return n.Cmd("carousel.itemclick").bubble(this,{event:t,file:this.data}),!1},opacity:function(t){return n.Accessor(this,"Opacity",t)},addToList:function(){var r=this,n;return r.opacity(1),n=r.getRootElement(),i.Animations.addToList(n,i.Animations.Direction.Horizontal).pipe(function(){return n.css("min-width","0px"),t.when()})},deleteFromList:function(){return i.Animations.deleteFromList(this.getRootElement(),i.Animations.Direction.Horizontal)},getRootElement:function(){return _$ge(this.ControlNamespace)},width:function(){return this.getRootElement().width()}};t.views.tags({carouselItemControl:y})}(window.ol,window.originaljQuery||window.jQuery),function(n){n.fn.wheel=function(){return this.bind("DOMMouseScroll",function(t){t.stopPropagation(),t.preventDefault(),n(this).trigger("wheel",-1*t.detail)}).bind("mousewheel",function(t){t.stopPropagation(),t.preventDefault(),n(this).trigger("wheel",t.originalEvent.wheelDelta/120)})}}(window.originaljQuery||window.jQuery),function(n,t){"use strict";var h=window,c=h.wLive=h.wLive||{},f=c.Controls.Notifications,i={right:"right",left:"left"},r={page:"page",item:"item",max:"max"},v=n.config.compose,l="carouselTemplate",u=n.Accessor,y={dropAreaSelector:"body",spinnerMarkup:$f.createLoading({returnMarkup:!0,size:"0px"}),slideAnimationDuration:100,easing:"swing",itemHeight:130,maxItemWidth:260,standardPadding:10,carouselBottomPadding:9,borderWidth:3,listTopPadding:0,maxUploadBytes:0,maxUploadFileCount:0,delayAnimateAdd:500,useCssAnimations:!0,transitionDuration:0,totalSizeDecimalPlaces:2,captionPadding:20,inlineErrorHeight:20,inlineImageHostSelector:""},a=1024,o=a*a,s={drop:"drop",paste:"paste",externalUploader:"externalUploader"},e=n.BrowserCapabilities,p=t.templates(null,{markup:"#"+l,converters:{getCollapserCssClass:function(n,t){var i="carouselCollapserIcon sprite  ";return i=n?i+"chevron_expand_000000_8x6":i+"chevron_collapse_000000_8x6",t===0&&(i+=" displayHidden"),i},getCarouselClass:function(n,t){return"carousel"+(n===0?"":" carouselVisible")+(t?"  carouselListCollapsed":"")},getCarouselOptionsClass:function(n){return"carouselOptions"+(n===0?" DisplayNone":"")}}}),w={templateId:l,template:p,attr:"html",init:function(i){var r=this;r.data=i.ctx.data,r._options=t.extend({},y,i.ctx.options),r.ErrorMessage="",r.ListHeight=0,r.Width=0,r.Height=0,r.ListVisibility="hidden",r.Initialized=!1,r.NumUploadsInProgress=0,r.Collapsed=!0,r.layout=i.ctx.layout,r._left=0,r._numToBeProcessed=0,r._contentWidth=0,r._arrayChangeHandler=t.proxy(r._arrayChange,r),r._itemPropertyChangeHandler=t.proxy(r._itemPropertyChange,r),r._mouseDragHandler=t.proxy(r.onDragOver,r),r._mouseDropHandler=t.proxy(r.onDrop,r),r._fileSelectionHandler=t.proxy(r._fileSelection,r),r.contextMenu=new n.ContextMenu,r.Menu=new n.vm.Menu({sutraTag:"attachmentcontextmenu",items:[new n.vm.MenuItem({key:"Remove",text:n.GetString("EditMessage.RemoveAttachment"),sutraTag:"removeattachment"})]}),r._skyDriveUpsellMessages={},r.ControlNamespace=n.createControlNamespace(r.tagName)},render:function(){return this.tagCtx.render(this.data)},onCmdBubble:function(t,i,r){var u=this,e,f,o,s,h;switch(i.name){case"carousel.itemclick":return u._fileSelected=r.file,e=r.event,n.Accessor(u,"MenuNeeded",!0),f=u.contextMenu.getMenuEventPosition(e),f=u.ctx.adjustMenuPosition(f,u.ctx.containerSelector),o=u._$root[0],u.contextMenu.cancelTimers(),s=u._$root.find(".c_m")[0],h={targetLoc:f,menuEl:s,noDockCache:!0,sourceEl:e.target,parentEl:o,forceDispose:!0,disableAnimations:!0},u.contextMenu.show(s,o,h,"Carousel"),!1}},onAfterLink:function(){var i=this,u,r;t.observable.simpleOn([i.data.RegularFiles],"arrayChange."+i.ControlNamespace,i._arrayChangeHandler),t.observable.simpleOn([i.data.InlineFiles],"arrayChange."+i.ControlNamespace,i._arrayChangeHandler),u=i.contents(),i._$root=_$ge(i.ControlNamespace);i._$root.on("click.carousel",".carouselCollapser",t.proxy(i._onClickCollapse,i)).on("click.carousel",".menuLinkItem",t.proxy(i._onMenuClick,i));i._animating=!1,i._$list=i._$root.find(".carouselList"),i._$listContainer=i._$root.find(".carouselListContainer"),i._$form=i._$root.find("form").first(),i._$prevButton=i._$root.find(".carouselPrevButton"),i._$nextButton=i._$root.find(".carouselNextButton"),r=i._$listContainer.css("transition-duration")||i._$listContainer.css("-ms-transition-duration")||i._$listContainer.css("-webkit-transition-duration")||i._$listContainer.css("-moz-transition-duration"),r&&(i._options.transitionDuration=parseFloat(r.substr(0,r.length-1),10)*1e3),i._numFileInputs=0,i._uploadManager=new n.UploadManager(i._$root,{}),i._uploadManager.init().done(function(){i.initialized(!0)}),i._disableButton(i._$prevButton,!0),i._disableButton(i._$nextButton,!0),i._options.useCssAnimations=c.Animations.Enabled,$B.IE||i._$form.removeClass("DisplayNone").addClass("displayHidden");i._$nextButton.on("click.carousel",t.proxy(i._pageRight,i));i._$prevButton.on("click.carousel",t.proxy(i._pageLeft,i));i._$root.on("wheel.carousel",function(n,t){!t&&n.originalEvent&&(t=n.originalEvent.wheelDelta/120||-n.originalEvent.deltaY),t<0?i._$nextButton.prop("disabled")||i._slideItem("right"):i._$prevButton.prop("disabled")||i._slideItem("left")});i._calculateWidth(),i.height(i._calculateHeight())},gainControl:function(){var n=this;if(n._options.dropAreaSelector)t(n._options.dropAreaSelector).on("dragover."+n.ControlNamespace,n._mouseDragHandler).on("drop."+n.ControlNamespace,n._mouseDropHandler)},loseControl:function(){var n=this;n._options.dropAreaSelector&&t(n._options.dropAreaSelector).off("."+n.ControlNamespace),n._closeSkyDriveUpsell()},onDispose:function(){var n=this,i;for(t.observable.simpleOff([n.data.RegularFiles],"arrayChange."+n.ControlNamespace),t.observable.simpleOff([n.data.InlineFiles],"arrayChange."+n.ControlNamespace),i=0;i<n.data.RegularFiles.length;i++)t.observable.simpleOff(n.data.RegularFiles[i],"propertyChange."+n.ControlNamespace);n._$root.off(".carousel"),n._$root.wheel().off(".carousel"),n._$nextButton.off(".carousel"),n._$prevButton.off(".carousel"),n._uploadManager.dispose(),n._disposed=!0,n._uploadManager=n._$root=n._$list=n._$listContainer=n._$form=n._$prevButton=n._$nextButton=n._arrayChangeHandler=n._itemPropertyChangeHandler=n._mouseDragHandler=n._mouseDropHandler=n._fileSelectionHandler=n.contextMenu=n.Menu=n.data=null},inlineImageHost:function(){return t(this._options.inlineImageHostSelector)},numberInlineImages:function(n){this._uniqueContentId=n},height:function(t){var i=u(this,"Height",t);return t!==undefined&&n.Cmd("carousel.heightchange").bubble(this),i},width:function(n){return u(this,"Width",n)},listVisibility:function(n){return u(this,"ListVisibility",n)},numUploadsInProgress:function(n){return u(this,"NumUploadsInProgress",n)},initialized:function(n){var t=this,f=u(t,"Initialized",n),i,r;return n!==undefined&&(t.collapsed(t.data.RegularFiles.length===0),i=t._$root.find(".carouselScroller"),r=i.outerHeight(),i.css("margin-top",(t._options.itemHeight-r)/2+"px")),f},collapsed:function(n){var t=this,i;if(n===undefined||n||t.data.RegularFiles.length!==0)return i=u(t,"Collapsed",n),n!==undefined&&t.initialized()&&(n?(t.listVisibility("hidden"),t.listHeight(0)):(t.listHeight(t._options.itemHeight+t._options.carouselBottomPadding),t._setTimeout(function(){t.listVisibility("visible")},t._options.transitionDuration)),t._calculateWidth()),i},listHeight:function(n){var t=this,i=u(t,"ListHeight",n);return n!==undefined&&t.initialized()&&(t._$listContainer.css("height",n),t.height(t._calculateHeight())),i},getUploadProgressMessage:function(t,i){var r=this,e=0,s=0,u,f;if(r.data&&r.data.RegularFiles)for(u=0;u<r.data.RegularFiles.length;u++)r.data.RegularFiles[u].uploaded()&&(e+=r.data.RegularFiles[u].size(),s++);return f="",(t>0||i>0)&&(f=n.GetString("Carousel.UploadProgressFormat").format(s,t,(e/o).toFixed(r._options.totalSizeDecimalPlaces))),f},onResize:function(){this._calculateWidth()},addFile:function(i,r){var u=this,o,s;if(!u._disposed){if(!u.initialized()){f.createFlyout({content:n.GetString("Carousel.WaitForInitialization"),anchor:i.target,buttons:{action:n.GetString("Carousel.UploadBusyOk")}}).show();return}e.asyncUploads?(o=e.multiFileSelect?"multiple='multiple'":"",s=t("<input type='file' id='fileinput"+u._numFileInputs+++"' "+o+" />").appendTo(u._$form).on("change."+u.ControlNamespace,null,{isInline:r},u._fileSelectionHandler).focus().click()):u._uploadManager.isBusy()?f.createFlyout({content:n.GetString("Carousel.AlreadyUploading"),anchor:i.target,buttons:{action:n.GetString("Carousel.UploadBusyOk")}}).show():u._uploadManager.getFileInput().off("change."+u.ControlNamespace).on("change."+u.ControlNamespace,null,{isInline:r},u._fileSelectionHandler).focus().click()}},_oninsert:function(r){var u=this,o,s,f;r.size()===0&&e.asyncUploads?(r.itemErrorMessage(n.GetString("Carousel.EmptyFile")),r.hasError(!0)):r.upload(),r.isInline()||(t.observable.simpleOn(r,"propertyChange."+u.ControlNamespace,u._itemPropertyChangeHandler),u.data.RegularFiles.length===1&&(o=u._$root.find(".carouselScroller"),s=o.outerHeight(),o.removeClass("DisplayNone").css("margin-top",(u._options.itemHeight-s)/2+"px")),f=u.collapsed()?u._options.transitionDuration:0,u._setTimeout(function(){var t=u._findCarouselItem(r);u._setTimeout(function(){var e=!n.config.Ltr,o=e?i.left:i.right,s=u._slideMax(o);f=s?u._options.transitionDuration:0,u._setTimeout(function(){t.addToList().then(function(){u._disposed||(r.generateThumbnail(),u._calculateWidth(),u._decrementNumToBeProcessed())})},f)},f)},0))},_remove:function(n){var t=this,r;n.dispose(),t.data.RegularFiles.length===1&&t._$root.find(".carouselScroller").css("margin-top",""),r=t._findCarouselItem(n),r.deleteFromList().then(function(){t._disposed||(t.data.removeFile(n,!1),t._calculateWidth(),t.height(t._calculateHeight()),t._$nextButton.prop("disabled")&&t._slideMax(i.right))})},onPaste:function(n){var t=n.clipboardData;t&&(t.files.length>0?this._fileSelection(n):t.getData("Text")||(n.stopPropagation(),n.preventDefault()))},onDrop:function(n){this._fileSelection(n)},_onMenuClick:function(){return this._remove(this._fileSelected),$menu.closeCurrent(),!1},_onClickCollapse:function(n){var t=this;t.collapsed(!t.collapsed()),n.preventDefault()},onDragOver:function(n){n.stopPropagation(),n.preventDefault();var t=n.dataTransfer?n.dataTransfer:n.originalEvent.dataTransfer;t&&(t.dropEffect="copy")},_arrayChange:function(n,t){var i=this,r;i._calculateWidth(),t.change==="insert"&&(r=t.items[0],i._oninsert(r),r.isInline()||i.collapsed(!1)),i.data.RegularFiles.length===0&&i.collapsed(!0)},_itemPropertyChange:function(t,i){var r=this;i.path==="Uploading"?i.value===!0?r.numUploadsInProgress(r.numUploadsInProgress()+1):r.numUploadsInProgress(r.numUploadsInProgress()-1):i.path==="Width"?r._calculateWidth():i.path==="Size"&&r.data.getTotalItemSizeExcludingFilesWithErrors()>r._options.maxUploadBytes&&(t.target.itemErrorMessage(n.GetString("Carousel.FileExceededMaxBytes")),t.target.hasError(!0),r._upsellSkyDrive(n.GetString("Carousel.UpsellSkydriveOverQuantityFormat").format((r._options.maxUploadBytes/o).toFixed(0))))},inProcessedDeferred:function(){return this._inProcessedDeferred||t.when()},_fileSelection:function(i){var r,o,u=this,l=i.data&&i.data.isInline||i.type===s.paste,a,v,h,c,f,y;if(u._skyDriveUpsellMessages={},i.type===s.drop||i.type===s.paste){if(i.stopPropagation(),i.preventDefault(),a=i.dataTransfer||i.clipboardData||i.originalEvent.dataTransfer,r=a.files,!r||r&&!r.length)return;o=r.length}else v=i.target.files,r=v||[{name:i.target.value}],o=r.length;for(n.Cmd(l?"instrument.insertinlineimages":"instrument.insertattachments").fire({files:r,numSelected:o,entryPoint:HM.InstrumentationEntryPoint.CommandBar,isFullCompose:u.ctx.thread.isFullCompose()}),h=u.data.getNumValidAllFiles()+o-u._options.maxUploadFileCount,h>0&&u._upsellSkyDrive(n.GetString("Carousel.UpsellSkydriveOverQuantityFormat").format(u._options.maxUploadFileCount)),c=h>0?r.length-h:r.length,u._numToBeProcessed+=c,u._inProcessedDeferred=t.Deferred(),f=0;f<c;f++)y=e.asyncUploads?null:i.target,u._newFile(r[f],y,f,l)},_calculateHeight:function(){var n=this,t=0,i=0;return n._$root&&(!n.collapsed()&&n.listHeight()&&(t=n._options.listTopPadding+n.listHeight()),n.data.RegularFiles.length!==0&&(i=n._$root.find(".carouselOptions").outerHeight())),t+i},_calculateWidth:function(){var n=this;n._$root&&n._$list&&(n._contentWidth=n._calcContentWidth(),n._updateFlipperButtons(),n.width(n._$root.width()),n._$list.width(n._contentWidth+2*n._options.itemHeight))},_newFileImpl:function(i,r,u){var f=this,e=new n.vm.AttachmentFile({inputElement:r,file:i,maxThumbnailWidth:u?null:f._options.maxItemWidth,initialHeight:f._options.itemHeight,initialWidth:f._options.itemHeight,isInline:u,isFullCompose:f.ctx.thread.isFullCompose()}),s=f.data.getTotalItemSizeExcludingFilesWithErrors();e.size()&&(s+=e.size()),s>f._options.maxUploadBytes?f._upsellSkyDrive(n.GetString("Carousel.UpsellSkydriveOverSizeLimitFormat").format((f._options.maxUploadBytes/o).toFixed(0))):u?f._insertInlineImage(e):(f._incrementNumToBeProcessed(),t.observable(f.data.RegularFiles).insert(f.data.RegularFiles.length,e)),f._decrementNumToBeProcessed()},_incrementNumToBeProcessed:function(){this._numToBeProcessed++},_decrementNumToBeProcessed:function(){var n=this;n._numToBeProcessed--,n._numToBeProcessed===0&&n._inProcessedDeferred&&n._inProcessedDeferred.resolve()},_newFile:function(n,t,i,r){var u=this;u._setTimeout(function(){u._newFileImpl(n,t,r)},i*u._options.delayAnimateAdd)},_setTimeout:function(n,t){var i=this;setTimeout(function(){i._disposed||n()},t)},_insertInlineImage:function(i){var r=this,u;i.cid("inlineImage"+r._uniqueContentId++),i.html(r._options.spinnerMarkup),i.isLoadingSpinner(!0),u=r.inlineImageHost(),i.generateThumbnail(u.width(),u.height()),i.isImage()||(i.hasError(!0),i.itemErrorMessage(n.GetString("InlineImage.InlineIsNotAnImageError"))),t.observable(r.data.InlineFiles).insert(r.data.InlineFiles.length,i)},_updateFlipperButtons:function(){var t=this,r=!n.config.Ltr,i;t.collapsed()?(t._disableButton(t._$prevButton,!0),t._disableButton(t._$nextButton,!0)):(t._disableButton(t._$prevButton,t._left==0),i=r?-(-t._left-t._$root.width()):-(t._left-t._$root.width()),t._disableButton(t._$nextButton,i>=t._contentWidth))},_animateSlide:function(n){var t=this;t._left=n,t._updateFlipperButtons(),t._options.useCssAnimations?t._$list.css({"-webkit-transform":"translate("+n+"px,0px)","-moz-transform":"translate("+n+"px,0px)","-ms-transform":"translate("+n+"px,0px)",transform:"translate("+n+"px,0px)"}):(t._animating=!0,t._$list.animate({left:n},t._options.slideAnimationDuration,t._options.easing,function(){t._animating=!1}))},_calcContentWidth:function(){var n=this,i=0,t;if(n.data&&n.data.RegularFiles){for(t=0;t<n.data.RegularFiles.length;t++)i+=n.data.RegularFiles[t].width();i+=n._options.standardPadding*n.data.RegularFiles.length}return i},_calcLeftOffset:function(n,t,u){var o=this,f=-o._left,s=o._calcContentWidth(),e=s-o._$root.width();return n===i.right?(t===r.page?f+=o._$root.width():t===r.item?f+=o._options.itemHeight:t===r.max&&(f=Math.max(e,0)),u?f>0&&(f=0):f>e&&e>0&&(f=e)):n===i.left&&(t===r.page?f-=o._$root.width():t===r.item?f-=o._options.itemHeight:t===r.max&&(f=-Math.min(e,0)),u?f<-e&&e>0&&(f=-e):f<0&&(f=0)),f},_pageRight:function(){var r=this,t=!n.config.Ltr;return r._slidePage(t?i.left:i.right,t)},_pageLeft:function(){var r=this,t=!n.config.Ltr;return r._slidePage(t?i.right:i.left,t)},_slidePage:function(n,t){var i=this,u=i._calcLeftOffset(n,r.page,t);return i._animateSlide(-u,t),!1},_slideMax:function(n){var t=this,i=t._calcLeftOffset(n,r.max);return t._animateSlide(-i),i>0},_slideItem:function(n){var t=this,i=t._calcLeftOffset(n,r.item);return t._animateSlide(-i),!1},_findCarouselItem:function(t){for(var r=n.findChildTag(this,"carouselItemControl"),u=null,i=0;i<r.length;i++)if(r[i].data===t){u=r[i];break}return u},_upsellSkyDrive:function(t){var i=this;i._skyDriveUpsellMessages[t]||(i._skyDriveUpsellMessages[t]=!0,i._skyDriveUpsellNotification=f.createTopBar({content:t,dismissalMode:f.BarDismissalMode.Explicit,buttons:{action:n.GetString("Carousel.SkyDrive.GoToSkyDrive"),close:n.GetString("Carousel.SkyDrive.Close")}}),i._skyDriveUpsellNotification.show().then(function(n){n.buttonClicked==="action"&&window.open(v.attach.skyDriveUrl),i.skyDriveUpsellNotification=null}))},_disableButton:function(n,t){if(n){var i=n.hasClass("DisplayNone");i!==t&&(n.prop("disabled",t),t?n.addClass("DisplayNone"):n.removeClass("DisplayNone"))}},_closeSkyDriveUpsell:function(){var n=this;n._skyDriveUpsellNotification&&(n._skyDriveUpsellNotification.dismiss(),n._skyDriveUpsellNotification=null)}};t.views.tags({carouselControl:w})}(window.ol,window.originaljQuery||window.jQuery),function(n){var t=window,i;t.ol=t.ol||{},i=t.ol,i.Selector=function(t){function y(){r=l(o),f.Items=r,n.observable.simpleOn([o],"arrayChange",c),e.link(n.templates("#"+s),f,h),v&&e.click(p)}function p(t){u.select(function(i){return i===n(t.target).view().data}),t.preventDefault()}function c(t,i){var u=i.change;u==="remove"?n.observable(r).remove(i.index,i.items.length):u==="insert"&&n.observable(r).insert(i.index,l(i.items))}function l(t){return n.map(t,a)}var u=this,i=t,e=n(i.container),s=i.templateId,o=i.itemsModel,r=null,f=i.dataModel,a=i.createPresenter,v=i.selectOnClick,h=i.context;u.dispose=function(){n.observable.simpleOff([o],"arrayChange",c)},u.select=function(t){for(var e=!1,u,i=0;i<r.length;++i)if(u=r[i],t(u)){n.observable(f).setProperty("SelectedItem",u),e=!0;break}return e},u.render=function(){e.link(n.templates("#"+s),f,h)},y()}}(window.originaljQuery||window.jQuery),function(n){function r(n,t){var i="";return n===t&&(i="Selected"),i}var t=window,i;t.ol=t.ol||{},i=t.ol,i.ComposeOptionsSelector=function(t,u,f,e,o,s){function p(){h={SelectedItem:v.Items[e]};var t={getSelectedClass:r};n.extend(t,s),c=new i.Selector({container:a,templateId:"composeOptionsListTemplate",itemsModel:v.Items,dataModel:h,createPresenter:function(n){return n},selectOnClick:o,context:t}),n(h).bind("propertyChange",w),a.click($menu.closeCurrent)}function w(n,t){t.path==="SelectedItem"&&y&&y(t.value)}var l=this,a=t,v=u,y=f,h=null,c=null;l.select=function(n){c.select(n)},l.dispose=function(){c.dispose()},p()}}(window.originaljQuery||window.jQuery),function(n,t){"use strict";function g(){a=t("#SendMessage"),v=t("#CancelMessage"),r.push(a.parent()[0]),r.push(t("#InsertMenu").parent()[0]),r.push(t("#SaveDraft").parent()[0]),r.push(t("#ComposeOptions").parent()[0]),l.isRteToolbarToggleEnabled&&r.push(t("#FormatToggle").parent()[0]),r.push(v.parent()[0]),r.push(t(".c_cmore")[0]),e=t(".c_c")[0];var i=t("#SendingMessage");i.prepend($f.createLoading({returnMarkup:!0,type:$f.loadingType.spinning,color:"#FFF",text:n.GetString("EditMessage.Sending")})),o=i.parent(),o.addClass("NoDisplay").css("display",""),c.spellChkSupp&&r.push(t("[aid=spellCheck]").parent()[0]),f.fileReader&&f.fileSelect||t("#AttachInline").parent().addClass("NoDisplay"),t("#ShareSkyDrive").parent().addClass("NoDisplay"),t("#c_clogot").click(ht)}function u(t){return n.Cmd("compose.action").fire({action:t.currentTarget.id.toLowerCase(),event:t,entryPoint:HM.InstrumentationEntryPoint.CommandBar}),$menu.closeCurrent(),!1}function nt(){t("#c_cb0").delegate("#SendMessage","click",u).delegate("#AttachFiles","click",u).delegate("#AttachInline","click",u).delegate("#ShareSkyDrive","click",u).delegate("#SaveDraft","click",u).delegate("#SpellCheck","click",u).delegate("#CancelMessage","click",u),l.isRteToolbarToggleEnabled===!0&&t("#c_cb0").delegate("#FormatToggle","click",u)}function tt(r){var e=n.vm.Compose.TextModes,f=e.PlainText,u=r.Key,o=i.TextMode!==f&&u===f;return o?d.createFlyout({title:"",content:n.GetString("RTE.Toolbar.LoseFormattingWarning"),anchor:t("#ComposeOptions")[0],buttons:{action:n.GetString("RTE.Toolbar.LoseFormattingAction")}}).show().then(function(n){n.buttonClicked&&i.textMode(u),s.select(function(n){return n.Key===i.TextMode})}):i.textMode(u),!1}function it(t){return i.importance()!==t.Key&&n.Cmd("instrument.changepriority").fire({entryPoint:HM.InstrumentationEntryPoint.CommandBar,newPriority:n.Instrumentation.priorityFromImportance(t.Key),isFullCompose:i.isFullCompose()}),i.importance(t.Key),!1}function rt(){var i=n.getContextObject(),r,u,f;t("#ComposeOptions").siblings("ul").link(t.templates("#composeOptionsTemplate"),{},i),r=t("#rteMode"),r.length>0&&(u=new n.vm.Menu({items:[new n.vm.MenuItem({text:n.GetString("RTE.Mode.RichText"),key:n.vm.Compose.TextModes.RichText,sutraTag:"richtext",tooltip:n.GetString("RTE.Mode.RichText.Tooltip")}),new n.vm.MenuItem({text:n.GetString("RTE.Mode.PlainText"),key:n.vm.Compose.TextModes.PlainText,sutraTag:"plaintext",tooltip:n.GetString("RTE.Mode.PlainText.Tooltip")}),new n.vm.MenuItem({text:n.GetString("RTE.Mode.HTML"),key:n.vm.Compose.TextModes.HTML,sutraTag:"editinhtml",tooltip:n.GetString("RTE.Mode.HTML.Tooltip")})]}),s=new n.ComposeOptionsSelector(r,u,tt,0,!0,i)),f=new n.vm.Menu({items:[new n.vm.MenuItem({text:n.GetString("EditMessage.HighImportance"),key:n.vm.Compose.Priorities.High,sutraTag:"highpriority"}),new n.vm.MenuItem({text:n.GetString("EditMessage.NormalImportance"),key:n.vm.Compose.Priorities.Normal,sutraTag:"normalpriority"}),new n.vm.MenuItem({text:n.GetString("EditMessage.LowImportance"),key:n.vm.Compose.Priorities.Low,sutraTag:"lowpriority"})]}),y=new n.ComposeOptionsSelector(t("#msgPriority"),f,it,0,!0,i)}function ut(n,t){t.path==="Importance"?w():t.path==="TextMode"&&b()}function w(){y.select(function(n){return n.Key===i.Importance})}function b(){s.select(function(n){return n.Key===i.TextMode});var r=_$ge("SpellCheck");i.TextMode===n.vm.Compose.TextModes.HTML?(r.attr("title",n.GetString("SpellChecker.SpellCheck.InvalidRTEMode")),r.addClass("DisabledLink")):(r.attr("title",n.GetString("SpellChecker.SpellCheck.Title")),r.removeClass("DisabledLink")),i.TextMode!==n.vm.Compose.TextModes.RichText?(t("#AttachInline").parent().addClass("NoDisplay"),t("#ShareSkyDrive").parent().addClass("NoDisplay")):(f.fileReader&&f.fileSelect&&t("#AttachInline").parent().removeClass("NoDisplay"),c.shareSkyDrive&&(n.delayLoadedControls.shareSkyDriveControl||t("#ShareSkyDrive").parent().addClass("NoDisplay"),n.init.NotifyLoad(n.config.compose.featureBuckets.shareSkyDrive).then(function(){i.TextMode===n.vm.Compose.TextModes.RichText&&t("#ShareSkyDrive").parent().removeClass("NoDisplay")})))}function ft(n){var r=n.thread;i&&t(i).off("propertyChange.composecommandbar"),i=r;t(i).on("propertyChange.composecommandbar",ut);w(),b()}function et(){setTimeout(function(){t(r).addClass("NoDisplay")},0)}function ot(){setTimeout(function(){t(r).removeClass("NoDisplay").css("display",""),k()},0)}function k(){e&&e.collapse&&setTimeout(function(){e.collapse.redraw()},0)}function st(n){setTimeout(function(){o.toggleClass("NoDisplay",!n.value)})}function ht(){return n.Cmd("nav.inbox").fire({skipDataEventHandler:"true",dontInstrument:!0}),!1}var h={},c=n.config.pageManager.manifests.Compose.initContext,l=n.config.compose,f=n.BrowserCapabilities,r=[],a,v,o,e,s,y,i=null,p=window.wLive,ct=p.Hotmail,d=p.Controls.Notifications;h.initialize=function(){g(),nt(),rt(),n.Cmd("composecommandbar.update").subscribe(ft),n.Cmd("composecommandbar.redraw").subscribe(k),n.Cmd("composecommandbar.hide").subscribe(et),n.Cmd("composecommandbar.show").subscribe(ot),n.Cmd("composecommandbar.sendingstate").subscribe(st)},h.initialize()}(window.ol,window.originaljQuery||window.jQuery),HmType=Function,window.__classes={},HmType.getType=function(n){return window.__classes[n]},HmType.prototype.createClass=function(n,t){HmType.createStaticClass(this,n),this.prototype.constructor=this,t&&this.extendFrom(t)},HmType.createStaticClass=function(n,t){n.__typeName=t,window.__classes[t]=n},__classes.HmType=HmType,HmType=Function,HmType.prototype.extendFrom=function(n){this.__baseType=n,this.prototype.callBase=HmType$callBase;for(var t in n.prototype)this.prototype[t]||(this.prototype[t]=n.prototype[t])},HmType.prototype.isInstance=function(n){var i,t;if(n===null||n===undefined)return!1;if(this==Object||n instanceof this)return!0;i=null;try{i=n.constructor}catch(r){}if(this==Object||this==i)return!0;if(!i)return!1;for(t=n.constructor.__baseType;t;){if(t==this)return!0;t=t.__baseType}return!1},HmType.__typeName="HmType",Boolean.__typeName="Boolean",Object.__typeName="Object",Number.__typeName="Number",String.__typeName="String",Array.__typeName="Array",RegExp.__typeName="RegExp",Date.__typeName="Date",Error.__typeName="Error",function(){function i(i,r,u,f,e){var o,s,h,c,l,a;if($B.IE||(t.event=u),o=u||t.event,s=null,e){if(!o)return;if(h=n.findControl(o.srcElement,i),!h)return;if(c=h[r],!c)return;s=c.call(h,f)}else{if(l=HmType.getType(i),!l)return;if(a=l[r],!a)return;s=a(f)}return t.__usingCompat?o&&o._returnValueSet?o.returnValue:s:s}var t=window,n;t.Control={},n=t.Control,n.create=function(n,t){n.elt=t,t["__"+n.constructor.__typeName]=n},n.destroy=function(n){var t=n.elt;t["__"+n.constructor.__typeName]=n.elt=null,t=null,n.elt=null},n.tryFindControl=function(n,t){var r=HmType.getType(t),i;if(!r)return null;for(i="__"+r.__typeName;n&&n!==document.body;){if(n[i])return n[i];n=n.parentNode}return null},n.findControl=function(t,i){return n.tryFindControl(t,i)},n.invoke=function(n,t,r,u){return i(n,t,r,u,!0)},n.invokeStatic=function(n,t,r,u){return i(n,t,r,u,!1)},n.lookup=function(t,i){var t=n.getAncestorByAttr(t,i);return t?t.getAttribute(i):null},n.getAncestorByAttr=function(n,t){while(n&&n.getAttribute&&!n.getAttribute(t))n=n.parentElement;return n&&n.getAttribute?n:null},n.dispose=function(){},HmType.createStaticClass(Control,"Control"),t.__usingCompat&&(n.invoke=FunctionHelper.wrapTopLevelMethod("Control","invoke",n.invoke.__original),n.invokeStatic=FunctionHelper.wrapTopLevelMethod("Control","invokeStatic",n.invokeStatic.__original))}(window.originaljQuery||window.jQuery),function(n){var r=window,t,f,o,i;r.RTE=r.RTE||{},t=r.RTE,r.wLive=r.wLive||{},f=r.wLive,f.Hotmail=f.Hotmail||{};var s=f.Hotmail,u=t.ModeStrings=["PlainText","RichText","HTML"],e=t.Mode={};for(i=u.length-1;i>=0;i--)e[u[i]]=i;if(o=r.ol&&ol.config.compose&&ol.config.compose.RTE||r.RTE_CONFIG,t.getConfig=function(n){return o[n]},t.FONT_UPDATE=function(n){return n.size?t.getConfig("FONT_SIZE")[n.size-1]:"inherit"},t.isTextarea=function(t){var i=n(t);return i.closest(".Textarea").length>0||i.closest(".RteEditor").find(".Textarea").length>0},t.focus=function(i){var f=n(i).closest(".RteEditor"),r=f.find("IFRAME"),e,u,o;r.length>0?(e=r[0],u=function(){var i=e.contentWindow,n,t;i.focus(),n=i.document,t=n.selection.createRange(),t.moveToElementText(n.body),t.collapse(!0)},r.attr("frameready")==="yes"?u():r.on("load",u)):(o=f.find("TEXTAREA"),o.focus())},t.Sync=function(i){var f=n("IFRAME",i)[0],s;if(f&&f.contentWindow&&f.contentWindow.document){var h=f.contentWindow.document,r=h.body,c=n("TEXTAREA",i)[0],o=null;i&&i.getAttribute("suppressempty")&&(s=r.createTextRange?r.createTextRange():h.selection.createRange(),s.moveToElementText&&(s.moveToElementText(r),""==s.text&&(o=""))),o==null&&(o=i.getAttribute("mode")==u[e.RichText]?r.innerHTML:t.ConvertToPlainText(r)),c.value=o,n("INPUT",i)[0].value=i.getAttribute("mode")}},t.ConvertToPlainText=function(n,i,r){var u=n.innerText||"",f;return $B.Firefox&&(f=_ce("div"),f.innerHTML=n.innerHTML.replace(/<br>/g,"\n"),u=f.innerText||f.textContent||""),r||(u=u.replace(/<!--(.|\n)*?-->/mg,"")),i&&(u=t.Editor.HTMLEncode(u,!0)),u},t.value=function(i,r){var f,e;f=[],r!=null&&(t.isTextarea(i)&&(r=t.ConvertToPlainText(n("<div />").html(r)[0])),f.push(r));var o=n("TEXTAREA",i),s=o.val.apply(o,f),u=n("IFRAME",i)[0];return u&&u.getAttribute("frameready")==="yes"&&u.contentWindow&&u.contentWindow.document&&(e=n(u.contentWindow.document.body),s=e.html.apply(e,f)),s},t.turnOn=function(i,r){var f,h;if(i.getAttribute("frameready")!=="yes"&&i.contentWindow){var o=i.contentWindow,c=o.document,s=c.body,l=i.nextSibling;for($B.IE&&$B.V<11||$Browser.attachCompatabilities(o),setTimeout(function(){for(var t=["fontFamily","fontSize","fontWeight","backgroundColor","color"],i=c.body,n=t.length-1;n>=0;n--)i.style[t[n]]=l.style[t[n]]},0),t._setInitialValue(s,i.parentElement.getElementsByTagName("TEXTAREA")[0].value),f=i.parentElement;f&&f.tagName!="FORM";)f=f.parentElement;n(f).bind("submit.rte",function(){var n=i.parentElement;t.Sync(n)}),r||(n(s).removeClass(u.join(" ")),n(s).addClass(u[e.PlainText])),$B.Firefox&&(o.document.designMode="on"),o.document.body.contentEditable=!0,i.setAttribute("frameready","yes"),h=Control.tryFindControl(i,"RTE.Editor"),h&&h._doInit()}},t._setInitialValue=function(n,t){try{t!=""&&(n.innerHTML=t)}catch(i){try{n.innerHTML=t.replace(/<p.*>/gi,"<br/>")}catch(i){}}},$B.IE&&r.__RTE){for(i=__RTE.length-1;i>=0;i--)t.turnOn(__RTE[i][0],__RTE[i][1]);__RTE=null}}(window.originaljQuery||window.jQuery),function(){var t=window,i,n;if(t.RTE=t.RTE||{},i=t.RTE,i._setInitialValue=function(n,t){n.innerHTML=t},t.__RTE){for(n=__RTE.length-1;n>=0;n--)i.turnOn(__RTE[n][0],__RTE[n][1]);__RTE=null}}(),new function(){function n(n){function r(t){t.__defineGetter__("text",function(){return this.cloneContents().textContent||""}),t.__defineSetter__("text",function(t){this.insertNode(n.document.createTextNode(t))}),t.__defineGetter__("htmlText",function(){var t=n.document.createElement("div");return t.appendChild(this.cloneContents()),t.innerHTML}),t.__defineGetter__("parentElement",function(){return this.commonAncestorContainer}),t.moveToElementText=function(n){t.selectNodeContents(n)},t.execCommand=function(t,i,r){return n.document.execCommand(t,i||!1,r||null)},t.queryCommandEnabled=function(t){try{return n.document.queryCommandEnabled(t)}catch(i){return!1}},t.queryCommandState=function(t){try{return n.document.queryCommandState(t)||!1}catch(i){return!1}},t.queryCommandIndeterm=function(t){return n.document.queryCommandIndeterm(t)};var i=["bold","italic","underline","fontname","fontsize","justifyleft","justifyright","justifycenter","insertorderedlist","insertunorderedlist","indent","outdent","createlink","forecolor","hilitecolor","inserthorizontalrule"];return t.queryCommandSupported=function(n){return i.exists(n)},t.queryCommandValue=function(t){return n.document.queryCommandValue(t)},t.select=function(){n.document.designMode=="on"?n.focus():(n.getSelection().removeAllRanges(),n.getSelection().addRange(t))},t.__defineGetter__("parentElement",function(){return function(){var n=this.commonAncestorContainer;return n.nodeType==3&&(n=n.parentNode),n}}),t.pasteHTML=function(i){var r,u,f;if(t.queryCommandEnabled("insertHTML"))t.execCommand("insertHTML",!1,i);else{for(t.deleteContents(),r=n.document.createElement("div"),r.innerHTML=i,u=n.document.createDocumentFragment();f=r.firstChild;)u.appendChild(f);t.insertNode(u)}},t}function i(){}function e(){n.getSelection().deleteFromDocument()}function o(){n.getSelection().removeAllRanges()}function s(){var t=n.getSelection();return t.rangeCount==0&&t.collapse(n.document.body,0),r(t.getRangeAt(0))}function h(t){for(var i=!1;t&&!i;)t.getAttribute&&t.getAttribute("contenteditable")=="true"?i=!0:t===n.document&&t.body&&t.body.getAttribute&&t.body.getAttribute("contenteditable")=="true"&&(i=!0),t=t.parentNode;return i}function t(t){(n.document.designMode=="on"||h(t.srcElement))&&(n.__selChangeTimeout&&clearTimeout(n.__selChangeTimeout),n.__selChangeTimeout=setTimeout(c,100))}function c(){clearTimeout(n.__selChangeTimeout),n.__selChangeTimeout=null,l("selectionchange",n.document)}function l(t,i){if(n.document){var r=n.document.createEvent("Event");r.initEvent(t,!0,!1),i.dispatchEvent(r)}}function u(){var i=n.document;i.addEventListener("DOMCharacterDataModified",t,!1),i.addEventListener("mouseup",t,!1),i.addEventListener("keydown",t,!1),i.addEventListener("keyup",t,!1)}if(!$B.SF_M2){var f=n.HTMLDocument.prototype;n.__oldCR=n.document.createRange,n.document.createRange=function(){var t=n.__oldCR.call(n.document);return r(t)},i.prototype={clear:e,empty:o,createRange:s},i.prototype.__defineGetter__("type",function(){var t=n.getSelection();return t.rangeCount>0?"Text":"None"}),f.selection=new i,n.__selChangeTimeout=null,n.document.body?u():n.addEventListener("load",u,!1)}}$Browser.addExtension(n)},function(n){function y(n){return u.ol&&u.ol.GetString?u.ol.GetString(n):decodeURIComponent(s[n])}function p(n){return t.HTMLEncode(n,!0).replace(/&lt;br&gt;/ig,"&lt;br&gt;<br>").replace(/&lt;\/p&gt;/ig,"&lt;/p&gt;<br>").replace(/&lt;\/div&gt;/ig,"&lt;/div&gt;<br>")}var u=window,i,o;u.RTE=u.RTE||{},i=u.RTE,u.wLive=u.wLive||{},o=u.wLive,o.Hotmail=o.Hotmail||{};var w=o.Hotmail,e=i.ModeStrings,r=i.Mode,s=u.RTE_STRINGS,h="ecx_rte_preskyattach",c="ecx_rte_skyattach",l="ecx_rte_postskyattach",a="PlaceholderText",v=u.ol&&ol.callFocus||$callFocus,t=i.Editor=function(t,i){Control.create(this,t),this._rteReadyDeferred=new n.Deferred,this._isPageVisible=i,this._plainText=t.getElementsByTagName("textarea")[0],this._mode=r[t.getAttribute("mode")],this._isRTEMode=this._mode===r.RichText,n("IFRAME",this.elt)[0].getAttribute("frameready")==="yes"&&this.setMode(this._mode),this._$placeholderDiv=n(t).find("."+a),this._placeholderInitialized=!1,this._placeholderShowOnInit=!t.hasAttribute("placeholder")||t.getAttribute("placeholder")!=="false",this._initializeEditor()},f=t.Events={onbeforepropertychange:"onbeforepropertychange",onpropertychange:"onpropertychange",onexeccommand:"onexeccommand",onselectionchange:"onselectionchange",ontextchange:"ontextchange"};t.prototype={elt:null,_toolbar:null,_editor:null,_mode:null,_isRTEMode:!1,_onSelChangeHandler:null,dispose:function(){var i,t;this._disposePlaceholder(),this._document&&this._onSelChangeHandler&&n(this._document).off("selectionchange",this._onSelChangeHandler),this.elt&&(i=n(this.elt),this._onSelChangeHandler&&i.off("keyup",this._onSelChangeHandler),this._onBeforeFocusOut&&i.off("beforedeactivate",this._onBeforeFocusOut)),this._editor&&(t=n(this._editor),this._onBeforePasteHandler&&t.off("beforepaste",this._onBeforePasteHandler),this._onPasteHandler&&t.off("paste",this._onPasteHandler),t.empty()),this._rte&&this._onFrameLoad&&n(this._rte).off("load",this._onFrameLoad).empty(),this._rteReadyDeferred.reject(),n(this).unbind(),Control.destroy(this),this._onFrameLoad=this._onNodeInsertedHandler=this._onPasteHandler=this._onSelChangeHandler=null,this._rte=this._editor=this._document=this._window=this._iframe=this._$placeholderDiv=this._mode=this._plainText=null},isRTEMode:function(){return this._isRTEMode},iframe:function(){return this._iframe},rteReadyPromise:function(){return this._rteReadyDeferred.promise()},_initializeEditor:function(){var t=n("IFRAME",this.elt)[0];if(this._editor=this._rte=t,this._frameReady=t.getAttribute("frameready")==="yes",!this._frameReady){this._frameData={display:this._isRTEMode,focus:!1},this._onFrameLoad=function(){i.turnOn(t)};n(this._rte).on("load",this._onFrameLoad)}this._doInit()},_doInit:function(){if(this._iframe=n("IFRAME",this.elt)[0],this._iframe.getAttribute("frameready")!=="no"){this._window=this._iframe.contentWindow,this._document=this._window.document,this._editor=this._document.body;var t=n(this._editor);this._iframe.title&&(this._document.title=this._iframe.title),t.removeClass(e.join(" ")),t.addClass(this.elt.getAttribute("mode")),this._frameReady||(this._frameReady=!0,this._frameData.focus&&this.focus(),this._frameData=null),this._onSelChangeHandler=$CD(this,this._detectSelectionChange);n(this._document).on("selectionchange",this._onSelChangeHandler);this._doInitImpl(),this._initPlaceholder(),this._fireOnReady()}},_doInitImpl:function(){this._onBeforeDeactivateHandler=$CD(this,this._onBeforeFocusOut),this._onBeforePasteHandler=$CD(this,this._onBeforePaste),this._onPasteHandler=$CD(this,this._onPaste);var t=n(this.elt),i=n(this._editor);t.on("keyup",this._onSelChangeHandler);t.on("beforedeactivate",this._onBeforeDeactivateHandler);i.on("beforepaste",this._onBeforePasteHandler);i.on("paste",this._onPasteHandler)},onViewInitialization:function(){this._isPageVisible=!0,this._initPlaceholder(),this._onViewInitializationImpl()},_onViewInitializationImpl:function(){},_onBeforeFocusOut:function(){this._lastGoodSelection=this._getCurrentRange()},_onBeforePaste:function(n){n.returnValue=!1},_onPaste:function(n){this.getMode()!==r.RichText&&(n.returnValue=!1,this.setSelection(clipboardData.getData("Text")))},_fireOnReady:function(){this.elt.setAttribute("ready","1");var n=this;setTimeout(function(){n._rteReadyDeferred.resolve([n])},100)},_alertConversionError:function(){alert(y("RTE.Editor.ConversionError"))},_updateRTEEditor:function(f,o){var v,s,a,w,y;if(v=u.EmojiRenderer||u.ol.EmojiRenderer,f!==o){s=function(n){var t=this._document.getElementById(h),i=this._document.getElementById(l);t?(t.innerHTML=n(t),i.innerHTML=n(i)):this._editor.innerHTML=n(this._editor)},a="";switch(o){case r.RichText:if(f===r.PlainText)s.call(this,function(n){var r=i.ConvertToPlainText(n,!0);return t.isEmojiEnabled()&&v&&(r=v.RenderEmoji(t.getImageServerPath(),r)),r});else try{s.call(this,function(n){return n.innerText})}catch(b){this._alertConversionError();return}a=e[r.RichText];break;case r.HTML:try{w=function(n){return p(n.innerHTML)},s.call(this,w),y=this._document.getElementById(c),y&&(y.innerHTML=w(y))}catch(b){this._alertConversionError();return}a=e[r.HTML];break;case r.PlainText:try{f===r.HTML&&s.call(this,function(t){return n(t).text()}),s.call(this,function(n){return t.isEmojiEnabled()&&v&&(n.innerHTML=v.ReverseRenderEmoji(n.innerHTML)),i.ConvertToPlainText(n,!0)})}catch(b){this._alertConversionError();return}a=e[r.PlainText];break;default:return}n(this._editor).removeClass(e.join(" ")),n(this._editor).addClass(a),this.elt.setAttribute("mode",a),this._mode=o,this._isRTEMode=o===r.RichText}},_isSwapping:!1,setMode:function(t){var r=this.getMode();this._isSwapping=!0,r!==t&&n(this).trigger(f.onbeforepropertychange,[this,{property:"mode",from:r,to:t}]),this._updateRTEEditor(r,t),i.Sync(this.elt),this._isSwapping=!1,r!==this.getMode()&&n(this).trigger(f.onpropertychange,[this,{property:"mode",from:r,to:t}]),this._lastGoodSelection=null},setRteToolbarDisplayMode:function(t){n(this).trigger(f.onpropertychange,[this,{property:"rtetoolbardisplay",display:t}])},getMode:function(){return this._mode},queryCommandValue:function(n,t){var i=null;try{i=this._document.queryCommandValue(t)}catch(r){}return i},queryCommandState:function(n,t){return this._document.queryCommandState(t)},queryCommandSupported:function(n,t){return this._document.queryCommandSupported(t)},execCommand:function(i,r,u){var e=!1,o=null;return this.queryCommandSupported(i,r)&&(i.collapsed||i.select(),t.commandNeedsToSaveFont[r]&&this.saveCurrentFont(i),this._document.execCommand(r,!1,u),o=this.queryCommandValue(i,r),t.commandNeedsToSaveFont[r]&&this.applySavedFont(i),e=!0),n(this).trigger(f.onexeccommand,[this,{range:i,command:r,value:u,handled:e,resultValue:o}]),e},attachRTEEvent:function(t,i){i._rteHandler=function(n){return i(n.originalEvent||n)},n(this._document).bind(t,i._rteHandler)},detachRTEEvent:function(t,i){i&&n(this._document).unbind(t,i._rteHandler)},enable:function(n){this._editor&&(this._editor.contentEditable=n)},getSelection:function(n){var t=this._getSelectionImpl();return n==="all"?(t.moveToElementText(this._getRTEElement()),t.parentElement()):t},_lastGoodSelection:null,_getSelectionImpl:function(){var n=this._getCurrentRange();if(!this._isRangeWithinRTE(n)){if(!this._lastGoodSelection){try{n.moveToElementText(this._editor)}catch(t){n=this._editor.createTextRange()}n.collapse(!0),this._lastGoodSelection=n}return this._lastGoodSelection}return this._lastGoodSelection=n,n},_getCurrentRange:function(){var n;try{n=this._document.selection.createRange()}catch(t){n=this._editor.createTextRange(),n.collapse(!0)}return n},getCurrentSelectionType:function(){return this._document.selection.type},setSelection:function(t){var e,i,f,u;this._mode!==r.PlainText&&(e="_newContentId",t+="<span id='{0}'><\/span>".format(e)),i=this.getSelection();try{if(i.item){while(i.length>1)i.remove(i.item(0));f=n(i.item(0)),i.remove(i.item(0)),n(t).each(function(){var t=n(this);f.after(t),f=t}),i.add(f[0])}else this._isRTEMode?i.pasteHTML(t):i.text=t;u=null,this._mode!==r.PlainText&&(u=this._document.getElementById(e),i.moveToElementText(u)),i.select(),n(u).remove()}catch(o){return}},_isRangeWithinRTE:function(n){try{var t=n.commonParentElement?n.commonParentElement():n.parentElement();return this._editor.contains(t)||this._editor===t}catch(i){return!1}},_detectSelectionChange:function(){var t=null;try{t=this._document.selection.createRange()}catch(i){return}t.length||n(this).trigger(f.onselectionchange,[this,{range:t}]).trigger(f.ontextchange,[this,{}])},getValue:function(){var n=this._isRTEMode?this._editor.innerHTML:i.ConvertToPlainText(this._editor,!1,!0);return i.Sync(this.elt),n},setValue:function(n){this._mode===r.RichText||this._mode===r.PlainText?($B.IE&&$B.V<=9&&(n=n.replace(/&#13;&#10;/g,"<br/>")),this._editor.innerHTML=n):this._editor.innerHTML=t.HTMLEncode(n,!0),i.Sync(this.elt)},focus:function(){this._togglePlaceholder(!1),this._focusImpl()},_focusImpl:function(){var r,t,i,f,u;if(!this._frameReady){this._frameData.focus=!0;return}r=this._window,r&&r.document&&r.document.body&&v(r.document.body),$B.Firefox&&(t=this._document.getElementById("FontBreak"),t&&(i=this._document.selection.createRange(),f=t.parentElement,n(i.commonAncestorContainer).closest(f).length===0&&(u=f.lastChild,u===t?(i.setStartBefore(t),i.setEndBefore(t)):(i.setStartAfter(u),i.setEndAfter(u))))),this._isRTEMode&&this._detectSelectionChange()},insertContent:function(n){this.setSelection(n),this._togglePlaceholder(!1)},defaultFont:{},_savedFont:{},saveCurrentFont:function(n){for(var t in this.defaultFont)this._savedFont[t]=this.queryCommandState(n,t)||this.defaultFont[t]},applySavedFont:function(t){this.focus();for(var i in this.defaultFont)this._savedFont[i]&&(this._document.execCommand(i,!1,this._savedFont[i]),n(this).trigger(f.onexeccommand,[this,{range:t,command:i,value:this._savedFont[i],handled:!0}]))},_initPlaceholder:function(){if(this._isPageVisible&&!this._placeholderInitialized){var t=this._$placeholderDiv;t.length&&(n(this._window).bind("focus.rteph",$CD(this,function(){this._togglePlaceholder(!1)})).bind("blur.rteph",$CD(this,function(){this._togglePlaceholder(!0)})),t.bind("click.rteph",$CD(this,this.focus)),this._placeholderInitialized=!0,this._$placeholderDiv.toggle(this._placeholderShowOnInit))}},_disposePlaceholder:function(){this._placeholderInitialized&&(n(this._window).unbind(".rteph"),this._$placeholderDiv.unbind(".rteph"))},_togglePlaceholder:function(t){if(this._placeholderInitialized){if(t){var i=n(this._editor);t=!(i.text().trim()||i.find("IMG, LI").length>0)}this._$placeholderDiv.toggle(t)}else this._placeholderShowOnInit=t},isPlaceholderShown:function(){return this._placeholderInitialized&&this._$placeholderDiv.is(":visible")},getPlaceholder:function(){return this._$placeholderDiv}},t.commandNeedsToSaveFont={},t.ConvertLineBreaks=function(n,t){return n?t?n.replace(/(\r|&#13;)?(\n|&#10;)/g,"<br>"):n.replace(/<br>/gi,"\r\n"):""},t.HTMLEncode=function(n,i){if(n==null)return"";var r=n.encodeHtml();return t.ConvertLineBreaks(r,i)},t.getFontSizes=function(){return i.getConfig("FONT_SIZE")},t.getFontNames=function(){return i.getConfig("FONT_NAME")},t.getFontOrder=function(){return i.getConfig("FONT_ORDER")},t.getImageServerPath=function(){return i.getConfig("IMAGESERVER_PATH")},t.isEmojiEnabled=function(){return i.getConfig("EMOJI_ENABLED")},t.getSutraTags=function(){return i.getConfig("SUTRA")},t.createClass("RTE.Editor"),i._CODE_READY=!0}(window.originaljQuery||window.jQuery),function(n){function u(n){return'<a href="{0}" target="_blank" class="newlyinsertedlink">{1}<\/a>'.format(n.encodeHtml(),t.HTMLEncode(n))}var r=window;r.RTE=r.RTE||{};var i=r.RTE,f=i.Mode,t=i.Editor;i._CODE_READY=!1,$B.Safari&&(t.prototype._doInitImpl=function(){var i=window.getSelection(),t;""!=i&&i.collapse(this._editor,0),t=n(this._editor);t.on("keydown",this._onSelChangeHandler);this._onPasteHandler=$CD(this,this._onPaste);t.on("paste",this._onPasteHandler);this._document.execCommand("styleWithCSS",!1,!1),this._onNodeInsertedHandler=$CD(this,this._onNodeInserted);t.on("DOMNodeInserted",this._onNodeInsertedHandler);t.on("DOMAttrModified",this._onNodeInsertedHandler)},t.prototype._onPaste=function(t){var i=t.originalEvent&&t.originalEvent.clipboardData,l,r,e,o,h,c,s,f;if(i){if(l=/(^(www\.|mailto\:|(news|(ht|f)tp(s?))\:\/\/){1}\S+)/,r=i.getData("text/plain"),!r)if(e=i.types,e)for(o=0;o<e.length;){if(h=i.getData(e[o]),h){r=h;break}o++}else r=i.getData("text/uri-list")?i.getData("text/uri-list"):i.getData("text/html");r&&l.test(r)&&(t.preventDefault(),c=this._document.selection.createRange(),this.saveCurrentFont(c),this.insertContent(u(r)),s=n(c.commonAncestorContainer.ownerDocument.body).find(".newlyinsertedlink"),s.removeClass("newlyinsertedlink"),f=this._document.selection.createRange(),f.selectNode(s[0]),this.applySavedFont(f),f.setStartAfter(s[0]),f.collapse(!0),f.select())}},t.prototype._onNodeInserted=function(r){var e=r.srcElement,f,u;if("SPAN"==e.tagName){if(fontSize=e.style.fontSize,null==fontSize||""==fontSize||fontSize.indexOf("pt")>=0||fontSize.indexOf("px")>=0)return;f=t.getFontSizes(),u=i.getConfig("DEFAULT_FONT_SIZE");switch(fontSize){case"x-small":u=f[0];break;case"small":u=f[1];break;case"medium":u=f[2];break;case"large":u=f[3];break;case"x-large":u=f[4];break;case"xx-large":u=f[5];break;case"-webkit-xxx-large":u=f[6]}e.style.fontSize=u}else $B.rtl&&"BLOCKQUOTE"===e.tagName&&n(e).removeAttr("style")},t.commandNeedsToSaveFont={inserthorizontalrule:!0}),$B.Firefox&&(t.prototype._doInitImpl=function(){this._onNodeInsertedHandler=$CD(this,this._onNodeInserted);var t=n(this._editor);t.on("DOMNodeInserted",this._onNodeInsertedHandler);t.on("DOMAttrModified",this._onNodeInsertedHandler);this._keyDownHandler=$CD(this,this._rte_onKeyDown);t.on("keydown",this._keyDownHandler);this._isPageVisible&&this._document.execCommand("styleWithCSS",!1,!1)},t.prototype._onViewInitializationImpl=function(){this._document.execCommand("styleWithCSS",!1,!1)},t.prototype._rte_onKeyDown=function(t){var o,w,y,h,l;if(t.keyCode===9||t.keyCode===13||t.keyCode===32){var r=this._document.selection.createRange(),i=r.startContainer.nodeValue,e=r.startContainer.parentNode.innerHTML,a=r.endOffset;if((!i||i.trim().length<=0)&&(r.startContainer.wholeText?i=r.startContainer.wholeText:(i=r.startContainer.innerText,e=r.startContainer.innerHTML),a=i?i.length-1:0),i){i=i.trim();var p=/(^(www\.|mailto\:|(news|(ht|f)tp(s?))\:\/\/){1}\S+)/,s=0,v=a,c;if(i.indexOf(" ")<0)c=i,s=0;else{for(o=a;o>=0;--o)if(/[\s,;]/.test(i.charAt(o))){if(p.test(i.substring(o+1,v))){s=o+1;break}v=o>0?o:0}c=i.substring(s<0?0:s,v)}p.test(c)&&(w=u(c),y=i.substring(0,s)+w+i.substring(s+c.length,i.length),this.getMode()===f.RichText&&(r.commonAncestorContainer.nodeName==="#text"||r.commonAncestorContainer.nodeName==="BODY")&&(e.indexOf("&amp;")>=0&&(e=e.replace(/&amp;/g,"&")),e.indexOf(i)>=0&&e.indexOf(i)==e.lastIndexOf(i)&&(r.startContainer.innerText?r.startContainer.innerHTML=e.replace(i,y):r.startContainer.parentNode.innerHTML=e.replace(i,y)))),h=n(r.parentElement()).find(".newlyinsertedlink"),h&&h.length>0&&(h.removeClass("newlyinsertedlink"),l=this._document.selection.createRange(),l.selectNode(h[0]),l.setStartAfter(h[0]),l.collapse(!0))}}},t.prototype._getSelectionImpl=function(){return this._document.selection.createRange()},t.prototype.queryCommandValue=function(n,t){return n.queryCommandValue(t)},t.prototype.queryCommandState=function(n,t){return n.queryCommandState(t)},t.prototype.queryCommandSupported=function(n,t){return n.queryCommandSupported(t)},t.prototype._onNodeInserted=function(n){var i=n.srcElement,r;i.tagName=="FONT"&&(r=i.getAttribute("size"),i.style.fontSize=t.getFontSizes()[r-1])},t.ConvertLineBreaks=function(n,t){return n?t?n.replace(/(\r|&#13;)?(\n|&#10;)/g,"<br>"):n:""},t.HTMLEncode=function(n,i){var r="";return n!=null&&(r=n.encodeHtml(),r=t.ConvertLineBreaks(r,i)),r},t.commandNeedsToSaveFont={inserthorizontalrule:!0}),i._CODE_READY=!0}(window.originaljQuery||window.jQuery)